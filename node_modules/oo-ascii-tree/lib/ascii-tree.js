"use strict";
/**
 * A tree of nodes that can be ASCII visualized.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.AsciiTree = void 0;
class AsciiTree {
    /**
     * Creates a node.
     * @param text The node's text content
     * @param children Children of this node (can also be added via "add")
     */
    constructor(text, ...children) {
        this.text = text;
        this._children = new Array();
        for (const child of children) {
            this.add(child);
        }
    }
    /**
     * Prints the tree to an output stream.
     */
    printTree(output = process.stdout) {
        let ancestorsPrefix = '';
        for (const parent of this.ancestors) {
            // -1 represents a "hidden" root, and so it's children
            // will all appear as roots (level 0).
            if (parent.level <= 0) {
                continue;
            }
            if (parent.last) {
                ancestorsPrefix += '  ';
            }
            else {
                ancestorsPrefix += ' │';
            }
        }
        let myPrefix = '';
        let multilinePrefix = '';
        if (this.level > 0) {
            if (this.last) {
                if (!this.empty) {
                    myPrefix += ' └─┬ ';
                    multilinePrefix += ' └─┬ ';
                }
                else {
                    myPrefix += ' └── ';
                    multilinePrefix = '     ';
                }
            }
            else {
                if (!this.empty) {
                    myPrefix += ' ├─┬ ';
                    multilinePrefix += ' │ │ ';
                }
                else {
                    myPrefix += ' ├── ';
                    multilinePrefix += ' │   ';
                }
            }
        }
        if (this.text) {
            output.write(ancestorsPrefix);
            output.write(myPrefix);
            const lines = this.text.split('\n');
            output.write(lines[0]);
            output.write('\n');
            for (const line of lines.splice(1)) {
                output.write(ancestorsPrefix);
                output.write(multilinePrefix);
                output.write(line);
                output.write('\n');
            }
        }
        for (const child of this._children) {
            child.printTree(output);
        }
    }
    /**
     * Returns a string representation of the tree.
     */
    toString() {
        let out = '';
        const printer = {
            write: (data) => {
                out += data;
                return true;
            },
        };
        this.printTree(printer);
        return out;
    }
    /**
     * Adds children to the node.
     */
    add(...children) {
        for (const child of children) {
            child.parent = this;
            this._children.push(child);
        }
    }
    /**
     * Returns a copy of the children array.
     */
    get children() {
        return this._children.map((x) => x);
    }
    /**
     * @returns true if this is the root node
     */
    get root() {
        return !this.parent;
    }
    /**
     * @returns true if this is the last child
     */
    get last() {
        if (!this.parent) {
            return true;
        }
        return (this.parent.children.indexOf(this) === this.parent.children.length - 1);
    }
    /**
     * @returns the node level (0 is the root node)
     */
    get level() {
        if (!this.parent) {
            // if the root node does not have text, it will be considered level -1
            // so that all it's children will be roots.
            return this.text ? 0 : -1;
        }
        return this.parent.level + 1;
    }
    /**
     * @returns true if this node does not have any children
     */
    get empty() {
        return this.children.length === 0;
    }
    /**
     * @returns an array of parent nodes (from the root to this node, exclusive)
     */
    get ancestors() {
        if (!this.parent) {
            return [];
        }
        return [...this.parent.ancestors, this.parent];
    }
}
exports.AsciiTree = AsciiTree;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNjaWktdHJlZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImFzY2lpLXRyZWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOzs7QUFFSCxNQUFhLFNBQVM7SUFRcEI7Ozs7T0FJRztJQUNILFlBQW1DLElBQWEsRUFBRSxHQUFHLFFBQXFCO1FBQXZDLFNBQUksR0FBSixJQUFJLENBQVM7UUFQL0IsY0FBUyxHQUFHLElBQUksS0FBSyxFQUFhLENBQUM7UUFRbEQsS0FBSyxNQUFNLEtBQUssSUFBSSxRQUFRLEVBQUU7WUFDNUIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUNqQjtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNJLFNBQVMsQ0FBQyxTQUFrQixPQUFPLENBQUMsTUFBTTtRQUMvQyxJQUFJLGVBQWUsR0FBRyxFQUFFLENBQUM7UUFFekIsS0FBSyxNQUFNLE1BQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ25DLHNEQUFzRDtZQUN0RCxzQ0FBc0M7WUFDdEMsSUFBSSxNQUFNLENBQUMsS0FBSyxJQUFJLENBQUMsRUFBRTtnQkFDckIsU0FBUzthQUNWO1lBRUQsSUFBSSxNQUFNLENBQUMsSUFBSSxFQUFFO2dCQUNmLGVBQWUsSUFBSSxJQUFJLENBQUM7YUFDekI7aUJBQU07Z0JBQ0wsZUFBZSxJQUFJLElBQUksQ0FBQzthQUN6QjtTQUNGO1FBRUQsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ2xCLElBQUksZUFBZSxHQUFHLEVBQUUsQ0FBQztRQUN6QixJQUFJLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFO1lBQ2xCLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtnQkFDYixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRTtvQkFDZixRQUFRLElBQUksT0FBTyxDQUFDO29CQUNwQixlQUFlLElBQUksT0FBTyxDQUFDO2lCQUM1QjtxQkFBTTtvQkFDTCxRQUFRLElBQUksT0FB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QUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDM0I7UUFFRCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztJQUMvQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFXLEtBQUs7UUFDZCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFXLFNBQVM7UUFDbEIsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDaEIsT0FBTyxFQUFFLENBQUM7U0FDWDtRQUVELE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqRCxDQUFDO0NBQ0Y7QUFsS0QsOEJBa0tDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBIHRyZWUgb2Ygbm9kZXMgdGhhdCBjYW4gYmUgQVNDSUkgdmlzdWFsaXplZC5cbiAqL1xuXG5leHBvcnQgY2xhc3MgQXNjaWlUcmVlIHtcbiAgLyoqXG4gICAqIFRoZSBwYXJlbnQgbm9kZS5cbiAgICovXG4gIHB1YmxpYyBwYXJlbnQ/OiBBc2NpaVRyZWU7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBfY2hpbGRyZW4gPSBuZXcgQXJyYXk8QXNjaWlUcmVlPigpO1xuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbm9kZS5cbiAgICogQHBhcmFtIHRleHQgVGhlIG5vZGUncyB0ZXh0IGNvbnRlbnRcbiAgICogQHBhcmFtIGNoaWxkcmVuIENoaWxkcmVuIG9mIHRoaXMgbm9kZSAoY2FuIGFsc28gYmUgYWRkZWQgdmlhIFwiYWRkXCIpXG4gICAqL1xuICBwdWJsaWMgY29uc3RydWN0b3IocHVibGljIHJlYWRvbmx5IHRleHQ/OiBzdHJpbmcsIC4uLmNoaWxkcmVuOiBBc2NpaVRyZWVbXSkge1xuICAgIGZvciAoY29uc3QgY2hpbGQgb2YgY2hpbGRyZW4pIHtcbiAgICAgIHRoaXMuYWRkKGNoaWxkKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUHJpbnRzIHRoZSB0cmVlIHRvIGFuIG91dHB1dCBzdHJlYW0uXG4gICAqL1xuICBwdWJsaWMgcHJpbnRUcmVlKG91dHB1dDogUHJpbnRlciA9IHByb2Nlc3Muc3Rkb3V0KSB7XG4gICAgbGV0IGFuY2VzdG9yc1ByZWZpeCA9ICcnO1xuXG4gICAgZm9yIChjb25zdCBwYXJlbnQgb2YgdGhpcy5hbmNlc3RvcnMpIHtcbiAgICAgIC8vIC0xIHJlcHJlc2VudHMgYSBcImhpZGRlblwiIHJvb3QsIGFuZCBzbyBpdCdzIGNoaWxkcmVuXG4gICAgICAvLyB3aWxsIGFsbCBhcHBlYXIgYXMgcm9vdHMgKGxldmVsIDApLlxuICAgICAgaWYgKHBhcmVudC5sZXZlbCA8PSAwKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAocGFyZW50Lmxhc3QpIHtcbiAgICAgICAgYW5jZXN0b3JzUHJlZml4ICs9ICcgICc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhbmNlc3RvcnNQcmVmaXggKz0gJyDilIInO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxldCBteVByZWZpeCA9ICcnO1xuICAgIGxldCBtdWx0aWxpbmVQcmVmaXggPSAnJztcbiAgICBpZiAodGhpcy5sZXZlbCA+IDApIHtcbiAgICAgIGlmICh0aGlzLmxhc3QpIHtcbiAgICAgICAgaWYgKCF0aGlzLmVtcHR5KSB7XG4gICAgICAgICAgbXlQcmVmaXggKz0gJyDilJTilIDilKwgJztcbiAgICAgICAgICBtdWx0aWxpbmVQcmVmaXggKz0gJyDilJTilIDilKwgJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBteVByZWZpeCArPSAnIOKUlOKUgOKUgCAnO1xuICAgICAgICAgIG11bHRpbGluZVByZWZpeCA9ICcgICAgICc7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICghdGhpcy5lbXB0eSkge1xuICAgICAgICAgIG15UHJlZml4ICs9ICcg4pSc4pSA4pSsICc7XG4gICAgICAgICAgbXVsdGlsaW5lUHJlZml4ICs9ICcg4pSCIOKUgiAnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG15UHJlZml4ICs9ICcg4pSc4pSA4pSAICc7XG4gICAgICAgICAgbXVsdGlsaW5lUHJlZml4ICs9ICcg4pSCICAgJztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLnRleHQpIHtcbiAgICAgIG91dHB1dC53cml0ZShhbmNlc3RvcnNQcmVmaXgpO1xuICAgICAgb3V0cHV0LndyaXRlKG15UHJlZml4KTtcbiAgICAgIGNvbnN0IGxpbmVzID0gdGhpcy50ZXh0LnNwbGl0KCdcXG4nKTtcbiAgICAgIG91dHB1dC53cml0ZShsaW5lc1swXSk7XG4gICAgICBvdXRwdXQud3JpdGUoJ1xcbicpO1xuXG4gICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMuc3BsaWNlKDEpKSB7XG4gICAgICAgIG91dHB1dC53cml0ZShhbmNlc3RvcnNQcmVmaXgpO1xuICAgICAgICBvdXRwdXQud3JpdGUobXVsdGlsaW5lUHJlZml4KTtcbiAgICAgICAgb3V0cHV0LndyaXRlKGxpbmUpO1xuICAgICAgICBvdXRwdXQud3JpdGUoJ1xcbicpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpcy5fY2hpbGRyZW4pIHtcbiAgICAgIGNoaWxkLnByaW50VHJlZShvdXRwdXQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSB0cmVlLlxuICAgKi9cbiAgcHVibGljIHRvU3RyaW5nKCkge1xuICAgIGxldCBvdXQgPSAnJztcbiAgICBjb25zdCBwcmludGVyOiBQcmludGVyID0ge1xuICAgICAgd3JpdGU6IChkYXRhOiBVaW50OEFycmF5IHwgc3RyaW5nKSA9PiB7XG4gICAgICAgIG91dCArPSBkYXRhO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0sXG4gICAgfTtcbiAgICB0aGlzLnByaW50VHJlZShwcmludGVyKTtcbiAgICByZXR1cm4gb3V0O1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgY2hpbGRyZW4gdG8gdGhlIG5vZGUuXG4gICAqL1xuICBwdWJsaWMgYWRkKC4uLmNoaWxkcmVuOiBBc2NpaVRyZWVbXSkge1xuICAgIGZvciAoY29uc3QgY2hpbGQgb2YgY2hpbGRyZW4pIHtcbiAgICAgIGNoaWxkLnBhcmVudCA9IHRoaXM7XG4gICAgICB0aGlzLl9jaGlsZHJlbi5wdXNoKGNoaWxkKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIGNvcHkgb2YgdGhlIGNoaWxkcmVuIGFycmF5LlxuICAgKi9cbiAgcHVibGljIGdldCBjaGlsZHJlbigpIHtcbiAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW4ubWFwKCh4KSA9PiB4KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJucyB0cnVlIGlmIHRoaXMgaXMgdGhlIHJvb3Qgbm9kZVxuICAgKi9cbiAgcHVibGljIGdldCByb290KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy5wYXJlbnQ7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGlzIGlzIHRoZSBsYXN0IGNoaWxkXG4gICAqL1xuICBwdWJsaWMgZ2V0IGxhc3QoKTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLnBhcmVudCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICB0aGlzLnBhcmVudC5jaGlsZHJlbi5pbmRleE9mKHRoaXMpID09PSB0aGlzLnBhcmVudC5jaGlsZHJlbi5sZW5ndGggLSAxXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJucyB0aGUgbm9kZSBsZXZlbCAoMCBpcyB0aGUgcm9vdCBub2RlKVxuICAgKi9cbiAgcHVibGljIGdldCBsZXZlbCgpOiBudW1iZXIge1xuICAgIGlmICghdGhpcy5wYXJlbnQpIHtcbiAgICAgIC8vIGlmIHRoZSByb290IG5vZGUgZG9lcyBub3QgaGF2ZSB0ZXh0LCBpdCB3aWxsIGJlIGNvbnNpZGVyZWQgbGV2ZWwgLTFcbiAgICAgIC8vIHNvIHRoYXQgYWxsIGl0J3MgY2hpbGRyZW4gd2lsbCBiZSByb290cy5cbiAgICAgIHJldHVybiB0aGlzLnRleHQgPyAwIDogLTE7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMucGFyZW50LmxldmVsICsgMTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJucyB0cnVlIGlmIHRoaXMgbm9kZSBkb2VzIG5vdCBoYXZlIGFueSBjaGlsZHJlblxuICAgKi9cbiAgcHVibGljIGdldCBlbXB0eSgpIHtcbiAgICByZXR1cm4gdGhpcy5jaGlsZHJlbi5sZW5ndGggPT09IDA7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybnMgYW4gYXJyYXkgb2YgcGFyZW50IG5vZGVzIChmcm9tIHRoZSByb290IHRvIHRoaXMgbm9kZSwgZXhjbHVzaXZlKVxuICAgKi9cbiAgcHVibGljIGdldCBhbmNlc3RvcnMoKTogQXNjaWlUcmVlW10ge1xuICAgIGlmICghdGhpcy5wYXJlbnQpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICByZXR1cm4gWy4uLnRoaXMucGFyZW50LmFuY2VzdG9ycywgdGhpcy5wYXJlbnRdO1xuICB9XG59XG5cbmV4cG9ydCB0eXBlIFByaW50ZXIgPSBQaWNrPE5vZGVKUy5Xcml0YWJsZVN0cmVhbSwgJ3dyaXRlJz47XG4iXX0=