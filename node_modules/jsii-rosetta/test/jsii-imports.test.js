"use strict";
// Test translation of imports with actual jsii assemblies
//
// - For Python, there is a lot of variation in what imports get translated to (mirroring
//   the style in TypeScript, occasionally adding extra imports as required).
// - For other languages, we'll mostly translate the same thing.
Object.defineProperty(exports, "__esModule", { value: true });
const lib_1 = require("../lib");
const testutil_1 = require("./testutil");
describe('no submodule', () => {
    describe('top-level struct', () => {
        let module;
        beforeAll(async () => {
            module = await makeJsiiModule({ withModule: false, nestedStruct: false });
        });
        afterAll(() => module.cleanup());
        describe('package import', () => {
            let trans;
            beforeAll(() => {
                trans = module.translateHere(`
            import * as masm from 'my_assembly';
            const obj = new masm.MyClass('value', {
              myStruct: {
                value: 'v',
              },
            });
          `);
            });
            test('to Python', () => {
                expectTranslation(trans, lib_1.TargetLanguage.PYTHON, [
                    'import example_test_demo as masm',
                    'obj = masm.MyClass("value",',
                    '    my_struct=masm.MyStruct(',
                    '        value="v"',
                    '    )',
                    ')',
                ]);
            });
            test('to Java', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.JAVA, [
                    'import example.test.demo.*;',
                    ...DEFAULT_JAVA_CODE,
                ]);
            });
            test('to C#', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.CSHARP, [
                    'using Example.Test.Demo;',
                    ...DEFAULT_CSHARP_CODE,
                ]);
            });
        });
        describe('class import', () => {
            let trans;
            beforeAll(() => {
                trans = module.translateHere(`import { MyClass } from 'my_assembly';
            const obj = new MyClass('value', {
              myStruct: {
                value: 'v',
              },
            });
          `);
            });
            test('to Python', () => {
                expectTranslation(trans, lib_1.TargetLanguage.PYTHON, [
                    'from example_test_demo import MyStruct',
                    'from example_test_demo import MyClass',
                    'obj = MyClass("value",',
                    '    my_struct=MyStruct(',
                    '        value="v"',
                    '    )',
                    ')',
                ]);
            });
            test('to Java', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.JAVA, [
                    'import example.test.demo.MyClass;',
                    ...DEFAULT_JAVA_CODE,
                ]);
            });
            test('to C#', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.CSHARP, [
                    'using Example.Test.Demo;',
                    ...DEFAULT_CSHARP_CODE,
                ]);
            });
        });
    });
    describe('nested struct', () => {
        let module;
        beforeAll(async () => {
            module = await makeJsiiModule({ withModule: false, nestedStruct: true });
        });
        afterAll(() => module.cleanup());
        describe('package import', () => {
            let trans;
            beforeAll(() => {
                trans = module.translateHere(`
            import * as masm from 'my_assembly';
            const obj = new masm.MyClass('value', {
              myStruct: {
                value: 'v',
              },
            });
          `);
            });
            test('to Python', () => {
                expectTranslation(trans, lib_1.TargetLanguage.PYTHON, [
                    'import example_test_demo as masm',
                    'obj = masm.MyClass("value",',
                    '    my_struct=masm.MyClass.MyStruct(',
                    '        value="v"',
                    '    )',
                    ')',
                ]);
            });
            test('to Java', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.JAVA, [
                    'import example.test.demo.*;',
                    ...DEFAULT_JAVA_CODE,
                ]);
            });
            test('to C#', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.CSHARP, [
                    'using Example.Test.Demo;',
                    ...DEFAULT_CSHARP_CODE,
                ]);
            });
        });
        describe('class import', () => {
            let trans;
            beforeAll(() => {
                trans = module.translateHere(`
            import { MyClass } from 'my_assembly';
            const obj = new MyClass('value', {
              myStruct: {
                value: 'v',
              },
            });
          `);
            });
            test('to Python', () => {
                expectTranslation(trans, lib_1.TargetLanguage.PYTHON, [
                    'from example_test_demo import MyClass',
                    'obj = MyClass("value",',
                    '    my_struct=MyClass.MyStruct(',
                    '        value="v"',
                    '    )',
                    ')',
                ]);
            });
            test('to Java', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.JAVA, [
                    'import example.test.demo.MyClass;',
                    ...DEFAULT_JAVA_CODE,
                ]);
            });
            test('to C#', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.CSHARP, [
                    'using Example.Test.Demo;',
                    ...DEFAULT_CSHARP_CODE,
                ]);
            });
        });
    });
    describe('enum', () => {
        let module;
        beforeAll(async () => {
            module = await testutil_1.TestJsiiModule.fromSource({
                'index.ts': `export enum MyEnum { OPTION_A = 'a', OPTION_B = 'b' }

          export interface MyProps { readonly prop: MyEnum }

          export function myFun(props: MyProps) {
            Array.isArray(props);
          }
          `,
            }, {
                name: 'my_assembly',
                jsii: testutil_1.DUMMY_JSII_CONFIG,
            });
        });
        afterAll(() => module.cleanup());
        describe('package import', () => {
            let trans;
            beforeAll(() => {
                trans = module.translateHere(`
            import * as masm from 'my_assembly';
            const x = masm.MyEnum.OPTION_A;
          `);
            });
            test('to Python', () => {
                expectTranslation(trans, lib_1.TargetLanguage.PYTHON, [
                    'import example_test_demo as masm',
                    'x = masm.MyEnum.OPTION_A',
                ]);
            });
            test('to Java', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.JAVA, [
                    'import example.test.demo.*;',
                    'MyEnum x = MyEnum.OPTION_A;',
                ]);
            });
            test('to C#', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.CSHARP, [
                    'using Example.Test.Demo;',
                    'MyEnum x = MyEnum.OPTION_A;',
                ]);
            });
        });
        describe('direct import', () => {
            let trans;
            beforeAll(() => {
                trans = module.translateHere(`import { MyEnum } from 'my_assembly';
          const x = MyEnum.OPTION_A;
          `);
            });
            test('to Python', () => {
                expectTranslation(trans, lib_1.TargetLanguage.PYTHON, [
                    'from example_test_demo import MyEnum',
                    'x = MyEnum.OPTION_A',
                ]);
            });
            test('to Java', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.JAVA, [
                    'import example.test.demo.MyEnum;',
                    'MyEnum x = MyEnum.OPTION_A;',
                ]);
            });
            test('to C#', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.CSHARP, [
                    'using Example.Test.Demo;',
                    'MyEnum x = MyEnum.OPTION_A;',
                ]);
            });
        });
        describe('implicit import', () => {
            let trans;
            beforeAll(() => {
                trans = module.translateHere(`import * as masm from 'my_assembly';
          masm.myFun({ prop: masm.MyEnum.OPTION_A });
          `);
            });
            test('to Python', () => {
                expectTranslation(trans, lib_1.TargetLanguage.PYTHON, [
                    'import example_test_demo as masm',
                    'masm.my_fun(prop=masm.MyEnum.OPTION_A)',
                ]);
            });
            test('to Java', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.JAVA, [
                    'import example.test.demo.*;',
                    'myFun(MyProps.builder().prop(MyEnum.OPTION_A).build());',
                ]);
            });
            test('to C#', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.CSHARP, [
                    'using Example.Test.Demo;',
                    'MyFun(new MyProps { Prop = MyEnum.OPTION_A });',
                ]);
            });
        });
    });
});
describe('with submodule', () => {
    describe('top-level struct', () => {
        let module;
        beforeAll(async () => {
            module = await makeJsiiModule({ withModule: true, nestedStruct: false });
        });
        afterAll(() => module.cleanup());
        describe('namespace import', () => {
            let trans;
            beforeAll(() => {
                trans = module.translateHere(`
            import { submod as mod } from 'my_assembly';
            const obj = new mod.MyClass('value', {
              myStruct: {
                value: 'v',
              },
            });
          `);
            });
            test('to Python', () => {
                expectTranslation(trans, lib_1.TargetLanguage.PYTHON, [
                    'from example_test_demo import boop as mod',
                    'obj = mod.MyClass("value",',
                    '    my_struct=mod.MyStruct(',
                    '        value="v"',
                    '    )',
                    ')',
                ]);
            });
            test('to Java', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.JAVA, [
                    'import example.test.demo.boop.*;',
                    ...DEFAULT_JAVA_CODE,
                ]);
            });
            test('to C#', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.CSHARP, [
                    'using Example.Test.Demo.Boop;',
                    ...DEFAULT_CSHARP_CODE,
                ]);
            });
        });
    });
    describe('nested struct', () => {
        let module;
        beforeAll(async () => {
            module = await makeJsiiModule({ withModule: true, nestedStruct: true });
        });
        afterAll(() => module.cleanup());
        describe('namespace import', () => {
            let trans;
            beforeAll(() => {
                trans = module.translateHere(`
            import { submod as mod } from 'my_assembly';
            const obj = new mod.MyClass('value', {
              myStruct: {
                value: 'v',
              },
            });
          `);
            });
            test('to Python', () => {
                expectTranslation(trans, lib_1.TargetLanguage.PYTHON, [
                    'from example_test_demo import boop as mod',
                    'obj = mod.MyClass("value",',
                    '    my_struct=mod.MyClass.MyStruct(',
                    '        value="v"',
                    '    )',
                    ')',
                ]);
            });
            test('to Java', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.JAVA, [
                    'import example.test.demo.boop.*;',
                    ...DEFAULT_JAVA_CODE,
                ]);
            });
            test('to C#', () => {
                // eslint-disable-next-line prettier/prettier
                expectTranslation(trans, lib_1.TargetLanguage.CSHARP, [
                    'using Example.Test.Demo.Boop;',
                    ...DEFAULT_CSHARP_CODE,
                ]);
            });
        });
    });
});
async function makeJsiiModule(options) {
    const nsRef = options.nestedStruct ? 'MyClass.' : '';
    const nsDeclBegin = options.nestedStruct ? 'export namespace MyClass {\n' : '';
    const nsDeclEnd = options.nestedStruct ? '}' : '';
    const payload = `
    export class MyClass {
      constructor(value: string, props: ${nsRef}MyClassProps) {
        Array.isArray(value);
        Array.isArray(props);
      }
    }

    ${nsDeclBegin}
    export interface MyClassProps {
      readonly myStruct: MyStruct;
    }

    export interface MyStruct {
      readonly value: string;
    }
    ${nsDeclEnd}
    `;
    const source = options.withModule
        ? {
            'index.ts': 'export * as submod from "./submodule/module";',
            'submodule/module.ts': payload,
            'submodule/.jsiirc.json': JSON.stringify({
                targets: {
                    python: {
                        module: 'example_test_demo.boop',
                    },
                    java: {
                        package: 'example.test.demo.boop',
                    },
                    dotnet: {
                        namespace: 'Example.Test.Demo.Boop',
                    },
                },
            }),
        }
        : {
            'index.ts': payload,
        };
    return testutil_1.TestJsiiModule.fromSource(source, {
        name: 'my_assembly',
        jsii: testutil_1.DUMMY_JSII_CONFIG,
    });
}
// The implementation part of the Java code is always the same
const DEFAULT_JAVA_CODE = [
    'MyClass obj = MyClass.Builder.create("value")',
    '        .myStruct(MyStruct.builder()',
    '                .value("v")',
    '                .build())',
    '        .build();',
];
// The implementation part of the CSharp code is always the same
const DEFAULT_CSHARP_CODE = [
    'MyClass obj = new MyClass("value", new MyClassProps {',
    '    MyStruct = new MyStruct {',
    '        Value = "v"',
    '    }',
    '});',
];
/**
 * Verify the Java output. All expected Java outputs look the same.
 */
function expectTranslation(trans, lang, expected) {
    var _a;
    expect((_a = trans.get(lang)) === null || _a === void 0 ? void 0 : _a.source.split('\n')).toEqual(expected);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianNpaS1pbXBvcnRzLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJqc2lpLWltcG9ydHMudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsMERBQTBEO0FBQzFELEVBQUU7QUFDRix5RkFBeUY7QUFDekYsNkVBQTZFO0FBQzdFLGdFQUFnRTs7QUFFaEUsZ0NBQTJEO0FBQzNELHlDQUFnRjtBQUVoRixRQUFRLENBQUMsY0FBYyxFQUFFLEdBQUcsRUFBRTtJQUM1QixRQUFRLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO1FBQ2hDLElBQUksTUFBc0IsQ0FBQztRQUMzQixTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7WUFDbkIsTUFBTSxHQUFHLE1BQU0sY0FBYyxDQUFDLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUM1RSxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztRQUVqQyxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1lBQzlCLElBQUksS0FBd0IsQ0FBQztZQUM3QixTQUFTLENBQUMsR0FBRyxFQUFFO2dCQUNiLEtBQUssR0FBRyxNQUFNLENBQUMsYUFBYSxDQUFDOzs7Ozs7O1dBTzFCLENBQUMsQ0FBQztZQUNQLENBQUMsQ0FBQyxDQUFDO1lBRUgsSUFBSSxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUU7Z0JBQ3JCLGlCQUFpQixDQUFDLEtBQUssRUFBRSxvQkFBYyxDQUFDLE1BQU0sRUFBRTtvQkFDOUMsa0NBQWtDO29CQUNsQyw2QkFBNkI7b0JBQzdCLDhCQUE4QjtvQkFDOUIsbUJBQW1CO29CQUNuQixPQUFPO29CQUNQLEdBQUc7aUJBQ0osQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7WUFFSCxJQUFJLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRTtn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QWdFO0FBQ2hFLE1BQU0sbUJBQW1CLEdBQUc7SUFDMUIsdURBQXVEO0lBQ3ZELCtCQUErQjtJQUMvQixxQkFBcUI7SUFDckIsT0FBTztJQUNQLEtBQUs7Q0FDTixDQUFDO0FBRUY7O0dBRUc7QUFDSCxTQUFTLGlCQUFpQixDQUFDLEtBQXdCLEVBQUUsSUFBb0IsRUFBRSxRQUFrQjs7SUFDM0YsTUFBTSxPQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLDBDQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ2hFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUZXN0IHRyYW5zbGF0aW9uIG9mIGltcG9ydHMgd2l0aCBhY3R1YWwganNpaSBhc3NlbWJsaWVzXG4vL1xuLy8gLSBGb3IgUHl0aG9uLCB0aGVyZSBpcyBhIGxvdCBvZiB2YXJpYXRpb24gaW4gd2hhdCBpbXBvcnRzIGdldCB0cmFuc2xhdGVkIHRvIChtaXJyb3Jpbmdcbi8vICAgdGhlIHN0eWxlIGluIFR5cGVTY3JpcHQsIG9jY2FzaW9uYWxseSBhZGRpbmcgZXh0cmEgaW1wb3J0cyBhcyByZXF1aXJlZCkuXG4vLyAtIEZvciBvdGhlciBsYW5ndWFnZXMsIHdlJ2xsIG1vc3RseSB0cmFuc2xhdGUgdGhlIHNhbWUgdGhpbmcuXG5cbmltcG9ydCB7IFRhcmdldExhbmd1YWdlLCBUcmFuc2xhdGVkU25pcHBldCB9IGZyb20gJy4uL2xpYic7XG5pbXBvcnQgeyBNdWx0aXBsZVNvdXJjZXMsIFRlc3RKc2lpTW9kdWxlLCBEVU1NWV9KU0lJX0NPTkZJRyB9IGZyb20gJy4vdGVzdHV0aWwnO1xuXG5kZXNjcmliZSgnbm8gc3VibW9kdWxlJywgKCkgPT4ge1xuICBkZXNjcmliZSgndG9wLWxldmVsIHN0cnVjdCcsICgpID0+IHtcbiAgICBsZXQgbW9kdWxlOiBUZXN0SnNpaU1vZHVsZTtcbiAgICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgICAgbW9kdWxlID0gYXdhaXQgbWFrZUpzaWlNb2R1bGUoeyB3aXRoTW9kdWxlOiBmYWxzZSwgbmVzdGVkU3RydWN0OiBmYWxzZSB9KTtcbiAgICB9KTtcblxuICAgIGFmdGVyQWxsKCgpID0+IG1vZHVsZS5jbGVhbnVwKCkpO1xuXG4gICAgZGVzY3JpYmUoJ3BhY2thZ2UgaW1wb3J0JywgKCkgPT4ge1xuICAgICAgbGV0IHRyYW5zOiBUcmFuc2xhdGVkU25pcHBldDtcbiAgICAgIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgICAgIHRyYW5zID0gbW9kdWxlLnRyYW5zbGF0ZUhlcmUoYFxuICAgICAgICAgICAgaW1wb3J0ICogYXMgbWFzbSBmcm9tICdteV9hc3NlbWJseSc7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgbWFzbS5NeUNsYXNzKCd2YWx1ZScsIHtcbiAgICAgICAgICAgICAgbXlTdHJ1Y3Q6IHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogJ3YnLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgYCk7XG4gICAgICB9KTtcblxuICAgICAgdGVzdCgndG8gUHl0aG9uJywgKCkgPT4ge1xuICAgICAgICBleHBlY3RUcmFuc2xhdGlvbih0cmFucywgVGFyZ2V0TGFuZ3VhZ2UuUFlUSE9OLCBbXG4gICAgICAgICAgJ2ltcG9ydCBleGFtcGxlX3Rlc3RfZGVtbyBhcyBtYXNtJyxcbiAgICAgICAgICAnb2JqID0gbWFzbS5NeUNsYXNzKFwidmFsdWVcIiwnLFxuICAgICAgICAgICcgICAgbXlfc3RydWN0PW1hc20uTXlTdHJ1Y3QoJyxcbiAgICAgICAgICAnICAgICAgICB2YWx1ZT1cInZcIicsXG4gICAgICAgICAgJyAgICApJyxcbiAgICAgICAgICAnKScsXG4gICAgICAgIF0pO1xuICAgICAgfSk7XG5cbiAgICAgIHRlc3QoJ3RvIEphdmEnLCAoKSA9PiB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmV0dGllci9wcmV0dGllclxuICAgICAgICBleHBlY3RUcmFuc2xhdGlvbih0cmFucywgVGFyZ2V0TGFuZ3VhZ2UuSkFWQSwgW1xuICAgICAgICAgICdpbXBvcnQgZXhhbXBsZS50ZXN0LmRlbW8uKjsnLFxuICAgICAgICAgIC4uLkRFRkFVTFRfSkFWQV9DT0RFLFxuICAgICAgICBdKTtcbiAgICAgIH0pO1xuXG4gICAgICB0ZXN0KCd0byBDIycsICgpID0+IHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByZXR0aWVyL3ByZXR0aWVyXG4gICAgICAgIGV4cGVjdFRyYW5zbGF0aW9uKHRyYW5zLCBUYXJnZXRMYW5ndWFnZS5DU0hBUlAsIFtcbiAgICAgICAgICAndXNpbmcgRXhhbXBsZS5UZXN0LkRlbW87JyxcbiAgICAgICAgICAuLi5ERUZBVUxUX0NTSEFSUF9DT0RFLFxuICAgICAgICBdKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2NsYXNzIGltcG9ydCcsICgpID0+IHtcbiAgICAgIGxldCB0cmFuczogVHJhbnNsYXRlZFNuaXBwZXQ7XG4gICAgICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgICAgICB0cmFucyA9IG1vZHVsZS50cmFuc2xhdGVIZXJlKFxuICAgICAgICAgIGBpbXBvcnQgeyBNeUNsYXNzIH0gZnJvbSAnbXlfYXNzZW1ibHknO1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IE15Q2xhc3MoJ3ZhbHVlJywge1xuICAgICAgICAgICAgICBteVN0cnVjdDoge1xuICAgICAgICAgICAgICAgIHZhbHVlOiAndicsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICBgLFxuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIHRlc3QoJ3RvIFB5dGhvbicsICgpID0+IHtcbiAgICAgICAgZXhwZWN0VHJhbnNsYXRpb24odHJhbnMsIFRhcmdldExhbmd1YWdlLlBZVEhPTiwgW1xuICAgICAgICAgICdmcm9tIGV4YW1wbGVfdGVzdF9kZW1vIGltcG9ydCBNeVN0cnVjdCcsXG4gICAgICAgICAgJ2Zyb20gZXhhbXBsZV90ZXN0X2RlbW8gaW1wb3J0IE15Q2xhc3MnLFxuICAgICAgICAgICdvYmogPSBNeUNsYXNzKFwidmFsdWVcIiwnLFxuICAgICAgICAgICcgICAgbXlfc3RydWN0PU15U3RydWN0KCcsXG4gICAgICAgICAgJyAgICAgICAgdmFsdWU9XCJ2XCInLFxuICAgICAgICAgICcgICAgKScsXG4gICAgICAgICAgJyknLFxuICAgICAgICBdKTtcbiAgICAgIH0pO1xuXG4gICAgICB0ZXN0KCd0byBKYXZhJywgKCkgPT4ge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJldHRpZXIvcHJldHRpZXJcbiAgICAgICAgZXhwZWN0VHJhbnNsYXRpb24odHJhbnMsIFRhcmdldExhbmd1YWdlLkpBVkEsIFtcbiAgICAgICAgICAnaW1wb3J0IGV4YW1wbGUudGVzdC5kZW1vLk15Q2xhc3M7JyxcbiAgICAgICAgICAuLi5ERUZBVUxUX0pBVkFfQ09ERSxcbiAgICAgICAgXSk7XG4gICAgICB9KTtcblxuICAgICAgdGVzdCgndG8gQyMnLCAoKSA9PiB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmV0dGllci9wcmV0dGllclxuICAgICAgICBleHBlY3RUcmFuc2xhdGlvbih0cmFucywgVGFyZ2V0TGFuZ3VhZ2UuQ1NIQVJQLCBbXG4gICAgICAgICAgJ3VzaW5nIEV4YW1wbGUuVGVzdC5EZW1vOycsXG4gICAgICAgICAgLi4uREVGQVVMVF9DU0hBUlBfQ09ERSxcbiAgICAgICAgXSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ25lc3RlZCBzdHJ1Y3QnLCAoKSA9PiB7XG4gICAgbGV0IG1vZHVsZTogVGVzdEpzaWlNb2R1bGU7XG4gICAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICAgIG1vZHVsZSA9IGF3YWl0IG1ha2VKc2lpTW9kdWxlKHsgd2l0aE1vZHVsZTogZmFsc2UsIG5lc3RlZFN0cnVjdDogdHJ1ZSB9KTtcbiAgICB9KTtcbiAgICBhZnRlckFsbCgoKSA9PiBtb2R1bGUuY2xlYW51cCgpKTtcblxuICAgIGRlc2NyaWJlKCdwYWNrYWdlIGltcG9ydCcsICgpID0+IHtcbiAgICAgIGxldCB0cmFuczogVHJhbnNsYXRlZFNuaXBwZXQ7XG4gICAgICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgICAgICB0cmFucyA9IG1vZHVsZS50cmFuc2xhdGVIZXJlKGBcbiAgICAgICAgICAgIGltcG9ydCAqIGFzIG1hc20gZnJvbSAnbXlfYXNzZW1ibHknO1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gbmV3IG1hc20uTXlDbGFzcygndmFsdWUnLCB7XG4gICAgICAgICAgICAgIG15U3RydWN0OiB7XG4gICAgICAgICAgICAgICAgdmFsdWU6ICd2JyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIGApO1xuICAgICAgfSk7XG5cbiAgICAgIHRlc3QoJ3RvIFB5dGhvbicsICgpID0+IHtcbiAgICAgICAgZXhwZWN0VHJhbnNsYXRpb24odHJhbnMsIFRhcmdldExhbmd1YWdlLlBZVEhPTiwgW1xuICAgICAgICAgICdpbXBvcnQgZXhhbXBsZV90ZXN0X2RlbW8gYXMgbWFzbScsXG4gICAgICAgICAgJ29iaiA9IG1hc20uTXlDbGFzcyhcInZhbHVlXCIsJyxcbiAgICAgICAgICAnICAgIG15X3N0cnVjdD1tYXNtLk15Q2xhc3MuTXlTdHJ1Y3QoJyxcbiAgICAgICAgICAnICAgICAgICB2YWx1ZT1cInZcIicsXG4gICAgICAgICAgJyAgICApJyxcbiAgICAgICAgICAnKScsXG4gICAgICAgIF0pO1xuICAgICAgfSk7XG5cbiAgICAgIHRlc3QoJ3RvIEphdmEnLCAoKSA9PiB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmV0dGllci9wcmV0dGllclxuICAgICAgICBleHBlY3RUcmFuc2xhdGlvbih0cmFucywgVGFyZ2V0TGFuZ3VhZ2UuSkFWQSwgW1xuICAgICAgICAgICdpbXBvcnQgZXhhbXBsZS50ZXN0LmRlbW8uKjsnLFxuICAgICAgICAgIC4uLkRFRkFVTFRfSkFWQV9DT0RFLFxuICAgICAgICBdKTtcbiAgICAgIH0pO1xuXG4gICAgICB0ZXN0KCd0byBDIycsICgpID0+IHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByZXR0aWVyL3ByZXR0aWVyXG4gICAgICAgIGV4cGVjdFRyYW5zbGF0aW9uKHRyYW5zLCBUYXJnZXRMYW5ndWFnZS5DU0hBUlAsIFtcbiAgICAgICAgICAndXNpbmcgRXhhbXBsZS5UZXN0LkRlbW87JyxcbiAgICAgICAgICAuLi5ERUZBVUxUX0NTSEFSUF9DT0RFLFxuICAgICAgICBdKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2NsYXNzIGltcG9ydCcsICgpID0+IHtcbiAgICAgIGxldCB0cmFuczogVHJhbnNsYXRlZFNuaXBwZXQ7XG4gICAgICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgICAgICB0cmFucyA9IG1vZHVsZS50cmFuc2xhdGVIZXJlKGBcbiAgICAgICAgICAgIGltcG9ydCB7IE15Q2xhc3MgfSBmcm9tICdteV9hc3NlbWJseSc7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgTXlDbGFzcygndmFsdWUnLCB7XG4gICAgICAgICAgICAgIG15U3RydWN0OiB7XG4gICAgICAgICAgICAgICAgdmFsdWU6ICd2JyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIGApO1xuICAgICAgfSk7XG5cbiAgICAgIHRlc3QoJ3RvIFB5dGhvbicsICgpID0+IHtcbiAgICAgICAgZXhwZWN0VHJhbnNsYXRpb24odHJhbnMsIFRhcmdldExhbmd1YWdlLlBZVEhPTiwgW1xuICAgICAgICAgICdmcm9tIGV4YW1wbGVfdGVzdF9kZW1vIGltcG9ydCBNeUNsYXNzJyxcbiAgICAgICAgICAnb2JqID0gTXlDbGFzcyhcInZhbHVlXCIsJyxcbiAgICAgICAgICAnICAgIG15X3N0cnVjdD1NeUNsYXNzLk15U3RydWN0KCcsXG4gICAgICAgICAgJyAgICAgICAgdmFsdWU9XCJ2XCInLFxuICAgICAgICAgICcgICAgKScsXG4gICAgICAgICAgJyknLFxuICAgICAgICBdKTtcbiAgICAgIH0pO1xuXG4gICAgICB0ZXN0KCd0byBKYXZhJywgKCkgPT4ge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJldHRpZXIvcHJldHRpZXJcbiAgICAgICAgZXhwZWN0VHJhbnNsYXRpb24odHJhbnMsIFRhcmdldExhbmd1YWdlLkpBVkEsIFtcbiAgICAgICAgICAnaW1wb3J0IGV4YW1wbGUudGVzdC5kZW1vLk15Q2xhc3M7JyxcbiAgICAgICAgICAuLi5ERUZBVUxUX0pBVkFfQ09ERSxcbiAgICAgICAgXSk7XG4gICAgICB9KTtcblxuICAgICAgdGVzdCgndG8gQyMnLCAoKSA9PiB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmV0dGllci9wcmV0dGllclxuICAgICAgICBleHBlY3RUcmFuc2xhdGlvbih0cmFucywgVGFyZ2V0TGFuZ3VhZ2UuQ1NIQVJQLCBbXG4gICAgICAgICAgJ3VzaW5nIEV4YW1wbGUuVGVzdC5EZW1vOycsXG4gICAgICAgICAgLi4uREVGQVVMVF9DU0hBUlBfQ09ERSxcbiAgICAgICAgXSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2VudW0nLCAoKSA9PiB7XG4gICAgbGV0IG1vZHVsZTogVGVzdEpzaWlNb2R1bGU7XG4gICAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICAgIG1vZHVsZSA9IGF3YWl0IFRlc3RKc2lpTW9kdWxlLmZyb21Tb3VyY2UoXG4gICAgICAgIHtcbiAgICAgICAgICAnaW5kZXgudHMnOiBgZXhwb3J0IGVudW0gTXlFbnVtIHsgT1BUSU9OX0EgPSAnYScsIE9QVElPTl9CID0gJ2InIH1cblxuICAgICAgICAgIGV4cG9ydCBpbnRlcmZhY2UgTXlQcm9wcyB7IHJlYWRvbmx5IHByb3A6IE15RW51bSB9XG5cbiAgICAgICAgICBleHBvcnQgZnVuY3Rpb24gbXlGdW4ocHJvcHM6IE15UHJvcHMpIHtcbiAgICAgICAgICAgIEFycmF5LmlzQXJyYXkocHJvcHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBgLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ215X2Fzc2VtYmx5JyxcbiAgICAgICAgICBqc2lpOiBEVU1NWV9KU0lJX0NPTkZJRyxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBhZnRlckFsbCgoKSA9PiBtb2R1bGUuY2xlYW51cCgpKTtcblxuICAgIGRlc2NyaWJlKCdwYWNrYWdlIGltcG9ydCcsICgpID0+IHtcbiAgICAgIGxldCB0cmFuczogVHJhbnNsYXRlZFNuaXBwZXQ7XG4gICAgICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgICAgICB0cmFucyA9IG1vZHVsZS50cmFuc2xhdGVIZXJlKGBcbiAgICAgICAgICAgIGltcG9ydCAqIGFzIG1hc20gZnJvbSAnbXlfYXNzZW1ibHknO1xuICAgICAgICAgICAgY29uc3QgeCA9IG1hc20uTXlFbnVtLk9QVElPTl9BO1xuICAgICAgICAgIGApO1xuICAgICAgfSk7XG5cbiAgICAgIHRlc3QoJ3RvIFB5dGhvbicsICgpID0+IHtcbiAgICAgICAgZXhwZWN0VHJhbnNsYXRpb24odHJhbnMsIFRhcmdldExhbmd1YWdlLlBZVEhPTiwgW1xuICAgICAgICAgICdpbXBvcnQgZXhhbXBsZV90ZXN0X2RlbW8gYXMgbWFzbScsXG4gICAgICAgICAgJ3ggPSBtYXNtLk15RW51bS5PUFRJT05fQScsXG4gICAgICAgIF0pO1xuICAgICAgfSk7XG5cbiAgICAgIHRlc3QoJ3RvIEphdmEnLCAoKSA9PiB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmV0dGllci9wcmV0dGllclxuICAgICAgICBleHBlY3RUcmFuc2xhdGlvbih0cmFucywgVGFyZ2V0TGFuZ3VhZ2UuSkFWQSwgW1xuICAgICAgICAgICdpbXBvcnQgZXhhbXBsZS50ZXN0LmRlbW8uKjsnLFxuICAgICAgICAgICdNeUVudW0geCA9IE15RW51bS5PUFRJT05fQTsnLFxuICAgICAgICBdKTtcbiAgICAgIH0pO1xuXG4gICAgICB0ZXN0KCd0byBDIycsICgpID0+IHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByZXR0aWVyL3ByZXR0aWVyXG4gICAgICAgIGV4cGVjdFRyYW5zbGF0aW9uKHRyYW5zLCBUYXJnZXRMYW5ndWFnZS5DU0hBUlAsIFtcbiAgICAgICAgICAndXNpbmcgRXhhbXBsZS5UZXN0LkRlbW87JyxcbiAgICAgICAgICAnTXlFbnVtIHggPSBNeUVudW0uT1BUSU9OX0E7JyxcbiAgICAgICAgXSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdkaXJlY3QgaW1wb3J0JywgKCkgPT4ge1xuICAgICAgbGV0IHRyYW5zOiBUcmFuc2xhdGVkU25pcHBldDtcbiAgICAgIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgICAgIHRyYW5zID0gbW9kdWxlLnRyYW5zbGF0ZUhlcmUoXG4gICAgICAgICAgYGltcG9ydCB7IE15RW51bSB9IGZyb20gJ215X2Fzc2VtYmx5JztcbiAgICAgICAgICBjb25zdCB4ID0gTXlFbnVtLk9QVElPTl9BO1xuICAgICAgICAgIGAsXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgdGVzdCgndG8gUHl0aG9uJywgKCkgPT4ge1xuICAgICAgICBleHBlY3RUcmFuc2xhdGlvbih0cmFucywgVGFyZ2V0TGFuZ3VhZ2UuUFlUSE9OLCBbXG4gICAgICAgICAgJ2Zyb20gZXhhbXBsZV90ZXN0X2RlbW8gaW1wb3J0IE15RW51bScsXG4gICAgICAgICAgJ3ggPSBNeUVudW0uT1BUSU9OX0EnLFxuICAgICAgICBdKTtcbiAgICAgIH0pO1xuXG4gICAgICB0ZXN0KCd0byBKYXZhJywgKCkgPT4ge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJldHRpZXIvcHJldHRpZXJcbiAgICAgICAgZXhwZWN0VHJhbnNsYXRpb24odHJhbnMsIFRhcmdldExhbmd1YWdlLkpBVkEsIFtcbiAgICAgICAgICAnaW1wb3J0IGV4YW1wbGUudGVzdC5kZW1vLk15RW51bTsnLFxuICAgICAgICAgICdNeUVudW0geCA9IE15RW51bS5PUFRJT05fQTsnLFxuICAgICAgICBdKTtcbiAgICAgIH0pO1xuXG4gICAgICB0ZXN0KCd0byBDIycsICgpID0+IHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByZXR0aWVyL3ByZXR0aWVyXG4gICAgICAgIGV4cGVjdFRyYW5zbGF0aW9uKHRyYW5zLCBUYXJnZXRMYW5ndWFnZS5DU0hBUlAsIFtcbiAgICAgICAgICAndXNpbmcgRXhhbXBsZS5UZXN0LkRlbW87JyxcbiAgICAgICAgICAnTXlFbnVtIHggPSBNeUVudW0uT1BUSU9OX0E7JyxcbiAgICAgICAgXSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdpbXBsaWNpdCBpbXBvcnQnLCAoKSA9PiB7XG4gICAgICBsZXQgdHJhbnM6IFRyYW5zbGF0ZWRTbmlwcGV0O1xuICAgICAgYmVmb3JlQWxsKCgpID0+IHtcbiAgICAgICAgdHJhbnMgPSBtb2R1bGUudHJhbnNsYXRlSGVyZShcbiAgICAgICAgICBgaW1wb3J0ICogYXMgbWFzbSBmcm9tICdteV9hc3NlbWJseSc7XG4gICAgICAgICAgbWFzbS5teUZ1bih7IHByb3A6IG1hc20uTXlFbnVtLk9QVElPTl9BIH0pO1xuICAgICAgICAgIGAsXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgdGVzdCgndG8gUHl0aG9uJywgKCkgPT4ge1xuICAgICAgICBleHBlY3RUcmFuc2xhdGlvbih0cmFucywgVGFyZ2V0TGFuZ3VhZ2UuUFlUSE9OLCBbXG4gICAgICAgICAgJ2ltcG9ydCBleGFtcGxlX3Rlc3RfZGVtbyBhcyBtYXNtJyxcbiAgICAgICAgICAnbWFzbS5teV9mdW4ocHJvcD1tYXNtLk15RW51bS5PUFRJT05fQSknLFxuICAgICAgICBdKTtcbiAgICAgIH0pO1xuXG4gICAgICB0ZXN0KCd0byBKYXZhJywgKCkgPT4ge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJldHRpZXIvcHJldHRpZXJcbiAgICAgICAgZXhwZWN0VHJhbnNsYXRpb24odHJhbnMsIFRhcmdldExhbmd1YWdlLkpBVkEsIFtcbiAgICAgICAgICAnaW1wb3J0IGV4YW1wbGUudGVzdC5kZW1vLio7JyxcbiAgICAgICAgICAnbXlGdW4oTXlQcm9wcy5idWlsZGVyKCkucHJvcChNeUVudW0uT1BUSU9OX0EpLmJ1aWxkKCkpOycsXG4gICAgICAgIF0pO1xuICAgICAgfSk7XG5cbiAgICAgIHRlc3QoJ3RvIEMjJywgKCkgPT4ge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJldHRpZXIvcHJldHRpZXJcbiAgICAgICAgZXhwZWN0VHJhbnNsYXRpb24odHJhbnMsIFRhcmdldExhbmd1YWdlLkNTSEFSUCwgW1xuICAgICAgICAgICd1c2luZyBFeGFtcGxlLlRlc3QuRGVtbzsnLFxuICAgICAgICAgICdNeUZ1bihuZXcgTXlQcm9wcyB7IFByb3AgPSBNeUVudW0uT1BUSU9OX0EgfSk7JyxcbiAgICAgICAgXSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ3dpdGggc3VibW9kdWxlJywgKCkgPT4ge1xuICBkZXNjcmliZSgndG9wLWxldmVsIHN0cnVjdCcsICgpID0+IHtcbiAgICBsZXQgbW9kdWxlOiBUZXN0SnNpaU1vZHVsZTtcbiAgICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgICAgbW9kdWxlID0gYXdhaXQgbWFrZUpzaWlNb2R1bGUoeyB3aXRoTW9kdWxlOiB0cnVlLCBuZXN0ZWRTdHJ1Y3Q6IGZhbHNlIH0pO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJBbGwoKCkgPT4gbW9kdWxlLmNsZWFudXAoKSk7XG5cbiAgICBkZXNjcmliZSgnbmFtZXNwYWNlIGltcG9ydCcsICgpID0+IHtcbiAgICAgIGxldCB0cmFuczogVHJhbnNsYXRlZFNuaXBwZXQ7XG4gICAgICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgICAgICB0cmFucyA9IG1vZHVsZS50cmFuc2xhdGVIZXJlKGBcbiAgICAgICAgICAgIGltcG9ydCB7IHN1Ym1vZCBhcyBtb2QgfSBmcm9tICdteV9hc3NlbWJseSc7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgbW9kLk15Q2xhc3MoJ3ZhbHVlJywge1xuICAgICAgICAgICAgICBteVN0cnVjdDoge1xuICAgICAgICAgICAgICAgIHZhbHVlOiAndicsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICBgKTtcbiAgICAgIH0pO1xuXG4gICAgICB0ZXN0KCd0byBQeXRob24nLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdFRyYW5zbGF0aW9uKHRyYW5zLCBUYXJnZXRMYW5ndWFnZS5QWVRIT04sIFtcbiAgICAgICAgICAnZnJvbSBleGFtcGxlX3Rlc3RfZGVtbyBpbXBvcnQgYm9vcCBhcyBtb2QnLFxuICAgICAgICAgICdvYmogPSBtb2QuTXlDbGFzcyhcInZhbHVlXCIsJyxcbiAgICAgICAgICAnICAgIG15X3N0cnVjdD1tb2QuTXlTdHJ1Y3QoJyxcbiAgICAgICAgICAnICAgICAgICB2YWx1ZT1cInZcIicsXG4gICAgICAgICAgJyAgICApJyxcbiAgICAgICAgICAnKScsXG4gICAgICAgIF0pO1xuICAgICAgfSk7XG5cbiAgICAgIHRlc3QoJ3RvIEphdmEnLCAoKSA9PiB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmV0dGllci9wcmV0dGllclxuICAgICAgICBleHBlY3RUcmFuc2xhdGlvbih0cmFucywgVGFyZ2V0TGFuZ3VhZ2UuSkFWQSwgW1xuICAgICAgICAgICdpbXBvcnQgZXhhbXBsZS50ZXN0LmRlbW8uYm9vcC4qOycsXG4gICAgICAgICAgLi4uREVGQVVMVF9KQVZBX0NPREUsXG4gICAgICAgIF0pO1xuICAgICAgfSk7XG5cbiAgICAgIHRlc3QoJ3RvIEMjJywgKCkgPT4ge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJldHRpZXIvcHJldHRpZXJcbiAgICAgICAgZXhwZWN0VHJhbnNsYXRpb24odHJhbnMsIFRhcmdldExhbmd1YWdlLkNTSEFSUCwgW1xuICAgICAgICAgICd1c2luZyBFeGFtcGxlLlRlc3QuRGVtby5Cb29wOycsXG4gICAgICAgICAgLi4uREVGQVVMVF9DU0hBUlBfQ09ERSxcbiAgICAgICAgXSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ25lc3RlZCBzdHJ1Y3QnLCAoKSA9PiB7XG4gICAgbGV0IG1vZHVsZTogVGVzdEpzaWlNb2R1bGU7XG4gICAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICAgIG1vZHVsZSA9IGF3YWl0IG1ha2VKc2lpTW9kdWxlKHsgd2l0aE1vZHVsZTogdHJ1ZSwgbmVzdGVkU3RydWN0OiB0cnVlIH0pO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJBbGwoKCkgPT4gbW9kdWxlLmNsZWFudXAoKSk7XG5cbiAgICBkZXNjcmliZSgnbmFtZXNwYWNlIGltcG9ydCcsICgpID0+IHtcbiAgICAgIGxldCB0cmFuczogVHJhbnNsYXRlZFNuaXBwZXQ7XG4gICAgICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgICAgICB0cmFucyA9IG1vZHVsZS50cmFuc2xhdGVIZXJlKGBcbiAgICAgICAgICAgIGltcG9ydCB7IHN1Ym1vZCBhcyBtb2QgfSBmcm9tICdteV9hc3NlbWJseSc7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBuZXcgbW9kLk15Q2xhc3MoJ3ZhbHVlJywge1xuICAgICAgICAgICAgICBteVN0cnVjdDoge1xuICAgICAgICAgICAgICAgIHZhbHVlOiAndicsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICBgKTtcbiAgICAgIH0pO1xuXG4gICAgICB0ZXN0KCd0byBQeXRob24nLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdFRyYW5zbGF0aW9uKHRyYW5zLCBUYXJnZXRMYW5ndWFnZS5QWVRIT04sIFtcbiAgICAgICAgICAnZnJvbSBleGFtcGxlX3Rlc3RfZGVtbyBpbXBvcnQgYm9vcCBhcyBtb2QnLFxuICAgICAgICAgICdvYmogPSBtb2QuTXlDbGFzcyhcInZhbHVlXCIsJyxcbiAgICAgICAgICAnICAgIG15X3N0cnVjdD1tb2QuTXlDbGFzcy5NeVN0cnVjdCgnLFxuICAgICAgICAgICcgICAgICAgIHZhbHVlPVwidlwiJyxcbiAgICAgICAgICAnICAgICknLFxuICAgICAgICAgICcpJyxcbiAgICAgICAgXSk7XG4gICAgICB9KTtcblxuICAgICAgdGVzdCgndG8gSmF2YScsICgpID0+IHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByZXR0aWVyL3ByZXR0aWVyXG4gICAgICAgIGV4cGVjdFRyYW5zbGF0aW9uKHRyYW5zLCBUYXJnZXRMYW5ndWFnZS5KQVZBLCBbXG4gICAgICAgICAgJ2ltcG9ydCBleGFtcGxlLnRlc3QuZGVtby5ib29wLio7JyxcbiAgICAgICAgICAuLi5ERUZBVUxUX0pBVkFfQ09ERSxcbiAgICAgICAgXSk7XG4gICAgICB9KTtcblxuICAgICAgdGVzdCgndG8gQyMnLCAoKSA9PiB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmV0dGllci9wcmV0dGllclxuICAgICAgICBleHBlY3RUcmFuc2xhdGlvbih0cmFucywgVGFyZ2V0TGFuZ3VhZ2UuQ1NIQVJQLCBbXG4gICAgICAgICAgJ3VzaW5nIEV4YW1wbGUuVGVzdC5EZW1vLkJvb3A7JyxcbiAgICAgICAgICAuLi5ERUZBVUxUX0NTSEFSUF9DT0RFLFxuICAgICAgICBdKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5hc3luYyBmdW5jdGlvbiBtYWtlSnNpaU1vZHVsZShvcHRpb25zOiB7XG4gIHJlYWRvbmx5IHdpdGhNb2R1bGU6IGJvb2xlYW47XG4gIHJlYWRvbmx5IG5lc3RlZFN0cnVjdDogYm9vbGVhbjtcbn0pOiBQcm9taXNlPFRlc3RKc2lpTW9kdWxlPiB7XG4gIGNvbnN0IG5zUmVmID0gb3B0aW9ucy5uZXN0ZWRTdHJ1Y3QgPyAnTXlDbGFzcy4nIDogJyc7XG4gIGNvbnN0IG5zRGVjbEJlZ2luID0gb3B0aW9ucy5uZXN0ZWRTdHJ1Y3QgPyAnZXhwb3J0IG5hbWVzcGFjZSBNeUNsYXNzIHtcXG4nIDogJyc7XG4gIGNvbnN0IG5zRGVjbEVuZCA9IG9wdGlvbnMubmVzdGVkU3RydWN0ID8gJ30nIDogJyc7XG5cbiAgY29uc3QgcGF5bG9hZCA9IGBcbiAgICBleHBvcnQgY2xhc3MgTXlDbGFzcyB7XG4gICAgICBjb25zdHJ1Y3Rvcih2YWx1ZTogc3RyaW5nLCBwcm9wczogJHtuc1JlZn1NeUNsYXNzUHJvcHMpIHtcbiAgICAgICAgQXJyYXkuaXNBcnJheSh2YWx1ZSk7XG4gICAgICAgIEFycmF5LmlzQXJyYXkocHJvcHMpO1xuICAgICAgfVxuICAgIH1cblxuICAgICR7bnNEZWNsQmVnaW59XG4gICAgZXhwb3J0IGludGVyZmFjZSBNeUNsYXNzUHJvcHMge1xuICAgICAgcmVhZG9ubHkgbXlTdHJ1Y3Q6IE15U3RydWN0O1xuICAgIH1cblxuICAgIGV4cG9ydCBpbnRlcmZhY2UgTXlTdHJ1Y3Qge1xuICAgICAgcmVhZG9ubHkgdmFsdWU6IHN0cmluZztcbiAgICB9XG4gICAgJHtuc0RlY2xFbmR9XG4gICAgYDtcblxuICBjb25zdCBzb3VyY2U6IE11bHRpcGxlU291cmNlcyA9IG9wdGlvbnMud2l0aE1vZHVsZVxuICAgID8ge1xuICAgICAgICAnaW5kZXgudHMnOiAnZXhwb3J0ICogYXMgc3VibW9kIGZyb20gXCIuL3N1Ym1vZHVsZS9tb2R1bGVcIjsnLFxuICAgICAgICAnc3VibW9kdWxlL21vZHVsZS50cyc6IHBheWxvYWQsXG4gICAgICAgICdzdWJtb2R1bGUvLmpzaWlyYy5qc29uJzogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIHRhcmdldHM6IHtcbiAgICAgICAgICAgIHB5dGhvbjoge1xuICAgICAgICAgICAgICBtb2R1bGU6ICdleGFtcGxlX3Rlc3RfZGVtby5ib29wJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBqYXZhOiB7XG4gICAgICAgICAgICAgIHBhY2thZ2U6ICdleGFtcGxlLnRlc3QuZGVtby5ib29wJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkb3RuZXQ6IHtcbiAgICAgICAgICAgICAgbmFtZXNwYWNlOiAnRXhhbXBsZS5UZXN0LkRlbW8uQm9vcCcsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgfVxuICAgIDoge1xuICAgICAgICAnaW5kZXgudHMnOiBwYXlsb2FkLFxuICAgICAgfTtcblxuICByZXR1cm4gVGVzdEpzaWlNb2R1bGUuZnJvbVNvdXJjZShzb3VyY2UsIHtcbiAgICBuYW1lOiAnbXlfYXNzZW1ibHknLFxuICAgIGpzaWk6IERVTU1ZX0pTSUlfQ09ORklHLFxuICB9KTtcbn1cblxuLy8gVGhlIGltcGxlbWVudGF0aW9uIHBhcnQgb2YgdGhlIEphdmEgY29kZSBpcyBhbHdheXMgdGhlIHNhbWVcbmNvbnN0IERFRkFVTFRfSkFWQV9DT0RFID0gW1xuICAnTXlDbGFzcyBvYmogPSBNeUNsYXNzLkJ1aWxkZXIuY3JlYXRlKFwidmFsdWVcIiknLFxuICAnICAgICAgICAubXlTdHJ1Y3QoTXlTdHJ1Y3QuYnVpbGRlcigpJyxcbiAgJyAgICAgICAgICAgICAgICAudmFsdWUoXCJ2XCIpJyxcbiAgJyAgICAgICAgICAgICAgICAuYnVpbGQoKSknLFxuICAnICAgICAgICAuYnVpbGQoKTsnLFxuXTtcblxuLy8gVGhlIGltcGxlbWVudGF0aW9uIHBhcnQgb2YgdGhlIENTaGFycCBjb2RlIGlzIGFsd2F5cyB0aGUgc2FtZVxuY29uc3QgREVGQVVMVF9DU0hBUlBfQ09ERSA9IFtcbiAgJ015Q2xhc3Mgb2JqID0gbmV3IE15Q2xhc3MoXCJ2YWx1ZVwiLCBuZXcgTXlDbGFzc1Byb3BzIHsnLFxuICAnICAgIE15U3RydWN0ID0gbmV3IE15U3RydWN0IHsnLFxuICAnICAgICAgICBWYWx1ZSA9IFwidlwiJyxcbiAgJyAgICB9JyxcbiAgJ30pOycsXG5dO1xuXG4vKipcbiAqIFZlcmlmeSB0aGUgSmF2YSBvdXRwdXQuIEFsbCBleHBlY3RlZCBKYXZhIG91dHB1dHMgbG9vayB0aGUgc2FtZS5cbiAqL1xuZnVuY3Rpb24gZXhwZWN0VHJhbnNsYXRpb24odHJhbnM6IFRyYW5zbGF0ZWRTbmlwcGV0LCBsYW5nOiBUYXJnZXRMYW5ndWFnZSwgZXhwZWN0ZWQ6IHN0cmluZ1tdKSB7XG4gIGV4cGVjdCh0cmFucy5nZXQobGFuZyk/LnNvdXJjZS5zcGxpdCgnXFxuJykpLnRvRXF1YWwoZXhwZWN0ZWQpO1xufVxuIl19