"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lib_1 = require("../lib");
const visualize_1 = require("../lib/languages/visualize");
const key_1 = require("../lib/tablets/key");
const location = {
    api: { api: 'moduleReadme', moduleFqn: '@aws-cdk/aws-apigateway' },
    field: { field: 'example' },
};
test('does not fail on "Debug Failure"', () => {
    // GIVEN
    const snippet = {
        completeSource: 'Missing literate source file test/integ.restapi-import.lit.ts',
        location,
        visibleSource: "import { App, CfnOutput, NestedStack, NestedStackProps, Stack } from '@aws-cdk/core';\nimport { Construct } from 'constructs';\nimport { Deployment, Method, MockIntegration, PassthroughBehavior, RestApi, Stage } from '../lib';\n\n/**\n * This file showcases how to split up a RestApi's Resources and Methods across nested stacks.\n *\n * The root stack 'RootStack' first defines a RestApi.\n * Two nested stacks BooksStack and PetsStack, create corresponding Resources '/books' and '/pets'.\n * They are thenâ€¦;\n\n  readonly methods?: Method[];\n}\n\nclass DeployStack extends NestedStack {\n  constructor(scope: Construct, props: DeployStackProps) {\n    super(scope, 'integ-restapi-import-DeployStack', props);\n\n    const deployment = new Deployment(this, 'Deployment', {\n      api: RestApi.fromRestApiId(this, 'RestApi', props.restApiId),\n    });\n    (props.methods ?? []).forEach((method) => deployment.node.addDependency(method));\n    new Stage(this, 'Stage', { deployment });\n  }\n}\n\nnew RootStack(new App());",
        parameters: { lit: 'test/integ.restapi-import.lit.ts' },
        strict: false,
    };
    // WHEN
    const subject = new lib_1.SnippetTranslator(snippet, {
        includeCompilerDiagnostics: true,
    });
    // THEN
    expect(subject.renderUsing(new visualize_1.VisualizeAstVisitor())).toMatchInlineSnapshot(`
    "(ExpressionStatement Missing
      (Identifier Missing))(ExpressionStatement literate
      (Identifier literate))(ExpressionStatement source
      (Identifier source))(ExpressionStatement file
      (Identifier file))(ExpressionStatement test/integ.restapi-import.lit.ts
      (BinaryExpression test/integ.restapi-import.lit.ts
        (BinaryExpression test/integ.restapi
          (Identifier test)
          (SlashToken /)
          (PropertyAccessExpression integ.restapi
            (Identifier integ)
            (Identifier restapi)))
        (MinusToken -)
        (PropertyAccessExpression import.lit.ts
          import.lit
          (Identifier ts))))"
  `);
});
test('rejects ?? operator', () => {
    const snippet = {
        completeSource: 'const x = false ?? true;',
        location,
        visibleSource: 'const x = false ?? true;',
        parameters: { lit: 'test/integ.restapi-import.lit.ts' },
        strict: false,
    };
    // WHEN
    const subject = new lib_1.SnippetTranslator(snippet, {
        includeCompilerDiagnostics: true,
    });
    subject.renderUsing(new lib_1.PythonVisitor());
    expect(subject.diagnostics[0].messageText).toContain('QuestionQuestionToken');
});
test('rejects function declarations in object literals', () => {
    const snippet = {
        completeSource: 'const x = { method() { return 1; } }',
        location,
        visibleSource: 'const x = { method() { return 1; } }',
        parameters: { lit: 'test/integ.restapi-import.lit.ts' },
        strict: false,
    };
    // WHEN
    const subject = new lib_1.SnippetTranslator(snippet, {
        includeCompilerDiagnostics: true,
    });
    subject.renderUsing(new lib_1.PythonVisitor());
    expect(subject.diagnostics[0].messageText).toContain('Use of MethodDeclaration in an object literal is not supported');
});
test('completeSource does not impact the snippet key', () => {
    const snippet1 = {
        visibleSource: '// hello',
        location: { api: { api: 'member', fqn: 'my.class', memberName: 'member1' } },
        completeSource: '// i do not like to say\n// hello',
    };
    const snippet2 = {
        ...snippet1,
        completeSource: undefined,
    };
    expect(key_1.snippetKey(snippet1)).toEqual(key_1.snippetKey(snippet2));
});
test('Snippets from different locations have different keys', () => {
    const visibleSource = 'console.log("banana");';
    const snippet1 = {
        visibleSource,
        location: { api: { api: 'member', fqn: 'my.class', memberName: 'member1' } },
    };
    const snippet2 = {
        visibleSource,
        location: { api: { api: 'type', fqn: 'my.class' } },
    };
    expect(key_1.snippetKey(snippet1)).not.toEqual(key_1.snippetKey(snippet2));
});
test('didSuccessfullyCompile is true when compilation is attempted', () => {
    const visibleSource = 'console.log("banana");';
    const snippet = {
        visibleSource,
        location: { api: { api: 'type', fqn: 'my.class' } },
    };
    // WHEN
    const subject = new lib_1.SnippetTranslator(snippet, {
        includeCompilerDiagnostics: true,
    });
    subject.renderUsing(new lib_1.PythonVisitor());
    expect(subject.didSuccessfullyCompile).toBeTruthy();
});
test('didSuccessfullyCompile is undefined when compilation is not attempted', () => {
    const visibleSource = 'console.log("banana");';
    const snippet = {
        visibleSource,
        location: { api: { api: 'type', fqn: 'my.class' } },
    };
    // WHEN
    const subject = new lib_1.SnippetTranslator(snippet);
    subject.renderUsing(new lib_1.PythonVisitor());
    expect(subject.didSuccessfullyCompile).toBeUndefined();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNsYXRlLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ0cmFuc2xhdGUudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGdDQUE2RTtBQUM3RSwwREFBaUU7QUFDakUsNENBQWdEO0FBRWhELE1BQU0sUUFBUSxHQUFHO0lBQ2YsR0FBRyxFQUFFLEVBQUUsR0FBRyxFQUFFLGNBQWMsRUFBRSxTQUFTLEVBQUUseUJBQXlCLEVBQUU7SUFDbEUsS0FBSyxFQUFFLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRTtDQUNuQixDQUFDO0FBRVgsSUFBSSxDQUFDLGtDQUFrQyxFQUFFLEdBQUcsRUFBRTtJQUM1QyxRQUFRO0lBQ1IsTUFBTSxPQUFPLEdBQXNCO1FBQ2pDLGNBQWMsRUFBRSwrREFBK0Q7UUFDL0UsUUFBUTtRQUNSLGFBQWEsRUFDWCxrZ0NBQWtnQztRQUNwZ0MsVUFBVSxFQUFFLEVBQUUsR0FBRyxFQUFFLGtDQUFrQyxFQUFFO1FBQ3ZELE1BQU0sRUFBRSxLQUFLO0tBQ2QsQ0FBQztJQUVGLE9BQU87SUFDUCxNQUFNLE9BQU8sR0FBRyxJQUFJLHVCQUFpQixDQUFDLE9BQU8sRUFBRTtRQUM3QywwQkFBMEIsRUFBRSxJQUFJO0tBQ2pDLENBQUMsQ0FBQztJQUVILE9BQU87SUFDUCxNQUFNLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxJQUFJLCtCQUFtQixFQUFFLENBQUMsQ0FBQyxDQUFDLHFCQUFxQixDQUFDOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCNUUsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO0lBQy9CLE1BQU0sT0FBTyxHQUFzQjtRQUNqQyxjQUFjLEVBQUUsMEJBQTBCO1FBQzFDLFFBQVE7UUFDUixhQUFhLEVBQUUsMEJBQTBCO1FBQ3pDLFVBQVUsRUFBRSxFQUFFLEdBQUcsRUFBRSxrQ0FBa0MsRUFBRTtRQUN2RCxNQUFNLEVBQUUs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dUJBQWlCLENBQUMsT0FBTyxFQUFFO1FBQzdDLDBCQUEwQixFQUFFLElBQUk7S0FDakMsQ0FBQyxDQUFDO0lBQ0gsT0FBTyxDQUFDLFdBQVcsQ0FBQyxJQUFJLG1CQUFhLEVBQUUsQ0FBQyxDQUFDO0lBRXpDLE1BQU0sQ0FBQyxPQUFPLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztBQUN0RCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyx1RUFBdUUsRUFBRSxHQUFHLEVBQUU7SUFDakYsTUFBTSxhQUFhLEdBQUcsd0JBQXdCLENBQUM7SUFFL0MsTUFBTSxPQUFPLEdBQXNCO1FBQ2pDLGFBQWE7UUFDYixRQUFRLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsRUFBRTtLQUNwRCxDQUFDO0lBRUYsT0FBTztJQUNQLE1BQU0sT0FBTyxHQUFHLElBQUksdUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDL0MsT0FBTyxDQUFDLFdBQVcsQ0FBQyxJQUFJLG1CQUFhLEVBQUUsQ0FBQyxDQUFDO0lBRXpDLE1BQU0sQ0FBQyxPQUFPLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztBQUN6RCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNuaXBwZXRUcmFuc2xhdG9yLCBUeXBlU2NyaXB0U25pcHBldCwgUHl0aG9uVmlzaXRvciB9IGZyb20gJy4uL2xpYic7XG5pbXBvcnQgeyBWaXN1YWxpemVBc3RWaXNpdG9yIH0gZnJvbSAnLi4vbGliL2xhbmd1YWdlcy92aXN1YWxpemUnO1xuaW1wb3J0IHsgc25pcHBldEtleSB9IGZyb20gJy4uL2xpYi90YWJsZXRzL2tleSc7XG5cbmNvbnN0IGxvY2F0aW9uID0ge1xuICBhcGk6IHsgYXBpOiAnbW9kdWxlUmVhZG1lJywgbW9kdWxlRnFuOiAnQGF3cy1jZGsvYXdzLWFwaWdhdGV3YXknIH0sXG4gIGZpZWxkOiB7IGZpZWxkOiAnZXhhbXBsZScgfSxcbn0gYXMgY29uc3Q7XG5cbnRlc3QoJ2RvZXMgbm90IGZhaWwgb24gXCJEZWJ1ZyBGYWlsdXJlXCInLCAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHNuaXBwZXQ6IFR5cGVTY3JpcHRTbmlwcGV0ID0ge1xuICAgIGNvbXBsZXRlU291cmNlOiAnTWlzc2luZyBsaXRlcmF0ZSBzb3VyY2UgZmlsZSB0ZXN0L2ludGVnLnJlc3RhcGktaW1wb3J0LmxpdC50cycsXG4gICAgbG9jYXRpb24sXG4gICAgdmlzaWJsZVNvdXJjZTpcbiAgICAgIFwiaW1wb3J0IHsgQXBwLCBDZm5PdXRwdXQsIE5lc3RlZFN0YWNrLCBOZXN0ZWRTdGFja1Byb3BzLCBTdGFjayB9IGZyb20gJ0Bhd3MtY2RrL2NvcmUnO1xcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xcbmltcG9ydCB7IERlcGxveW1lbnQsIE1ldGhvZCwgTW9ja0ludGVncmF0aW9uLCBQYXNzdGhyb3VnaEJlaGF2aW9yLCBSZXN0QXBpLCBTdGFnZSB9IGZyb20gJy4uL2xpYic7XFxuXFxuLyoqXFxuICogVGhpcyBmaWxlIHNob3djYXNlcyBob3cgdG8gc3BsaXQgdXAgYSBSZXN0QXBpJ3MgUmVzb3VyY2VzIGFuZCBNZXRob2RzIGFjcm9zcyBuZXN0ZWQgc3RhY2tzLlxcbiAqXFxuICogVGhlIHJvb3Qgc3RhY2sgJ1Jvb3RTdGFjaycgZmlyc3QgZGVmaW5lcyBhIFJlc3RBcGkuXFxuICogVHdvIG5lc3RlZCBzdGFja3MgQm9va3NTdGFjayBhbmQgUGV0c1N0YWNrLCBjcmVhdGUgY29ycmVzcG9uZGluZyBSZXNvdXJjZXMgJy9ib29rcycgYW5kICcvcGV0cycuXFxuICogVGhleSBhcmUgdGhlbuKApjtcXG5cXG4gIHJlYWRvbmx5IG1ldGhvZHM/OiBNZXRob2RbXTtcXG59XFxuXFxuY2xhc3MgRGVwbG95U3RhY2sgZXh0ZW5kcyBOZXN0ZWRTdGFjayB7XFxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBwcm9wczogRGVwbG95U3RhY2tQcm9wcykge1xcbiAgICBzdXBlcihzY29wZSwgJ2ludGVnLXJlc3RhcGktaW1wb3J0LURlcGxveVN0YWNrJywgcHJvcHMpO1xcblxcbiAgICBjb25zdCBkZXBsb3ltZW50ID0gbmV3IERlcGxveW1lbnQodGhpcywgJ0RlcGxveW1lbnQnLCB7XFxuICAgICAgYXBpOiBSZXN0QXBpLmZyb21SZXN0QXBpSWQodGhpcywgJ1Jlc3RBcGknLCBwcm9wcy5yZXN0QXBpSWQpLFxcbiAgICB9KTtcXG4gICAgKHByb3BzLm1ldGhvZHMgPz8gW10pLmZvckVhY2goKG1ldGhvZCkgPT4gZGVwbG95bWVudC5ub2RlLmFkZERlcGVuZGVuY3kobWV0aG9kKSk7XFxuICAgIG5ldyBTdGFnZSh0aGlzLCAnU3RhZ2UnLCB7IGRlcGxveW1lbnQgfSk7XFxuICB9XFxufVxcblxcbm5ldyBSb290U3RhY2sobmV3IEFwcCgpKTtcIixcbiAgICBwYXJhbWV0ZXJzOiB7IGxpdDogJ3Rlc3QvaW50ZWcucmVzdGFwaS1pbXBvcnQubGl0LnRzJyB9LFxuICAgIHN0cmljdDogZmFsc2UsXG4gIH07XG5cbiAgLy8gV0hFTlxuICBjb25zdCBzdWJqZWN0ID0gbmV3IFNuaXBwZXRUcmFuc2xhdG9yKHNuaXBwZXQsIHtcbiAgICBpbmNsdWRlQ29tcGlsZXJEaWFnbm9zdGljczogdHJ1ZSxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3Qoc3ViamVjdC5yZW5kZXJVc2luZyhuZXcgVmlzdWFsaXplQXN0VmlzaXRvcigpKSkudG9NYXRjaElubGluZVNuYXBzaG90KGBcbiAgICBcIihFeHByZXNzaW9uU3RhdGVtZW50IE1pc3NpbmdcbiAgICAgIChJZGVudGlmaWVyIE1pc3NpbmcpKShFeHByZXNzaW9uU3RhdGVtZW50IGxpdGVyYXRlXG4gICAgICAoSWRlbnRpZmllciBsaXRlcmF0ZSkpKEV4cHJlc3Npb25TdGF0ZW1lbnQgc291cmNlXG4gICAgICAoSWRlbnRpZmllciBzb3VyY2UpKShFeHByZXNzaW9uU3RhdGVtZW50IGZpbGVcbiAgICAgIChJZGVudGlmaWVyIGZpbGUpKShFeHByZXNzaW9uU3RhdGVtZW50IHRlc3QvaW50ZWcucmVzdGFwaS1pbXBvcnQubGl0LnRzXG4gICAgICAoQmluYXJ5RXhwcmVzc2lvbiB0ZXN0L2ludGVnLnJlc3RhcGktaW1wb3J0LmxpdC50c1xuICAgICAgICAoQmluYXJ5RXhwcmVzc2lvbiB0ZXN0L2ludGVnLnJlc3RhcGlcbiAgICAgICAgICAoSWRlbnRpZmllciB0ZXN0KVxuICAgICAgICAgIChTbGFzaFRva2VuIC8pXG4gICAgICAgICAgKFByb3BlcnR5QWNjZXNzRXhwcmVzc2lvbiBpbnRlZy5yZXN0YXBpXG4gICAgICAgICAgICAoSWRlbnRpZmllciBpbnRlZylcbiAgICAgICAgICAgIChJZGVudGlmaWVyIHJlc3RhcGkpKSlcbiAgICAgICAgKE1pbnVzVG9rZW4gLSlcbiAgICAgICAgKFByb3BlcnR5QWNjZXNzRXhwcmVzc2lvbiBpbXBvcnQubGl0LnRzXG4gICAgICAgICAgaW1wb3J0LmxpdFxuICAgICAgICAgIChJZGVudGlmaWVyIHRzKSkpKVwiXG4gIGApO1xufSk7XG5cbnRlc3QoJ3JlamVjdHMgPz8gb3BlcmF0b3InLCAoKSA9PiB7XG4gIGNvbnN0IHNuaXBwZXQ6IFR5cGVTY3JpcHRTbmlwcGV0ID0ge1xuICAgIGNvbXBsZXRlU291cmNlOiAnY29uc3QgeCA9IGZhbHNlID8/IHRydWU7JyxcbiAgICBsb2NhdGlvbixcbiAgICB2aXNpYmxlU291cmNlOiAnY29uc3QgeCA9IGZhbHNlID8/IHRydWU7JyxcbiAgICBwYXJhbWV0ZXJzOiB7IGxpdDogJ3Rlc3QvaW50ZWcucmVzdGFwaS1pbXBvcnQubGl0LnRzJyB9LFxuICAgIHN0cmljdDogZmFsc2UsXG4gIH07XG5cbiAgLy8gV0hFTlxuICBjb25zdCBzdWJqZWN0ID0gbmV3IFNuaXBwZXRUcmFuc2xhdG9yKHNuaXBwZXQsIHtcbiAgICBpbmNsdWRlQ29tcGlsZXJEaWFnbm9zdGljczogdHJ1ZSxcbiAgfSk7XG4gIHN1YmplY3QucmVuZGVyVXNpbmcobmV3IFB5dGhvblZpc2l0b3IoKSk7XG5cbiAgZXhwZWN0KHN1YmplY3QuZGlhZ25vc3RpY3NbMF0ubWVzc2FnZVRleHQpLnRvQ29udGFpbignUXVlc3Rpb25RdWVzdGlvblRva2VuJyk7XG59KTtcblxudGVzdCgncmVqZWN0cyBmdW5jdGlvbiBkZWNsYXJhdGlvbnMgaW4gb2JqZWN0IGxpdGVyYWxzJywgKCkgPT4ge1xuICBjb25zdCBzbmlwcGV0OiBUeXBlU2NyaXB0U25pcHBldCA9IHtcbiAgICBjb21wbGV0ZVNvdXJjZTogJ2NvbnN0IHggPSB7IG1ldGhvZCgpIHsgcmV0dXJuIDE7IH0gfScsXG4gICAgbG9jYXRpb24sXG4gICAgdmlzaWJsZVNvdXJjZTogJ2NvbnN0IHggPSB7IG1ldGhvZCgpIHsgcmV0dXJuIDE7IH0gfScsXG4gICAgcGFyYW1ldGVyczogeyBsaXQ6ICd0ZXN0L2ludGVnLnJlc3RhcGktaW1wb3J0LmxpdC50cycgfSxcbiAgICBzdHJpY3Q6IGZhbHNlLFxuICB9O1xuXG4gIC8vIFdIRU5cbiAgY29uc3Qgc3ViamVjdCA9IG5ldyBTbmlwcGV0VHJhbnNsYXRvcihzbmlwcGV0LCB7XG4gICAgaW5jbHVkZUNvbXBpbGVyRGlhZ25vc3RpY3M6IHRydWUsXG4gIH0pO1xuICBzdWJqZWN0LnJlbmRlclVzaW5nKG5ldyBQeXRob25WaXNpdG9yKCkpO1xuXG4gIGV4cGVjdChzdWJqZWN0LmRpYWdub3N0aWNzWzBdLm1lc3NhZ2VUZXh0KS50b0NvbnRhaW4oXG4gICAgJ1VzZSBvZiBNZXRob2REZWNsYXJhdGlvbiBpbiBhbiBvYmplY3QgbGl0ZXJhbCBpcyBub3Qgc3VwcG9ydGVkJyxcbiAgKTtcbn0pO1xuXG50ZXN0KCdjb21wbGV0ZVNvdXJjZSBkb2VzIG5vdCBpbXBhY3QgdGhlIHNuaXBwZXQga2V5JywgKCkgPT4ge1xuICBjb25zdCBzbmlwcGV0MTogVHlwZVNjcmlwdFNuaXBwZXQgPSB7XG4gICAgdmlzaWJsZVNvdXJjZTogJy8vIGhlbGxvJyxcbiAgICBsb2NhdGlvbjogeyBhcGk6IHsgYXBpOiAnbWVtYmVyJywgZnFuOiAnbXkuY2xhc3MnLCBtZW1iZXJOYW1lOiAnbWVtYmVyMScgfSB9LFxuICAgIGNvbXBsZXRlU291cmNlOiAnLy8gaSBkbyBub3QgbGlrZSB0byBzYXlcXG4vLyBoZWxsbycsXG4gIH07XG5cbiAgY29uc3Qgc25pcHBldDIgPSB7XG4gICAgLi4uc25pcHBldDEsXG4gICAgY29tcGxldGVTb3VyY2U6IHVuZGVmaW5lZCxcbiAgfTtcblxuICBleHBlY3Qoc25pcHBldEtleShzbmlwcGV0MSkpLnRvRXF1YWwoc25pcHBldEtleShzbmlwcGV0MikpO1xufSk7XG5cbnRlc3QoJ1NuaXBwZXRzIGZyb20gZGlmZmVyZW50IGxvY2F0aW9ucyBoYXZlIGRpZmZlcmVudCBrZXlzJywgKCkgPT4ge1xuICBjb25zdCB2aXNpYmxlU291cmNlID0gJ2NvbnNvbGUubG9nKFwiYmFuYW5hXCIpOyc7XG5cbiAgY29uc3Qgc25pcHBldDE6IFR5cGVTY3JpcHRTbmlwcGV0ID0ge1xuICAgIHZpc2libGVTb3VyY2UsXG4gICAgbG9jYXRpb246IHsgYXBpOiB7IGFwaTogJ21lbWJlcicsIGZxbjogJ215LmNsYXNzJywgbWVtYmVyTmFtZTogJ21lbWJlcjEnIH0gfSxcbiAgfTtcblxuICBjb25zdCBzbmlwcGV0MjogVHlwZVNjcmlwdFNuaXBwZXQgPSB7XG4gICAgdmlzaWJsZVNvdXJjZSxcbiAgICBsb2NhdGlvbjogeyBhcGk6IHsgYXBpOiAndHlwZScsIGZxbjogJ215LmNsYXNzJyB9IH0sXG4gIH07XG5cbiAgZXhwZWN0KHNuaXBwZXRLZXkoc25pcHBldDEpKS5ub3QudG9FcXVhbChzbmlwcGV0S2V5KHNuaXBwZXQyKSk7XG59KTtcblxudGVzdCgnZGlkU3VjY2Vzc2Z1bGx5Q29tcGlsZSBpcyB0cnVlIHdoZW4gY29tcGlsYXRpb24gaXMgYXR0ZW1wdGVkJywgKCkgPT4ge1xuICBjb25zdCB2aXNpYmxlU291cmNlID0gJ2NvbnNvbGUubG9nKFwiYmFuYW5hXCIpOyc7XG5cbiAgY29uc3Qgc25pcHBldDogVHlwZVNjcmlwdFNuaXBwZXQgPSB7XG4gICAgdmlzaWJsZVNvdXJjZSxcbiAgICBsb2NhdGlvbjogeyBhcGk6IHsgYXBpOiAndHlwZScsIGZxbjogJ215LmNsYXNzJyB9IH0sXG4gIH07XG5cbiAgLy8gV0hFTlxuICBjb25zdCBzdWJqZWN0ID0gbmV3IFNuaXBwZXRUcmFuc2xhdG9yKHNuaXBwZXQsIHtcbiAgICBpbmNsdWRlQ29tcGlsZXJEaWFnbm9zdGljczogdHJ1ZSxcbiAgfSk7XG4gIHN1YmplY3QucmVuZGVyVXNpbmcobmV3IFB5dGhvblZpc2l0b3IoKSk7XG5cbiAgZXhwZWN0KHN1YmplY3QuZGlkU3VjY2Vzc2Z1bGx5Q29tcGlsZSkudG9CZVRydXRoeSgpO1xufSk7XG5cbnRlc3QoJ2RpZFN1Y2Nlc3NmdWxseUNvbXBpbGUgaXMgdW5kZWZpbmVkIHdoZW4gY29tcGlsYXRpb24gaXMgbm90IGF0dGVtcHRlZCcsICgpID0+IHtcbiAgY29uc3QgdmlzaWJsZVNvdXJjZSA9ICdjb25zb2xlLmxvZyhcImJhbmFuYVwiKTsnO1xuXG4gIGNvbnN0IHNuaXBwZXQ6IFR5cGVTY3JpcHRTbmlwcGV0ID0ge1xuICAgIHZpc2libGVTb3VyY2UsXG4gICAgbG9jYXRpb246IHsgYXBpOiB7IGFwaTogJ3R5cGUnLCBmcW46ICdteS5jbGFzcycgfSB9LFxuICB9O1xuXG4gIC8vIFdIRU5cbiAgY29uc3Qgc3ViamVjdCA9IG5ldyBTbmlwcGV0VHJhbnNsYXRvcihzbmlwcGV0KTtcbiAgc3ViamVjdC5yZW5kZXJVc2luZyhuZXcgUHl0aG9uVmlzaXRvcigpKTtcblxuICBleHBlY3Qoc3ViamVjdC5kaWRTdWNjZXNzZnVsbHlDb21waWxlKS50b0JlVW5kZWZpbmVkKCk7XG59KTtcbiJdfQ==