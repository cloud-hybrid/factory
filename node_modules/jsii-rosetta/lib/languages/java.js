"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.JavaVisitor = void 0;
const ts = require("typescript");
const jsii_types_1 = require("../jsii/jsii-types");
const jsii_utils_1 = require("../jsii/jsii-utils");
const packages_1 = require("../jsii/packages");
const target_language_1 = require("../languages/target-language");
const o_tree_1 = require("../o-tree");
const ast_utils_1 = require("../typescript/ast-utils");
const types_1 = require("../typescript/types");
const util_1 = require("../util");
const default_1 = require("./default");
class JavaVisitor extends default_1.DefaultVisitor {
    constructor() {
        super(...arguments);
        /**
         * Aliases for modules
         *
         * If these are encountered in the LHS of a property access, they will be dropped.
         */
        this.dropPropertyAccesses = new Set();
        this.language = target_language_1.TargetLanguage.JAVA;
        this.defaultContext = {};
    }
    mergeContext(old, update) {
        return Object.assign({}, old, update);
    }
    importStatement(importStatement) {
        var _a;
        const guessedNamespace = guessJavaNamespaceName(importStatement.packageName);
        if (importStatement.imports.import === 'full') {
            this.dropPropertyAccesses.add(importStatement.imports.alias);
            const namespace = (_a = util_1.fmap(importStatement.moduleSymbol, findJavaName)) !== null && _a !== void 0 ? _a : guessedNamespace;
            return new o_tree_1.OTree([`import ${namespace}.*;`], [], { canBreakLine: true });
        }
        const imports = importStatement.imports.elements.map((e) => {
            var _a, _b;
            const fqn = (_a = util_1.fmap(e.importedSymbol, findJavaName)) !== null && _a !== void 0 ? _a : `${guessedNamespace}.${e.sourceName}`;
            return ((_b = e.importedSymbol) === null || _b === void 0 ? void 0 : _b.symbolType) === 'module' ? `import ${fqn}.*;` : `import ${fqn};`;
        });
        const localNames = importStatement.imports.elements
            .filter((el) => { var _a; return ((_a = el.importedSymbol) === null || _a === void 0 ? void 0 : _a.symbolType) === 'module'; })
            .map((el) => { var _a; return (_a = el.alias) !== null && _a !== void 0 ? _a : el.sourceName; });
        util_1.setExtend(this.dropPropertyAccesses, localNames);
        return new o_tree_1.OTree([], imports, { canBreakLine: true, separator: '\n' });
    }
    classDeclaration(node, renderer) {
        return this.renderClassDeclaration(node, renderer);
    }
    structInterfaceDeclaration(node, renderer) {
        // Render structs as simple Java classes with getters, and setters that return `this`.
        // This is a compromise between brevity
        // (rendering a full inner static Builder class, like JSII uses, would be quite verbose)
        // and ease of use
        // (fluent setters allow us to mirror JavaScript object literals more closely than classic,
        // void-returning setters would).
        return this.renderClassDeclaration(node, renderer);
    }
    regularInterfaceDeclaration(node, renderer) {
        return new o_tree_1.OTree([
            'public ',
            'interface ',
            renderer.convert(node.name),
            ...this.typeHeritage(node, renderer.updateContext({ discardPropertyAccess: true })),
            ' {',
        ], renderer
            .updateContext({
            insideTypeDeclaration: { typeName: node.name, isInterface: true },
        })
            .convertAll(node.members), {
            indent: 4,
            canBreakLine: true,
            suffix: '\n}',
        });
    }
    propertySignature(node, renderer) {
        var _a;
        const propertyType = this.renderTypeNode(node.type, renderer, 'Object');
        const propertyName = renderer.convert(node.name);
        const isClass = !((_a = renderer.currentContext.insideTypeDeclaration) === null || _a === void 0 ? void 0 : _a.isInterface);
        const blockSep = isClass ? ' ' : ';';
        const field = isClass
            ? new o_tree_1.OTree([], ['private ', propertyType, ' ', propertyName, ';'], {
                canBreakLine: true,
            })
            : o_tree_1.NO_SYNTAX;
        const getter = new o_tree_1.OTree([], [
            isClass ? 'public ' : o_tree_1.NO_SYNTAX,
            propertyType,
            ' ',
            `get${capitalize(renderer.textOf(node.name))}()${blockSep}`,
            isClass ? this.renderBlock([new o_tree_1.OTree(['\n'], ['return this.', propertyName, ';'])]) : o_tree_1.NO_SYNTAX,
        ], {
            canBreakLine: true,
        });
        const hasSetter = isClass || !ast_utils_1.isReadOnly(node);
        const setter = hasSetter
            ? new o_tree_1.OTree([], [
                isClass ? 'public ' : o_tree_1.NO_SYNTAX,
                renderer.convert(renderer.currentContext.insideTypeDeclaration.typeName),
                ' ',
                propertyName,
                '(',
                propertyType,
                ' ',
                propertyName,
                `)${blockSep}`,
                isClass
                    ? this.renderBlock([
                        new o_tree_1.OTree(['\n'], ['this.', propertyName, ' = ', propertyName, ';']),
                        new o_tree_1.OTree(['\n'], ['return this;']),
                    ])
                    : o_tree_1.NO_SYNTAX,
            ], {
                canBreakLine: true,
            })
            : o_tree_1.NO_SYNTAX;
        return new o_tree_1.OTree([], [field, getter, setter], {
            canBreakLine: true,
            separator: '\n',
        });
    }
    propertyDeclaration(node, renderer) {
        const vis = ast_utils_1.visibility(node);
        return new o_tree_1.OTree([
            vis,
            ast_utils_1.isReadOnly(node) ? ' final' : '',
            ' ',
            this.renderTypeNode(node.type, renderer, 'Object'),
            ' ',
            renderer.convert(node.name),
            ';',
        ], [], {
            canBreakLine: true,
        });
    }
    constructorDeclaration(node, renderer) {
        return this.renderProcedure(node, renderer, renderer.currentContext.insideTypeDeclaration.typeName, undefined);
    }
    methodDeclaration(node, renderer) {
        const retType = types_1.determineReturnType(renderer.typeChecker, node);
        return this.renderProcedure(node, renderer, node.name, this.renderType(node, retType, renderer, 'void'));
    }
    functionDeclaration(node, renderer) {
        const retType = types_1.determineReturnType(renderer.typeChecker, node);
        return this.renderProcedure(node, renderer, node.name, this.renderType(node, retType, renderer, 'void'));
    }
    methodSignature(node, renderer) {
        return new o_tree_1.OTree([
            this.renderTypeNode(node.type, renderer, 'void'),
            ' ',
            renderer.convert(node.name),
            '(',
            new o_tree_1.OTree([], renderer.convertAll(node.parameters), {
                separator: ', ',
            }),
            ');',
        ], [], { canBreakLine: true });
    }
    parameterDeclaration(node, renderer) {
        let renderedType = this.renderTypeNode(node.type, renderer);
        if (node.dotDotDotToken && renderedType.endsWith('[]')) {
            // Varargs. In Java, render this as `Element...` (instead of `Element[]` which is what we'll have gotten).
            renderedType = `${renderedType.substr(0, renderedType.length - 2)}...`;
        }
        return new o_tree_1.OTree([renderedType, ' ', renderer.convert(node.name)]);
    }
    block(node, renderer) {
        return this.renderBlock(renderer.convertAll(node.statements));
    }
    variableDeclaration(node, renderer) {
        let fallback = 'Object';
        if (node.type) {
            fallback = node.type.getText();
        }
        const type = (node.type && renderer.typeOfType(node.type)) ||
            (node.initializer && renderer.typeOfExpression(node.initializer));
        const renderedType = type ? this.renderType(node, type, renderer, fallback) : fallback;
        if (!node.initializer) {
            return new o_tree_1.OTree([renderedType, ' ', renderer.convert(node.name), ';'], []);
        }
        return new o_tree_1.OTree([
            renderedType,
            ' ',
            renderer.convert(node.name),
            ...(node.initializer ? [' = ', renderer.convert(node.initializer)] : []),
            ';',
        ], [], {
            canBreakLine: true,
        });
    }
    expressionStatement(node, renderer) {
        const inner = renderer.convert(node.expression);
        return inner.isEmpty ? inner : new o_tree_1.OTree([inner, ';'], [], { canBreakLine: true });
    }
    ifStatement(node, renderer) {
        const ifStmt = new o_tree_1.OTree(['if (', renderer.convert(node.expression), ') '], [renderer.convert(node.thenStatement)], {
            canBreakLine: true,
        });
        const elseStmt = node.elseStatement
            ? new o_tree_1.OTree(['else '], [renderer.convert(node.elseStatement)], {
                canBreakLine: true,
            })
            : undefined;
        return elseStmt
            ? new o_tree_1.OTree([], [ifStmt, elseStmt], {
                separator: ' ',
                canBreakLine: true,
            })
            : ifStmt;
    }
    forOfStatement(node, renderer) {
        // This is what a "for (const x of ...)" looks like in the AST
        let variableName = '???';
        ast_utils_1.matchAst(node.initializer, ast_utils_1.nodeOfType(ts.SyntaxKind.VariableDeclarationList, ast_utils_1.nodeOfType('var', ts.SyntaxKind.VariableDeclaration)), (bindings) => {
            variableName = renderer.textOf(bindings.var.name);
        });
        return new o_tree_1.OTree(['for (Object ', variableName, ' : ', renderer.convert(node.expression), ') '], [renderer.convert(node.statement)], {
            canBreakLine: true,
        });
    }
    printStatement(args, renderer) {
        return new o_tree_1.OTree([
            'System.out.println(',
            args.length === 1 ? renderer.convert(args[0]) : new o_tree_1.OTree([], renderer.convertAll(args), { separator: ' + ' }),
            ')',
        ]);
    }
    templateExpression(node, renderer) {
        let template = '';
        const parameters = new Array();
        if (node.head.rawText) {
            template += node.head.rawText;
        }
        for (const span of node.templateSpans) {
            template += '%s';
            parameters.push(renderer
                .updateContext({
                convertPropertyToGetter: true,
                identifierAsString: false,
            })
                .convert(span.expression));
            if (span.literal.rawText) {
                template += span.literal.rawText;
            }
        }
        if (parameters.length === 0) {
            return new o_tree_1.OTree([JSON.stringify(ast_utils_1.quoteStringLiteral(template))]);
        }
        return new o_tree_1.OTree([
            'String.format(',
            `"${ast_utils_1.quoteStringLiteral(template)
                // Java does not have multiline string literals, so we must replace literal newlines with %n
                .replace(/\n/g, '%n')}"`,
            ...parameters.reduce((list, element) => list.concat(', ', element), new Array()),
            ')',
        ]);
    }
    asExpression(node, renderer) {
        return new o_tree_1.OTree(['(', this.renderTypeNode(node.type, renderer, 'Object'), ')', renderer.convert(node.expression)]);
    }
    arrayLiteralExpression(node, renderer) {
        return new o_tree_1.OTree(['List.of('], renderer.convertAll(node.elements), {
            separator: ', ',
            suffix: ')',
            indent: 4,
        });
    }
    regularCallExpression(node, renderer) {
        return new o_tree_1.OTree([
            renderer.updateContext({ convertPropertyToGetter: false }).convert(node.expression),
            '(',
            this.argumentList(node.arguments, renderer),
            ')',
        ]);
    }
    newExpression(node, renderer) {
        const argsLength = node.arguments ? node.arguments.length : 0;
        const lastArg = argsLength > 0 ? node.arguments[argsLength - 1] : undefined;
        // We render the ClassName.Builder.create(...) expression
        // if the last argument is an object literal, and either a known struct (because
        // those are the jsii rules) or an unknown type (because the example didn't
        // compile but most of the target examples will intend this to be a struct).
        const structArgument = lastArg && ts.isObjectLiteralExpression(lastArg) ? lastArg : undefined;
        let renderBuilder = false;
        if (lastArg && ts.isObjectLiteralExpression(lastArg)) {
            const analysis = jsii_types_1.analyzeObjectLiteral(renderer.typeChecker, lastArg);
            renderBuilder = analysis.kind === 'struct' || analysis.kind === 'unknown';
        }
        const className = renderer
            .updateContext({
            discardPropertyAccess: true,
            convertPropertyToGetter: false,
        })
            .convert(node.expression);
        if (renderBuilder) {
            const initialArguments = node.arguments.slice(0, argsLength - 1);
            return new o_tree_1.OTree([], [
                className,
                '.Builder.create(',
                this.argumentList(initialArguments, renderer),
                ')',
                ...renderer.convertAll(structArgument.properties),
                new o_tree_1.OTree([renderer.mirrorNewlineBefore(structArgument.properties[0])], ['.build()']),
            ], { canBreakLine: true, indent: 8 });
        }
        return new o_tree_1.OTree([], ['new ', className, '(', this.argumentList(node.arguments, renderer), ')'], {
            canBreakLine: true,
        });
    }
    unknownTypeObjectLiteralExpression(node, renderer) {
        return renderer.currentContext.inNewExprWithObjectLiteralAsLastArg
            ? this.renderObjectLiteralAsBuilder(node, renderer)
            : this.keyValueObjectLiteralExpression(node, renderer);
    }
    keyValueObjectLiteralExpression(node, renderer) {
        return new o_tree_1.OTree(['Map.of('], renderer.updateContext({ inKeyValueList: true }).convertAll(node.properties), {
            suffix: ')',
            separator: ', ',
            indent: 8,
        });
    }
    knownStructObjectLiteralExpression(node, structType, renderer) {
        // Special case: we're rendering an object literal, but the containing constructor
        // has already started the builder: we don't have to create a new instance,
        // all we have to do is pile on arguments.
        if (renderer.currentContext.inNewExprWithObjectLiteralAsLastArg) {
            return new o_tree_1.OTree([], renderer.convertAll(node.properties), { indent: 8 });
        }
        // Jsii-generated classes have builders, classes we generated in the course of
        // this example do not.
        const hasBuilder = structType.kind !== 'local-struct';
        return new o_tree_1.OTree(hasBuilder ? [structType.type.symbol.name, '.builder()'] : ['new ', structType.type.symbol.name, '()'], [
            ...renderer.convertAll(node.properties),
            new o_tree_1.OTree([renderer.mirrorNewlineBefore(node.properties[0])], [hasBuilder ? '.build()' : '']),
        ], {
            indent: 8,
        });
    }
    propertyAssignment(node, renderer) {
        return renderer.currentContext.inKeyValueList
            ? this.singlePropertyInJavaScriptObjectLiteralToJavaMap(node.name, node.initializer, renderer)
            : this.singlePropertyInJavaScriptObjectLiteralToFluentSetters(node.name, node.initializer, renderer);
    }
    shorthandPropertyAssignment(node, renderer) {
        return renderer.currentContext.inKeyValueList
            ? this.singlePropertyInJavaScriptObjectLiteralToJavaMap(node.name, node.name, renderer)
            : this.singlePropertyInJavaScriptObjectLiteralToFluentSetters(node.name, node.name, renderer);
    }
    propertyAccessExpression(node, renderer) {
        const rightHandSide = renderer.convert(node.name);
        let parts;
        const leftHandSide = renderer.textOf(node.expression);
        // Suppress the LHS of the dot operator if it matches an alias for a module import.
        if (this.dropPropertyAccesses.has(leftHandSide) || renderer.currentContext.discardPropertyAccess) {
            parts = [rightHandSide];
        }
        else if (leftHandSide === 'this') {
            // for 'this', assume this is a field, and access it directly
            parts = ['this', '.', rightHandSide];
        }
        else {
            let convertToGetter = renderer.currentContext.convertPropertyToGetter !== false;
            // See if we're not accessing an enum member or public static readonly property (const).
            if (types_1.isEnumAccess(renderer.typeChecker, node)) {
                convertToGetter = false;
            }
            if (types_1.isStaticReadonlyAccess(renderer.typeChecker, node)) {
                convertToGetter = false;
            }
            // add a 'get' prefix to the property name, and change the access to a method call, if required
            const renderedRightHandSide = convertToGetter ? `get${capitalize(node.name.text)}()` : rightHandSide;
            // strip any trailing ! from the left-hand side, as they're not meaningful in Java
            parts = [renderer.convert(node.expression), '.', renderedRightHandSide];
        }
        return new o_tree_1.OTree(parts);
    }
    stringLiteral(node, renderer) {
        if (renderer.currentContext.stringLiteralAsIdentifier) {
            return this.identifier(node, renderer);
        }
        // Java does not have multiline string literals, so we must replace literal newlines with \n
        return new o_tree_1.OTree([JSON.stringify(node.text).replace(/\n/g, '\\n')]);
    }
    identifier(node, renderer) {
        const nodeText = node.text;
        return new o_tree_1.OTree([renderer.currentContext.identifierAsString ? JSON.stringify(nodeText) : nodeText]);
    }
    renderObjectLiteralAsBuilder(node, renderer) {
        return new o_tree_1.OTree([], [
            ...renderer.convertAll(node.properties),
            new o_tree_1.OTree([renderer.mirrorNewlineBefore(node.properties[0])], ['.build()']),
        ], {
            indent: 8,
        });
    }
    singlePropertyInJavaScriptObjectLiteralToJavaMap(name, initializer, renderer) {
        return new o_tree_1.OTree([], [
            renderer
                .updateContext({
                identifierAsString: !ts.isComputedPropertyName(name),
            })
                .convert(name),
            ', ',
            renderer.updateContext({ inKeyValueList: false }).convert(initializer),
        ], {
            canBreakLine: true,
        });
    }
    singlePropertyInJavaScriptObjectLiteralToFluentSetters(name, initializer, renderer) {
        return new o_tree_1.OTree([], [
            '.',
            renderer.updateContext({ stringLiteralAsIdentifier: true }).convert(name),
            '(',
            renderer.updateContext({ inNewExprWithObjectLiteralAsLastArg: false }).convert(initializer),
            ')',
        ], {
            canBreakLine: true,
        });
    }
    renderClassDeclaration(node, renderer) {
        return new o_tree_1.OTree([
            'public ',
            'class ',
            renderer.convert(node.name),
            ...this.typeHeritage(node, renderer.updateContext({ discardPropertyAccess: true })),
            ' {',
        ], renderer.updateContext({ insideTypeDeclaration: { typeName: node.name } }).convertAll(node.members), {
            indent: 4,
            canBreakLine: true,
            suffix: '\n}',
        });
    }
    typeHeritage(node, renderer) {
        return [
            ...this.extractSuperTypes(node, renderer, ts.SyntaxKind.ExtendsKeyword, 'extends'),
            ...this.extractSuperTypes(node, renderer, ts.SyntaxKind.ImplementsKeyword, 'implements'),
        ];
    }
    extractSuperTypes(node, renderer, heritageKeyword, outputKeyword) {
        var _a;
        const heritageClause = ((_a = node.heritageClauses) !== null && _a !== void 0 ? _a : []).find((hc) => hc.token === heritageKeyword);
        const superTypes = heritageClause ? heritageClause.types.map((t) => renderer.convert(t.expression)) : [];
        return superTypes.length > 0 ? [` ${outputKeyword} `, new o_tree_1.OTree([], superTypes, { separator: ', ' })] : [];
    }
    renderTypeNode(typeNode, renderer, fallback) {
        fallback = fallback !== null && fallback !== void 0 ? fallback : (typeNode
            ? lastElement(renderer.textOf(typeNode).split('.')) // remove any namespace prefixes
            : 'Object');
        if (!typeNode) {
            return fallback;
        }
        return this.renderType(typeNode, renderer.typeOfType(typeNode), renderer, fallback);
    }
    renderType(owningNode, type, renderer, fallback) {
        if (!type) {
            return fallback;
        }
        return doRender(jsii_types_1.determineJsiiType(renderer.typeChecker, type), false);
        // eslint-disable-next-line consistent-return
        function doRender(jsiiType, requiresReferenceType) {
            switch (jsiiType.kind) {
                case 'unknown':
                    return fallback;
                case 'error':
                    renderer.report(owningNode, jsiiType.message);
                    return fallback;
                case 'map':
                    return `Map<String, ${doRender(jsiiType.elementType, true)}>`;
                case 'list':
                    return `${doRender(jsiiType.elementType, true)}[]`;
                case 'namedType':
                    return jsiiType.name;
                case 'builtIn':
                    switch (jsiiType.builtIn) {
                        case 'boolean':
                            return requiresReferenceType ? 'Boolean' : 'boolean';
                        case 'number':
                            return 'Number';
                        case 'string':
                            return 'String';
                        case 'any':
                            return 'Object';
                        default:
                            return jsiiType.builtIn;
                    }
            }
        }
    }
    renderProcedure(node, renderer, methodOrConstructorName, returnType) {
        const overloads = new Array();
        for (let i = 0; i < node.parameters.length; i++) {
            const param = node.parameters[i];
            if (!!param.questionToken || !!param.initializer) {
                // The parameter is either optional, or has a default -
                // render an overload that delegates to a version with one more parameter.
                // Note that we don't check that all parameters with indexes > i are also optional/have a default -
                // we assume the TypeScript compiler does that for us.
                // parameters up to but excluding the current one
                const parametersUpToIth = node.parameters.slice(0, i);
                // how should the call to the next overload look
                const callExpr = ts.isConstructorDeclaration(node) ? 'this' : renderer.convert(methodOrConstructorName);
                overloads.push(this.renderOverload(returnType, renderer, methodOrConstructorName, parametersUpToIth, 
                // the body is the call to the next overload
                this.renderBlock([
                    new o_tree_1.OTree(['\n', callExpr, '('], [
                        ...parametersUpToIth.map((param) => renderer.convert(param.name)),
                        param.initializer ? renderer.convert(param.initializer) : 'null',
                    ], {
                        separator: ', ',
                        suffix: ');',
                    }),
                ])));
            }
        }
        // render the primary overload
        overloads.push(this.renderOverload(returnType, renderer, methodOrConstructorName, node.parameters, renderer.convert(node.body)));
        return new o_tree_1.OTree([], overloads, {
            canBreakLine: true,
            separator: '\n\n',
        });
    }
    renderOverload(returnType, renderer, methodOrConstructorName, parameters, body) {
        return new o_tree_1.OTree([
            'public ',
            returnType ? `${returnType} ` : undefined,
            renderer.convert(methodOrConstructorName),
            '(',
            new o_tree_1.OTree([], renderer.convertAll(parameters), { separator: ', ' }),
            ') ',
        ], [body], {
            canBreakLine: true,
        });
    }
    renderBlock(blockContents) {
        return new o_tree_1.OTree(['{'], blockContents, {
            indent: 4,
            suffix: '\n}',
        });
    }
}
exports.JavaVisitor = JavaVisitor;
/**
 * Translation version
 *
 * Bump this when you change something in the implementation to invalidate
 * existing cached translations.
 */
JavaVisitor.VERSION = '1';
function capitalize(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
}
function lastElement(strings) {
    return strings[strings.length - 1];
}
/**
 * Find the Java name of a module or type
 */
function findJavaName(jsiiSymbol) {
    var _a, _b;
    if (!((_a = jsiiSymbol.sourceAssembly) === null || _a === void 0 ? void 0 : _a.assembly)) {
        // Don't have accurate info, just guess
        return jsiiSymbol.symbolType !== 'module' ? jsii_utils_1.simpleName(jsiiSymbol.fqn) : guessJavaNamespaceName(jsiiSymbol.fqn);
    }
    const asm = (_b = jsiiSymbol.sourceAssembly) === null || _b === void 0 ? void 0 : _b.assembly;
    return recurse(jsiiSymbol.fqn);
    function recurse(fqn) {
        var _a, _b;
        if (fqn === asm.name) {
            return (_a = packages_1.jsiiTargetParameter(asm, 'java.package')) !== null && _a !== void 0 ? _a : guessJavaNamespaceName(fqn);
        }
        if ((_b = asm.submodules) === null || _b === void 0 ? void 0 : _b[fqn]) {
            const modName = packages_1.jsiiTargetParameter(asm.submodules[fqn], 'java.package');
            if (modName) {
                return modName;
            }
        }
        return `${recurse(jsii_utils_1.namespaceName(fqn))}.${jsii_utils_1.simpleName(jsiiSymbol.fqn)}`;
    }
}
function guessJavaNamespaceName(packageName) {
    return packageName
        .split(/[^a-zA-Z0-9]+/g)
        .filter((s) => s !== '')
        .join('.');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiamF2YS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImphdmEudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsaUNBQWlDO0FBRWpDLG1EQUE0RztBQUM1RyxtREFBMkU7QUFDM0UsK0NBQXVEO0FBQ3ZELGtFQUE4RDtBQUM5RCxzQ0FBNkM7QUFFN0MsdURBQTJHO0FBRTNHLCtDQUFnRztBQUNoRyxrQ0FBMEM7QUFDMUMsdUNBQTJDO0FBc0YzQyxNQUFhLFdBQVksU0FBUSx3QkFBMkI7SUFBNUQ7O1FBU0U7Ozs7V0FJRztRQUNjLHlCQUFvQixHQUFHLElBQUksR0FBRyxFQUFVLENBQUM7UUFFMUMsYUFBUSxHQUFHLGdDQUFjLENBQUMsSUFBSSxDQUFDO1FBQy9CLG1CQUFjLEdBQUcsRUFBRSxDQUFDO0lBMHNCdEMsQ0FBQztJQXhzQlEsWUFBWSxDQUFDLEdBQWdCLEVBQUUsTUFBNEI7UUFDaEUsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVNLGVBQWUsQ0FBQyxlQUFnQzs7UUFDckQsTUFBTSxnQkFBZ0IsR0FBRyxzQkFBc0IsQ0FBQyxlQUFlLENBQUMsV0FBVyxDQUFDLENBQUM7UUFFN0UsSUFBSSxlQUFlLENBQUMsT0FBTyxDQUFDLE1BQU0sS0FBSyxNQUFNLEVBQUU7WUFDN0MsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzdELE1BQU0sU0FBUyxTQUFHLFdBQUksQ0FBQyxlQUFlLENBQUMsWUFBWSxFQUFFLFlBQVksQ0FBQyxtQ0FBSSxnQkFBZ0IsQ0FBQztZQUV2RixPQUFPLElBQUksY0FBSyxDQUFDLENBQUMsVUFBVSxTQUFTLEtBQUssQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1NBQzFFO1FBRUQsTUFBTSxP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LENBQUMsZ0JBQWdCLENBQUM7U0FDdkIsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO1NBQ3ZCLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNmLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyB0cyBmcm9tICd0eXBlc2NyaXB0JztcblxuaW1wb3J0IHsgZGV0ZXJtaW5lSnNpaVR5cGUsIEpzaWlUeXBlLCBhbmFseXplT2JqZWN0TGl0ZXJhbCwgT2JqZWN0TGl0ZXJhbFN0cnVjdCB9IGZyb20gJy4uL2pzaWkvanNpaS10eXBlcyc7XG5pbXBvcnQgeyBKc2lpU3ltYm9sLCBzaW1wbGVOYW1lLCBuYW1lc3BhY2VOYW1lIH0gZnJvbSAnLi4vanNpaS9qc2lpLXV0aWxzJztcbmltcG9ydCB7IGpzaWlUYXJnZXRQYXJhbWV0ZXIgfSBmcm9tICcuLi9qc2lpL3BhY2thZ2VzJztcbmltcG9ydCB7IFRhcmdldExhbmd1YWdlIH0gZnJvbSAnLi4vbGFuZ3VhZ2VzL3RhcmdldC1sYW5ndWFnZSc7XG5pbXBvcnQgeyBPVHJlZSwgTk9fU1lOVEFYIH0gZnJvbSAnLi4vby10cmVlJztcbmltcG9ydCB7IEFzdFJlbmRlcmVyIH0gZnJvbSAnLi4vcmVuZGVyZXInO1xuaW1wb3J0IHsgaXNSZWFkT25seSwgbWF0Y2hBc3QsIG5vZGVPZlR5cGUsIHF1b3RlU3RyaW5nTGl0ZXJhbCwgdmlzaWJpbGl0eSB9IGZyb20gJy4uL3R5cGVzY3JpcHQvYXN0LXV0aWxzJztcbmltcG9ydCB7IEltcG9ydFN0YXRlbWVudCB9IGZyb20gJy4uL3R5cGVzY3JpcHQvaW1wb3J0cyc7XG5pbXBvcnQgeyBpc0VudW1BY2Nlc3MsIGlzU3RhdGljUmVhZG9ubHlBY2Nlc3MsIGRldGVybWluZVJldHVyblR5cGUgfSBmcm9tICcuLi90eXBlc2NyaXB0L3R5cGVzJztcbmltcG9ydCB7IGZtYXAsIHNldEV4dGVuZCB9IGZyb20gJy4uL3V0aWwnO1xuaW1wb3J0IHsgRGVmYXVsdFZpc2l0b3IgfSBmcm9tICcuL2RlZmF1bHQnO1xuXG5pbnRlcmZhY2UgSmF2YUNvbnRleHQge1xuICAvKipcbiAgICogV2hldGhlciB0byBpZ25vcmUgdGhlIGxlZnQtaGFuZCBwYXJ0IG9mIGEgcHJvcGVydHkgYWNjZXNzIGV4cHJlc3Npb24uXG4gICAqXG4gICAqIFVzZWQgdG8gc3RyaXAgb3V0IFR5cGVTY3JpcHQgbmFtZXNwYWNlIHByZWZpeGVzIGZyb20gJ2V4dGVuZHMnIGFuZCAnbmV3JyBjbGF1c2VzLFxuICAgKiBFVkVOIGlmIHRoZSBzb3VyY2UgZG9lc24ndCBjb21waWxlLlxuICAgKlxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgZGlzY2FyZFByb3BlcnR5QWNjZXNzPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogV2hldGhlciBhIHByb3BlcnR5IGFjY2VzcyAoJ3N0aC5iJykgc2hvdWxkIGJlIHN1YnN0aXR1dGVkIGJ5IGEgZ2V0dGVyICgnc3RoLmdldEIoKScpLlxuICAgKiBOb3QgdHJ1ZSBmb3IgJ25ldycgZXhwcmVzc2lvbnMgYW5kIGNhbGxzIHRvIG1ldGhvZHMgb24gb2JqZWN0cy5cbiAgICpcbiAgICogQGRlZmF1bHQgdHJ1ZVxuICAgKi9cbiAgcmVhZG9ubHkgY29udmVydFByb3BlcnR5VG9HZXR0ZXI/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBTZXQgd2hlbiB3ZSBhcmUgaW4gdGhlIG1pZGRsZSB0cmFuc2xhdGluZyBhIHR5cGUgKD0gY2xhc3MsIGludGVyZmFjZSBvciBlbnVtKSBkZWNsYXJhdGlvbi5cbiAgICovXG4gIHJlYWRvbmx5IGluc2lkZVR5cGVEZWNsYXJhdGlvbj86IEluc2lkZVR5cGVEZWNsYXJhdGlvbjtcblxuICAvKipcbiAgICogVHJ1ZSBpZiB3ZSBhcmUgaW4gdGhlIG1pZGRsZSBvZiBhIGBuZXdgIGV4cHJlc3Npb24gdGhhdCBoYXMgYW4gb2JqZWN0IGxpdGVyYWwgYXMgaXRzIGxhc3QgYXJndW1lbnQgLVxuICAgKiBpbiB0aGF0IGNhc2UsIHdlIHJlbmRlciBhIENsYXNzTmFtZS5CdWlsZGVyLmNyZWF0ZSguLi4pLnByb3AoLi4uKS5idWlsZCgpIGV4cHJlc3Npb24gaW5zdGVhZC5cbiAgICpcbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHJlYWRvbmx5IGluTmV3RXhwcldpdGhPYmplY3RMaXRlcmFsQXNMYXN0QXJnPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogVHJ1ZSB3aGVuLCBmcm9tIHRoZSBjb250ZXh0LFxuICAgKiB3ZSBhcmUgc3VwcG9zZWQgdG8gcmVuZGVyIGEgSmF2YVNjcmlwdCBvYmplY3QgbGl0ZXJhbCBhcyBhIE1hcCBpbiBKYXZhLlxuICAgKlxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgaW5LZXlWYWx1ZUxpc3Q/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBVc2VkIHdoZW4gcmVuZGVyaW5nIGEgSmF2YVNjcmlwdCBvYmplY3QgbGl0ZXJhbCB0aGF0IGlzIF9ub3RfIGZvciBhIHN0cnVjdCAtXG4gICAqIHdlIHJlbmRlciB0aGF0IGFzIGEgTWFwIGluIEphdmEuXG4gICAqXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICByZWFkb25seSBpZGVudGlmaWVyQXNTdHJpbmc/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBVc2VkIHdoZW4gcmVuZGVyaW5nIGEgSmF2YVNjcmlwdCBvYmplY3QgbGl0ZXJhbCB0aGF0IGlzIGZvciBhIHN0cnVjdCAtXG4gICAqIG1hcHMgdG8gYSBCdWlsZGVyIGluIEphdmEuXG4gICAqXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICByZWFkb25seSBzdHJpbmdMaXRlcmFsQXNJZGVudGlmaWVyPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogVXNlZCB0byBkZW5vdGUgdGhhdCBhIHR5cGUgaXMgYmVpbmcgcmVuZGVyZWQgaW4gYSBwb3NpdGlvbiB3aGVyZSBhIGdlbmVyaWNcbiAgICogdHlwZSBwYXJhbWV0ZXIgaXMgZXhwZWN0ZWQsIHNvIG9ubHkgcmVmZXJlbmNlIHR5cGVzIGFyZSB2YWxpZCAobm90XG4gICAqIHByaW1pdGl2ZXMpLlxuICAgKlxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgcmVxdWlyZXNSZWZlcmVuY2VUeXBlPzogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBWYWx1ZXMgc2F2ZWQgd2hlbiB3ZSBhcmUgdHJhbnNsYXRpbmcgYSB0eXBlIGRlY2xhcmF0aW9uLlxuICovXG5pbnRlcmZhY2UgSW5zaWRlVHlwZURlY2xhcmF0aW9uIHtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSB0eXBlLlxuICAgKiBOZWVkZWQgdG8gY29ycmVjdGx5IGdlbmVyYXRlIHRoZSBjb25zdHJ1Y3Rvci5cbiAgICovXG4gIHJlYWRvbmx5IHR5cGVOYW1lOiB0cy5Ob2RlIHwgdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBJcyB0aGlzIGFuIGludGVyZmFjZSAodHJ1ZSkgb3IgYSBjbGFzcyAodW5zZXQvZmFsc2UpXG4gICAqL1xuICByZWFkb25seSBpc0ludGVyZmFjZT86IGJvb2xlYW47XG59XG5cbnR5cGUgSmF2YVJlbmRlcmVyID0gQXN0UmVuZGVyZXI8SmF2YUNvbnRleHQ+O1xuXG5leHBvcnQgY2xhc3MgSmF2YVZpc2l0b3IgZXh0ZW5kcyBEZWZhdWx0VmlzaXRvcjxKYXZhQ29udGV4dD4ge1xuICAvKipcbiAgICogVHJhbnNsYXRpb24gdmVyc2lvblxuICAgKlxuICAgKiBCdW1wIHRoaXMgd2hlbiB5b3UgY2hhbmdlIHNvbWV0aGluZyBpbiB0aGUgaW1wbGVtZW50YXRpb24gdG8gaW52YWxpZGF0ZVxuICAgKiBleGlzdGluZyBjYWNoZWQgdHJhbnNsYXRpb25zLlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBWRVJTSU9OID0gJzEnO1xuXG4gIC8qKlxuICAgKiBBbGlhc2VzIGZvciBtb2R1bGVzXG4gICAqXG4gICAqIElmIHRoZXNlIGFyZSBlbmNvdW50ZXJlZCBpbiB0aGUgTEhTIG9mIGEgcHJvcGVydHkgYWNjZXNzLCB0aGV5IHdpbGwgYmUgZHJvcHBlZC5cbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgZHJvcFByb3BlcnR5QWNjZXNzZXMgPSBuZXcgU2V0PHN0cmluZz4oKTtcblxuICBwdWJsaWMgcmVhZG9ubHkgbGFuZ3VhZ2UgPSBUYXJnZXRMYW5ndWFnZS5KQVZBO1xuICBwdWJsaWMgcmVhZG9ubHkgZGVmYXVsdENvbnRleHQgPSB7fTtcblxuICBwdWJsaWMgbWVyZ2VDb250ZXh0KG9sZDogSmF2YUNvbnRleHQsIHVwZGF0ZTogUGFydGlhbDxKYXZhQ29udGV4dD4pOiBKYXZhQ29udGV4dCB7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIG9sZCwgdXBkYXRlKTtcbiAgfVxuXG4gIHB1YmxpYyBpbXBvcnRTdGF0ZW1lbnQoaW1wb3J0U3RhdGVtZW50OiBJbXBvcnRTdGF0ZW1lbnQpOiBPVHJlZSB7XG4gICAgY29uc3QgZ3Vlc3NlZE5hbWVzcGFjZSA9IGd1ZXNzSmF2YU5hbWVzcGFjZU5hbWUoaW1wb3J0U3RhdGVtZW50LnBhY2thZ2VOYW1lKTtcblxuICAgIGlmIChpbXBvcnRTdGF0ZW1lbnQuaW1wb3J0cy5pbXBvcnQgPT09ICdmdWxsJykge1xuICAgICAgdGhpcy5kcm9wUHJvcGVydHlBY2Nlc3Nlcy5hZGQoaW1wb3J0U3RhdGVtZW50LmltcG9ydHMuYWxpYXMpO1xuICAgICAgY29uc3QgbmFtZXNwYWNlID0gZm1hcChpbXBvcnRTdGF0ZW1lbnQubW9kdWxlU3ltYm9sLCBmaW5kSmF2YU5hbWUpID8/IGd1ZXNzZWROYW1lc3BhY2U7XG5cbiAgICAgIHJldHVybiBuZXcgT1RyZWUoW2BpbXBvcnQgJHtuYW1lc3BhY2V9Lio7YF0sIFtdLCB7IGNhbkJyZWFrTGluZTogdHJ1ZSB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBpbXBvcnRzID0gaW1wb3J0U3RhdGVtZW50LmltcG9ydHMuZWxlbWVudHMubWFwKChlKSA9PiB7XG4gICAgICBjb25zdCBmcW4gPSBmbWFwKGUuaW1wb3J0ZWRTeW1ib2wsIGZpbmRKYXZhTmFtZSkgPz8gYCR7Z3Vlc3NlZE5hbWVzcGFjZX0uJHtlLnNvdXJjZU5hbWV9YDtcblxuICAgICAgcmV0dXJuIGUuaW1wb3J0ZWRTeW1ib2w/LnN5bWJvbFR5cGUgPT09ICdtb2R1bGUnID8gYGltcG9ydCAke2Zxbn0uKjtgIDogYGltcG9ydCAke2Zxbn07YDtcbiAgICB9KTtcblxuICAgIGNvbnN0IGxvY2FsTmFtZXMgPSBpbXBvcnRTdGF0ZW1lbnQuaW1wb3J0cy5lbGVtZW50c1xuICAgICAgLmZpbHRlcigoZWwpID0+IGVsLmltcG9ydGVkU3ltYm9sPy5zeW1ib2xUeXBlID09PSAnbW9kdWxlJylcbiAgICAgIC5tYXAoKGVsKSA9PiBlbC5hbGlhcyA/PyBlbC5zb3VyY2VOYW1lKTtcbiAgICBzZXRFeHRlbmQodGhpcy5kcm9wUHJvcGVydHlBY2Nlc3NlcywgbG9jYWxOYW1lcyk7XG5cbiAgICByZXR1cm4gbmV3IE9UcmVlKFtdLCBpbXBvcnRzLCB7IGNhbkJyZWFrTGluZTogdHJ1ZSwgc2VwYXJhdG9yOiAnXFxuJyB9KTtcbiAgfVxuXG4gIHB1YmxpYyBjbGFzc0RlY2xhcmF0aW9uKG5vZGU6IHRzLkNsYXNzRGVjbGFyYXRpb24sIHJlbmRlcmVyOiBKYXZhUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgcmV0dXJuIHRoaXMucmVuZGVyQ2xhc3NEZWNsYXJhdGlvbihub2RlLCByZW5kZXJlcik7XG4gIH1cblxuICBwdWJsaWMgc3RydWN0SW50ZXJmYWNlRGVjbGFyYXRpb24obm9kZTogdHMuSW50ZXJmYWNlRGVjbGFyYXRpb24sIHJlbmRlcmVyOiBKYXZhUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgLy8gUmVuZGVyIHN0cnVjdHMgYXMgc2ltcGxlIEphdmEgY2xhc3NlcyB3aXRoIGdldHRlcnMsIGFuZCBzZXR0ZXJzIHRoYXQgcmV0dXJuIGB0aGlzYC5cbiAgICAvLyBUaGlzIGlzIGEgY29tcHJvbWlzZSBiZXR3ZWVuIGJyZXZpdHlcbiAgICAvLyAocmVuZGVyaW5nIGEgZnVsbCBpbm5lciBzdGF0aWMgQnVpbGRlciBjbGFzcywgbGlrZSBKU0lJIHVzZXMsIHdvdWxkIGJlIHF1aXRlIHZlcmJvc2UpXG4gICAgLy8gYW5kIGVhc2Ugb2YgdXNlXG4gICAgLy8gKGZsdWVudCBzZXR0ZXJzIGFsbG93IHVzIHRvIG1pcnJvciBKYXZhU2NyaXB0IG9iamVjdCBsaXRlcmFscyBtb3JlIGNsb3NlbHkgdGhhbiBjbGFzc2ljLFxuICAgIC8vIHZvaWQtcmV0dXJuaW5nIHNldHRlcnMgd291bGQpLlxuXG4gICAgcmV0dXJuIHRoaXMucmVuZGVyQ2xhc3NEZWNsYXJhdGlvbihub2RlLCByZW5kZXJlcik7XG4gIH1cblxuICBwdWJsaWMgcmVndWxhckludGVyZmFjZURlY2xhcmF0aW9uKG5vZGU6IHRzLkludGVyZmFjZURlY2xhcmF0aW9uLCByZW5kZXJlcjogSmF2YVJlbmRlcmVyKTogT1RyZWUge1xuICAgIHJldHVybiBuZXcgT1RyZWUoXG4gICAgICBbXG4gICAgICAgICdwdWJsaWMgJyxcbiAgICAgICAgJ2ludGVyZmFjZSAnLFxuICAgICAgICByZW5kZXJlci5jb252ZXJ0KG5vZGUubmFtZSksXG4gICAgICAgIC4uLnRoaXMudHlwZUhlcml0YWdlKG5vZGUsIHJlbmRlcmVyLnVwZGF0ZUNvbnRleHQoeyBkaXNjYXJkUHJvcGVydHlBY2Nlc3M6IHRydWUgfSkpLFxuICAgICAgICAnIHsnLFxuICAgICAgXSxcbiAgICAgIHJlbmRlcmVyXG4gICAgICAgIC51cGRhdGVDb250ZXh0KHtcbiAgICAgICAgICBpbnNpZGVUeXBlRGVjbGFyYXRpb246IHsgdHlwZU5hbWU6IG5vZGUubmFtZSwgaXNJbnRlcmZhY2U6IHRydWUgfSxcbiAgICAgICAgfSlcbiAgICAgICAgLmNvbnZlcnRBbGwobm9kZS5tZW1iZXJzKSxcbiAgICAgIHtcbiAgICAgICAgaW5kZW50OiA0LFxuICAgICAgICBjYW5CcmVha0xpbmU6IHRydWUsXG4gICAgICAgIHN1ZmZpeDogJ1xcbn0nLFxuICAgICAgfSxcbiAgICApO1xuICB9XG5cbiAgcHVibGljIHByb3BlcnR5U2lnbmF0dXJlKG5vZGU6IHRzLlByb3BlcnR5U2lnbmF0dXJlLCByZW5kZXJlcjogSmF2YVJlbmRlcmVyKTogT1RyZWUge1xuICAgIGNvbnN0IHByb3BlcnR5VHlwZSA9IHRoaXMucmVuZGVyVHlwZU5vZGUobm9kZS50eXBlLCByZW5kZXJlciwgJ09iamVjdCcpO1xuICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHJlbmRlcmVyLmNvbnZlcnQobm9kZS5uYW1lKTtcblxuICAgIGNvbnN0IGlzQ2xhc3MgPSAhcmVuZGVyZXIuY3VycmVudENvbnRleHQuaW5zaWRlVHlwZURlY2xhcmF0aW9uPy5pc0ludGVyZmFjZTtcbiAgICBjb25zdCBibG9ja1NlcCA9IGlzQ2xhc3MgPyAnICcgOiAnOyc7XG5cbiAgICBjb25zdCBmaWVsZCA9IGlzQ2xhc3NcbiAgICAgID8gbmV3IE9UcmVlKFtdLCBbJ3ByaXZhdGUgJywgcHJvcGVydHlUeXBlLCAnICcsIHByb3BlcnR5TmFtZSwgJzsnXSwge1xuICAgICAgICAgIGNhbkJyZWFrTGluZTogdHJ1ZSxcbiAgICAgICAgfSlcbiAgICAgIDogTk9fU1lOVEFYO1xuXG4gICAgY29uc3QgZ2V0dGVyID0gbmV3IE9UcmVlKFxuICAgICAgW10sXG4gICAgICBbXG4gICAgICAgIGlzQ2xhc3MgPyAncHVibGljICcgOiBOT19TWU5UQVgsXG4gICAgICAgIHByb3BlcnR5VHlwZSxcbiAgICAgICAgJyAnLFxuICAgICAgICBgZ2V0JHtjYXBpdGFsaXplKHJlbmRlcmVyLnRleHRPZihub2RlLm5hbWUpKX0oKSR7YmxvY2tTZXB9YCxcbiAgICAgICAgaXNDbGFzcyA/IHRoaXMucmVuZGVyQmxvY2soW25ldyBPVHJlZShbJ1xcbiddLCBbJ3JldHVybiB0aGlzLicsIHByb3BlcnR5TmFtZSwgJzsnXSldKSA6IE5PX1NZTlRBWCxcbiAgICAgIF0sXG4gICAgICB7XG4gICAgICAgIGNhbkJyZWFrTGluZTogdHJ1ZSxcbiAgICAgIH0sXG4gICAgKTtcblxuICAgIGNvbnN0IGhhc1NldHRlciA9IGlzQ2xhc3MgfHwgIWlzUmVhZE9ubHkobm9kZSk7XG5cbiAgICBjb25zdCBzZXR0ZXIgPSBoYXNTZXR0ZXJcbiAgICAgID8gbmV3IE9UcmVlKFxuICAgICAgICAgIFtdLFxuICAgICAgICAgIFtcbiAgICAgICAgICAgIGlzQ2xhc3MgPyAncHVibGljICcgOiBOT19TWU5UQVgsXG4gICAgICAgICAgICByZW5kZXJlci5jb252ZXJ0KHJlbmRlcmVyLmN1cnJlbnRDb250ZXh0Lmluc2lkZVR5cGVEZWNsYXJhdGlvbiEudHlwZU5hbWUpLFxuICAgICAgICAgICAgJyAnLFxuICAgICAgICAgICAgcHJvcGVydHlOYW1lLCAvLyBkb24ndCBwcmVmaXggdGhlIHNldHRlciB3aXRoIGBzZXRgIC0gbWFrZXMgaXQgbW9yZSBhbGlnbmVkIHdpdGggSlNJSSBidWlsZGVyc1xuICAgICAgICAgICAgJygnLFxuICAgICAgICAgICAgcHJvcGVydHlUeXBlLFxuICAgICAgICAgICAgJyAnLFxuICAgICAgICAgICAgcHJvcGVydHlOYW1lLFxuICAgICAgICAgICAgYCkke2Jsb2NrU2VwfWAsXG4gICAgICAgICAgICBpc0NsYXNzXG4gICAgICAgICAgICAgID8gdGhpcy5yZW5kZXJCbG9jayhbXG4gICAgICAgICAgICAgICAgICBuZXcgT1RyZWUoWydcXG4nXSwgWyd0aGlzLicsIHByb3BlcnR5TmFtZSwgJyA9ICcsIHByb3BlcnR5TmFtZSwgJzsnXSksXG4gICAgICAgICAgICAgICAgICBuZXcgT1RyZWUoWydcXG4nXSwgWydyZXR1cm4gdGhpczsnXSksXG4gICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgOiBOT19TWU5UQVgsXG4gICAgICAgICAgXSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBjYW5CcmVha0xpbmU6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgKVxuICAgICAgOiBOT19TWU5UQVg7XG5cbiAgICByZXR1cm4gbmV3IE9UcmVlKFtdLCBbZmllbGQsIGdldHRlciwgc2V0dGVyXSwge1xuICAgICAgY2FuQnJlYWtMaW5lOiB0cnVlLFxuICAgICAgc2VwYXJhdG9yOiAnXFxuJyxcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBwcm9wZXJ0eURlY2xhcmF0aW9uKG5vZGU6IHRzLlByb3BlcnR5RGVjbGFyYXRpb24sIHJlbmRlcmVyOiBKYXZhUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgY29uc3QgdmlzID0gdmlzaWJpbGl0eShub2RlKTtcblxuICAgIHJldHVybiBuZXcgT1RyZWUoXG4gICAgICBbXG4gICAgICAgIHZpcyxcbiAgICAgICAgaXNSZWFkT25seShub2RlKSA/ICcgZmluYWwnIDogJycsXG4gICAgICAgICcgJyxcbiAgICAgICAgdGhpcy5yZW5kZXJUeXBlTm9kZShub2RlLnR5cGUsIHJlbmRlcmVyLCAnT2JqZWN0JyksXG4gICAgICAgICcgJyxcbiAgICAgICAgcmVuZGVyZXIuY29udmVydChub2RlLm5hbWUpLFxuICAgICAgICAnOycsXG4gICAgICBdLFxuICAgICAgW10sXG4gICAgICB7XG4gICAgICAgIGNhbkJyZWFrTGluZTogdHJ1ZSxcbiAgICAgIH0sXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBjb25zdHJ1Y3RvckRlY2xhcmF0aW9uKG5vZGU6IHRzLkNvbnN0cnVjdG9yRGVjbGFyYXRpb24sIHJlbmRlcmVyOiBKYXZhUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgcmV0dXJuIHRoaXMucmVuZGVyUHJvY2VkdXJlKG5vZGUsIHJlbmRlcmVyLCByZW5kZXJlci5jdXJyZW50Q29udGV4dC5pbnNpZGVUeXBlRGVjbGFyYXRpb24hLnR5cGVOYW1lLCB1bmRlZmluZWQpO1xuICB9XG5cbiAgcHVibGljIG1ldGhvZERlY2xhcmF0aW9uKG5vZGU6IHRzLk1ldGhvZERlY2xhcmF0aW9uLCByZW5kZXJlcjogSmF2YVJlbmRlcmVyKTogT1RyZWUge1xuICAgIGNvbnN0IHJldFR5cGUgPSBkZXRlcm1pbmVSZXR1cm5UeXBlKHJlbmRlcmVyLnR5cGVDaGVja2VyLCBub2RlKTtcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJQcm9jZWR1cmUobm9kZSwgcmVuZGVyZXIsIG5vZGUubmFtZSwgdGhpcy5yZW5kZXJUeXBlKG5vZGUsIHJldFR5cGUsIHJlbmRlcmVyLCAndm9pZCcpKTtcbiAgfVxuXG4gIHB1YmxpYyBmdW5jdGlvbkRlY2xhcmF0aW9uKG5vZGU6IHRzLkZ1bmN0aW9uRGVjbGFyYXRpb24sIHJlbmRlcmVyOiBKYXZhUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgY29uc3QgcmV0VHlwZSA9IGRldGVybWluZVJldHVyblR5cGUocmVuZGVyZXIudHlwZUNoZWNrZXIsIG5vZGUpO1xuICAgIHJldHVybiB0aGlzLnJlbmRlclByb2NlZHVyZShub2RlLCByZW5kZXJlciwgbm9kZS5uYW1lLCB0aGlzLnJlbmRlclR5cGUobm9kZSwgcmV0VHlwZSwgcmVuZGVyZXIsICd2b2lkJykpO1xuICB9XG5cbiAgcHVibGljIG1ldGhvZFNpZ25hdHVyZShub2RlOiB0cy5NZXRob2RTaWduYXR1cmUsIHJlbmRlcmVyOiBKYXZhUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShcbiAgICAgIFtcbiAgICAgICAgdGhpcy5yZW5kZXJUeXBlTm9kZShub2RlLnR5cGUsIHJlbmRlcmVyLCAndm9pZCcpLFxuICAgICAgICAnICcsXG4gICAgICAgIHJlbmRlcmVyLmNvbnZlcnQobm9kZS5uYW1lKSxcbiAgICAgICAgJygnLFxuICAgICAgICBuZXcgT1RyZWUoW10sIHJlbmRlcmVyLmNvbnZlcnRBbGwobm9kZS5wYXJhbWV0ZXJzKSwge1xuICAgICAgICAgIHNlcGFyYXRvcjogJywgJyxcbiAgICAgICAgfSksXG4gICAgICAgICcpOycsXG4gICAgICBdLFxuICAgICAgW10sXG4gICAgICB7IGNhbkJyZWFrTGluZTogdHJ1ZSB9LFxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgcGFyYW1ldGVyRGVjbGFyYXRpb24obm9kZTogdHMuUGFyYW1ldGVyRGVjbGFyYXRpb24sIHJlbmRlcmVyOiBKYXZhUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgbGV0IHJlbmRlcmVkVHlwZSA9IHRoaXMucmVuZGVyVHlwZU5vZGUobm9kZS50eXBlLCByZW5kZXJlcik7XG4gICAgaWYgKG5vZGUuZG90RG90RG90VG9rZW4gJiYgcmVuZGVyZWRUeXBlLmVuZHNXaXRoKCdbXScpKSB7XG4gICAgICAvLyBWYXJhcmdzLiBJbiBKYXZhLCByZW5kZXIgdGhpcyBhcyBgRWxlbWVudC4uLmAgKGluc3RlYWQgb2YgYEVsZW1lbnRbXWAgd2hpY2ggaXMgd2hhdCB3ZSdsbCBoYXZlIGdvdHRlbikuXG4gICAgICByZW5kZXJlZFR5cGUgPSBgJHtyZW5kZXJlZFR5cGUuc3Vic3RyKDAsIHJlbmRlcmVkVHlwZS5sZW5ndGggLSAyKX0uLi5gO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgT1RyZWUoW3JlbmRlcmVkVHlwZSwgJyAnLCByZW5kZXJlci5jb252ZXJ0KG5vZGUubmFtZSldKTtcbiAgfVxuXG4gIHB1YmxpYyBibG9jayhub2RlOiB0cy5CbG9jaywgcmVuZGVyZXI6IEphdmFSZW5kZXJlcik6IE9UcmVlIHtcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJCbG9jayhyZW5kZXJlci5jb252ZXJ0QWxsKG5vZGUuc3RhdGVtZW50cykpO1xuICB9XG5cbiAgcHVibGljIHZhcmlhYmxlRGVjbGFyYXRpb24obm9kZTogdHMuVmFyaWFibGVEZWNsYXJhdGlvbiwgcmVuZGVyZXI6IEphdmFSZW5kZXJlcik6IE9UcmVlIHtcbiAgICBsZXQgZmFsbGJhY2sgPSAnT2JqZWN0JztcbiAgICBpZiAobm9kZS50eXBlKSB7XG4gICAgICBmYWxsYmFjayA9IG5vZGUudHlwZS5nZXRUZXh0KCk7XG4gICAgfVxuICAgIGNvbnN0IHR5cGUgPVxuICAgICAgKG5vZGUudHlwZSAmJiByZW5kZXJlci50eXBlT2ZUeXBlKG5vZGUudHlwZSkpIHx8XG4gICAgICAobm9kZS5pbml0aWFsaXplciAmJiByZW5kZXJlci50eXBlT2ZFeHByZXNzaW9uKG5vZGUuaW5pdGlhbGl6ZXIpKTtcblxuICAgIGNvbnN0IHJlbmRlcmVkVHlwZSA9IHR5cGUgPyB0aGlzLnJlbmRlclR5cGUobm9kZSwgdHlwZSwgcmVuZGVyZXIsIGZhbGxiYWNrKSA6IGZhbGxiYWNrO1xuXG4gICAgaWYgKCFub2RlLmluaXRpYWxpemVyKSB7XG4gICAgICByZXR1cm4gbmV3IE9UcmVlKFtyZW5kZXJlZFR5cGUsICcgJywgcmVuZGVyZXIuY29udmVydChub2RlLm5hbWUpLCAnOyddLCBbXSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBPVHJlZShcbiAgICAgIFtcbiAgICAgICAgcmVuZGVyZWRUeXBlLFxuICAgICAgICAnICcsXG4gICAgICAgIHJlbmRlcmVyLmNvbnZlcnQobm9kZS5uYW1lKSxcbiAgICAgICAgLi4uKG5vZGUuaW5pdGlhbGl6ZXIgPyBbJyA9ICcsIHJlbmRlcmVyLmNvbnZlcnQobm9kZS5pbml0aWFsaXplcildIDogW10pLFxuICAgICAgICAnOycsXG4gICAgICBdLFxuICAgICAgW10sXG4gICAgICB7XG4gICAgICAgIGNhbkJyZWFrTGluZTogdHJ1ZSxcbiAgICAgIH0sXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBleHByZXNzaW9uU3RhdGVtZW50KG5vZGU6IHRzLkV4cHJlc3Npb25TdGF0ZW1lbnQsIHJlbmRlcmVyOiBKYXZhUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgY29uc3QgaW5uZXIgPSByZW5kZXJlci5jb252ZXJ0KG5vZGUuZXhwcmVzc2lvbik7XG4gICAgcmV0dXJuIGlubmVyLmlzRW1wdHkgPyBpbm5lciA6IG5ldyBPVHJlZShbaW5uZXIsICc7J10sIFtdLCB7IGNhbkJyZWFrTGluZTogdHJ1ZSB9KTtcbiAgfVxuXG4gIHB1YmxpYyBpZlN0YXRlbWVudChub2RlOiB0cy5JZlN0YXRlbWVudCwgcmVuZGVyZXI6IEphdmFSZW5kZXJlcik6IE9UcmVlIHtcbiAgICBjb25zdCBpZlN0bXQgPSBuZXcgT1RyZWUoXG4gICAgICBbJ2lmICgnLCByZW5kZXJlci5jb252ZXJ0KG5vZGUuZXhwcmVzc2lvbiksICcpICddLFxuICAgICAgW3JlbmRlcmVyLmNvbnZlcnQobm9kZS50aGVuU3RhdGVtZW50KV0sXG4gICAgICB7XG4gICAgICAgIGNhbkJyZWFrTGluZTogdHJ1ZSxcbiAgICAgIH0sXG4gICAgKTtcbiAgICBjb25zdCBlbHNlU3RtdCA9IG5vZGUuZWxzZVN0YXRlbWVudFxuICAgICAgPyBuZXcgT1RyZWUoWydlbHNlICddLCBbcmVuZGVyZXIuY29udmVydChub2RlLmVsc2VTdGF0ZW1lbnQpXSwge1xuICAgICAgICAgIGNhbkJyZWFrTGluZTogdHJ1ZSxcbiAgICAgICAgfSlcbiAgICAgIDogdW5kZWZpbmVkO1xuXG4gICAgcmV0dXJuIGVsc2VTdG10XG4gICAgICA/IG5ldyBPVHJlZShbXSwgW2lmU3RtdCwgZWxzZVN0bXRdLCB7XG4gICAgICAgICAgc2VwYXJhdG9yOiAnICcsXG4gICAgICAgICAgY2FuQnJlYWtMaW5lOiB0cnVlLFxuICAgICAgICB9KVxuICAgICAgOiBpZlN0bXQ7XG4gIH1cblxuICBwdWJsaWMgZm9yT2ZTdGF0ZW1lbnQobm9kZTogdHMuRm9yT2ZTdGF0ZW1lbnQsIHJlbmRlcmVyOiBKYXZhUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgLy8gVGhpcyBpcyB3aGF0IGEgXCJmb3IgKGNvbnN0IHggb2YgLi4uKVwiIGxvb2tzIGxpa2UgaW4gdGhlIEFTVFxuICAgIGxldCB2YXJpYWJsZU5hbWUgPSAnPz8/JztcblxuICAgIG1hdGNoQXN0KFxuICAgICAgbm9kZS5pbml0aWFsaXplcixcbiAgICAgIG5vZGVPZlR5cGUodHMuU3ludGF4S2luZC5WYXJpYWJsZURlY2xhcmF0aW9uTGlzdCwgbm9kZU9mVHlwZSgndmFyJywgdHMuU3ludGF4S2luZC5WYXJpYWJsZURlY2xhcmF0aW9uKSksXG4gICAgICAoYmluZGluZ3MpID0+IHtcbiAgICAgICAgdmFyaWFibGVOYW1lID0gcmVuZGVyZXIudGV4dE9mKGJpbmRpbmdzLnZhci5uYW1lKTtcbiAgICAgIH0sXG4gICAgKTtcblxuICAgIHJldHVybiBuZXcgT1RyZWUoXG4gICAgICBbJ2ZvciAoT2JqZWN0ICcsIHZhcmlhYmxlTmFtZSwgJyA6ICcsIHJlbmRlcmVyLmNvbnZlcnQobm9kZS5leHByZXNzaW9uKSwgJykgJ10sXG4gICAgICBbcmVuZGVyZXIuY29udmVydChub2RlLnN0YXRlbWVudCldLFxuICAgICAge1xuICAgICAgICBjYW5CcmVha0xpbmU6IHRydWUsXG4gICAgICB9LFxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgcHJpbnRTdGF0ZW1lbnQoYXJnczogdHMuTm9kZUFycmF5PHRzLkV4cHJlc3Npb24+LCByZW5kZXJlcjogSmF2YVJlbmRlcmVyKSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShbXG4gICAgICAnU3lzdGVtLm91dC5wcmludGxuKCcsXG4gICAgICBhcmdzLmxlbmd0aCA9PT0gMSA/IHJlbmRlcmVyLmNvbnZlcnQoYXJnc1swXSkgOiBuZXcgT1RyZWUoW10sIHJlbmRlcmVyLmNvbnZlcnRBbGwoYXJncyksIHsgc2VwYXJhdG9yOiAnICsgJyB9KSxcbiAgICAgICcpJyxcbiAgICBdKTtcbiAgfVxuXG4gIHB1YmxpYyB0ZW1wbGF0ZUV4cHJlc3Npb24obm9kZTogdHMuVGVtcGxhdGVFeHByZXNzaW9uLCByZW5kZXJlcjogSmF2YVJlbmRlcmVyKTogT1RyZWUge1xuICAgIGxldCB0ZW1wbGF0ZSA9ICcnO1xuICAgIGNvbnN0IHBhcmFtZXRlcnMgPSBuZXcgQXJyYXk8T1RyZWU+KCk7XG5cbiAgICBpZiAobm9kZS5oZWFkLnJhd1RleHQpIHtcbiAgICAgIHRlbXBsYXRlICs9IG5vZGUuaGVhZC5yYXdUZXh0O1xuICAgIH1cblxuICAgIGZvciAoY29uc3Qgc3BhbiBvZiBub2RlLnRlbXBsYXRlU3BhbnMpIHtcbiAgICAgIHRlbXBsYXRlICs9ICclcyc7XG4gICAgICBwYXJhbWV0ZXJzLnB1c2goXG4gICAgICAgIHJlbmRlcmVyXG4gICAgICAgICAgLnVwZGF0ZUNvbnRleHQoe1xuICAgICAgICAgICAgY29udmVydFByb3BlcnR5VG9HZXR0ZXI6IHRydWUsXG4gICAgICAgICAgICBpZGVudGlmaWVyQXNTdHJpbmc6IGZhbHNlLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmNvbnZlcnQoc3Bhbi5leHByZXNzaW9uKSxcbiAgICAgICk7XG4gICAgICBpZiAoc3Bhbi5saXRlcmFsLnJhd1RleHQpIHtcbiAgICAgICAgdGVtcGxhdGUgKz0gc3Bhbi5saXRlcmFsLnJhd1RleHQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHBhcmFtZXRlcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbmV3IE9UcmVlKFtKU09OLnN0cmluZ2lmeShxdW90ZVN0cmluZ0xpdGVyYWwodGVtcGxhdGUpKV0pO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgT1RyZWUoW1xuICAgICAgJ1N0cmluZy5mb3JtYXQoJyxcbiAgICAgIGBcIiR7cXVvdGVTdHJpbmdMaXRlcmFsKHRlbXBsYXRlKVxuICAgICAgICAvLyBKYXZhIGRvZXMgbm90IGhhdmUgbXVsdGlsaW5lIHN0cmluZyBsaXRlcmFscywgc28gd2UgbXVzdCByZXBsYWNlIGxpdGVyYWwgbmV3bGluZXMgd2l0aCAlblxuICAgICAgICAucmVwbGFjZSgvXFxuL2csICclbicpfVwiYCxcbiAgICAgIC4uLnBhcmFtZXRlcnMucmVkdWNlKChsaXN0LCBlbGVtZW50KSA9PiBsaXN0LmNvbmNhdCgnLCAnLCBlbGVtZW50KSwgbmV3IEFycmF5PHN0cmluZyB8IE9UcmVlPigpKSxcbiAgICAgICcpJyxcbiAgICBdKTtcbiAgfVxuXG4gIHB1YmxpYyBhc0V4cHJlc3Npb24obm9kZTogdHMuQXNFeHByZXNzaW9uLCByZW5kZXJlcjogSmF2YVJlbmRlcmVyKTogT1RyZWUge1xuICAgIHJldHVybiBuZXcgT1RyZWUoWycoJywgdGhpcy5yZW5kZXJUeXBlTm9kZShub2RlLnR5cGUsIHJlbmRlcmVyLCAnT2JqZWN0JyksICcpJywgcmVuZGVyZXIuY29udmVydChub2RlLmV4cHJlc3Npb24pXSk7XG4gIH1cblxuICBwdWJsaWMgYXJyYXlMaXRlcmFsRXhwcmVzc2lvbihub2RlOiB0cy5BcnJheUxpdGVyYWxFeHByZXNzaW9uLCByZW5kZXJlcjogSmF2YVJlbmRlcmVyKTogT1RyZWUge1xuICAgIHJldHVybiBuZXcgT1RyZWUoWydMaXN0Lm9mKCddLCByZW5kZXJlci5jb252ZXJ0QWxsKG5vZGUuZWxlbWVudHMpLCB7XG4gICAgICBzZXBhcmF0b3I6ICcsICcsXG4gICAgICBzdWZmaXg6ICcpJyxcbiAgICAgIGluZGVudDogNCxcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyByZWd1bGFyQ2FsbEV4cHJlc3Npb24obm9kZTogdHMuQ2FsbEV4cHJlc3Npb24sIHJlbmRlcmVyOiBKYXZhUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShbXG4gICAgICByZW5kZXJlci51cGRhdGVDb250ZXh0KHsgY29udmVydFByb3BlcnR5VG9HZXR0ZXI6IGZhbHNlIH0pLmNvbnZlcnQobm9kZS5leHByZXNzaW9uKSxcbiAgICAgICcoJyxcbiAgICAgIHRoaXMuYXJndW1lbnRMaXN0KG5vZGUuYXJndW1lbnRzLCByZW5kZXJlciksXG4gICAgICAnKScsXG4gICAgXSk7XG4gIH1cblxuICBwdWJsaWMgbmV3RXhwcmVzc2lvbihub2RlOiB0cy5OZXdFeHByZXNzaW9uLCByZW5kZXJlcjogSmF2YVJlbmRlcmVyKTogT1RyZWUge1xuICAgIGNvbnN0IGFyZ3NMZW5ndGggPSBub2RlLmFyZ3VtZW50cyA/IG5vZGUuYXJndW1lbnRzLmxlbmd0aCA6IDA7XG4gICAgY29uc3QgbGFzdEFyZyA9IGFyZ3NMZW5ndGggPiAwID8gbm9kZS5hcmd1bWVudHMhW2FyZ3NMZW5ndGggLSAxXSA6IHVuZGVmaW5lZDtcblxuICAgIC8vIFdlIHJlbmRlciB0aGUgQ2xhc3NOYW1lLkJ1aWxkZXIuY3JlYXRlKC4uLikgZXhwcmVzc2lvblxuICAgIC8vIGlmIHRoZSBsYXN0IGFyZ3VtZW50IGlzIGFuIG9iamVjdCBsaXRlcmFsLCBhbmQgZWl0aGVyIGEga25vd24gc3RydWN0IChiZWNhdXNlXG4gICAgLy8gdGhvc2UgYXJlIHRoZSBqc2lpIHJ1bGVzKSBvciBhbiB1bmtub3duIHR5cGUgKGJlY2F1c2UgdGhlIGV4YW1wbGUgZGlkbid0XG4gICAgLy8gY29tcGlsZSBidXQgbW9zdCBvZiB0aGUgdGFyZ2V0IGV4YW1wbGVzIHdpbGwgaW50ZW5kIHRoaXMgdG8gYmUgYSBzdHJ1Y3QpLlxuXG4gICAgY29uc3Qgc3RydWN0QXJndW1lbnQgPSBsYXN0QXJnICYmIHRzLmlzT2JqZWN0TGl0ZXJhbEV4cHJlc3Npb24obGFzdEFyZykgPyBsYXN0QXJnIDogdW5kZWZpbmVkO1xuICAgIGxldCByZW5kZXJCdWlsZGVyID0gZmFsc2U7XG4gICAgaWYgKGxhc3RBcmcgJiYgdHMuaXNPYmplY3RMaXRlcmFsRXhwcmVzc2lvbihsYXN0QXJnKSkge1xuICAgICAgY29uc3QgYW5hbHlzaXMgPSBhbmFseXplT2JqZWN0TGl0ZXJhbChyZW5kZXJlci50eXBlQ2hlY2tlciwgbGFzdEFyZyk7XG4gICAgICByZW5kZXJCdWlsZGVyID0gYW5hbHlzaXMua2luZCA9PT0gJ3N0cnVjdCcgfHwgYW5hbHlzaXMua2luZCA9PT0gJ3Vua25vd24nO1xuICAgIH1cblxuICAgIGNvbnN0IGNsYXNzTmFtZSA9IHJlbmRlcmVyXG4gICAgICAudXBkYXRlQ29udGV4dCh7XG4gICAgICAgIGRpc2NhcmRQcm9wZXJ0eUFjY2VzczogdHJ1ZSxcbiAgICAgICAgY29udmVydFByb3BlcnR5VG9HZXR0ZXI6IGZhbHNlLFxuICAgICAgfSlcbiAgICAgIC5jb252ZXJ0KG5vZGUuZXhwcmVzc2lvbik7XG5cbiAgICBpZiAocmVuZGVyQnVpbGRlcikge1xuICAgICAgY29uc3QgaW5pdGlhbEFyZ3VtZW50cyA9IG5vZGUuYXJndW1lbnRzIS5zbGljZSgwLCBhcmdzTGVuZ3RoIC0gMSk7XG4gICAgICByZXR1cm4gbmV3IE9UcmVlKFxuICAgICAgICBbXSxcbiAgICAgICAgW1xuICAgICAgICAgIGNsYXNzTmFtZSxcbiAgICAgICAgICAnLkJ1aWxkZXIuY3JlYXRlKCcsXG4gICAgICAgICAgdGhpcy5hcmd1bWVudExpc3QoaW5pdGlhbEFyZ3VtZW50cywgcmVuZGVyZXIpLFxuICAgICAgICAgICcpJyxcbiAgICAgICAgICAuLi5yZW5kZXJlci5jb252ZXJ0QWxsKHN0cnVjdEFyZ3VtZW50IS5wcm9wZXJ0aWVzKSxcbiAgICAgICAgICBuZXcgT1RyZWUoW3JlbmRlcmVyLm1pcnJvck5ld2xpbmVCZWZvcmUoc3RydWN0QXJndW1lbnQhLnByb3BlcnRpZXNbMF0pXSwgWycuYnVpbGQoKSddKSxcbiAgICAgICAgXSxcbiAgICAgICAgeyBjYW5CcmVha0xpbmU6IHRydWUsIGluZGVudDogOCB9LFxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IE9UcmVlKFtdLCBbJ25ldyAnLCBjbGFzc05hbWUsICcoJywgdGhpcy5hcmd1bWVudExpc3Qobm9kZS5hcmd1bWVudHMsIHJlbmRlcmVyKSwgJyknXSwge1xuICAgICAgY2FuQnJlYWtMaW5lOiB0cnVlLFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHVua25vd25UeXBlT2JqZWN0TGl0ZXJhbEV4cHJlc3Npb24obm9kZTogdHMuT2JqZWN0TGl0ZXJhbEV4cHJlc3Npb24sIHJlbmRlcmVyOiBKYXZhUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgcmV0dXJuIHJlbmRlcmVyLmN1cnJlbnRDb250ZXh0LmluTmV3RXhwcldpdGhPYmplY3RMaXRlcmFsQXNMYXN0QXJnXG4gICAgICA/IHRoaXMucmVuZGVyT2JqZWN0TGl0ZXJhbEFzQnVpbGRlcihub2RlLCByZW5kZXJlcilcbiAgICAgIDogdGhpcy5rZXlWYWx1ZU9iamVjdExpdGVyYWxFeHByZXNzaW9uKG5vZGUsIHJlbmRlcmVyKTtcbiAgfVxuXG4gIHB1YmxpYyBrZXlWYWx1ZU9iamVjdExpdGVyYWxFeHByZXNzaW9uKG5vZGU6IHRzLk9iamVjdExpdGVyYWxFeHByZXNzaW9uLCByZW5kZXJlcjogSmF2YVJlbmRlcmVyKTogT1RyZWUge1xuICAgIHJldHVybiBuZXcgT1RyZWUoWydNYXAub2YoJ10sIHJlbmRlcmVyLnVwZGF0ZUNvbnRleHQoeyBpbktleVZhbHVlTGlzdDogdHJ1ZSB9KS5jb252ZXJ0QWxsKG5vZGUucHJvcGVydGllcyksIHtcbiAgICAgIHN1ZmZpeDogJyknLFxuICAgICAgc2VwYXJhdG9yOiAnLCAnLFxuICAgICAgaW5kZW50OiA4LFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGtub3duU3RydWN0T2JqZWN0TGl0ZXJhbEV4cHJlc3Npb24oXG4gICAgbm9kZTogdHMuT2JqZWN0TGl0ZXJhbEV4cHJlc3Npb24sXG4gICAgc3RydWN0VHlwZTogT2JqZWN0TGl0ZXJhbFN0cnVjdCxcbiAgICByZW5kZXJlcjogSmF2YVJlbmRlcmVyLFxuICApOiBPVHJlZSB7XG4gICAgLy8gU3BlY2lhbCBjYXNlOiB3ZSdyZSByZW5kZXJpbmcgYW4gb2JqZWN0IGxpdGVyYWwsIGJ1dCB0aGUgY29udGFpbmluZyBjb25zdHJ1Y3RvclxuICAgIC8vIGhhcyBhbHJlYWR5IHN0YXJ0ZWQgdGhlIGJ1aWxkZXI6IHdlIGRvbid0IGhhdmUgdG8gY3JlYXRlIGEgbmV3IGluc3RhbmNlLFxuICAgIC8vIGFsbCB3ZSBoYXZlIHRvIGRvIGlzIHBpbGUgb24gYXJndW1lbnRzLlxuICAgIGlmIChyZW5kZXJlci5jdXJyZW50Q29udGV4dC5pbk5ld0V4cHJXaXRoT2JqZWN0TGl0ZXJhbEFzTGFzdEFyZykge1xuICAgICAgcmV0dXJuIG5ldyBPVHJlZShbXSwgcmVuZGVyZXIuY29udmVydEFsbChub2RlLnByb3BlcnRpZXMpLCB7IGluZGVudDogOCB9KTtcbiAgICB9XG5cbiAgICAvLyBKc2lpLWdlbmVyYXRlZCBjbGFzc2VzIGhhdmUgYnVpbGRlcnMsIGNsYXNzZXMgd2UgZ2VuZXJhdGVkIGluIHRoZSBjb3Vyc2Ugb2ZcbiAgICAvLyB0aGlzIGV4YW1wbGUgZG8gbm90LlxuICAgIGNvbnN0IGhhc0J1aWxkZXIgPSBzdHJ1Y3RUeXBlLmtpbmQgIT09ICdsb2NhbC1zdHJ1Y3QnO1xuXG4gICAgcmV0dXJuIG5ldyBPVHJlZShcbiAgICAgIGhhc0J1aWxkZXIgPyBbc3RydWN0VHlwZS50eXBlLnN5bWJvbC5uYW1lLCAnLmJ1aWxkZXIoKSddIDogWyduZXcgJywgc3RydWN0VHlwZS50eXBlLnN5bWJvbC5uYW1lLCAnKCknXSxcbiAgICAgIFtcbiAgICAgICAgLi4ucmVuZGVyZXIuY29udmVydEFsbChub2RlLnByb3BlcnRpZXMpLFxuICAgICAgICBuZXcgT1RyZWUoW3JlbmRlcmVyLm1pcnJvck5ld2xpbmVCZWZvcmUobm9kZS5wcm9wZXJ0aWVzWzBdKV0sIFtoYXNCdWlsZGVyID8gJy5idWlsZCgpJyA6ICcnXSksXG4gICAgICBdLFxuICAgICAge1xuICAgICAgICBpbmRlbnQ6IDgsXG4gICAgICB9LFxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgcHJvcGVydHlBc3NpZ25tZW50KG5vZGU6IHRzLlByb3BlcnR5QXNzaWdubWVudCwgcmVuZGVyZXI6IEphdmFSZW5kZXJlcik6IE9UcmVlIHtcbiAgICByZXR1cm4gcmVuZGVyZXIuY3VycmVudENvbnRleHQuaW5LZXlWYWx1ZUxpc3RcbiAgICAgID8gdGhpcy5zaW5nbGVQcm9wZXJ0eUluSmF2YVNjcmlwdE9iamVjdExpdGVyYWxUb0phdmFNYXAobm9kZS5uYW1lLCBub2RlLmluaXRpYWxpemVyLCByZW5kZXJlcilcbiAgICAgIDogdGhpcy5zaW5nbGVQcm9wZXJ0eUluSmF2YVNjcmlwdE9iamVjdExpdGVyYWxUb0ZsdWVudFNldHRlcnMobm9kZS5uYW1lLCBub2RlLmluaXRpYWxpemVyLCByZW5kZXJlcik7XG4gIH1cblxuICBwdWJsaWMgc2hvcnRoYW5kUHJvcGVydHlBc3NpZ25tZW50KG5vZGU6IHRzLlNob3J0aGFuZFByb3BlcnR5QXNzaWdubWVudCwgcmVuZGVyZXI6IEphdmFSZW5kZXJlcik6IE9UcmVlIHtcbiAgICByZXR1cm4gcmVuZGVyZXIuY3VycmVudENvbnRleHQuaW5LZXlWYWx1ZUxpc3RcbiAgICAgID8gdGhpcy5zaW5nbGVQcm9wZXJ0eUluSmF2YVNjcmlwdE9iamVjdExpdGVyYWxUb0phdmFNYXAobm9kZS5uYW1lLCBub2RlLm5hbWUsIHJlbmRlcmVyKVxuICAgICAgOiB0aGlzLnNpbmdsZVByb3BlcnR5SW5KYXZhU2NyaXB0T2JqZWN0TGl0ZXJhbFRvRmx1ZW50U2V0dGVycyhub2RlLm5hbWUsIG5vZGUubmFtZSwgcmVuZGVyZXIpO1xuICB9XG5cbiAgcHVibGljIHByb3BlcnR5QWNjZXNzRXhwcmVzc2lvbihub2RlOiB0cy5Qcm9wZXJ0eUFjY2Vzc0V4cHJlc3Npb24sIHJlbmRlcmVyOiBKYXZhUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgY29uc3QgcmlnaHRIYW5kU2lkZSA9IHJlbmRlcmVyLmNvbnZlcnQobm9kZS5uYW1lKTtcbiAgICBsZXQgcGFydHM6IEFycmF5PE9UcmVlIHwgc3RyaW5nIHwgdW5kZWZpbmVkPjtcblxuICAgIGNvbnN0IGxlZnRIYW5kU2lkZSA9IHJlbmRlcmVyLnRleHRPZihub2RlLmV4cHJlc3Npb24pO1xuXG4gICAgLy8gU3VwcHJlc3MgdGhlIExIUyBvZiB0aGUgZG90IG9wZXJhdG9yIGlmIGl0IG1hdGNoZXMgYW4gYWxpYXMgZm9yIGEgbW9kdWxlIGltcG9ydC5cbiAgICBpZiAodGhpcy5kcm9wUHJvcGVydHlBY2Nlc3Nlcy5oYXMobGVmdEhhbmRTaWRlKSB8fCByZW5kZXJlci5jdXJyZW50Q29udGV4dC5kaXNjYXJkUHJvcGVydHlBY2Nlc3MpIHtcbiAgICAgIHBhcnRzID0gW3JpZ2h0SGFuZFNpZGVdO1xuICAgIH0gZWxzZSBpZiAobGVmdEhhbmRTaWRlID09PSAndGhpcycpIHtcbiAgICAgIC8vIGZvciAndGhpcycsIGFzc3VtZSB0aGlzIGlzIGEgZmllbGQsIGFuZCBhY2Nlc3MgaXQgZGlyZWN0bHlcbiAgICAgIHBhcnRzID0gWyd0aGlzJywgJy4nLCByaWdodEhhbmRTaWRlXTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGNvbnZlcnRUb0dldHRlciA9IHJlbmRlcmVyLmN1cnJlbnRDb250ZXh0LmNvbnZlcnRQcm9wZXJ0eVRvR2V0dGVyICE9PSBmYWxzZTtcblxuICAgICAgLy8gU2VlIGlmIHdlJ3JlIG5vdCBhY2Nlc3NpbmcgYW4gZW51bSBtZW1iZXIgb3IgcHVibGljIHN0YXRpYyByZWFkb25seSBwcm9wZXJ0eSAoY29uc3QpLlxuICAgICAgaWYgKGlzRW51bUFjY2VzcyhyZW5kZXJlci50eXBlQ2hlY2tlciwgbm9kZSkpIHtcbiAgICAgICAgY29udmVydFRvR2V0dGVyID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoaXNTdGF0aWNSZWFkb25seUFjY2VzcyhyZW5kZXJlci50eXBlQ2hlY2tlciwgbm9kZSkpIHtcbiAgICAgICAgY29udmVydFRvR2V0dGVyID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIC8vIGFkZCBhICdnZXQnIHByZWZpeCB0byB0aGUgcHJvcGVydHkgbmFtZSwgYW5kIGNoYW5nZSB0aGUgYWNjZXNzIHRvIGEgbWV0aG9kIGNhbGwsIGlmIHJlcXVpcmVkXG4gICAgICBjb25zdCByZW5kZXJlZFJpZ2h0SGFuZFNpZGUgPSBjb252ZXJ0VG9HZXR0ZXIgPyBgZ2V0JHtjYXBpdGFsaXplKG5vZGUubmFtZS50ZXh0KX0oKWAgOiByaWdodEhhbmRTaWRlO1xuXG4gICAgICAvLyBzdHJpcCBhbnkgdHJhaWxpbmcgISBmcm9tIHRoZSBsZWZ0LWhhbmQgc2lkZSwgYXMgdGhleSdyZSBub3QgbWVhbmluZ2Z1bCBpbiBKYXZhXG4gICAgICBwYXJ0cyA9IFtyZW5kZXJlci5jb252ZXJ0KG5vZGUuZXhwcmVzc2lvbiksICcuJywgcmVuZGVyZWRSaWdodEhhbmRTaWRlXTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IE9UcmVlKHBhcnRzKTtcbiAgfVxuXG4gIHB1YmxpYyBzdHJpbmdMaXRlcmFsKG5vZGU6IHRzLlN0cmluZ0xpdGVyYWwgfCB0cy5Ob1N1YnN0aXR1dGlvblRlbXBsYXRlTGl0ZXJhbCwgcmVuZGVyZXI6IEphdmFSZW5kZXJlcik6IE9UcmVlIHtcbiAgICBpZiAocmVuZGVyZXIuY3VycmVudENvbnRleHQuc3RyaW5nTGl0ZXJhbEFzSWRlbnRpZmllcikge1xuICAgICAgcmV0dXJuIHRoaXMuaWRlbnRpZmllcihub2RlLCByZW5kZXJlcik7XG4gICAgfVxuICAgIC8vIEphdmEgZG9lcyBub3QgaGF2ZSBtdWx0aWxpbmUgc3RyaW5nIGxpdGVyYWxzLCBzbyB3ZSBtdXN0IHJlcGxhY2UgbGl0ZXJhbCBuZXdsaW5lcyB3aXRoIFxcblxuICAgIHJldHVybiBuZXcgT1RyZWUoW0pTT04uc3RyaW5naWZ5KG5vZGUudGV4dCkucmVwbGFjZSgvXFxuL2csICdcXFxcbicpXSk7XG4gIH1cblxuICBwdWJsaWMgaWRlbnRpZmllcihcbiAgICBub2RlOiB0cy5JZGVudGlmaWVyIHwgdHMuU3RyaW5nTGl0ZXJhbCB8IHRzLk5vU3Vic3RpdHV0aW9uVGVtcGxhdGVMaXRlcmFsLFxuICAgIHJlbmRlcmVyOiBKYXZhUmVuZGVyZXIsXG4gICk6IE9UcmVlIHtcbiAgICBjb25zdCBub2RlVGV4dCA9IG5vZGUudGV4dDtcbiAgICByZXR1cm4gbmV3IE9UcmVlKFtyZW5kZXJlci5jdXJyZW50Q29udGV4dC5pZGVudGlmaWVyQXNTdHJpbmcgPyBKU09OLnN0cmluZ2lmeShub2RlVGV4dCkgOiBub2RlVGV4dF0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJPYmplY3RMaXRlcmFsQXNCdWlsZGVyKG5vZGU6IHRzLk9iamVjdExpdGVyYWxFeHByZXNzaW9uLCByZW5kZXJlcjogSmF2YVJlbmRlcmVyKTogT1RyZWUge1xuICAgIHJldHVybiBuZXcgT1RyZWUoXG4gICAgICBbXSxcbiAgICAgIFtcbiAgICAgICAgLi4ucmVuZGVyZXIuY29udmVydEFsbChub2RlLnByb3BlcnRpZXMpLFxuICAgICAgICBuZXcgT1RyZWUoW3JlbmRlcmVyLm1pcnJvck5ld2xpbmVCZWZvcmUobm9kZS5wcm9wZXJ0aWVzWzBdKV0sIFsnLmJ1aWxkKCknXSksXG4gICAgICBdLFxuICAgICAge1xuICAgICAgICBpbmRlbnQ6IDgsXG4gICAgICB9LFxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIHNpbmdsZVByb3BlcnR5SW5KYXZhU2NyaXB0T2JqZWN0TGl0ZXJhbFRvSmF2YU1hcChcbiAgICBuYW1lOiB0cy5Ob2RlLFxuICAgIGluaXRpYWxpemVyOiB0cy5Ob2RlLFxuICAgIHJlbmRlcmVyOiBKYXZhUmVuZGVyZXIsXG4gICk6IE9UcmVlIHtcbiAgICByZXR1cm4gbmV3IE9UcmVlKFxuICAgICAgW10sXG4gICAgICBbXG4gICAgICAgIHJlbmRlcmVyXG4gICAgICAgICAgLnVwZGF0ZUNvbnRleHQoe1xuICAgICAgICAgICAgaWRlbnRpZmllckFzU3RyaW5nOiAhdHMuaXNDb21wdXRlZFByb3BlcnR5TmFtZShuYW1lKSxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jb252ZXJ0KG5hbWUpLFxuICAgICAgICAnLCAnLFxuICAgICAgICByZW5kZXJlci51cGRhdGVDb250ZXh0KHsgaW5LZXlWYWx1ZUxpc3Q6IGZhbHNlIH0pLmNvbnZlcnQoaW5pdGlhbGl6ZXIpLFxuICAgICAgXSxcbiAgICAgIHtcbiAgICAgICAgY2FuQnJlYWtMaW5lOiB0cnVlLFxuICAgICAgfSxcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBzaW5nbGVQcm9wZXJ0eUluSmF2YVNjcmlwdE9iamVjdExpdGVyYWxUb0ZsdWVudFNldHRlcnMoXG4gICAgbmFtZTogdHMuTm9kZSxcbiAgICBpbml0aWFsaXplcjogdHMuTm9kZSxcbiAgICByZW5kZXJlcjogSmF2YVJlbmRlcmVyLFxuICApOiBPVHJlZSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShcbiAgICAgIFtdLFxuICAgICAgW1xuICAgICAgICAnLicsXG4gICAgICAgIHJlbmRlcmVyLnVwZGF0ZUNvbnRleHQoeyBzdHJpbmdMaXRlcmFsQXNJZGVudGlmaWVyOiB0cnVlIH0pLmNvbnZlcnQobmFtZSksXG4gICAgICAgICcoJyxcbiAgICAgICAgcmVuZGVyZXIudXBkYXRlQ29udGV4dCh7IGluTmV3RXhwcldpdGhPYmplY3RMaXRlcmFsQXNMYXN0QXJnOiBmYWxzZSB9KS5jb252ZXJ0KGluaXRpYWxpemVyKSxcbiAgICAgICAgJyknLFxuICAgICAgXSxcbiAgICAgIHtcbiAgICAgICAgY2FuQnJlYWtMaW5lOiB0cnVlLFxuICAgICAgfSxcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJDbGFzc0RlY2xhcmF0aW9uKG5vZGU6IHRzLkNsYXNzRGVjbGFyYXRpb24gfCB0cy5JbnRlcmZhY2VEZWNsYXJhdGlvbiwgcmVuZGVyZXI6IEphdmFSZW5kZXJlcikge1xuICAgIHJldHVybiBuZXcgT1RyZWUoXG4gICAgICBbXG4gICAgICAgICdwdWJsaWMgJyxcbiAgICAgICAgJ2NsYXNzICcsXG4gICAgICAgIHJlbmRlcmVyLmNvbnZlcnQobm9kZS5uYW1lKSxcbiAgICAgICAgLi4udGhpcy50eXBlSGVyaXRhZ2Uobm9kZSwgcmVuZGVyZXIudXBkYXRlQ29udGV4dCh7IGRpc2NhcmRQcm9wZXJ0eUFjY2VzczogdHJ1ZSB9KSksXG4gICAgICAgICcgeycsXG4gICAgICBdLFxuICAgICAgcmVuZGVyZXIudXBkYXRlQ29udGV4dCh7IGluc2lkZVR5cGVEZWNsYXJhdGlvbjogeyB0eXBlTmFtZTogbm9kZS5uYW1lIH0gfSkuY29udmVydEFsbChub2RlLm1lbWJlcnMpLFxuICAgICAge1xuICAgICAgICBpbmRlbnQ6IDQsXG4gICAgICAgIGNhbkJyZWFrTGluZTogdHJ1ZSxcbiAgICAgICAgc3VmZml4OiAnXFxufScsXG4gICAgICB9LFxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIHR5cGVIZXJpdGFnZShcbiAgICBub2RlOiB0cy5DbGFzc0RlY2xhcmF0aW9uIHwgdHMuSW50ZXJmYWNlRGVjbGFyYXRpb24sXG4gICAgcmVuZGVyZXI6IEphdmFSZW5kZXJlcixcbiAgKTogQXJyYXk8T1RyZWUgfCBzdHJpbmcgfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gW1xuICAgICAgLi4udGhpcy5leHRyYWN0U3VwZXJUeXBlcyhub2RlLCByZW5kZXJlciwgdHMuU3ludGF4S2luZC5FeHRlbmRzS2V5d29yZCwgJ2V4dGVuZHMnKSxcbiAgICAgIC4uLnRoaXMuZXh0cmFjdFN1cGVyVHlwZXMobm9kZSwgcmVuZGVyZXIsIHRzLlN5bnRheEtpbmQuSW1wbGVtZW50c0tleXdvcmQsICdpbXBsZW1lbnRzJyksXG4gICAgXTtcbiAgfVxuXG4gIHByaXZhdGUgZXh0cmFjdFN1cGVyVHlwZXMoXG4gICAgbm9kZTogdHMuQ2xhc3NEZWNsYXJhdGlvbiB8IHRzLkludGVyZmFjZURlY2xhcmF0aW9uLFxuICAgIHJlbmRlcmVyOiBKYXZhUmVuZGVyZXIsXG4gICAgaGVyaXRhZ2VLZXl3b3JkOiB0cy5TeW50YXhLaW5kLFxuICAgIG91dHB1dEtleXdvcmQ6IHN0cmluZyxcbiAgKTogQXJyYXk8T1RyZWUgfCBzdHJpbmcgfCB1bmRlZmluZWQ+IHtcbiAgICBjb25zdCBoZXJpdGFnZUNsYXVzZSA9IChub2RlLmhlcml0YWdlQ2xhdXNlcyA/PyBbXSkuZmluZCgoaGMpID0+IGhjLnRva2VuID09PSBoZXJpdGFnZUtleXdvcmQpO1xuICAgIGNvbnN0IHN1cGVyVHlwZXMgPSBoZXJpdGFnZUNsYXVzZSA/IGhlcml0YWdlQ2xhdXNlLnR5cGVzLm1hcCgodCkgPT4gcmVuZGVyZXIuY29udmVydCh0LmV4cHJlc3Npb24pKSA6IFtdO1xuICAgIHJldHVybiBzdXBlclR5cGVzLmxlbmd0aCA+IDAgPyBbYCAke291dHB1dEtleXdvcmR9IGAsIG5ldyBPVHJlZShbXSwgc3VwZXJUeXBlcywgeyBzZXBhcmF0b3I6ICcsICcgfSldIDogW107XG4gIH1cblxuICBwcml2YXRlIHJlbmRlclR5cGVOb2RlKHR5cGVOb2RlOiB0cy5UeXBlTm9kZSB8IHVuZGVmaW5lZCwgcmVuZGVyZXI6IEphdmFSZW5kZXJlciwgZmFsbGJhY2s/OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGZhbGxiYWNrID1cbiAgICAgIGZhbGxiYWNrID8/XG4gICAgICAodHlwZU5vZGVcbiAgICAgICAgPyBsYXN0RWxlbWVudChyZW5kZXJlci50ZXh0T2YodHlwZU5vZGUpLnNwbGl0KCcuJykpIC8vIHJlbW92ZSBhbnkgbmFtZXNwYWNlIHByZWZpeGVzXG4gICAgICAgIDogJ09iamVjdCcpO1xuXG4gICAgaWYgKCF0eXBlTm9kZSkge1xuICAgICAgcmV0dXJuIGZhbGxiYWNrO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnJlbmRlclR5cGUodHlwZU5vZGUsIHJlbmRlcmVyLnR5cGVPZlR5cGUodHlwZU5vZGUpLCByZW5kZXJlciwgZmFsbGJhY2spO1xuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJUeXBlKG93bmluZ05vZGU6IHRzLk5vZGUsIHR5cGU6IHRzLlR5cGUgfCB1bmRlZmluZWQsIHJlbmRlcmVyOiBKYXZhUmVuZGVyZXIsIGZhbGxiYWNrOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGlmICghdHlwZSkge1xuICAgICAgcmV0dXJuIGZhbGxiYWNrO1xuICAgIH1cblxuICAgIHJldHVybiBkb1JlbmRlcihkZXRlcm1pbmVKc2lpVHlwZShyZW5kZXJlci50eXBlQ2hlY2tlciwgdHlwZSksIGZhbHNlKTtcblxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb25zaXN0ZW50LXJldHVyblxuICAgIGZ1bmN0aW9uIGRvUmVuZGVyKGpzaWlUeXBlOiBKc2lpVHlwZSwgcmVxdWlyZXNSZWZlcmVuY2VUeXBlOiBib29sZWFuKTogc3RyaW5nIHtcbiAgICAgIHN3aXRjaCAoanNpaVR5cGUua2luZCkge1xuICAgICAgICBjYXNlICd1bmtub3duJzpcbiAgICAgICAgICByZXR1cm4gZmFsbGJhY2s7XG4gICAgICAgIGNhc2UgJ2Vycm9yJzpcbiAgICAgICAgICByZW5kZXJlci5yZXBvcnQob3duaW5nTm9kZSwganNpaVR5cGUubWVzc2FnZSk7XG4gICAgICAgICAgcmV0dXJuIGZhbGxiYWNrO1xuICAgICAgICBjYXNlICdtYXAnOlxuICAgICAgICAgIHJldHVybiBgTWFwPFN0cmluZywgJHtkb1JlbmRlcihqc2lpVHlwZS5lbGVtZW50VHlwZSwgdHJ1ZSl9PmA7XG4gICAgICAgIGNhc2UgJ2xpc3QnOlxuICAgICAgICAgIHJldHVybiBgJHtkb1JlbmRlcihqc2lpVHlwZS5lbGVtZW50VHlwZSwgdHJ1ZSl9W11gO1xuICAgICAgICBjYXNlICduYW1lZFR5cGUnOlxuICAgICAgICAgIHJldHVybiBqc2lpVHlwZS5uYW1lO1xuICAgICAgICBjYXNlICdidWlsdEluJzpcbiAgICAgICAgICBzd2l0Y2ggKGpzaWlUeXBlLmJ1aWx0SW4pIHtcbiAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICByZXR1cm4gcmVxdWlyZXNSZWZlcmVuY2VUeXBlID8gJ0Jvb2xlYW4nIDogJ2Jvb2xlYW4nO1xuICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgcmV0dXJuICdOdW1iZXInO1xuICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgcmV0dXJuICdTdHJpbmcnO1xuICAgICAgICAgICAgY2FzZSAnYW55JzpcbiAgICAgICAgICAgICAgcmV0dXJuICdPYmplY3QnO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgcmV0dXJuIGpzaWlUeXBlLmJ1aWx0SW47XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyUHJvY2VkdXJlKFxuICAgIG5vZGU6IHRzLkNvbnN0cnVjdG9yRGVjbGFyYXRpb24gfCB0cy5NZXRob2REZWNsYXJhdGlvbiB8IHRzLkZ1bmN0aW9uRGVjbGFyYXRpb24sXG4gICAgcmVuZGVyZXI6IEphdmFSZW5kZXJlcixcbiAgICBtZXRob2RPckNvbnN0cnVjdG9yTmFtZTogdHMuTm9kZSB8IHVuZGVmaW5lZCxcbiAgICByZXR1cm5UeXBlOiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gICk6IE9UcmVlIHtcbiAgICBjb25zdCBvdmVybG9hZHMgPSBuZXcgQXJyYXk8T1RyZWU+KCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2RlLnBhcmFtZXRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHBhcmFtID0gbm9kZS5wYXJhbWV0ZXJzW2ldO1xuICAgICAgaWYgKCEhcGFyYW0ucXVlc3Rpb25Ub2tlbiB8fCAhIXBhcmFtLmluaXRpYWxpemVyKSB7XG4gICAgICAgIC8vIFRoZSBwYXJhbWV0ZXIgaXMgZWl0aGVyIG9wdGlvbmFsLCBvciBoYXMgYSBkZWZhdWx0IC1cbiAgICAgICAgLy8gcmVuZGVyIGFuIG92ZXJsb2FkIHRoYXQgZGVsZWdhdGVzIHRvIGEgdmVyc2lvbiB3aXRoIG9uZSBtb3JlIHBhcmFtZXRlci5cbiAgICAgICAgLy8gTm90ZSB0aGF0IHdlIGRvbid0IGNoZWNrIHRoYXQgYWxsIHBhcmFtZXRlcnMgd2l0aCBpbmRleGVzID4gaSBhcmUgYWxzbyBvcHRpb25hbC9oYXZlIGEgZGVmYXVsdCAtXG4gICAgICAgIC8vIHdlIGFzc3VtZSB0aGUgVHlwZVNjcmlwdCBjb21waWxlciBkb2VzIHRoYXQgZm9yIHVzLlxuXG4gICAgICAgIC8vIHBhcmFtZXRlcnMgdXAgdG8gYnV0IGV4Y2x1ZGluZyB0aGUgY3VycmVudCBvbmVcbiAgICAgICAgY29uc3QgcGFyYW1ldGVyc1VwVG9JdGggPSBub2RlLnBhcmFtZXRlcnMuc2xpY2UoMCwgaSk7XG4gICAgICAgIC8vIGhvdyBzaG91bGQgdGhlIGNhbGwgdG8gdGhlIG5leHQgb3ZlcmxvYWQgbG9va1xuICAgICAgICBjb25zdCBjYWxsRXhwciA9IHRzLmlzQ29uc3RydWN0b3JEZWNsYXJhdGlvbihub2RlKSA/ICd0aGlzJyA6IHJlbmRlcmVyLmNvbnZlcnQobWV0aG9kT3JDb25zdHJ1Y3Rvck5hbWUpO1xuXG4gICAgICAgIG92ZXJsb2Fkcy5wdXNoKFxuICAgICAgICAgIHRoaXMucmVuZGVyT3ZlcmxvYWQoXG4gICAgICAgICAgICByZXR1cm5UeXBlLFxuICAgICAgICAgICAgcmVuZGVyZXIsXG4gICAgICAgICAgICBtZXRob2RPckNvbnN0cnVjdG9yTmFtZSxcbiAgICAgICAgICAgIHBhcmFtZXRlcnNVcFRvSXRoLFxuICAgICAgICAgICAgLy8gdGhlIGJvZHkgaXMgdGhlIGNhbGwgdG8gdGhlIG5leHQgb3ZlcmxvYWRcbiAgICAgICAgICAgIHRoaXMucmVuZGVyQmxvY2soW1xuICAgICAgICAgICAgICBuZXcgT1RyZWUoXG4gICAgICAgICAgICAgICAgWydcXG4nLCBjYWxsRXhwciwgJygnXSxcbiAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICAuLi5wYXJhbWV0ZXJzVXBUb0l0aC5tYXAoKHBhcmFtKSA9PiByZW5kZXJlci5jb252ZXJ0KHBhcmFtLm5hbWUpKSxcbiAgICAgICAgICAgICAgICAgIHBhcmFtLmluaXRpYWxpemVyID8gcmVuZGVyZXIuY29udmVydChwYXJhbS5pbml0aWFsaXplcikgOiAnbnVsbCcsXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBzZXBhcmF0b3I6ICcsICcsXG4gICAgICAgICAgICAgICAgICBzdWZmaXg6ICcpOycsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICksXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIHJlbmRlciB0aGUgcHJpbWFyeSBvdmVybG9hZFxuICAgIG92ZXJsb2Fkcy5wdXNoKFxuICAgICAgdGhpcy5yZW5kZXJPdmVybG9hZChyZXR1cm5UeXBlLCByZW5kZXJlciwgbWV0aG9kT3JDb25zdHJ1Y3Rvck5hbWUsIG5vZGUucGFyYW1ldGVycywgcmVuZGVyZXIuY29udmVydChub2RlLmJvZHkpKSxcbiAgICApO1xuXG4gICAgcmV0dXJuIG5ldyBPVHJlZShbXSwgb3ZlcmxvYWRzLCB7XG4gICAgICBjYW5CcmVha0xpbmU6IHRydWUsXG4gICAgICBzZXBhcmF0b3I6ICdcXG5cXG4nLFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJPdmVybG9hZChcbiAgICByZXR1cm5UeXBlOiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gICAgcmVuZGVyZXI6IEphdmFSZW5kZXJlcixcbiAgICBtZXRob2RPckNvbnN0cnVjdG9yTmFtZTogdHMuTm9kZSB8IHVuZGVmaW5lZCxcbiAgICBwYXJhbWV0ZXJzOiB0cy5QYXJhbWV0ZXJEZWNsYXJhdGlvbltdIHwgdHMuTm9kZUFycmF5PHRzLlBhcmFtZXRlckRlY2xhcmF0aW9uPixcbiAgICBib2R5OiBPVHJlZSxcbiAgKTogT1RyZWUge1xuICAgIHJldHVybiBuZXcgT1RyZWUoXG4gICAgICBbXG4gICAgICAgICdwdWJsaWMgJyxcbiAgICAgICAgcmV0dXJuVHlwZSA/IGAke3JldHVyblR5cGV9IGAgOiB1bmRlZmluZWQsXG4gICAgICAgIHJlbmRlcmVyLmNvbnZlcnQobWV0aG9kT3JDb25zdHJ1Y3Rvck5hbWUpLFxuICAgICAgICAnKCcsXG4gICAgICAgIG5ldyBPVHJlZShbXSwgcmVuZGVyZXIuY29udmVydEFsbChwYXJhbWV0ZXJzKSwgeyBzZXBhcmF0b3I6ICcsICcgfSksXG4gICAgICAgICcpICcsXG4gICAgICBdLFxuICAgICAgW2JvZHldLFxuICAgICAge1xuICAgICAgICBjYW5CcmVha0xpbmU6IHRydWUsXG4gICAgICB9LFxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlckJsb2NrKGJsb2NrQ29udGVudHM6IE9UcmVlW10pOiBPVHJlZSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShbJ3snXSwgYmxvY2tDb250ZW50cywge1xuICAgICAgaW5kZW50OiA0LFxuICAgICAgc3VmZml4OiAnXFxufScsXG4gICAgfSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gY2FwaXRhbGl6ZShzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBzdHIuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzdHIuc2xpY2UoMSk7XG59XG5cbmZ1bmN0aW9uIGxhc3RFbGVtZW50KHN0cmluZ3M6IHN0cmluZ1tdKTogc3RyaW5nIHtcbiAgcmV0dXJuIHN0cmluZ3Nbc3RyaW5ncy5sZW5ndGggLSAxXTtcbn1cblxuLyoqXG4gKiBGaW5kIHRoZSBKYXZhIG5hbWUgb2YgYSBtb2R1bGUgb3IgdHlwZVxuICovXG5mdW5jdGlvbiBmaW5kSmF2YU5hbWUoanNpaVN5bWJvbDogSnNpaVN5bWJvbCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gIGlmICghanNpaVN5bWJvbC5zb3VyY2VBc3NlbWJseT8uYXNzZW1ibHkpIHtcbiAgICAvLyBEb24ndCBoYXZlIGFjY3VyYXRlIGluZm8sIGp1c3QgZ3Vlc3NcbiAgICByZXR1cm4ganNpaVN5bWJvbC5zeW1ib2xUeXBlICE9PSAnbW9kdWxlJyA/IHNpbXBsZU5hbWUoanNpaVN5bWJvbC5mcW4pIDogZ3Vlc3NKYXZhTmFtZXNwYWNlTmFtZShqc2lpU3ltYm9sLmZxbik7XG4gIH1cblxuICBjb25zdCBhc20gPSBqc2lpU3ltYm9sLnNvdXJjZUFzc2VtYmx5Py5hc3NlbWJseTtcbiAgcmV0dXJuIHJlY3Vyc2UoanNpaVN5bWJvbC5mcW4pO1xuXG4gIGZ1bmN0aW9uIHJlY3Vyc2UoZnFuOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGlmIChmcW4gPT09IGFzbS5uYW1lKSB7XG4gICAgICByZXR1cm4ganNpaVRhcmdldFBhcmFtZXRlcihhc20sICdqYXZhLnBhY2thZ2UnKSA/PyBndWVzc0phdmFOYW1lc3BhY2VOYW1lKGZxbik7XG4gICAgfVxuICAgIGlmIChhc20uc3VibW9kdWxlcz8uW2Zxbl0pIHtcbiAgICAgIGNvbnN0IG1vZE5hbWUgPSBqc2lpVGFyZ2V0UGFyYW1ldGVyKGFzbS5zdWJtb2R1bGVzW2Zxbl0sICdqYXZhLnBhY2thZ2UnKTtcbiAgICAgIGlmIChtb2ROYW1lKSB7XG4gICAgICAgIHJldHVybiBtb2ROYW1lO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBgJHtyZWN1cnNlKG5hbWVzcGFjZU5hbWUoZnFuKSl9LiR7c2ltcGxlTmFtZShqc2lpU3ltYm9sLmZxbil9YDtcbiAgfVxufVxuXG5mdW5jdGlvbiBndWVzc0phdmFOYW1lc3BhY2VOYW1lKHBhY2thZ2VOYW1lOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHBhY2thZ2VOYW1lXG4gICAgLnNwbGl0KC9bXmEtekEtWjAtOV0rL2cpXG4gICAgLmZpbHRlcigocykgPT4gcyAhPT0gJycpXG4gICAgLmpvaW4oJy4nKTtcbn1cbiJdfQ==