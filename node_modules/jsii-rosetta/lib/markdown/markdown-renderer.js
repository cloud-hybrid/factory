"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.stripTrailingWhitespace = exports.stripPara = exports.collapsePara = exports.para = exports.MarkdownRenderer = void 0;
const markdown_1 = require("./markdown");
/**
 * A renderer that will render a CommonMark tree back to MarkDown
 */
class MarkdownRenderer {
    block_quote(_node, context) {
        return para(markdown_1.prefixLines('> ', collapsePara(context.content())));
    }
    code(node, _context) {
        return `\`${node.literal}\``;
    }
    code_block(node, _context) {
        var _a;
        return para(`\`\`\`${(_a = node.info) !== null && _a !== void 0 ? _a : ''}\n${node.literal}\`\`\``);
    }
    text(node, _context) {
        var _a;
        return (_a = node.literal) !== null && _a !== void 0 ? _a : '';
    }
    softbreak(_node, _context) {
        return '\n';
    }
    linebreak(_node, _context) {
        return '\\\n';
    }
    emph(_node, context) {
        return `*${context.content()}*`;
    }
    strong(_node, context) {
        return `**${context.content()}**`;
    }
    html_inline(node, _context) {
        var _a;
        return (_a = node.literal) !== null && _a !== void 0 ? _a : '';
    }
    html_block(node, _context) {
        var _a;
        return (_a = node.literal) !== null && _a !== void 0 ? _a : '';
    }
    link(node, context) {
        var _a;
        return `[${context.content()}](${(_a = node.destination) !== null && _a !== void 0 ? _a : ''})`;
    }
    image(node, context) {
        var _a;
        return `![${context.content()}](${(_a = node.destination) !== null && _a !== void 0 ? _a : ''})`;
    }
    document(_node, context) {
        return stripTrailingWhitespace(collapsePara(context.content()));
    }
    paragraph(_node, context) {
        return para(context.content());
    }
    list(node, context) {
        // A list is not wrapped in a paragraph, but items may contain paragraphs.
        // All elements of a list are definitely 'item's.
        const items = [];
        let i = 1;
        for (const item of markdown_1.cmNodeChildren(node)) {
            const firstLinePrefix = determineItemPrefix(node, i);
            const hangingPrefix = ' '.repeat(firstLinePrefix.length);
            const rendered = context.recurse(item);
            // Prefix the first line with a different text than subsequent lines
            const prefixed = firstLinePrefix + markdown_1.prefixLines(hangingPrefix, rendered).substr(hangingPrefix.length);
            items.push(prefixed);
            i += 1;
        }
        return para(items.join('\n'));
    }
    item(_node, context) {
        return collapsePara(context.content());
    }
    heading(node, context) {
        return para(`${'#'.repeat(node.level)} ${context.content()}`);
    }
    thematic_break(_node, _context) {
        return '---\n';
    }
    custom_block(_node, context) {
        return `<custom>${context.content()}</custom>`;
    }
    custom_inline(_node, context) {
        return `<custom>${context.content()}</custom>`;
    }
}
exports.MarkdownRenderer = MarkdownRenderer;
const PARA_BREAK = '\u001d';
function para(x) {
    return `${PARA_BREAK}${x}${PARA_BREAK}`;
}
exports.para = para;
/**
 * Collapse paragraph markers
 */
function collapsePara(x, brk = '\n\n') {
    /* eslint-disable no-control-regex */
    return x
        .replace(/^\u001d+/, '')
        .replace(/\u001d+$/, '')
        .replace(/\u001d+/g, brk);
    /* eslint-enable no-control-regex */
}
exports.collapsePara = collapsePara;
/**
 * Strip paragraph markers from start and end
 */
function stripPara(x) {
    /* eslint-disable-next-line no-control-regex */
    return x.replace(/^\u001d+/, '').replace(/\u001d+$/, '');
}
exports.stripPara = stripPara;
function determineItemPrefix(listNode, index) {
    if (listNode.listType === 'bullet') {
        return '* ';
    }
    return `${index}${listNode.listDelimiter} `;
}
function stripTrailingWhitespace(x) {
    return x.replace(/[ \t]+$/gm, '');
}
exports.stripTrailingWhitespace = stripTrailingWhitespace;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFya2Rvd24tcmVuZGVyZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJtYXJrZG93bi1yZW5kZXJlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFFQSx5Q0FBOEY7QUFFOUY7O0dBRUc7QUFDSCxNQUFhLGdCQUFnQjtJQUNwQixXQUFXLENBQUMsS0FBYyxFQUFFLE9BQXdCO1FBQ3pELE9BQU8sSUFBSSxDQUFDLHNCQUFXLENBQUMsSUFBSSxFQUFFLFlBQVksQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbEUsQ0FBQztJQUVNLElBQUksQ0FBQyxJQUFhLEVBQUUsUUFBeUI7UUFDbEQsT0FBTyxLQUFLLElBQUksQ0FBQyxPQUFPLElBQUksQ0FBQztJQUMvQixDQUFDO0lBRU0sVUFBVSxDQUFDLElBQWEsRUFBRSxRQUF5Qjs7UUFDeEQsT0FBTyxJQUFJLENBQUMsU0FBUyxNQUFBLElBQUksQ0FBQyxJQUFJLG1DQUFJLEVBQUUsS0FBSyxJQUFJLENBQUMsT0FBTyxRQUFRLENBQUMsQ0FBQztJQUNqRSxDQUFDO0lBRU0sSUFBSSxDQUFDLElBQWEsRUFBRSxRQUF5Qjs7UUFDbEQsYUFBTyxJQUFJLENBQUMsT0FBTyxtQ0FBSSxFQUFFLENBQUM7SUFDNUIsQ0FBQztJQUVNLFNBQVMsQ0FBQyxLQUFjLEVBQUUsUUFBeUI7UUFDeEQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRU0sU0FBUyxDQUFDLEtBQWMsRUFBRSxRQUF5QjtRQUN4RCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRU0sSUFBSSxDQUFDLEtBQWMsRUFBRSxPQUF3QjtRQUNsRCxPQUFPLElBQUksT0FBTyxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUM7SUFDbEMsQ0FBQztJQUVNLE1BQU0sQ0FBQyxLQUFjLEVBQUUsT0FBd0I7UUFDcEQsT0FBTyxLQUFLLE9BQU8sQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDO0lBQ3BDLENBQUM7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RyxVQUFVLEdBQUcsQ0FBQyxHQUFHLFVBQVUsRUFBRSxDQUFDO0FBQzFDLENBQUM7QUFGRCxvQkFFQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsWUFBWSxDQUFDLENBQVMsRUFBRSxHQUFHLEdBQUcsTUFBTTtJQUNsRCxxQ0FBcUM7SUFDckMsT0FBTyxDQUFDO1NBQ0wsT0FBTyxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUM7U0FDdkIsT0FBTyxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUM7U0FDdkIsT0FBTyxDQUFDLFVBQVUsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUM1QixvQ0FBb0M7QUFDdEMsQ0FBQztBQVBELG9DQU9DO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixTQUFTLENBQUMsQ0FBUztJQUNqQywrQ0FBK0M7SUFDL0MsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQzNELENBQUM7QUFIRCw4QkFHQztBQUVELFNBQVMsbUJBQW1CLENBQUMsUUFBaUIsRUFBRSxLQUFhO0lBQzNELElBQUksUUFBUSxDQUFDLFFBQVEsS0FBSyxRQUFRLEVBQUU7UUFDbEMsT0FBTyxJQUFJLENBQUM7S0FDYjtJQUNELE9BQU8sR0FBRyxLQUFLLEdBQUcsUUFBUSxDQUFDLGFBQWEsR0FBRyxDQUFDO0FBQzlDLENBQUM7QUFFRCxTQUFnQix1QkFBdUIsQ0FBQyxDQUFTO0lBQy9DLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDcEMsQ0FBQztBQUZELDBEQUVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgY20gZnJvbSAnY29tbW9ubWFyayc7XG5cbmltcG9ydCB7IGNtTm9kZUNoaWxkcmVuLCBDb21tb25NYXJrUmVuZGVyZXIsIHByZWZpeExpbmVzLCBSZW5kZXJlckNvbnRleHQgfSBmcm9tICcuL21hcmtkb3duJztcblxuLyoqXG4gKiBBIHJlbmRlcmVyIHRoYXQgd2lsbCByZW5kZXIgYSBDb21tb25NYXJrIHRyZWUgYmFjayB0byBNYXJrRG93blxuICovXG5leHBvcnQgY2xhc3MgTWFya2Rvd25SZW5kZXJlciBpbXBsZW1lbnRzIENvbW1vbk1hcmtSZW5kZXJlciB7XG4gIHB1YmxpYyBibG9ja19xdW90ZShfbm9kZTogY20uTm9kZSwgY29udGV4dDogUmVuZGVyZXJDb250ZXh0KSB7XG4gICAgcmV0dXJuIHBhcmEocHJlZml4TGluZXMoJz4gJywgY29sbGFwc2VQYXJhKGNvbnRleHQuY29udGVudCgpKSkpO1xuICB9XG5cbiAgcHVibGljIGNvZGUobm9kZTogY20uTm9kZSwgX2NvbnRleHQ6IFJlbmRlcmVyQ29udGV4dCkge1xuICAgIHJldHVybiBgXFxgJHtub2RlLmxpdGVyYWx9XFxgYDtcbiAgfVxuXG4gIHB1YmxpYyBjb2RlX2Jsb2NrKG5vZGU6IGNtLk5vZGUsIF9jb250ZXh0OiBSZW5kZXJlckNvbnRleHQpIHtcbiAgICByZXR1cm4gcGFyYShgXFxgXFxgXFxgJHtub2RlLmluZm8gPz8gJyd9XFxuJHtub2RlLmxpdGVyYWx9XFxgXFxgXFxgYCk7XG4gIH1cblxuICBwdWJsaWMgdGV4dChub2RlOiBjbS5Ob2RlLCBfY29udGV4dDogUmVuZGVyZXJDb250ZXh0KSB7XG4gICAgcmV0dXJuIG5vZGUubGl0ZXJhbCA/PyAnJztcbiAgfVxuXG4gIHB1YmxpYyBzb2Z0YnJlYWsoX25vZGU6IGNtLk5vZGUsIF9jb250ZXh0OiBSZW5kZXJlckNvbnRleHQpIHtcbiAgICByZXR1cm4gJ1xcbic7XG4gIH1cblxuICBwdWJsaWMgbGluZWJyZWFrKF9ub2RlOiBjbS5Ob2RlLCBfY29udGV4dDogUmVuZGVyZXJDb250ZXh0KSB7XG4gICAgcmV0dXJuICdcXFxcXFxuJztcbiAgfVxuXG4gIHB1YmxpYyBlbXBoKF9ub2RlOiBjbS5Ob2RlLCBjb250ZXh0OiBSZW5kZXJlckNvbnRleHQpIHtcbiAgICByZXR1cm4gYCoke2NvbnRleHQuY29udGVudCgpfSpgO1xuICB9XG5cbiAgcHVibGljIHN0cm9uZyhfbm9kZTogY20uTm9kZSwgY29udGV4dDogUmVuZGVyZXJDb250ZXh0KSB7XG4gICAgcmV0dXJuIGAqKiR7Y29udGV4dC5jb250ZW50KCl9KipgO1xuICB9XG5cbiAgcHVibGljIGh0bWxfaW5saW5lKG5vZGU6IGNtLk5vZGUsIF9jb250ZXh0OiBSZW5kZXJlckNvbnRleHQpIHtcbiAgICByZXR1cm4gbm9kZS5saXRlcmFsID8/ICcnO1xuICB9XG5cbiAgcHVibGljIGh0bWxfYmxvY2sobm9kZTogY20uTm9kZSwgX2NvbnRleHQ6IFJlbmRlcmVyQ29udGV4dCkge1xuICAgIHJldHVybiBub2RlLmxpdGVyYWwgPz8gJyc7XG4gIH1cblxuICBwdWJsaWMgbGluayhub2RlOiBjbS5Ob2RlLCBjb250ZXh0OiBSZW5kZXJlckNvbnRleHQpIHtcbiAgICByZXR1cm4gYFske2NvbnRleHQuY29udGVudCgpfV0oJHtub2RlLmRlc3RpbmF0aW9uID8/ICcnfSlgO1xuICB9XG5cbiAgcHVibGljIGltYWdlKG5vZGU6IGNtLk5vZGUsIGNvbnRleHQ6IFJlbmRlcmVyQ29udGV4dCkge1xuICAgIHJldHVybiBgIVske2NvbnRleHQuY29udGVudCgpfV0oJHtub2RlLmRlc3RpbmF0aW9uID8/ICcnfSlgO1xuICB9XG5cbiAgcHVibGljIGRvY3VtZW50KF9ub2RlOiBjbS5Ob2RlLCBjb250ZXh0OiBSZW5kZXJlckNvbnRleHQpIHtcbiAgICByZXR1cm4gc3RyaXBUcmFpbGluZ1doaXRlc3BhY2UoY29sbGFwc2VQYXJhKGNvbnRleHQuY29udGVudCgpKSk7XG4gIH1cblxuICBwdWJsaWMgcGFyYWdyYXBoKF9ub2RlOiBjbS5Ob2RlLCBjb250ZXh0OiBSZW5kZXJlckNvbnRleHQpIHtcbiAgICByZXR1cm4gcGFyYShjb250ZXh0LmNvbnRlbnQoKSk7XG4gIH1cblxuICBwdWJsaWMgbGlzdChub2RlOiBjbS5Ob2RlLCBjb250ZXh0OiBSZW5kZXJlckNvbnRleHQpIHtcbiAgICAvLyBBIGxpc3QgaXMgbm90IHdyYXBwZWQgaW4gYSBwYXJhZ3JhcGgsIGJ1dCBpdGVtcyBtYXkgY29udGFpbiBwYXJhZ3JhcGhzLlxuICAgIC8vIEFsbCBlbGVtZW50cyBvZiBhIGxpc3QgYXJlIGRlZmluaXRlbHkgJ2l0ZW0ncy5cbiAgICBjb25zdCBpdGVtcyA9IFtdO1xuXG4gICAgbGV0IGkgPSAxO1xuICAgIGZvciAoY29uc3QgaXRlbSBvZiBjbU5vZGVDaGlsZHJlbihub2RlKSkge1xuICAgICAgY29uc3QgZmlyc3RMaW5lUHJlZml4ID0gZGV0ZXJtaW5lSXRlbVByZWZpeChub2RlLCBpKTtcbiAgICAgIGNvbnN0IGhhbmdpbmdQcmVmaXggPSAnICcucmVwZWF0KGZpcnN0TGluZVByZWZpeC5sZW5ndGgpO1xuXG4gICAgICBjb25zdCByZW5kZXJlZCA9IGNvbnRleHQucmVjdXJzZShpdGVtKTtcbiAgICAgIC8vIFByZWZpeCB0aGUgZmlyc3QgbGluZSB3aXRoIGEgZGlmZmVyZW50IHRleHQgdGhhbiBzdWJzZXF1ZW50IGxpbmVzXG4gICAgICBjb25zdCBwcmVmaXhlZCA9IGZpcnN0TGluZVByZWZpeCArIHByZWZpeExpbmVzKGhhbmdpbmdQcmVmaXgsIHJlbmRlcmVkKS5zdWJzdHIoaGFuZ2luZ1ByZWZpeC5sZW5ndGgpO1xuXG4gICAgICBpdGVtcy5wdXNoKHByZWZpeGVkKTtcblxuICAgICAgaSArPSAxO1xuICAgIH1cblxuICAgIHJldHVybiBwYXJhKGl0ZW1zLmpvaW4oJ1xcbicpKTtcbiAgfVxuXG4gIHB1YmxpYyBpdGVtKF9ub2RlOiBjbS5Ob2RlLCBjb250ZXh0OiBSZW5kZXJlckNvbnRleHQpIHtcbiAgICByZXR1cm4gY29sbGFwc2VQYXJhKGNvbnRleHQuY29udGVudCgpKTtcbiAgfVxuXG4gIHB1YmxpYyBoZWFkaW5nKG5vZGU6IGNtLk5vZGUsIGNvbnRleHQ6IFJlbmRlcmVyQ29udGV4dCkge1xuICAgIHJldHVybiBwYXJhKGAkeycjJy5yZXBlYXQobm9kZS5sZXZlbCl9ICR7Y29udGV4dC5jb250ZW50KCl9YCk7XG4gIH1cblxuICBwdWJsaWMgdGhlbWF0aWNfYnJlYWsoX25vZGU6IGNtLk5vZGUsIF9jb250ZXh0OiBSZW5kZXJlckNvbnRleHQpIHtcbiAgICByZXR1cm4gJy0tLVxcbic7XG4gIH1cblxuICBwdWJsaWMgY3VzdG9tX2Jsb2NrKF9ub2RlOiBjbS5Ob2RlLCBjb250ZXh0OiBSZW5kZXJlckNvbnRleHQpIHtcbiAgICByZXR1cm4gYDxjdXN0b20+JHtjb250ZXh0LmNvbnRlbnQoKX08L2N1c3RvbT5gO1xuICB9XG5cbiAgcHVibGljIGN1c3RvbV9pbmxpbmUoX25vZGU6IGNtLk5vZGUsIGNvbnRleHQ6IFJlbmRlcmVyQ29udGV4dCkge1xuICAgIHJldHVybiBgPGN1c3RvbT4ke2NvbnRleHQuY29udGVudCgpfTwvY3VzdG9tPmA7XG4gIH1cbn1cblxuY29uc3QgUEFSQV9CUkVBSyA9ICdcXHUwMDFkJztcblxuZXhwb3J0IGZ1bmN0aW9uIHBhcmEoeDogc3RyaW5nKSB7XG4gIHJldHVybiBgJHtQQVJBX0JSRUFLfSR7eH0ke1BBUkFfQlJFQUt9YDtcbn1cblxuLyoqXG4gKiBDb2xsYXBzZSBwYXJhZ3JhcGggbWFya2Vyc1xuICovXG5leHBvcnQgZnVuY3Rpb24gY29sbGFwc2VQYXJhKHg6IHN0cmluZywgYnJrID0gJ1xcblxcbicpIHtcbiAgLyogZXNsaW50LWRpc2FibGUgbm8tY29udHJvbC1yZWdleCAqL1xuICByZXR1cm4geFxuICAgIC5yZXBsYWNlKC9eXFx1MDAxZCsvLCAnJylcbiAgICAucmVwbGFjZSgvXFx1MDAxZCskLywgJycpXG4gICAgLnJlcGxhY2UoL1xcdTAwMWQrL2csIGJyayk7XG4gIC8qIGVzbGludC1lbmFibGUgbm8tY29udHJvbC1yZWdleCAqL1xufVxuXG4vKipcbiAqIFN0cmlwIHBhcmFncmFwaCBtYXJrZXJzIGZyb20gc3RhcnQgYW5kIGVuZFxuICovXG5leHBvcnQgZnVuY3Rpb24gc3RyaXBQYXJhKHg6IHN0cmluZykge1xuICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29udHJvbC1yZWdleCAqL1xuICByZXR1cm4geC5yZXBsYWNlKC9eXFx1MDAxZCsvLCAnJykucmVwbGFjZSgvXFx1MDAxZCskLywgJycpO1xufVxuXG5mdW5jdGlvbiBkZXRlcm1pbmVJdGVtUHJlZml4KGxpc3ROb2RlOiBjbS5Ob2RlLCBpbmRleDogbnVtYmVyKSB7XG4gIGlmIChsaXN0Tm9kZS5saXN0VHlwZSA9PT0gJ2J1bGxldCcpIHtcbiAgICByZXR1cm4gJyogJztcbiAgfVxuICByZXR1cm4gYCR7aW5kZXh9JHtsaXN0Tm9kZS5saXN0RGVsaW1pdGVyfSBgO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3RyaXBUcmFpbGluZ1doaXRlc3BhY2UoeDogc3RyaW5nKSB7XG4gIHJldHVybiB4LnJlcGxhY2UoL1sgXFx0XSskL2dtLCAnJyk7XG59XG4iXX0=