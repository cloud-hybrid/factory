"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ResourceModel = exports.STRUCT_SHARDING_THRESHOLD = void 0;
const codemaker_1 = require("codemaker");
const path_1 = __importDefault(require("path"));
const util_1 = require("../../../util");
const provider_namespaces_1 = require("../constants/provider-namespaces");
const struct_1 = require("./struct");
exports.STRUCT_SHARDING_THRESHOLD = 400;
class ResourceModel {
    constructor(options) {
        this.className = options.className;
        this.filePath = options.filePath;
        this.terraformType = options.terraformType;
        this.baseName = options.baseName;
        this.attributes = options.attributes;
        this.schema = options.schema;
        this.provider = options.provider;
        this.fileName = options.fileName;
        this._structs = options.structs;
        this.terraformSchemaType = options.terraformSchemaType;
        this.configStructName = options.configStructName;
        this.dependencies = [
            `import { Construct } from 'constructs';`,
            `import * as cdktf from 'cdktf';`,
        ];
    }
    get structsRequireSharding() {
        return this._structs.length > exports.STRUCT_SHARDING_THRESHOLD;
    }
    get structs() {
        return [this.configStruct, ...this._structs];
    }
    get configStruct() {
        return new struct_1.ConfigStruct(this.configStructName, this.attributes);
    }
    get synthesizableAttributes() {
        return this.configStruct.assignableAttributes;
    }
    get importStatements() {
        return this.dependencies;
    }
    get schemaAsJson() {
        return this.escapeSchema(JSON.stringify(this.schema, undefined, 2));
    }
    get linkToDocs() {
        if (this.isProvider)
            return `https://www.terraform.io/docs/providers/${this.provider}`;
        return `https://www.terraform.io/docs/providers/${this.provider}/${this.isDataSource ? "d" : "r"}/${this.terraformDocName}.html`;
    }
    get isProvider() {
        return this.terraformSchemaType === "provider";
    }
    get namespace() {
        return provider_namespaces_1.getResourceNamespace(this.provider, this.baseName);
    }
    get isDataSource() {
        return this.terraformSchemaType === "data_source";
    }
    get parentClassName() {
        return this.isProvider
            ? "TerraformProvider"
            : this.isDataSource
                ? "TerraformDataSource"
                : "TerraformResource";
    }
    get terraformResourceType() {
        return this.isProvider
            ? this.provider
            : this.isDataSource
                ? this.terraformType.replace(/^data_/, "")
                : this.terraformType;
    }
    get terraformDocName() {
        return codemaker_1.toSnakeCase(this.terraformResourceType.replace(new RegExp(`^${this.provider}_`, "i"), ""));
    }
    get importableTypes() {
        const structNames = this.structNames;
        const result = [
            ...this.configStruct.attributeTypeNames,
            ...this.attributeTypeNames,
        ].filter((t) => structNames.includes(t));
        return Array.from(new Set(result));
    }
    get importableTypesFromClasses() {
        const structNames = this.structNames;
        const result = [
            ...this.configStruct.attributeTypeNamesFromClasses,
            ...this.attributeTypeNamesFromClasses,
        ].filter((t) => structNames.includes(t));
        return Array.from(new Set(result));
    }
    get importableOutputReferences() {
        return this.importableTypesFromClasses.map((type) => `${type}OutputReference`);
    }
    get importableStructMapper() {
        return this.importableTypes.map((type) => `${util_1.downcaseFirst(type)}ToTerraform`);
    }
    get structNames() {
        return this.structs.map((s) => s.name);
    }
    get structsFolderName() {
        return `${path_1.default.basename(this.fileName, ".ts")}-structs`;
    }
    get attributeTypeNames() {
        return this.attributes.map((a) => a.type.typeName);
    }
    get attributeTypeNamesFromClasses() {
        return this.attributes
            .filter((a) => { var _a; return (_a = a.type.struct) === null || _a === void 0 ? void 0 : _a.isClass; })
            .map((a) => a.type.typeName);
    }
    get structsFolderPath() {
        const basePath = this.filePath.split("/").slice(0, -1).join("/");
        if (this.namespace) {
            return path_1.default.join(basePath, this.namespace.name, this.structsFolderName);
        }
        else {
            return path_1.default.join(basePath, this.structsFolderName);
        }
    }
    escapeSchema(schema) {
        return schema.replace(/(\*\/)/gi, `*\\/`);
    }
}
exports.ResourceModel = ResourceModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzb3VyY2UtbW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJyZXNvdXJjZS1tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSx5Q0FBd0M7QUFDeEMsZ0RBQXdCO0FBQ3hCLHdDQUE4QztBQUM5QywwRUFHMEM7QUFHMUMscUNBQWdEO0FBRW5DLFFBQUEseUJBQXlCLEdBQUcsR0FBRyxDQUFDO0FBZTdDLE1BQWEsYUFBYTtJQWdCeEIsWUFBWSxPQUE2QjtRQUN2QyxJQUFJLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUM7UUFDbkMsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxhQUFhLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQztRQUMzQyxJQUFJLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUM7UUFDakMsSUFBSSxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDO1FBQ3JDLElBQUksQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQztRQUM3QixJQUFJLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUM7UUFDakMsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQztRQUNoQyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsT0FBTyxDQUFDLG1CQUFtQixDQUFDO1FBQ3ZELElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsZ0JBQWdCLENBQUM7UUFDakQsSUFBSSxDQUFDLFlBQVksR0FBRztZQUNsQix5Q0FBeUM7WUFDekMsaUNBQWlDO1NBQ2xDLENBQUM7SUFDSixDQUFDO0lBRUQsSUFBVyxzQkFBc0I7UUFDL0IsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxpQ0FBeUIs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UUFDdEMsT0FBTyxJQUFJLENBQUMsVUFBVTthQUNuQixNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSx3QkFBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sMENBQUUsT0FBTyxHQUFBLENBQUM7YUFDckMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFRCxJQUFXLGlCQUFpQjtRQUMxQixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRWpFLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNsQixPQUFPLGNBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxTQUFVLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1NBQzFFO2FBQU07WUFDTCxPQUFPLGNBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1NBQ3BEO0lBQ0gsQ0FBQztJQUVPLFlBQVksQ0FBQyxNQUFjO1FBQ2pDLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDNUMsQ0FBQztDQUNGO0FBdEtELHNDQXNLQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHRvU25ha2VDYXNlIH0gZnJvbSBcImNvZGVtYWtlclwiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCB7IGRvd25jYXNlRmlyc3QgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbFwiO1xuaW1wb3J0IHtcbiAgUmVzb3VyY2VOYW1lc3BhY2UsXG4gIGdldFJlc291cmNlTmFtZXNwYWNlLFxufSBmcm9tIFwiLi4vY29uc3RhbnRzL3Byb3ZpZGVyLW5hbWVzcGFjZXNcIjtcbmltcG9ydCB7IFNjaGVtYSB9IGZyb20gXCIuLi9wcm92aWRlci1zY2hlbWFcIjtcbmltcG9ydCB7IEF0dHJpYnV0ZU1vZGVsIH0gZnJvbSBcIi4vYXR0cmlidXRlLW1vZGVsXCI7XG5pbXBvcnQgeyBTdHJ1Y3QsIENvbmZpZ1N0cnVjdCB9IGZyb20gXCIuL3N0cnVjdFwiO1xuXG5leHBvcnQgY29uc3QgU1RSVUNUX1NIQVJESU5HX1RIUkVTSE9MRCA9IDQwMDtcbmludGVyZmFjZSBSZXNvdXJjZU1vZGVsT3B0aW9ucyB7XG4gIHRlcnJhZm9ybVR5cGU6IHN0cmluZztcbiAgY2xhc3NOYW1lOiBzdHJpbmc7XG4gIGJhc2VOYW1lOiBzdHJpbmc7XG4gIGZpbGVOYW1lOiBzdHJpbmc7XG4gIGZpbGVQYXRoOiBzdHJpbmc7XG4gIGF0dHJpYnV0ZXM6IEF0dHJpYnV0ZU1vZGVsW107XG4gIHN0cnVjdHM6IFN0cnVjdFtdO1xuICBwcm92aWRlcjogc3RyaW5nO1xuICBzY2hlbWE6IFNjaGVtYTtcbiAgdGVycmFmb3JtU2NoZW1hVHlwZTogc3RyaW5nO1xuICBjb25maWdTdHJ1Y3ROYW1lOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBSZXNvdXJjZU1vZGVsIHtcbiAgcHVibGljIGNsYXNzTmFtZTogc3RyaW5nO1xuICBwdWJsaWMgZmlsZVBhdGg6IHN0cmluZztcbiAgcHVibGljIHRlcnJhZm9ybVR5cGU6IHN0cmluZztcbiAgcHVibGljIGJhc2VOYW1lOiBzdHJpbmc7XG4gIHB1YmxpYyBwcm92aWRlcjogc3RyaW5nO1xuICBwdWJsaWMgcHJvdmlkZXJWZXJzaW9uQ29uc3RyYWludD86IHN0cmluZztcbiAgcHVibGljIHRlcnJhZm9ybVByb3ZpZGVyU291cmNlPzogc3RyaW5nO1xuICBwdWJsaWMgZmlsZU5hbWU6IHN0cmluZztcbiAgcHVibGljIGF0dHJpYnV0ZXM6IEF0dHJpYnV0ZU1vZGVsW107XG4gIHB1YmxpYyBzY2hlbWE6IFNjaGVtYTtcbiAgcHJpdmF0ZSBfc3RydWN0czogU3RydWN0W107XG4gIHByaXZhdGUgZGVwZW5kZW5jaWVzOiBzdHJpbmdbXTtcbiAgcHJpdmF0ZSB0ZXJyYWZvcm1TY2hlbWFUeXBlOiBzdHJpbmc7XG4gIHByaXZhdGUgY29uZmlnU3RydWN0TmFtZTogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IFJlc291cmNlTW9kZWxPcHRpb25zKSB7XG4gICAgdGhpcy5jbGFzc05hbWUgPSBvcHRpb25zLmNsYXNzTmFtZTtcbiAgICB0aGlzLmZpbGVQYXRoID0gb3B0aW9ucy5maWxlUGF0aDtcbiAgICB0aGlzLnRlcnJhZm9ybVR5cGUgPSBvcHRpb25zLnRlcnJhZm9ybVR5cGU7XG4gICAgdGhpcy5iYXNlTmFtZSA9IG9wdGlvbnMuYmFzZU5hbWU7XG4gICAgdGhpcy5hdHRyaWJ1dGVzID0gb3B0aW9ucy5hdHRyaWJ1dGVzO1xuICAgIHRoaXMuc2NoZW1hID0gb3B0aW9ucy5zY2hlbWE7XG4gICAgdGhpcy5wcm92aWRlciA9IG9wdGlvbnMucHJvdmlkZXI7XG4gICAgdGhpcy5maWxlTmFtZSA9IG9wdGlvbnMuZmlsZU5hbWU7XG4gICAgdGhpcy5fc3RydWN0cyA9IG9wdGlvbnMuc3RydWN0cztcbiAgICB0aGlzLnRlcnJhZm9ybVNjaGVtYVR5cGUgPSBvcHRpb25zLnRlcnJhZm9ybVNjaGVtYVR5cGU7XG4gICAgdGhpcy5jb25maWdTdHJ1Y3ROYW1lID0gb3B0aW9ucy5jb25maWdTdHJ1Y3ROYW1lO1xuICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gW1xuICAgICAgYGltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO2AsXG4gICAgICBgaW1wb3J0ICogYXMgY2RrdGYgZnJvbSAnY2RrdGYnO2AsXG4gICAgXTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgc3RydWN0c1JlcXVpcmVTaGFyZGluZygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fc3RydWN0cy5sZW5ndGggPiBTVFJVQ1RfU0hBUkRJTkdfVEhSRVNIT0xEO1xuICB9XG5cbiAgcHVibGljIGdldCBzdHJ1Y3RzKCk6IFN0cnVjdFtdIHtcbiAgICByZXR1cm4gW3RoaXMuY29uZmlnU3RydWN0LCAuLi50aGlzLl9zdHJ1Y3RzXTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgY29uZmlnU3RydWN0KCkge1xuICAgIHJldHVybiBuZXcgQ29uZmlnU3RydWN0KHRoaXMuY29uZmlnU3RydWN0TmFtZSwgdGhpcy5hdHRyaWJ1dGVzKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgc3ludGhlc2l6YWJsZUF0dHJpYnV0ZXMoKTogQXR0cmlidXRlTW9kZWxbXSB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnU3RydWN0LmFzc2lnbmFibGVBdHRyaWJ1dGVzO1xuICB9XG5cbiAgcHVibGljIGdldCBpbXBvcnRTdGF0ZW1lbnRzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gdGhpcy5kZXBlbmRlbmNpZXM7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHNjaGVtYUFzSnNvbigpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmVzY2FwZVNjaGVtYShKU09OLnN0cmluZ2lmeSh0aGlzLnNjaGVtYSwgdW5kZWZpbmVkLCAyKSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGxpbmtUb0RvY3MoKTogc3RyaW5nIHtcbiAgICBpZiAodGhpcy5pc1Byb3ZpZGVyKVxuICAgICAgcmV0dXJuIGBodHRwczovL3d3dy50ZXJyYWZvcm0uaW8vZG9jcy9wcm92aWRlcnMvJHt0aGlzLnByb3ZpZGVyfWA7XG4gICAgcmV0dXJuIGBodHRwczovL3d3dy50ZXJyYWZvcm0uaW8vZG9jcy9wcm92aWRlcnMvJHt0aGlzLnByb3ZpZGVyfS8ke1xuICAgICAgdGhpcy5pc0RhdGFTb3VyY2UgPyBcImRcIiA6IFwiclwiXG4gICAgfS8ke3RoaXMudGVycmFmb3JtRG9jTmFtZX0uaHRtbGA7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGlzUHJvdmlkZXIoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudGVycmFmb3JtU2NoZW1hVHlwZSA9PT0gXCJwcm92aWRlclwiO1xuICB9XG5cbiAgcHVibGljIGdldCBuYW1lc3BhY2UoKTogUmVzb3VyY2VOYW1lc3BhY2UgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiBnZXRSZXNvdXJjZU5hbWVzcGFjZSh0aGlzLnByb3ZpZGVyLCB0aGlzLmJhc2VOYW1lKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgaXNEYXRhU291cmNlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnRlcnJhZm9ybVNjaGVtYVR5cGUgPT09IFwiZGF0YV9zb3VyY2VcIjtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgcGFyZW50Q2xhc3NOYW1lKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuaXNQcm92aWRlclxuICAgICAgPyBcIlRlcnJhZm9ybVByb3ZpZGVyXCJcbiAgICAgIDogdGhpcy5pc0RhdGFTb3VyY2VcbiAgICAgID8gXCJUZXJyYWZvcm1EYXRhU291cmNlXCJcbiAgICAgIDogXCJUZXJyYWZvcm1SZXNvdXJjZVwiO1xuICB9XG5cbiAgcHVibGljIGdldCB0ZXJyYWZvcm1SZXNvdXJjZVR5cGUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5pc1Byb3ZpZGVyXG4gICAgICA/IHRoaXMucHJvdmlkZXJcbiAgICAgIDogdGhpcy5pc0RhdGFTb3VyY2VcbiAgICAgID8gdGhpcy50ZXJyYWZvcm1UeXBlLnJlcGxhY2UoL15kYXRhXy8sIFwiXCIpXG4gICAgICA6IHRoaXMudGVycmFmb3JtVHlwZTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgdGVycmFmb3JtRG9jTmFtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0b1NuYWtlQ2FzZShcbiAgICAgIHRoaXMudGVycmFmb3JtUmVzb3VyY2VUeXBlLnJlcGxhY2UoXG4gICAgICAgIG5ldyBSZWdFeHAoYF4ke3RoaXMucHJvdmlkZXJ9X2AsIFwiaVwiKSxcbiAgICAgICAgXCJcIlxuICAgICAgKVxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGltcG9ydGFibGVUeXBlcygpOiBzdHJpbmdbXSB7XG4gICAgY29uc3Qgc3RydWN0TmFtZXMgPSB0aGlzLnN0cnVjdE5hbWVzO1xuICAgIGNvbnN0IHJlc3VsdCA9IFtcbiAgICAgIC4uLnRoaXMuY29uZmlnU3RydWN0LmF0dHJpYnV0ZVR5cGVOYW1lcyxcbiAgICAgIC4uLnRoaXMuYXR0cmlidXRlVHlwZU5hbWVzLFxuICAgIF0uZmlsdGVyKCh0KSA9PiBzdHJ1Y3ROYW1lcy5pbmNsdWRlcyh0KSk7XG5cbiAgICByZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KHJlc3VsdCkpO1xuICB9XG5cbiAgcHVibGljIGdldCBpbXBvcnRhYmxlVHlwZXNGcm9tQ2xhc3NlcygpOiBzdHJpbmdbXSB7XG4gICAgY29uc3Qgc3RydWN0TmFtZXMgPSB0aGlzLnN0cnVjdE5hbWVzO1xuICAgIGNvbnN0IHJlc3VsdCA9IFtcbiAgICAgIC4uLnRoaXMuY29uZmlnU3RydWN0LmF0dHJpYnV0ZVR5cGVOYW1lc0Zyb21DbGFzc2VzLFxuICAgICAgLi4udGhpcy5hdHRyaWJ1dGVUeXBlTmFtZXNGcm9tQ2xhc3NlcyxcbiAgICBdLmZpbHRlcigodCkgPT4gc3RydWN0TmFtZXMuaW5jbHVkZXModCkpO1xuXG4gICAgcmV0dXJuIEFycmF5LmZyb20obmV3IFNldChyZXN1bHQpKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgaW1wb3J0YWJsZU91dHB1dFJlZmVyZW5jZXMoKTogc3RyaW5nW10ge1xuICAgIHJldHVybiB0aGlzLmltcG9ydGFibGVUeXBlc0Zyb21DbGFzc2VzLm1hcChcbiAgICAgICh0eXBlKSA9PiBgJHt0eXBlfU91dHB1dFJlZmVyZW5jZWBcbiAgICApO1xuICB9XG5cbiAgcHVibGljIGdldCBpbXBvcnRhYmxlU3RydWN0TWFwcGVyKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gdGhpcy5pbXBvcnRhYmxlVHlwZXMubWFwKFxuICAgICAgKHR5cGUpID0+IGAke2Rvd25jYXNlRmlyc3QodHlwZSl9VG9UZXJyYWZvcm1gXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgc3RydWN0TmFtZXMoKTogc3RyaW5nW10ge1xuICAgIHJldHVybiB0aGlzLnN0cnVjdHMubWFwKChzKSA9PiBzLm5hbWUpO1xuICB9XG5cbiAgcHVibGljIGdldCBzdHJ1Y3RzRm9sZGVyTmFtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBgJHtwYXRoLmJhc2VuYW1lKHRoaXMuZmlsZU5hbWUsIFwiLnRzXCIpfS1zdHJ1Y3RzYDtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgYXR0cmlidXRlVHlwZU5hbWVzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gdGhpcy5hdHRyaWJ1dGVzLm1hcCgoYSkgPT4gYS50eXBlLnR5cGVOYW1lKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgYXR0cmlidXRlVHlwZU5hbWVzRnJvbUNsYXNzZXMoKTogc3RyaW5nW10ge1xuICAgIHJldHVybiB0aGlzLmF0dHJpYnV0ZXNcbiAgICAgIC5maWx0ZXIoKGEpID0+IGEudHlwZS5zdHJ1Y3Q/LmlzQ2xhc3MpXG4gICAgICAubWFwKChhKSA9PiBhLnR5cGUudHlwZU5hbWUpO1xuICB9XG5cbiAgcHVibGljIGdldCBzdHJ1Y3RzRm9sZGVyUGF0aCgpOiBzdHJpbmcge1xuICAgIGNvbnN0IGJhc2VQYXRoID0gdGhpcy5maWxlUGF0aC5zcGxpdChcIi9cIikuc2xpY2UoMCwgLTEpLmpvaW4oXCIvXCIpO1xuXG4gICAgaWYgKHRoaXMubmFtZXNwYWNlKSB7XG4gICAgICByZXR1cm4gcGF0aC5qb2luKGJhc2VQYXRoLCB0aGlzLm5hbWVzcGFjZSEubmFtZSwgdGhpcy5zdHJ1Y3RzRm9sZGVyTmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBwYXRoLmpvaW4oYmFzZVBhdGgsIHRoaXMuc3RydWN0c0ZvbGRlck5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZXNjYXBlU2NoZW1hKHNjaGVtYTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gc2NoZW1hLnJlcGxhY2UoLyhcXCpcXC8pL2dpLCBgKlxcXFwvYCk7XG4gIH1cbn1cbiJdfQ==