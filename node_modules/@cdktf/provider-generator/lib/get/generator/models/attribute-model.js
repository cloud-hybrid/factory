"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AttributeModel = void 0;
class AttributeModel {
    constructor(options) {
        this.storageName = options.storageName;
        this._name = options.name;
        this.type = options.type;
        this.optional = options.optional;
        this.computed = options.computed;
        this.terraformName = options.terraformName;
        this.terraformFullName = options.terraformFullName;
        this._description = options.description;
        this.provider = options.provider;
        this.required = options.required;
    }
    get typeDefinition() {
        const optional = this.optional ? "?" : "";
        return `${this.name}${optional}: ${this.type.name}`;
    }
    get isAssignable() {
        return this.required || this.optional;
    }
    get isOptional() {
        return this.optional;
    }
    get isRequired() {
        return this.required;
    }
    get isTokenizable() {
        return this.type.isTokenizable;
    }
    get isProvider() {
        return this.provider;
    }
    get getterType() {
        let getterType = { _type: "plain" };
        if (
        // Complex Computed List Map
        this.computed &&
            !this.isOptional &&
            this.type.isComputedComplex &&
            this.type.isList &&
            this.type.isMap) {
            getterType = {
                _type: "args",
                args: "index: string, key: string",
                returnType: this.mapType,
                returnStatement: `new ${this.type.name}(this, \`${this.terraformName}.\${index}\`).lookup(key)`,
            };
        }
        else if (
        // Complex Computed List
        this.computed &&
            !this.isOptional &&
            this.type.isComputedComplex &&
            this.type.isList) {
            getterType = {
                _type: "args",
                args: "index: string",
                returnStatement: `new ${this.type.name}(this, '${this.terraformName}', index)`,
            };
        }
        else if (
        // Complex Computed Map
        this.computed &&
            !this.isOptional &&
            this.type.isComputedComplex &&
            this.type.isMap) {
            getterType = {
                _type: "args",
                args: "key: string",
                returnType: this.mapType,
                returnStatement: `new ${this.type.name}(this, '${this.terraformName}').lookup(key)`,
            };
        }
        if (this.type.isSingleItem && this.type.isComplex && !this.isProvider) {
            getterType = { _type: "stored_class" };
        }
        return getterType;
    }
    get mapType() {
        const type = this.type;
        if (type.isStringMap) {
            return `string`;
        }
        if (type.isNumberMap) {
            return `number`;
        }
        if (type.isBooleanMap) {
            return `boolean`;
        }
        if (process.env.DEBUG) {
            console.error(`The attribute ${JSON.stringify(this)} isn't implemented yet`);
        }
        return `any`;
    }
    get isStored() {
        return ((this.isAssignable && !this.isConfigIgnored) ||
            this.getterType._type === "stored_class");
    }
    get setterType() {
        if (!this.isStored) {
            return { _type: "none" };
        }
        if (this.getterType._type === "stored_class") {
            return {
                _type: "stored_class",
                type: this.type.name,
            };
        }
        return {
            _type: "set",
            type: `${this.type.name}${this.isProvider ? " | undefined" : ""}`,
        };
    }
    get name() {
        // `self` and `build` doesn't work in as property name in Python
        if (this._name === "self" || this._name === "build")
            return `${this._name}Attribute`;
        // jsii can't handle `getFoo` properties, since it's incompatible with Java
        if (this._name.match(/^get[A-Z]+/))
            return this._name.replace("get", "fetch");
        // `equals` is a prohibited name in jsii
        if (this._name === "equals")
            return "equalTo";
        // `node` is already used by the Constructs base class
        if (this._name === "node")
            return "nodeAttribute";
        // `System` shadows built-in types in CSharp (see #1420)
        if (this._name === "system")
            return "systemAttribute";
        // `tfResourceType` is already used by resources to distinguish between different resource types
        if (this._name === "tfResourceType")
            return `${this._name}Attribute`;
        return this._name;
    }
    get description() {
        var _a;
        return (_a = this._description) === null || _a === void 0 ? void 0 : _a.replace(/(\*\/)/gi, `*\\/`).replace(/'''/gi, "```");
    }
    get isConfigIgnored() {
        if (this.isAssignable && !this.computed) {
            return false;
        }
        const ignoreList = ["arn", "id"];
        return ignoreList.includes(this.name);
    }
}
exports.AttributeModel = AttributeModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXR0cmlidXRlLW1vZGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXR0cmlidXRlLW1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQWtDQSxNQUFhLGNBQWM7SUFZekIsWUFBWSxPQUE4QjtRQUN4QyxJQUFJLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUM7UUFDdkMsSUFBSSxDQUFDLEtBQUssR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQzFCLElBQUksQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztRQUN6QixJQUFJLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUM7UUFDakMsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxhQUFhLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQztRQUMzQyxJQUFJLENBQUMsaUJBQWlCLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDO1FBQ25ELElBQUksQ0FBQyxZQUFZLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQztRQUN4QyxJQUFJLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUM7UUFDakMsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDO0lBQ25DLENBQUM7SUFFRCxJQUFXLGNBQWM7UUFDdkIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDMUMsT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLEdBQUcsUUFBUSxLQUFLLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDdEQsQ0FBQztJQUVELElBQVcsWUFBWTtRQUNyQixPQUFPLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUN4QyxDQUFDO0lBRUQsSUFBVyxV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QUssS0FBSyxNQUFNO1lBQUUsT0FBTyxlQUFlLENBQUM7UUFDbEQsd0RBQXdEO1FBQ3hELElBQUksSUFBSSxDQUFDLEtBQUssS0FBSyxRQUFRO1lBQUUsT0FBTyxpQkFBaUIsQ0FBQztRQUN0RCxnR0FBZ0c7UUFDaEcsSUFBSSxJQUFJLENBQUMsS0FBSyxLQUFLLGdCQUFnQjtZQUFFLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxXQUFXLENBQUM7UUFDckUsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDO0lBQ3BCLENBQUM7SUFFRCxJQUFXLFdBQVc7O1FBQ3BCLGFBQU8sSUFBSSxDQUFDLFlBQVksMENBQ3BCLE9BQU8sQ0FBQyxVQUFVLEVBQUUsTUFBTSxFQUMzQixPQUFPLENBQUMsT0FBTyxFQUFFLEtBQUssRUFBRTtJQUM3QixDQUFDO0lBRUQsSUFBVyxlQUFlO1FBQ3hCLElBQUksSUFBSSxDQUFDLFlBQVksSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDdkMsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUNELE1BQU0sVUFBVSxHQUFHLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ2pDLE9BQU8sVUFBVSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDeEMsQ0FBQztDQUNGO0FBaExELHdDQWdMQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEF0dHJpYnV0ZVR5cGVNb2RlbCB9IGZyb20gXCIuL2F0dHJpYnV0ZS10eXBlLW1vZGVsXCI7XG5cbmV4cG9ydCB0eXBlIEdldHRlclR5cGUgPVxuICB8IHsgX3R5cGU6IFwicGxhaW5cIiB9XG4gIHwge1xuICAgICAgX3R5cGU6IFwiYXJnc1wiO1xuICAgICAgYXJnczogc3RyaW5nO1xuICAgICAgcmV0dXJuVHlwZT86IHN0cmluZztcbiAgICAgIHJldHVyblN0YXRlbWVudDogc3RyaW5nO1xuICAgIH1cbiAgfCB7XG4gICAgICBfdHlwZTogXCJzdG9yZWRfY2xhc3NcIjtcbiAgICB9O1xuXG5leHBvcnQgdHlwZSBTZXR0ZXJUeXBlID1cbiAgfCB7IF90eXBlOiBcIm5vbmVcIiB9XG4gIHwgeyBfdHlwZTogXCJzZXRcIjsgdHlwZTogc3RyaW5nIH1cbiAgfCB7IF90eXBlOiBcInB1dFwiOyB0eXBlOiBzdHJpbmcgfVxuICB8IHsgX3R5cGU6IFwic3RvcmVkX2NsYXNzXCI7IHR5cGU6IHN0cmluZyB9O1xuXG5leHBvcnQgaW50ZXJmYWNlIEF0dHJpYnV0ZU1vZGVsT3B0aW9ucyB7XG4gIHN0b3JhZ2VOYW1lOiBzdHJpbmc7IC8vIHByaXZhdGUgcHJvcGVydHlcbiAgbmFtZTogc3RyaW5nO1xuICB0eXBlOiBBdHRyaWJ1dGVUeXBlTW9kZWw7XG4gIG9wdGlvbmFsOiBib29sZWFuO1xuICBjb21wdXRlZDogYm9vbGVhbjtcbiAgdGVycmFmb3JtTmFtZTogc3RyaW5nO1xuICB0ZXJyYWZvcm1GdWxsTmFtZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgZ2V0QXR0Q2FsbD86IHN0cmluZztcbiAgcHJvdmlkZXI6IGJvb2xlYW47XG4gIHJlcXVpcmVkOiBib29sZWFuO1xufVxuXG5leHBvcnQgY2xhc3MgQXR0cmlidXRlTW9kZWwge1xuICBwdWJsaWMgc3RvcmFnZU5hbWU6IHN0cmluZzsgLy8gcHJpdmF0ZSBwcm9wZXJ0eVxuICBwcml2YXRlIF9uYW1lOiBzdHJpbmc7XG4gIHB1YmxpYyB0eXBlOiBBdHRyaWJ1dGVUeXBlTW9kZWw7XG4gIHB1YmxpYyBvcHRpb25hbDogYm9vbGVhbjtcbiAgcHVibGljIGNvbXB1dGVkOiBib29sZWFuO1xuICBwdWJsaWMgdGVycmFmb3JtTmFtZTogc3RyaW5nO1xuICBwdWJsaWMgdGVycmFmb3JtRnVsbE5hbWU6IHN0cmluZztcbiAgcHJpdmF0ZSBfZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIHB1YmxpYyBwcm92aWRlcjogYm9vbGVhbjtcbiAgcHVibGljIHJlcXVpcmVkOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IEF0dHJpYnV0ZU1vZGVsT3B0aW9ucykge1xuICAgIHRoaXMuc3RvcmFnZU5hbWUgPSBvcHRpb25zLnN0b3JhZ2VOYW1lO1xuICAgIHRoaXMuX25hbWUgPSBvcHRpb25zLm5hbWU7XG4gICAgdGhpcy50eXBlID0gb3B0aW9ucy50eXBlO1xuICAgIHRoaXMub3B0aW9uYWwgPSBvcHRpb25zLm9wdGlvbmFsO1xuICAgIHRoaXMuY29tcHV0ZWQgPSBvcHRpb25zLmNvbXB1dGVkO1xuICAgIHRoaXMudGVycmFmb3JtTmFtZSA9IG9wdGlvbnMudGVycmFmb3JtTmFtZTtcbiAgICB0aGlzLnRlcnJhZm9ybUZ1bGxOYW1lID0gb3B0aW9ucy50ZXJyYWZvcm1GdWxsTmFtZTtcbiAgICB0aGlzLl9kZXNjcmlwdGlvbiA9IG9wdGlvbnMuZGVzY3JpcHRpb247XG4gICAgdGhpcy5wcm92aWRlciA9IG9wdGlvbnMucHJvdmlkZXI7XG4gICAgdGhpcy5yZXF1aXJlZCA9IG9wdGlvbnMucmVxdWlyZWQ7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHR5cGVEZWZpbml0aW9uKCkge1xuICAgIGNvbnN0IG9wdGlvbmFsID0gdGhpcy5vcHRpb25hbCA/IFwiP1wiIDogXCJcIjtcbiAgICByZXR1cm4gYCR7dGhpcy5uYW1lfSR7b3B0aW9uYWx9OiAke3RoaXMudHlwZS5uYW1lfWA7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGlzQXNzaWduYWJsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1aXJlZCB8fCB0aGlzLm9wdGlvbmFsO1xuICB9XG5cbiAgcHVibGljIGdldCBpc09wdGlvbmFsKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLm9wdGlvbmFsO1xuICB9XG5cbiAgcHVibGljIGdldCBpc1JlcXVpcmVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnJlcXVpcmVkO1xuICB9XG5cbiAgcHVibGljIGdldCBpc1Rva2VuaXphYmxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnR5cGUuaXNUb2tlbml6YWJsZTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgaXNQcm92aWRlcigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5wcm92aWRlcjtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgZ2V0dGVyVHlwZSgpOiBHZXR0ZXJUeXBlIHtcbiAgICBsZXQgZ2V0dGVyVHlwZTogR2V0dGVyVHlwZSA9IHsgX3R5cGU6IFwicGxhaW5cIiB9O1xuXG4gICAgaWYgKFxuICAgICAgLy8gQ29tcGxleCBDb21wdXRlZCBMaXN0IE1hcFxuICAgICAgdGhpcy5jb21wdXRlZCAmJlxuICAgICAgIXRoaXMuaXNPcHRpb25hbCAmJlxuICAgICAgdGhpcy50eXBlLmlzQ29tcHV0ZWRDb21wbGV4ICYmXG4gICAgICB0aGlzLnR5cGUuaXNMaXN0ICYmXG4gICAgICB0aGlzLnR5cGUuaXNNYXBcbiAgICApIHtcbiAgICAgIGdldHRlclR5cGUgPSB7XG4gICAgICAgIF90eXBlOiBcImFyZ3NcIixcbiAgICAgICAgYXJnczogXCJpbmRleDogc3RyaW5nLCBrZXk6IHN0cmluZ1wiLFxuICAgICAgICByZXR1cm5UeXBlOiB0aGlzLm1hcFR5cGUsXG4gICAgICAgIHJldHVyblN0YXRlbWVudDogYG5ldyAke3RoaXMudHlwZS5uYW1lfSh0aGlzLCBcXGAke3RoaXMudGVycmFmb3JtTmFtZX0uXFwke2luZGV4fVxcYCkubG9va3VwKGtleSlgLFxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgLy8gQ29tcGxleCBDb21wdXRlZCBMaXN0XG4gICAgICB0aGlzLmNvbXB1dGVkICYmXG4gICAgICAhdGhpcy5pc09wdGlvbmFsICYmXG4gICAgICB0aGlzLnR5cGUuaXNDb21wdXRlZENvbXBsZXggJiZcbiAgICAgIHRoaXMudHlwZS5pc0xpc3RcbiAgICApIHtcbiAgICAgIGdldHRlclR5cGUgPSB7XG4gICAgICAgIF90eXBlOiBcImFyZ3NcIixcbiAgICAgICAgYXJnczogXCJpbmRleDogc3RyaW5nXCIsXG4gICAgICAgIHJldHVyblN0YXRlbWVudDogYG5ldyAke3RoaXMudHlwZS5uYW1lfSh0aGlzLCAnJHt0aGlzLnRlcnJhZm9ybU5hbWV9JywgaW5kZXgpYCxcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIC8vIENvbXBsZXggQ29tcHV0ZWQgTWFwXG4gICAgICB0aGlzLmNvbXB1dGVkICYmXG4gICAgICAhdGhpcy5pc09wdGlvbmFsICYmXG4gICAgICB0aGlzLnR5cGUuaXNDb21wdXRlZENvbXBsZXggJiZcbiAgICAgIHRoaXMudHlwZS5pc01hcFxuICAgICkge1xuICAgICAgZ2V0dGVyVHlwZSA9IHtcbiAgICAgICAgX3R5cGU6IFwiYXJnc1wiLFxuICAgICAgICBhcmdzOiBcImtleTogc3RyaW5nXCIsXG4gICAgICAgIHJldHVyblR5cGU6IHRoaXMubWFwVHlwZSxcbiAgICAgICAgcmV0dXJuU3RhdGVtZW50OiBgbmV3ICR7dGhpcy50eXBlLm5hbWV9KHRoaXMsICcke3RoaXMudGVycmFmb3JtTmFtZX0nKS5sb29rdXAoa2V5KWAsXG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmICh0aGlzLnR5cGUuaXNTaW5nbGVJdGVtICYmIHRoaXMudHlwZS5pc0NvbXBsZXggJiYgIXRoaXMuaXNQcm92aWRlcikge1xuICAgICAgZ2V0dGVyVHlwZSA9IHsgX3R5cGU6IFwic3RvcmVkX2NsYXNzXCIgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gZ2V0dGVyVHlwZTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgbWFwVHlwZSgpOiBzdHJpbmcge1xuICAgIGNvbnN0IHR5cGUgPSB0aGlzLnR5cGU7XG4gICAgaWYgKHR5cGUuaXNTdHJpbmdNYXApIHtcbiAgICAgIHJldHVybiBgc3RyaW5nYDtcbiAgICB9XG4gICAgaWYgKHR5cGUuaXNOdW1iZXJNYXApIHtcbiAgICAgIHJldHVybiBgbnVtYmVyYDtcbiAgICB9XG4gICAgaWYgKHR5cGUuaXNCb29sZWFuTWFwKSB7XG4gICAgICByZXR1cm4gYGJvb2xlYW5gO1xuICAgIH1cbiAgICBpZiAocHJvY2Vzcy5lbnYuREVCVUcpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgIGBUaGUgYXR0cmlidXRlICR7SlNPTi5zdHJpbmdpZnkodGhpcyl9IGlzbid0IGltcGxlbWVudGVkIHlldGBcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBgYW55YDtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgaXNTdG9yZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgICh0aGlzLmlzQXNzaWduYWJsZSAmJiAhdGhpcy5pc0NvbmZpZ0lnbm9yZWQpIHx8XG4gICAgICB0aGlzLmdldHRlclR5cGUuX3R5cGUgPT09IFwic3RvcmVkX2NsYXNzXCJcbiAgICApO1xuICB9XG5cbiAgcHVibGljIGdldCBzZXR0ZXJUeXBlKCk6IFNldHRlclR5cGUge1xuICAgIGlmICghdGhpcy5pc1N0b3JlZCkge1xuICAgICAgcmV0dXJuIHsgX3R5cGU6IFwibm9uZVwiIH07XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZ2V0dGVyVHlwZS5fdHlwZSA9PT0gXCJzdG9yZWRfY2xhc3NcIikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgX3R5cGU6IFwic3RvcmVkX2NsYXNzXCIsXG4gICAgICAgIHR5cGU6IHRoaXMudHlwZS5uYW1lLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgX3R5cGU6IFwic2V0XCIsXG4gICAgICB0eXBlOiBgJHt0aGlzLnR5cGUubmFtZX0ke3RoaXMuaXNQcm92aWRlciA/IFwiIHwgdW5kZWZpbmVkXCIgOiBcIlwifWAsXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgbmFtZSgpOiBzdHJpbmcge1xuICAgIC8vIGBzZWxmYCBhbmQgYGJ1aWxkYCBkb2Vzbid0IHdvcmsgaW4gYXMgcHJvcGVydHkgbmFtZSBpbiBQeXRob25cbiAgICBpZiAodGhpcy5fbmFtZSA9PT0gXCJzZWxmXCIgfHwgdGhpcy5fbmFtZSA9PT0gXCJidWlsZFwiKVxuICAgICAgcmV0dXJuIGAke3RoaXMuX25hbWV9QXR0cmlidXRlYDtcbiAgICAvLyBqc2lpIGNhbid0IGhhbmRsZSBgZ2V0Rm9vYCBwcm9wZXJ0aWVzLCBzaW5jZSBpdCdzIGluY29tcGF0aWJsZSB3aXRoIEphdmFcbiAgICBpZiAodGhpcy5fbmFtZS5tYXRjaCgvXmdldFtBLVpdKy8pKVxuICAgICAgcmV0dXJuIHRoaXMuX25hbWUucmVwbGFjZShcImdldFwiLCBcImZldGNoXCIpO1xuICAgIC8vIGBlcXVhbHNgIGlzIGEgcHJvaGliaXRlZCBuYW1lIGluIGpzaWlcbiAgICBpZiAodGhpcy5fbmFtZSA9PT0gXCJlcXVhbHNcIikgcmV0dXJuIFwiZXF1YWxUb1wiO1xuICAgIC8vIGBub2RlYCBpcyBhbHJlYWR5IHVzZWQgYnkgdGhlIENvbnN0cnVjdHMgYmFzZSBjbGFzc1xuICAgIGlmICh0aGlzLl9uYW1lID09PSBcIm5vZGVcIikgcmV0dXJuIFwibm9kZUF0dHJpYnV0ZVwiO1xuICAgIC8vIGBTeXN0ZW1gIHNoYWRvd3MgYnVpbHQtaW4gdHlwZXMgaW4gQ1NoYXJwIChzZWUgIzE0MjApXG4gICAgaWYgKHRoaXMuX25hbWUgPT09IFwic3lzdGVtXCIpIHJldHVybiBcInN5c3RlbUF0dHJpYnV0ZVwiO1xuICAgIC8vIGB0ZlJlc291cmNlVHlwZWAgaXMgYWxyZWFkeSB1c2VkIGJ5IHJlc291cmNlcyB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIGRpZmZlcmVudCByZXNvdXJjZSB0eXBlc1xuICAgIGlmICh0aGlzLl9uYW1lID09PSBcInRmUmVzb3VyY2VUeXBlXCIpIHJldHVybiBgJHt0aGlzLl9uYW1lfUF0dHJpYnV0ZWA7XG4gICAgcmV0dXJuIHRoaXMuX25hbWU7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGRlc2NyaXB0aW9uKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMuX2Rlc2NyaXB0aW9uXG4gICAgICA/LnJlcGxhY2UoLyhcXCpcXC8pL2dpLCBgKlxcXFwvYClcbiAgICAgIC5yZXBsYWNlKC8nJycvZ2ksIFwiYGBgXCIpO1xuICB9XG5cbiAgcHVibGljIGdldCBpc0NvbmZpZ0lnbm9yZWQoKTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMuaXNBc3NpZ25hYmxlICYmICF0aGlzLmNvbXB1dGVkKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGlnbm9yZUxpc3QgPSBbXCJhcm5cIiwgXCJpZFwiXTtcbiAgICByZXR1cm4gaWdub3JlTGlzdC5pbmNsdWRlcyh0aGlzLm5hbWUpO1xuICB9XG59XG4iXX0=