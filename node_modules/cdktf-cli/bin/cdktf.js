"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
process.env.NODE_ENV = process.env.NODE_ENV || "production";
const yargs = __importStar(require("yargs"));
const semver = __importStar(require("semver"));
const path = __importStar(require("path"));
const os = __importStar(require("os"));
const fs = __importStar(require("fs-extra"));
const terraform_1 = require("./cmds/helper/terraform");
const version_check_1 = require("./cmds/helper/version-check");
const util_1 = require("../lib/util");
const ensurePluginCache = () => {
    const pluginCachePath = process.env.TF_PLUGIN_CACHE_DIR ||
        path.join(os.homedir(), ".terraform.d", "plugin-cache");
    if (!fs.existsSync(pluginCachePath)) {
        fs.mkdirpSync(pluginCachePath);
    }
    return pluginCachePath;
};
if (!process.env.CDKTF_DISABLE_PLUGIN_CACHE_ENV) {
    process.env.TF_PLUGIN_CACHE_DIR = ensurePluginCache();
}
if (semver.lt(process.version, "10.12.0")) {
    console.error("Need at least Node v10.12 to run");
    process.exit(1);
}
const customCompletion = function (_current, argv, completionsFilter, done) {
    // The completion function gets called when bash completion is invoked and
    // we have very little context there. So when debugging via logs use e.g.
    // fs.appendFileSync("/Users/ansgar/cdktf-completions.log", `hello log\n`);
    // complete positional arg for stack for diff / deploy (and their aliases plan / apply)
    if (argv._.includes("diff") ||
        argv._.includes("deploy") ||
        argv._.includes("plan") ||
        argv._.includes("apply")) {
        completionsFilter(async (_err, defaults) => {
            const stacks = [];
            try {
                const manifest = await util_1.readCDKTFManifest();
                stacks.push(...Object.values(manifest.stacks).map((stack) => `${stack.name}:target stack "${stack.name}"`));
            }
            finally {
                done([...defaults, ...stacks]);
            }
        });
    }
    else {
        completionsFilter();
    }
    // return done([current]);
};
// ^ we need to fake the type here as yargs internally checks whether four
// arguments are present but does not expose the types correctly to typescript
// for the possible overload (which supports falling back to default completions)
// https://github.com/yargs/yargs/blob/d33e9972291406490cd8fdad0b3589be234e0f12/lib/completion.ts#L202
yargs
    .command(require("./cmds/init"))
    .command(require("./cmds/get"))
    .command(require("./cmds/convert"))
    .command(require("./cmds/deploy"))
    .command(require("./cmds/destroy"))
    .command(require("./cmds/diff"))
    .command(require("./cmds/list"))
    .command(require("./cmds/login"))
    .command(require("./cmds/synth"))
    .command(require("./cmds/watch"))
    .recommendCommands()
    .wrap(yargs.terminalWidth())
    .showHelpOnFail(false)
    .env("CDKTF")
    .epilogue(`Options can be specified via environment variables with the "CDKTF_" prefix (e.g. "CDKTF_OUTPUT")`)
    .help()
    .alias("h", "help")
    .option("disable-logging", {
    type: "boolean",
    default: true,
    required: false,
    desc: "Dont write log files. Supported using the env CDKTF_DISABLE_LOGGING.",
})
    .option("disable-plugin-cache-env", {
    type: "boolean",
    default: false,
    required: false,
    desc: "Dont set TF_PLUGIN_CACHE_DIR automatically. This is useful when the plugin cache is configured differently. Supported using the env CDKTF_DISABLE_PLUGIN_CACHE_ENV.",
})
    .option("log-level", {
    type: "string",
    required: false,
    desc: "Which log level should be written. Only supported via setting the env CDKTF_LOG_LEVEL",
})
    .option("context-json", {
    required: false,
    hidden: true,
    desc: "Used internally for env variable",
})
    .completion("completion", customCompletion) // outputs completion script on "cdktf completion"
    .command({
    command: "*",
    handler: (argv) => {
        const cmd = argv._[0];
        console.error(cmd ? `Could not find command "${cmd}"` : `Please pass a command`);
        console.error(`Please run "${argv.$0} help" to get a list of commands.`);
        process.exit(1);
    },
})
    .fail((_message, error) => {
    if (error) {
        console.error(error.stack);
    }
    terraform_1.terraformVersion.then((tfVersion) => {
        console.error(`
Debug Information:
    Terraform CDK version: ${version_check_1.DISPLAY_VERSION}
    Terraform version: ${tfVersion}`);
    });
}).argv;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2RrdGYuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjZGt0Zi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsSUFBSSxZQUFZLENBQUM7QUFFNUQsNkNBQStCO0FBQy9CLCtDQUFpQztBQUNqQywyQ0FBNkI7QUFDN0IsdUNBQXlCO0FBQ3pCLDZDQUErQjtBQUMvQix1REFBMkQ7QUFDM0QsK0RBQThEO0FBQzlELHNDQUFnRDtBQUVoRCxNQUFNLGlCQUFpQixHQUFHLEdBQVcsRUFBRTtJQUNyQyxNQUFNLGVBQWUsR0FDbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUI7UUFDL0IsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLEVBQUUsY0FBYyxFQUFFLGNBQWMsQ0FBQyxDQUFDO0lBQzFELElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxFQUFFO1FBQ25DLEVBQUUsQ0FBQyxVQUFVLENBQUMsZUFBZSxDQUFDLENBQUM7S0FDaEM7SUFDRCxPQUFPLGVBQWUsQ0FBQztBQUN6QixDQUFDLENBQUM7QUFFRixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyw4QkFBOEIsRUFBRTtJQUMvQyxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixHQUFHLGlCQUFpQixFQUFFLENBQUM7Q0FDdkQ7QUFFRCxJQUFJLE1BQU0sQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxTQUFTLENBQUMsRUFBRTtJQUN6QyxPQUFPLENBQUMsS0FBSyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7SUFDbEQsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztDQUNqQjtBQUVELE1BQU0sZ0JBQWdCLEdBQUcsVUFDdkIsUUFBZ0IsRUFDaEIsSUFBUyxFQUNULGlC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QU0sRUFBRSxJQUFJO0lBQ1osSUFBSSxFQUFFLGtDQUFrQztDQUN6QyxDQUFDO0tBQ0QsVUFBVSxDQUFDLFlBQVksRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDLGtEQUFrRDtLQUM3RixPQUFPLENBQUM7SUFDUCxPQUFPLEVBQUUsR0FBRztJQUNaLE9BQU8sRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFO1FBQ2hCLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdEIsT0FBTyxDQUFDLEtBQUssQ0FDWCxHQUFHLENBQUMsQ0FBQyxDQUFDLDJCQUEyQixHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsdUJBQXVCLENBQ2xFLENBQUM7UUFDRixPQUFPLENBQUMsS0FBSyxDQUFDLGVBQWUsSUFBSSxDQUFDLEVBQUUsbUNBQW1DLENBQUMsQ0FBQztRQUN6RSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2xCLENBQUM7Q0FDRixDQUFDO0tBQ0QsSUFBSSxDQUFDLENBQUMsUUFBUSxFQUFFLEtBQUssRUFBRSxFQUFFO0lBQ3hCLElBQUksS0FBSyxFQUFFO1FBQ1QsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7S0FDNUI7SUFFRCw0QkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLEVBQUUsRUFBRTtRQUNsQyxPQUFPLENBQUMsS0FBSyxDQUFDOzs2QkFFUywrQkFBZTt5QkFDbkIsU0FBUyxFQUFFLENBQUMsQ0FBQztJQUNsQyxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbInByb2Nlc3MuZW52Lk5PREVfRU5WID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgfHwgXCJwcm9kdWN0aW9uXCI7XG5cbmltcG9ydCAqIGFzIHlhcmdzIGZyb20gXCJ5YXJnc1wiO1xuaW1wb3J0ICogYXMgc2VtdmVyIGZyb20gXCJzZW12ZXJcIjtcbmltcG9ydCAqIGFzIHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCAqIGFzIG9zIGZyb20gXCJvc1wiO1xuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzLWV4dHJhXCI7XG5pbXBvcnQgeyB0ZXJyYWZvcm1WZXJzaW9uIH0gZnJvbSBcIi4vY21kcy9oZWxwZXIvdGVycmFmb3JtXCI7XG5pbXBvcnQgeyBESVNQTEFZX1ZFUlNJT04gfSBmcm9tIFwiLi9jbWRzL2hlbHBlci92ZXJzaW9uLWNoZWNrXCI7XG5pbXBvcnQgeyByZWFkQ0RLVEZNYW5pZmVzdCB9IGZyb20gXCIuLi9saWIvdXRpbFwiO1xuXG5jb25zdCBlbnN1cmVQbHVnaW5DYWNoZSA9ICgpOiBzdHJpbmcgPT4ge1xuICBjb25zdCBwbHVnaW5DYWNoZVBhdGggPVxuICAgIHByb2Nlc3MuZW52LlRGX1BMVUdJTl9DQUNIRV9ESVIgfHxcbiAgICBwYXRoLmpvaW4ob3MuaG9tZWRpcigpLCBcIi50ZXJyYWZvcm0uZFwiLCBcInBsdWdpbi1jYWNoZVwiKTtcbiAgaWYgKCFmcy5leGlzdHNTeW5jKHBsdWdpbkNhY2hlUGF0aCkpIHtcbiAgICBmcy5ta2RpcnBTeW5jKHBsdWdpbkNhY2hlUGF0aCk7XG4gIH1cbiAgcmV0dXJuIHBsdWdpbkNhY2hlUGF0aDtcbn07XG5cbmlmICghcHJvY2Vzcy5lbnYuQ0RLVEZfRElTQUJMRV9QTFVHSU5fQ0FDSEVfRU5WKSB7XG4gIHByb2Nlc3MuZW52LlRGX1BMVUdJTl9DQUNIRV9ESVIgPSBlbnN1cmVQbHVnaW5DYWNoZSgpO1xufVxuXG5pZiAoc2VtdmVyLmx0KHByb2Nlc3MudmVyc2lvbiwgXCIxMC4xMi4wXCIpKSB7XG4gIGNvbnNvbGUuZXJyb3IoXCJOZWVkIGF0IGxlYXN0IE5vZGUgdjEwLjEyIHRvIHJ1blwiKTtcbiAgcHJvY2Vzcy5leGl0KDEpO1xufVxuXG5jb25zdCBjdXN0b21Db21wbGV0aW9uID0gZnVuY3Rpb24gKFxuICBfY3VycmVudDogc3RyaW5nLFxuICBhcmd2OiBhbnksXG4gIGNvbXBsZXRpb25zRmlsdGVyOiAoXG4gICAgZG9uZT86IChlcnI6IGFueSwgZGVmYXVsdENvbXBsZXRpb25zOiBzdHJpbmdbXSkgPT4gdm9pZFxuICApID0+IHZvaWQsXG4gIGRvbmU6IChjb21wbGV0aW9uczogc3RyaW5nW10pID0+IHZvaWRcbikge1xuICAvLyBUaGUgY29tcGxldGlvbiBmdW5jdGlvbiBnZXRzIGNhbGxlZCB3aGVuIGJhc2ggY29tcGxldGlvbiBpcyBpbnZva2VkIGFuZFxuICAvLyB3ZSBoYXZlIHZlcnkgbGl0dGxlIGNvbnRleHQgdGhlcmUuIFNvIHdoZW4gZGVidWdnaW5nIHZpYSBsb2dzIHVzZSBlLmcuXG4gIC8vIGZzLmFwcGVuZEZpbGVTeW5jKFwiL1VzZXJzL2Fuc2dhci9jZGt0Zi1jb21wbGV0aW9ucy5sb2dcIiwgYGhlbGxvIGxvZ1xcbmApO1xuXG4gIC8vIGNvbXBsZXRlIHBvc2l0aW9uYWwgYXJnIGZvciBzdGFjayBmb3IgZGlmZiAvIGRlcGxveSAoYW5kIHRoZWlyIGFsaWFzZXMgcGxhbiAvIGFwcGx5KVxuICBpZiAoXG4gICAgYXJndi5fLmluY2x1ZGVzKFwiZGlmZlwiKSB8fFxuICAgIGFyZ3YuXy5pbmNsdWRlcyhcImRlcGxveVwiKSB8fFxuICAgIGFyZ3YuXy5pbmNsdWRlcyhcInBsYW5cIikgfHxcbiAgICBhcmd2Ll8uaW5jbHVkZXMoXCJhcHBseVwiKVxuICApIHtcbiAgICBjb21wbGV0aW9uc0ZpbHRlcihhc3luYyAoX2VyciwgZGVmYXVsdHMpID0+IHtcbiAgICAgIGNvbnN0IHN0YWNrczogc3RyaW5nW10gPSBbXTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG1hbmlmZXN0ID0gYXdhaXQgcmVhZENES1RGTWFuaWZlc3QoKTtcbiAgICAgICAgc3RhY2tzLnB1c2goXG4gICAgICAgICAgLi4uT2JqZWN0LnZhbHVlcyhtYW5pZmVzdC5zdGFja3MpLm1hcChcbiAgICAgICAgICAgIChzdGFjaykgPT4gYCR7c3RhY2submFtZX06dGFyZ2V0IHN0YWNrIFwiJHtzdGFjay5uYW1lfVwiYFxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgIGRvbmUoWy4uLmRlZmF1bHRzLCAuLi5zdGFja3NdKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBjb21wbGV0aW9uc0ZpbHRlcigpO1xuICB9XG4gIC8vIHJldHVybiBkb25lKFtjdXJyZW50XSk7XG59IGFzIHVua25vd24gYXMgeWFyZ3MuQXN5bmNDb21wbGV0aW9uRnVuY3Rpb247XG4vLyBeIHdlIG5lZWQgdG8gZmFrZSB0aGUgdHlwZSBoZXJlIGFzIHlhcmdzIGludGVybmFsbHkgY2hlY2tzIHdoZXRoZXIgZm91clxuLy8gYXJndW1lbnRzIGFyZSBwcmVzZW50IGJ1dCBkb2VzIG5vdCBleHBvc2UgdGhlIHR5cGVzIGNvcnJlY3RseSB0byB0eXBlc2NyaXB0XG4vLyBmb3IgdGhlIHBvc3NpYmxlIG92ZXJsb2FkICh3aGljaCBzdXBwb3J0cyBmYWxsaW5nIGJhY2sgdG8gZGVmYXVsdCBjb21wbGV0aW9ucylcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS95YXJncy95YXJncy9ibG9iL2QzM2U5OTcyMjkxNDA2NDkwY2Q4ZmRhZDBiMzU4OWJlMjM0ZTBmMTIvbGliL2NvbXBsZXRpb24udHMjTDIwMlxuXG55YXJnc1xuICAuY29tbWFuZChyZXF1aXJlKFwiLi9jbWRzL2luaXRcIikpXG4gIC5jb21tYW5kKHJlcXVpcmUoXCIuL2NtZHMvZ2V0XCIpKVxuICAuY29tbWFuZChyZXF1aXJlKFwiLi9jbWRzL2NvbnZlcnRcIikpXG4gIC5jb21tYW5kKHJlcXVpcmUoXCIuL2NtZHMvZGVwbG95XCIpKVxuICAuY29tbWFuZChyZXF1aXJlKFwiLi9jbWRzL2Rlc3Ryb3lcIikpXG4gIC5jb21tYW5kKHJlcXVpcmUoXCIuL2NtZHMvZGlmZlwiKSlcbiAgLmNvbW1hbmQocmVxdWlyZShcIi4vY21kcy9saXN0XCIpKVxuICAuY29tbWFuZChyZXF1aXJlKFwiLi9jbWRzL2xvZ2luXCIpKVxuICAuY29tbWFuZChyZXF1aXJlKFwiLi9jbWRzL3N5bnRoXCIpKVxuICAuY29tbWFuZChyZXF1aXJlKFwiLi9jbWRzL3dhdGNoXCIpKVxuICAucmVjb21tZW5kQ29tbWFuZHMoKVxuICAud3JhcCh5YXJncy50ZXJtaW5hbFdpZHRoKCkpXG4gIC5zaG93SGVscE9uRmFpbChmYWxzZSlcbiAgLmVudihcIkNES1RGXCIpXG4gIC5lcGlsb2d1ZShcbiAgICBgT3B0aW9ucyBjYW4gYmUgc3BlY2lmaWVkIHZpYSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgd2l0aCB0aGUgXCJDREtURl9cIiBwcmVmaXggKGUuZy4gXCJDREtURl9PVVRQVVRcIilgXG4gIClcbiAgLmhlbHAoKVxuICAuYWxpYXMoXCJoXCIsIFwiaGVscFwiKVxuICAub3B0aW9uKFwiZGlzYWJsZS1sb2dnaW5nXCIsIHtcbiAgICB0eXBlOiBcImJvb2xlYW5cIixcbiAgICBkZWZhdWx0OiB0cnVlLFxuICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICBkZXNjOiBcIkRvbnQgd3JpdGUgbG9nIGZpbGVzLiBTdXBwb3J0ZWQgdXNpbmcgdGhlIGVudiBDREtURl9ESVNBQkxFX0xPR0dJTkcuXCIsXG4gIH0pXG4gIC5vcHRpb24oXCJkaXNhYmxlLXBsdWdpbi1jYWNoZS1lbnZcIiwge1xuICAgIHR5cGU6IFwiYm9vbGVhblwiLFxuICAgIGRlZmF1bHQ6IGZhbHNlLFxuICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICBkZXNjOiBcIkRvbnQgc2V0IFRGX1BMVUdJTl9DQUNIRV9ESVIgYXV0b21hdGljYWxseS4gVGhpcyBpcyB1c2VmdWwgd2hlbiB0aGUgcGx1Z2luIGNhY2hlIGlzIGNvbmZpZ3VyZWQgZGlmZmVyZW50bHkuIFN1cHBvcnRlZCB1c2luZyB0aGUgZW52IENES1RGX0RJU0FCTEVfUExVR0lOX0NBQ0hFX0VOVi5cIixcbiAgfSlcbiAgLm9wdGlvbihcImxvZy1sZXZlbFwiLCB7XG4gICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICByZXF1aXJlZDogZmFsc2UsXG4gICAgZGVzYzogXCJXaGljaCBsb2cgbGV2ZWwgc2hvdWxkIGJlIHdyaXR0ZW4uIE9ubHkgc3VwcG9ydGVkIHZpYSBzZXR0aW5nIHRoZSBlbnYgQ0RLVEZfTE9HX0xFVkVMXCIsXG4gIH0pXG4gIC5vcHRpb24oXCJjb250ZXh0LWpzb25cIiwge1xuICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICBoaWRkZW46IHRydWUsXG4gICAgZGVzYzogXCJVc2VkIGludGVybmFsbHkgZm9yIGVudiB2YXJpYWJsZVwiLFxuICB9KVxuICAuY29tcGxldGlvbihcImNvbXBsZXRpb25cIiwgY3VzdG9tQ29tcGxldGlvbikgLy8gb3V0cHV0cyBjb21wbGV0aW9uIHNjcmlwdCBvbiBcImNka3RmIGNvbXBsZXRpb25cIlxuICAuY29tbWFuZCh7XG4gICAgY29tbWFuZDogXCIqXCIsIC8vIGNhdGNoZXMgZXZlcnl0aGluZyBub3QgcHJldmlvdXNseSBtYXRjaGVkXG4gICAgaGFuZGxlcjogKGFyZ3YpID0+IHtcbiAgICAgIGNvbnN0IGNtZCA9IGFyZ3YuX1swXTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgIGNtZCA/IGBDb3VsZCBub3QgZmluZCBjb21tYW5kIFwiJHtjbWR9XCJgIDogYFBsZWFzZSBwYXNzIGEgY29tbWFuZGBcbiAgICAgICk7XG4gICAgICBjb25zb2xlLmVycm9yKGBQbGVhc2UgcnVuIFwiJHthcmd2LiQwfSBoZWxwXCIgdG8gZ2V0IGEgbGlzdCBvZiBjb21tYW5kcy5gKTtcbiAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICB9LFxuICB9KVxuICAuZmFpbCgoX21lc3NhZ2UsIGVycm9yKSA9PiB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yLnN0YWNrKTtcbiAgICB9XG5cbiAgICB0ZXJyYWZvcm1WZXJzaW9uLnRoZW4oKHRmVmVyc2lvbikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihgXG5EZWJ1ZyBJbmZvcm1hdGlvbjpcbiAgICBUZXJyYWZvcm0gQ0RLIHZlcnNpb246ICR7RElTUExBWV9WRVJTSU9OfVxuICAgIFRlcnJhZm9ybSB2ZXJzaW9uOiAke3RmVmVyc2lvbn1gKTtcbiAgICB9KTtcbiAgfSkuYXJndjtcbiJdfQ==