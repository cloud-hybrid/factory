"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.useRunDestroy = exports.useRunDeploy = exports.useRunDiff = exports.useRunInit = exports.useRunSynth = exports.useRunWhen = exports.useTerraform = exports.useTerraformState = exports.TerraformProvider = exports.parseOutput = exports.Status = void 0;
/* eslint-disable no-control-regex */
const react_1 = __importDefault(require("react"));
const terraform_cli_1 = require("./models/terraform-cli");
const terraform_cloud_1 = require("./models/terraform-cloud");
const terraform_1 = require("./models/terraform");
const synth_stack_1 = require("../helper/synth-stack");
const ink_1 = require("ink");
const strip_ansi_1 = __importDefault(require("strip-ansi"));
const chalk = __importStar(require("chalk"));
const logging_1 = require("../../../lib/logging");
const schema_1 = require("./models/schema");
const z = __importStar(require("zod"));
const cdktf_1 = require("cdktf");
const chalkColour = new chalk.Instance();
const TerraformContextState = react_1.default.createContext(undefined);
const TerraformContextDispatch = react_1.default.createContext(
// eslint-disable-next-line @typescript-eslint/no-empty-function
(() => { }));
var Status;
(function (Status) {
    Status["STARTING"] = "starting";
    Status["SYNTHESIZING"] = "synthesizing";
    Status["SYNTHESIZED"] = "synthesized";
    Status["INITIALIZING"] = "initializing";
    Status["PLANNING"] = "planning";
    Status["PLANNED"] = "planned";
    Status["DEPLOYING"] = "deploying";
    Status["DESTROYING"] = "destroying";
    Status["DONE"] = "done";
})(Status = exports.Status || (exports.Status = {}));
const mapActionToState = (action, done) => {
    switch (action) {
        case "create":
        case "update":
            return done
                ? terraform_1.DeployingResourceApplyState.CREATED
                : terraform_1.DeployingResourceApplyState.CREATING;
        case "delete":
            return done
                ? terraform_1.DeployingResourceApplyState.DESTROYED
                : terraform_1.DeployingResourceApplyState.DESTROYING;
        default:
            return terraform_1.DeployingResourceApplyState.WAITING;
    }
};
const parseJsonOutputLine = (line) => {
    let json, message;
    try {
        json = JSON.parse(line);
    }
    catch (_a) {
        logging_1.logger.trace(`Could not parse line as JSON: ${line}`);
        return;
    }
    try {
        message = schema_1.schema.parse(json);
    }
    catch (err) {
        if (err instanceof z.ZodError) {
            logging_1.logger.warn(`Error parsing line into schema: ${JSON.stringify(err.errors)} => ${line}`);
        }
        return;
    }
    switch (message.type) {
        case "apply_start":
        case "apply_progress":
            return {
                id: message.hook.resource.resource,
                applyState: mapActionToState(message.hook.action, false),
            };
        case "apply_complete":
            return {
                id: message.hook.resource.resource,
                applyState: mapActionToState(message.hook.action, true),
            };
        default:
            return;
    }
};
const parseTextOutputLine = (line) => {
    if (/^Outputs:/.test(line)) {
        return;
    }
    if (/^Plan:/.test(line)) {
        return;
    }
    if (/^data\..*/.test(line)) {
        return;
    }
    const resourceMatch = line.match(/^([a-zA-Z_][a-zA-Z\d_\-.]*):/);
    let applyState;
    switch (true) {
        case /Creating.../.test(line):
        case /Still creating.../.test(line):
            applyState = terraform_1.DeployingResourceApplyState.CREATING;
            break;
        case /Creation complete/.test(line):
            applyState = terraform_1.DeployingResourceApplyState.CREATED;
            break;
        case /Modifying.../.test(line):
            applyState = terraform_1.DeployingResourceApplyState.UPDATING;
            break;
        case /Modifications complete/.test(line):
            applyState = terraform_1.DeployingResourceApplyState.UPDATED;
            break;
        case /Destroying.../.test(line):
        case /Still destroying.../.test(line):
            applyState = terraform_1.DeployingResourceApplyState.DESTROYING;
            break;
        case /Destruction complete/.test(line):
            applyState = terraform_1.DeployingResourceApplyState.DESTROYED;
            break;
        default:
            return;
    }
    if (resourceMatch &&
        resourceMatch.length >= 0 &&
        resourceMatch[1] != "Warning") {
        return {
            id: resourceMatch[1],
            applyState,
        };
    }
    else {
        return;
    }
};
exports.parseOutput = (str) => {
    const lines = strip_ansi_1.default(str.toString()).split("\n");
    const resources = lines.map((line) => {
        const parsed = parseJsonOutputLine(line) || parseTextOutputLine(line);
        if (parsed === undefined) {
            return;
        }
        const { id, applyState } = parsed;
        return {
            id,
            applyState,
            action: terraform_1.PlannedResourceAction.CREATE,
        };
    });
    return resources.reduce((acc, resource) => {
        if (resource) {
            acc.push(resource);
        }
        return acc;
        // eslint-disable-next-line @typescript-eslint/no-array-constructor
    }, new Array());
};
function deployReducer(state, action) {
    switch (action.type) {
        case "UPDATE_RESOURCES": {
            const map = new Map(state.resources.map((r) => [r.id, r]));
            action.resources.forEach((r) => map.set(r.id, r));
            return {
                ...state,
                resources: [...map.values()],
            };
        }
        case "SYNTH": {
            return { ...state, status: Status.SYNTHESIZING };
        }
        case "SYNTHESIZED": {
            return { ...state, status: Status.SYNTHESIZED, stacks: action.stacks };
        }
        case "CURRENT_STACK": {
            return {
                ...state,
                currentStack: action.currentStack,
            };
        }
        case "INIT": {
            return { ...state, status: Status.INITIALIZING };
        }
        case "PLAN": {
            return { ...state, status: Status.PLANNING };
        }
        case "PLANNED": {
            if (action.plan instanceof terraform_cloud_1.TerraformCloudPlan) {
                return {
                    ...state,
                    status: Status.PLANNED,
                    plan: action.plan,
                    url: action.plan.url,
                };
            }
            else {
                return {
                    ...state,
                    status: Status.PLANNED,
                    plan: action.plan,
                };
            }
        }
        case "DEPLOY": {
            return {
                ...state,
                status: Status.DEPLOYING,
                resources: action.resources,
            };
        }
        case "DESTROY": {
            return {
                ...state,
                status: Status.DESTROYING,
                resources: action.resources,
            };
        }
        case "OUTPUT": {
            return { ...state, output: action.output };
        }
        case "DONE": {
            return { ...state, status: Status.DONE };
        }
        case "ERROR": {
            return {
                ...state,
                errors: [
                    ...(Array.isArray(state.errors) ? state.errors : []),
                    action.error,
                ],
            };
        }
        default: {
            throw new Error(`Unhandled action type: ${JSON.stringify(action, null, 2)}`);
        }
    }
}
// eslint-disable-next-line react/prop-types
exports.TerraformProvider = ({ children, initialState, }) => {
    const initialCurrentStack = {
        constructPath: "",
        content: "",
        name: "",
        annotations: [],
        synthesizedStackPath: "",
        workingDirectory: "",
    };
    const [state, dispatch] = react_1.default.useReducer(deployReducer, initialState || {
        status: Status.STARTING,
        resources: [],
        currentStack: initialCurrentStack,
    });
    return (react_1.default.createElement(TerraformContextState.Provider, { value: state },
        react_1.default.createElement(TerraformContextDispatch.Provider, { value: dispatch }, children)));
};
exports.useTerraformState = () => {
    const state = react_1.default.useContext(TerraformContextState);
    if (state === undefined) {
        throw new Error("useTerraformState must be used within a TerraformContextState.Provider");
    }
    return state;
};
const useTerraformDispatch = () => {
    const dispatch = react_1.default.useContext(TerraformContextDispatch);
    if (dispatch === undefined) {
        throw new Error("useTerraform must be used within a TerraformContextDispatch.Provider");
    }
    return dispatch;
};
const useConfirmation = ({ autoApprove = false, }) => {
    const { exit } = ink_1.useApp();
    const [confirmed, setConfirmed] = react_1.default.useState(autoApprove);
    const confirmationCallback = react_1.default.useCallback((submitValue) => {
        if (submitValue === false) {
            exit();
            return;
        }
        setConfirmed(submitValue);
    }, [exit]);
    return [confirmed, confirmationCallback];
};
exports.useTerraform = ({ targetDir, targetStack, synthCommand, isSpeculative = false, }) => {
    const dispatch = useTerraformDispatch();
    const state = exports.useTerraformState();
    const [terraform, setTerraform] = react_1.default.useState();
    const executorForStack = async (stack) => {
        var _a, _b, _c, _d;
        const parsedStack = JSON.parse(stack.content);
        if ((_b = (_a = parsedStack.terraform) === null || _a === void 0 ? void 0 : _a.backend) === null || _b === void 0 ? void 0 : _b.remote) {
            const tfClient = new terraform_cloud_1.TerraformCloud(stack, (_d = (_c = parsedStack.terraform) === null || _c === void 0 ? void 0 : _c.backend) === null || _d === void 0 ? void 0 : _d.remote, isSpeculative);
            if (await tfClient.isRemoteWorkspace()) {
                setTerraform(tfClient);
            }
            else {
                setTerraform(new terraform_cli_1.TerraformCli(stack));
            }
        }
        else {
            setTerraform(new terraform_cli_1.TerraformCli(stack));
        }
    };
    const execTerraformSynth = async (loadExecutor = true) => {
        try {
            dispatch({ type: "SYNTH" });
            const stacks = await synth_stack_1.SynthStack.synth(synthCommand, targetDir);
            printAnnotations(stacks);
            if (loadExecutor) {
                if (stacks.length > 1 && !targetStack) {
                    throw new Error(`Found more than one stack, please specify a target stack. Run cdktf <verb> <stack> with one of these stacks: ${stacks
                        .map((s) => s.name)
                        .join(", ")} `);
                }
                const stack = targetStack
                    ? stacks.find((s) => s.name === targetStack)
                    : stacks[0];
                if (!stack)
                    throw new Error(`Can't find given stack ${targetStack} - Found the following stacks ${stacks
                        .map((s) => s.name)
                        .join(", ")}`);
                dispatch({ type: "CURRENT_STACK", currentStack: stack });
                await executorForStack(stack);
            }
            else {
                // synth
                const stack = targetStack
                    ? stacks.find((s) => s.name === targetStack)
                    : stacks[0];
                if (stack) {
                    dispatch({ type: "CURRENT_STACK", currentStack: stack });
                }
            }
            dispatch({ type: "SYNTHESIZED", stacks });
        }
        catch (e) {
            dispatch({ type: "ERROR", error: e });
        }
    };
    const execTerraformInit = async () => {
        try {
            if (!terraform)
                throw new Error("Internal error: Terraform is not initialized yet. Please call synth() with loadExecutor: true first");
            dispatch({ type: "INIT" });
            await terraform.init();
        }
        catch (e) {
            dispatch({ type: "ERROR", error: e });
        }
    };
    const execTerraformOutput = async () => {
        try {
            if (!terraform)
                throw new Error("Terraform is not initialized yet");
            const output = await terraform.output();
            dispatch({ type: "OUTPUT", output });
        }
        catch (e) {
            dispatch({ type: "ERROR", error: e });
        }
    };
    const execTerraformPlan = async (destroy = false) => {
        let plan;
        try {
            if (!terraform)
                throw new Error("Terraform is not initialized yet");
            dispatch({ type: "PLAN" });
            plan = await terraform.plan(destroy);
            dispatch({ type: "PLANNED", plan });
            return plan;
        }
        catch (e) {
            dispatch({ type: "ERROR", error: e });
        }
        return;
    };
    const execTerraformApply = async () => {
        const plan = state.plan;
        try {
            if (!terraform)
                throw new Error("Terraform is not initialized yet");
            if (!plan)
                throw new Error("No plan");
            if (plan.needsApply) {
                const resources = plan.applyableResources.map((r) => Object.assign({}, r, {
                    applyState: terraform_1.DeployingResourceApplyState.WAITING,
                }));
                dispatch({ type: "DEPLOY", resources });
                await terraform.deploy(plan.planFile, (output) => {
                    const resources = exports.parseOutput(output.toString());
                    dispatch({ type: "UPDATE_RESOURCES", resources });
                });
            }
            dispatch({ type: "DONE" });
        }
        catch (e) {
            dispatch({ type: "ERROR", error: e });
        }
    };
    const execTerraformDestroy = async () => {
        const plan = state.plan;
        try {
            if (!terraform)
                throw new Error("Terraform is not initialized yet");
            if (!plan)
                throw new Error("No plan");
            if (plan.needsApply) {
                const resources = plan.applyableResources.map((r) => Object.assign({}, r, {
                    applyState: terraform_1.DeployingResourceApplyState.WAITING,
                }));
                dispatch({ type: "DESTROY", resources });
                await terraform.destroy((output) => {
                    const resources = exports.parseOutput(output.toString());
                    dispatch({ type: "UPDATE_RESOURCES", resources });
                });
            }
            dispatch({ type: "DONE" });
        }
        catch (e) {
            dispatch({ type: "ERROR", error: e });
        }
    };
    return {
        synth: execTerraformSynth,
        deploy: execTerraformApply,
        diff: execTerraformPlan,
        output: execTerraformOutput,
        destroy: execTerraformDestroy,
        init: execTerraformInit,
    };
};
const useRunOnce = (fn, ...args) => {
    react_1.default.useEffect(() => {
        fn(...args);
        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, []); // only run once on mount – ignore any changes to fn
};
exports.useRunWhen = (condition, fn, ...args) => {
    react_1.default.useEffect(() => {
        if (condition)
            fn(...args);
        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [condition]); // only run if condition changes
};
exports.useRunSynth = (options) => {
    const state = exports.useTerraformState();
    const { synth } = exports.useTerraform(options);
    useRunOnce(synth, false);
    return state;
};
exports.useRunInit = (options) => {
    const { synth, init } = exports.useTerraform(options);
    const state = exports.useTerraformState();
    useRunOnce(synth);
    exports.useRunWhen(state.status === Status.SYNTHESIZED, init);
    return state;
};
exports.useRunDiff = (options) => {
    const { synth, init, diff } = exports.useTerraform(options);
    const state = exports.useTerraformState();
    useRunOnce(synth);
    exports.useRunWhen(state.status === Status.SYNTHESIZED, async () => {
        await init();
        await diff();
    });
    return state;
};
exports.useRunDeploy = ({ autoApprove, ...options }) => {
    const state = exports.useTerraformState();
    const { synth, init, diff, deploy, output } = exports.useTerraform(options);
    const [confirmed, confirmationCallback] = useConfirmation({ autoApprove });
    useRunOnce(synth);
    exports.useRunWhen(state.status === Status.SYNTHESIZED, async () => {
        await init();
        await diff();
    });
    exports.useRunWhen(confirmed && state.status === Status.PLANNED, async () => {
        await deploy();
        await output();
    });
    return {
        state,
        confirmation: confirmationCallback,
        isConfirmed: confirmed,
    };
};
exports.useRunDestroy = ({ autoApprove, ...options }) => {
    const state = exports.useTerraformState();
    const { synth, init, diff, destroy } = exports.useTerraform(options);
    const [confirmed, confirmationCallback] = useConfirmation({ autoApprove });
    useRunOnce(synth);
    exports.useRunWhen(state.status === Status.SYNTHESIZED, async () => {
        await init();
        await diff(true); // true = plan a destroy
    });
    exports.useRunWhen(confirmed && state.status === Status.PLANNED, async () => {
        await destroy();
    });
    return {
        state,
        confirmation: confirmationCallback,
        isConfirmed: confirmed,
    };
};
/**
 * prints annotations via console
 * @throws Error if an Annotation with level === ERROR has been encountered
 */
function printAnnotations(stacks) {
    let encounteredAnnotationError = false;
    stacks.forEach((stack) => (stack.annotations || []).forEach((annotation) => {
        if (annotation.level === cdktf_1.AnnotationMetadataEntryType.ERROR)
            encounteredAnnotationError = true;
        let color = chalkColour.whiteBright;
        let level = annotation.level;
        switch (annotation.level) {
            case cdktf_1.AnnotationMetadataEntryType.INFO: {
                level = "INFO";
                break;
            }
            case cdktf_1.AnnotationMetadataEntryType.WARN: {
                color = chalkColour.hex("#FFA500"); // orange
                level = "WARN";
                break;
            }
            case cdktf_1.AnnotationMetadataEntryType.ERROR: {
                color = chalkColour.redBright;
                level = "ERROR";
                break;
            }
        }
        console.log(color(`${level} [${annotation.constructPath}]: ${annotation.message}`));
        if (annotation.level === cdktf_1.AnnotationMetadataEntryType.ERROR &&
            annotation.stacktrace)
            console.log(chalkColour.gray(annotation.stacktrace.join("\n")));
    }));
    if (encounteredAnnotationError) {
        throw new Error("While synthesizing one or more error annotations have been encountered. Please check the log output above.");
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVycmFmb3JtLWNvbnRleHQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ0ZXJyYWZvcm0tY29udGV4dC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLHFDQUFxQztBQUNyQyxrREFBeUM7QUFDekMsMERBQXNEO0FBQ3RELDhEQUE4RTtBQUM5RSxrREFRNEI7QUFDNUIsdURBQW1EO0FBRW5ELDZCQUE2QjtBQUM3Qiw0REFBbUM7QUFDbkMsNkNBQStCO0FBRS9CLGtEQUE4QztBQUM5Qyw0Q0FBc0Q7QUFDdEQsdUNBQXlCO0FBQ3pCLGlDQUFvRDtBQUVwRCxNQUFNLFdBQVcsR0FBRyxJQUFJLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztBQUt6QyxNQUFNLHFCQUFxQixHQUFHLGVBQUssQ0FBQyxhQUFhLENBQWUsU0FBUyxDQUFDLENBQUM7QUFDM0UsTUFBTSx3QkFBd0IsR0FBRyxlQUFLLENBQUMsYUFBYTtBQUNsRCxnRUFBZ0U7QUFDaEUsQ0FBQyxHQUFHLEVBQUUsR0FBRSxDQUFDLENBQTJCLENBQ3JDLENBQUM7QUFFRixJQUFZLE1BVVg7QUFWRCxXQUFZLE1BQU07SUFDaEIsK0JBQXFCLENBQUE7SUFDckIsdUNBQTZCLENBQUE7SUFDN0IscUNBQTJCLENBQUE7SUFDM0IsdUNBQTZCLENBQUE7SUFDN0IsK0JBQXFCLENBQUE7SUFDckIsNkJBQW1CLENBQUE7SUFDbkIsaUNBQXVCLENBQUE7SUFDdkIsbUNBQXlCLENBQUE7SUFDekIsdUJBQWEsQ0FBQTtBQUNmLENBQUMsRUFWVyxNQUFNLEdBQU4sY0FBTSxLQUFOLGNBQU0sUUFVakI7QUFFRCxNQUFNLGdCQUFnQixHQUFHLENBQUMsTUFBbUIsRUFBRSxJQUFhLEVBQUUsRUFBRTtJQUM5RCxRQUFRLE1BQU0sRUFBRTtRQUNkLEtBQUssUUFBUSxDQUFDO1FBQ2QsS0FBSyxRQUFRO1lBQ1gsT0FBTyxJQUFJO2dCQUNULENBQUMsQ0FBQyx1Q0FB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LENBQUM7SUFFRixJQUFJLDBCQUEwQixFQUFFO1FBQzlCLE1BQU0sSUFBSSxLQUFLLENBQ2IsNEdBQTRHLENBQzdHLENBQUM7S0FDSDtBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBuby1jb250cm9sLXJlZ2V4ICovXG5pbXBvcnQgUmVhY3QsIHsgUmVhY3ROb2RlIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBUZXJyYWZvcm1DbGkgfSBmcm9tIFwiLi9tb2RlbHMvdGVycmFmb3JtLWNsaVwiO1xuaW1wb3J0IHsgVGVycmFmb3JtQ2xvdWQsIFRlcnJhZm9ybUNsb3VkUGxhbiB9IGZyb20gXCIuL21vZGVscy90ZXJyYWZvcm0tY2xvdWRcIjtcbmltcG9ydCB7XG4gIFRlcnJhZm9ybSxcbiAgRGVwbG95aW5nUmVzb3VyY2UsXG4gIERlcGxveWluZ1Jlc291cmNlQXBwbHlTdGF0ZSxcbiAgUGxhbm5lZFJlc291cmNlQWN0aW9uLFxuICBQbGFubmVkUmVzb3VyY2UsXG4gIFRlcnJhZm9ybVBsYW4sXG4gIFRlcnJhZm9ybU91dHB1dCxcbn0gZnJvbSBcIi4vbW9kZWxzL3RlcnJhZm9ybVwiO1xuaW1wb3J0IHsgU3ludGhTdGFjayB9IGZyb20gXCIuLi9oZWxwZXIvc3ludGgtc3RhY2tcIjtcbmltcG9ydCB7IFRlcnJhZm9ybUpzb24gfSBmcm9tIFwiLi90ZXJyYWZvcm0tanNvblwiO1xuaW1wb3J0IHsgdXNlQXBwIH0gZnJvbSBcImlua1wiO1xuaW1wb3J0IHN0cmlwQW5zaSBmcm9tIFwic3RyaXAtYW5zaVwiO1xuaW1wb3J0ICogYXMgY2hhbGsgZnJvbSBcImNoYWxrXCI7XG5pbXBvcnQgeyBTeW50aGVzaXplZFN0YWNrIH0gZnJvbSBcIi4uL2hlbHBlci9zeW50aC1zdGFja1wiO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIi4uLy4uLy4uL2xpYi9sb2dnaW5nXCI7XG5pbXBvcnQgeyBzY2hlbWEsIEFjdGlvblR5cGVzIH0gZnJvbSBcIi4vbW9kZWxzL3NjaGVtYVwiO1xuaW1wb3J0ICogYXMgeiBmcm9tIFwiem9kXCI7XG5pbXBvcnQgeyBBbm5vdGF0aW9uTWV0YWRhdGFFbnRyeVR5cGUgfSBmcm9tIFwiY2RrdGZcIjtcblxuY29uc3QgY2hhbGtDb2xvdXIgPSBuZXcgY2hhbGsuSW5zdGFuY2UoKTtcblxudHlwZSBEZWZhdWx0VmFsdWUgPSB1bmRlZmluZWQ7XG50eXBlIENvbnRleHRWYWx1ZSA9IERlZmF1bHRWYWx1ZSB8IERlcGxveVN0YXRlO1xuXG5jb25zdCBUZXJyYWZvcm1Db250ZXh0U3RhdGUgPSBSZWFjdC5jcmVhdGVDb250ZXh0PENvbnRleHRWYWx1ZT4odW5kZWZpbmVkKTtcbmNvbnN0IFRlcnJhZm9ybUNvbnRleHREaXNwYXRjaCA9IFJlYWN0LmNyZWF0ZUNvbnRleHQoXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZW1wdHktZnVuY3Rpb25cbiAgKCgpID0+IHt9KSBhcyBSZWFjdC5EaXNwYXRjaDxBY3Rpb24+XG4pO1xuXG5leHBvcnQgZW51bSBTdGF0dXMge1xuICBTVEFSVElORyA9IFwic3RhcnRpbmdcIixcbiAgU1lOVEhFU0laSU5HID0gXCJzeW50aGVzaXppbmdcIixcbiAgU1lOVEhFU0laRUQgPSBcInN5bnRoZXNpemVkXCIsXG4gIElOSVRJQUxJWklORyA9IFwiaW5pdGlhbGl6aW5nXCIsXG4gIFBMQU5OSU5HID0gXCJwbGFubmluZ1wiLFxuICBQTEFOTkVEID0gXCJwbGFubmVkXCIsXG4gIERFUExPWUlORyA9IFwiZGVwbG95aW5nXCIsXG4gIERFU1RST1lJTkcgPSBcImRlc3Ryb3lpbmdcIixcbiAgRE9ORSA9IFwiZG9uZVwiLFxufVxuXG5jb25zdCBtYXBBY3Rpb25Ub1N0YXRlID0gKGFjdGlvbjogQWN0aW9uVHlwZXMsIGRvbmU6IGJvb2xlYW4pID0+IHtcbiAgc3dpdGNoIChhY3Rpb24pIHtcbiAgICBjYXNlIFwiY3JlYXRlXCI6XG4gICAgY2FzZSBcInVwZGF0ZVwiOlxuICAgICAgcmV0dXJuIGRvbmVcbiAgICAgICAgPyBEZXBsb3lpbmdSZXNvdXJjZUFwcGx5U3RhdGUuQ1JFQVRFRFxuICAgICAgICA6IERlcGxveWluZ1Jlc291cmNlQXBwbHlTdGF0ZS5DUkVBVElORztcbiAgICBjYXNlIFwiZGVsZXRlXCI6XG4gICAgICByZXR1cm4gZG9uZVxuICAgICAgICA/IERlcGxveWluZ1Jlc291cmNlQXBwbHlTdGF0ZS5ERVNUUk9ZRURcbiAgICAgICAgOiBEZXBsb3lpbmdSZXNvdXJjZUFwcGx5U3RhdGUuREVTVFJPWUlORztcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIERlcGxveWluZ1Jlc291cmNlQXBwbHlTdGF0ZS5XQUlUSU5HO1xuICB9XG59O1xuY29uc3QgcGFyc2VKc29uT3V0cHV0TGluZSA9IChcbiAgbGluZTogc3RyaW5nXG4pOiBPbWl0PERlcGxveWluZ1Jlc291cmNlLCBcImFjdGlvblwiPiB8IHVuZGVmaW5lZCA9PiB7XG4gIGxldCBqc29uLCBtZXNzYWdlO1xuICB0cnkge1xuICAgIGpzb24gPSBKU09OLnBhcnNlKGxpbmUpO1xuICB9IGNhdGNoIHtcbiAgICBsb2dnZXIudHJhY2UoYENvdWxkIG5vdCBwYXJzZSBsaW5lIGFzIEpTT046ICR7bGluZX1gKTtcbiAgICByZXR1cm47XG4gIH1cblxuICB0cnkge1xuICAgIG1lc3NhZ2UgPSBzY2hlbWEucGFyc2UoanNvbik7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmIChlcnIgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICBsb2dnZXIud2FybihcbiAgICAgICAgYEVycm9yIHBhcnNpbmcgbGluZSBpbnRvIHNjaGVtYTogJHtKU09OLnN0cmluZ2lmeShcbiAgICAgICAgICBlcnIuZXJyb3JzXG4gICAgICAgICl9ID0+ICR7bGluZX1gXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybjtcbiAgfVxuXG4gIHN3aXRjaCAobWVzc2FnZS50eXBlKSB7XG4gICAgY2FzZSBcImFwcGx5X3N0YXJ0XCI6XG4gICAgY2FzZSBcImFwcGx5X3Byb2dyZXNzXCI6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZDogbWVzc2FnZS5ob29rLnJlc291cmNlLnJlc291cmNlLFxuICAgICAgICBhcHBseVN0YXRlOiBtYXBBY3Rpb25Ub1N0YXRlKG1lc3NhZ2UuaG9vay5hY3Rpb24sIGZhbHNlKSxcbiAgICAgIH07XG5cbiAgICBjYXNlIFwiYXBwbHlfY29tcGxldGVcIjpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBtZXNzYWdlLmhvb2sucmVzb3VyY2UucmVzb3VyY2UsXG4gICAgICAgIGFwcGx5U3RhdGU6IG1hcEFjdGlvblRvU3RhdGUobWVzc2FnZS5ob29rLmFjdGlvbiwgdHJ1ZSksXG4gICAgICB9O1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm47XG4gIH1cbn07XG5cbmNvbnN0IHBhcnNlVGV4dE91dHB1dExpbmUgPSAoXG4gIGxpbmU6IHN0cmluZ1xuKTogT21pdDxEZXBsb3lpbmdSZXNvdXJjZSwgXCJhY3Rpb25cIj4gfCB1bmRlZmluZWQgPT4ge1xuICBpZiAoL15PdXRwdXRzOi8udGVzdChsaW5lKSkge1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoL15QbGFuOi8udGVzdChsaW5lKSkge1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoL15kYXRhXFwuLiovLnRlc3QobGluZSkpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCByZXNvdXJjZU1hdGNoID0gbGluZS5tYXRjaCgvXihbYS16QS1aX11bYS16QS1aXFxkX1xcLS5dKik6Lyk7XG4gIGxldCBhcHBseVN0YXRlOiBEZXBsb3lpbmdSZXNvdXJjZUFwcGx5U3RhdGU7XG5cbiAgc3dpdGNoICh0cnVlKSB7XG4gICAgY2FzZSAvQ3JlYXRpbmcuLi4vLnRlc3QobGluZSk6XG4gICAgY2FzZSAvU3RpbGwgY3JlYXRpbmcuLi4vLnRlc3QobGluZSk6XG4gICAgICBhcHBseVN0YXRlID0gRGVwbG95aW5nUmVzb3VyY2VBcHBseVN0YXRlLkNSRUFUSU5HO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAvQ3JlYXRpb24gY29tcGxldGUvLnRlc3QobGluZSk6XG4gICAgICBhcHBseVN0YXRlID0gRGVwbG95aW5nUmVzb3VyY2VBcHBseVN0YXRlLkNSRUFURUQ7XG4gICAgICBicmVhaztcbiAgICBjYXNlIC9Nb2RpZnlpbmcuLi4vLnRlc3QobGluZSk6XG4gICAgICBhcHBseVN0YXRlID0gRGVwbG95aW5nUmVzb3VyY2VBcHBseVN0YXRlLlVQREFUSU5HO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAvTW9kaWZpY2F0aW9ucyBjb21wbGV0ZS8udGVzdChsaW5lKTpcbiAgICAgIGFwcGx5U3RhdGUgPSBEZXBsb3lpbmdSZXNvdXJjZUFwcGx5U3RhdGUuVVBEQVRFRDtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgL0Rlc3Ryb3lpbmcuLi4vLnRlc3QobGluZSk6XG4gICAgY2FzZSAvU3RpbGwgZGVzdHJveWluZy4uLi8udGVzdChsaW5lKTpcbiAgICAgIGFwcGx5U3RhdGUgPSBEZXBsb3lpbmdSZXNvdXJjZUFwcGx5U3RhdGUuREVTVFJPWUlORztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgL0Rlc3RydWN0aW9uIGNvbXBsZXRlLy50ZXN0KGxpbmUpOlxuICAgICAgYXBwbHlTdGF0ZSA9IERlcGxveWluZ1Jlc291cmNlQXBwbHlTdGF0ZS5ERVNUUk9ZRUQ7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKFxuICAgIHJlc291cmNlTWF0Y2ggJiZcbiAgICByZXNvdXJjZU1hdGNoLmxlbmd0aCA+PSAwICYmXG4gICAgcmVzb3VyY2VNYXRjaFsxXSAhPSBcIldhcm5pbmdcIlxuICApIHtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IHJlc291cmNlTWF0Y2hbMV0sXG4gICAgICBhcHBseVN0YXRlLFxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgcGFyc2VPdXRwdXQgPSAoc3RyOiBzdHJpbmcpOiBEZXBsb3lpbmdSZXNvdXJjZVtdID0+IHtcbiAgY29uc3QgbGluZXMgPSBzdHJpcEFuc2koc3RyLnRvU3RyaW5nKCkpLnNwbGl0KFwiXFxuXCIpO1xuXG4gIGNvbnN0IHJlc291cmNlcyA9IGxpbmVzLm1hcCgobGluZSkgPT4ge1xuICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlSnNvbk91dHB1dExpbmUobGluZSkgfHwgcGFyc2VUZXh0T3V0cHV0TGluZShsaW5lKTtcbiAgICBpZiAocGFyc2VkID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB7IGlkLCBhcHBseVN0YXRlIH0gPSBwYXJzZWQ7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkLFxuICAgICAgYXBwbHlTdGF0ZSxcbiAgICAgIGFjdGlvbjogUGxhbm5lZFJlc291cmNlQWN0aW9uLkNSRUFURSxcbiAgICB9O1xuICB9KTtcblxuICByZXR1cm4gcmVzb3VyY2VzLnJlZHVjZSgoYWNjLCByZXNvdXJjZSkgPT4ge1xuICAgIGlmIChyZXNvdXJjZSkge1xuICAgICAgYWNjLnB1c2gocmVzb3VyY2UpO1xuICAgIH1cbiAgICByZXR1cm4gYWNjO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tYXJyYXktY29uc3RydWN0b3JcbiAgfSwgbmV3IEFycmF5KCkpO1xufTtcblxuZXhwb3J0IHR5cGUgRGVwbG95U3RhdGUgPSB7XG4gIHN0YXR1czogU3RhdHVzO1xuICByZXNvdXJjZXM6IERlcGxveWluZ1Jlc291cmNlW107XG4gIHBsYW4/OiBUZXJyYWZvcm1QbGFuO1xuICB1cmw/OiBzdHJpbmc7XG4gIGN1cnJlbnRTdGFjazogU3ludGhlc2l6ZWRTdGFjaztcbiAgc3RhY2tzPzogU3ludGhlc2l6ZWRTdGFja1tdO1xuICBlcnJvcnM/OiBzdHJpbmdbXTtcbiAgb3V0cHV0PzogeyBba2V5OiBzdHJpbmddOiBUZXJyYWZvcm1PdXRwdXQgfTtcbn07XG5cbnR5cGUgQWN0aW9uID1cbiAgfCB7IHR5cGU6IFwiU1lOVEhcIiB9XG4gIHwgeyB0eXBlOiBcIlNZTlRIRVNJWkVEXCI7IHN0YWNrczogU3ludGhlc2l6ZWRTdGFja1tdIH1cbiAgfCB7IHR5cGU6IFwiQ1VSUkVOVF9TVEFDS1wiOyBjdXJyZW50U3RhY2s6IFN5bnRoZXNpemVkU3RhY2sgfVxuICB8IHsgdHlwZTogXCJJTklUXCIgfVxuICB8IHsgdHlwZTogXCJQTEFOXCIgfVxuICB8IHsgdHlwZTogXCJQTEFOTkVEXCI7IHBsYW46IFRlcnJhZm9ybVBsYW4gfVxuICB8IHsgdHlwZTogXCJERVBMT1lcIjsgcmVzb3VyY2VzOiBEZXBsb3lpbmdSZXNvdXJjZVtdIH1cbiAgfCB7IHR5cGU6IFwiREVTVFJPWVwiOyByZXNvdXJjZXM6IERlcGxveWluZ1Jlc291cmNlW10gfVxuICB8IHsgdHlwZTogXCJVUERBVEVfUkVTT1VSQ0VTXCI7IHJlc291cmNlczogRGVwbG95aW5nUmVzb3VyY2VbXSB9XG4gIHwgeyB0eXBlOiBcIk9VVFBVVFwiOyBvdXRwdXQ6IHsgW2tleTogc3RyaW5nXTogVGVycmFmb3JtT3V0cHV0IH0gfVxuICB8IHsgdHlwZTogXCJET05FXCIgfVxuICB8IHsgdHlwZTogXCJFUlJPUlwiOyBlcnJvcjogc3RyaW5nIH07XG5cbmZ1bmN0aW9uIGRlcGxveVJlZHVjZXIoc3RhdGU6IERlcGxveVN0YXRlLCBhY3Rpb246IEFjdGlvbik6IERlcGxveVN0YXRlIHtcbiAgc3dpdGNoIChhY3Rpb24udHlwZSkge1xuICAgIGNhc2UgXCJVUERBVEVfUkVTT1VSQ0VTXCI6IHtcbiAgICAgIGNvbnN0IG1hcCA9IG5ldyBNYXA8c3RyaW5nLCBEZXBsb3lpbmdSZXNvdXJjZT4oXG4gICAgICAgIHN0YXRlLnJlc291cmNlcy5tYXAoKHIpID0+IFtyLmlkLCByXSlcbiAgICAgICk7XG4gICAgICBhY3Rpb24ucmVzb3VyY2VzLmZvckVhY2goKHIpID0+IG1hcC5zZXQoci5pZCwgcikpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgIHJlc291cmNlczogWy4uLm1hcC52YWx1ZXMoKV0sXG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIFwiU1lOVEhcIjoge1xuICAgICAgcmV0dXJuIHsgLi4uc3RhdGUsIHN0YXR1czogU3RhdHVzLlNZTlRIRVNJWklORyB9O1xuICAgIH1cbiAgICBjYXNlIFwiU1lOVEhFU0laRURcIjoge1xuICAgICAgcmV0dXJuIHsgLi4uc3RhdGUsIHN0YXR1czogU3RhdHVzLlNZTlRIRVNJWkVELCBzdGFja3M6IGFjdGlvbi5zdGFja3MgfTtcbiAgICB9XG4gICAgY2FzZSBcIkNVUlJFTlRfU1RBQ0tcIjoge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgIGN1cnJlbnRTdGFjazogYWN0aW9uLmN1cnJlbnRTdGFjayxcbiAgICAgIH07XG4gICAgfVxuICAgIGNhc2UgXCJJTklUXCI6IHtcbiAgICAgIHJldHVybiB7IC4uLnN0YXRlLCBzdGF0dXM6IFN0YXR1cy5JTklUSUFMSVpJTkcgfTtcbiAgICB9XG4gICAgY2FzZSBcIlBMQU5cIjoge1xuICAgICAgcmV0dXJuIHsgLi4uc3RhdGUsIHN0YXR1czogU3RhdHVzLlBMQU5OSU5HIH07XG4gICAgfVxuICAgIGNhc2UgXCJQTEFOTkVEXCI6IHtcbiAgICAgIGlmIChhY3Rpb24ucGxhbiBpbnN0YW5jZW9mIFRlcnJhZm9ybUNsb3VkUGxhbikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgIHN0YXR1czogU3RhdHVzLlBMQU5ORUQsXG4gICAgICAgICAgcGxhbjogYWN0aW9uLnBsYW4sXG4gICAgICAgICAgdXJsOiBhY3Rpb24ucGxhbi51cmwsXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgIHN0YXR1czogU3RhdHVzLlBMQU5ORUQsXG4gICAgICAgICAgcGxhbjogYWN0aW9uLnBsYW4sXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICAgIGNhc2UgXCJERVBMT1lcIjoge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgIHN0YXR1czogU3RhdHVzLkRFUExPWUlORyxcbiAgICAgICAgcmVzb3VyY2VzOiBhY3Rpb24ucmVzb3VyY2VzLFxuICAgICAgfTtcbiAgICB9XG4gICAgY2FzZSBcIkRFU1RST1lcIjoge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgIHN0YXR1czogU3RhdHVzLkRFU1RST1lJTkcsXG4gICAgICAgIHJlc291cmNlczogYWN0aW9uLnJlc291cmNlcyxcbiAgICAgIH07XG4gICAgfVxuICAgIGNhc2UgXCJPVVRQVVRcIjoge1xuICAgICAgcmV0dXJuIHsgLi4uc3RhdGUsIG91dHB1dDogYWN0aW9uLm91dHB1dCB9O1xuICAgIH1cbiAgICBjYXNlIFwiRE9ORVwiOiB7XG4gICAgICByZXR1cm4geyAuLi5zdGF0ZSwgc3RhdHVzOiBTdGF0dXMuRE9ORSB9O1xuICAgIH1cbiAgICBjYXNlIFwiRVJST1JcIjoge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgIGVycm9yczogW1xuICAgICAgICAgIC4uLihBcnJheS5pc0FycmF5KHN0YXRlLmVycm9ycykgPyBzdGF0ZS5lcnJvcnMgOiBbXSksXG4gICAgICAgICAgYWN0aW9uLmVycm9yLFxuICAgICAgICBdLFxuICAgICAgfTtcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgVW5oYW5kbGVkIGFjdGlvbiB0eXBlOiAke0pTT04uc3RyaW5naWZ5KGFjdGlvbiwgbnVsbCwgMil9YFxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cblxuaW50ZXJmYWNlIFRlcnJhZm9ybVByb3ZpZGVyQ29uZmlnIHtcbiAgaW5pdGlhbFN0YXRlPzogRGVwbG95U3RhdGU7XG4gIGNoaWxkcmVuOiBSZWFjdE5vZGU7XG59XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9wcm9wLXR5cGVzXG5leHBvcnQgY29uc3QgVGVycmFmb3JtUHJvdmlkZXI6IFJlYWN0LkZ1bmN0aW9uQ29tcG9uZW50PFxuICBUZXJyYWZvcm1Qcm92aWRlckNvbmZpZ1xuPiA9ICh7XG4gIGNoaWxkcmVuLFxuICBpbml0aWFsU3RhdGUsXG59OiBUZXJyYWZvcm1Qcm92aWRlckNvbmZpZyk6IFJlYWN0LlJlYWN0RWxlbWVudCA9PiB7XG4gIGNvbnN0IGluaXRpYWxDdXJyZW50U3RhY2s6IFN5bnRoZXNpemVkU3RhY2sgPSB7XG4gICAgY29uc3RydWN0UGF0aDogXCJcIixcbiAgICBjb250ZW50OiBcIlwiLFxuICAgIG5hbWU6IFwiXCIsXG4gICAgYW5ub3RhdGlvbnM6IFtdLFxuICAgIHN5bnRoZXNpemVkU3RhY2tQYXRoOiBcIlwiLFxuICAgIHdvcmtpbmdEaXJlY3Rvcnk6IFwiXCIsXG4gIH07XG5cbiAgY29uc3QgW3N0YXRlLCBkaXNwYXRjaF0gPSBSZWFjdC51c2VSZWR1Y2VyKFxuICAgIGRlcGxveVJlZHVjZXIsXG4gICAgaW5pdGlhbFN0YXRlIHx8IHtcbiAgICAgIHN0YXR1czogU3RhdHVzLlNUQVJUSU5HLFxuICAgICAgcmVzb3VyY2VzOiBbXSxcbiAgICAgIGN1cnJlbnRTdGFjazogaW5pdGlhbEN1cnJlbnRTdGFjayxcbiAgICB9XG4gICk7XG5cbiAgcmV0dXJuIChcbiAgICA8VGVycmFmb3JtQ29udGV4dFN0YXRlLlByb3ZpZGVyIHZhbHVlPXtzdGF0ZX0+XG4gICAgICA8VGVycmFmb3JtQ29udGV4dERpc3BhdGNoLlByb3ZpZGVyIHZhbHVlPXtkaXNwYXRjaH0+XG4gICAgICAgIHtjaGlsZHJlbn1cbiAgICAgIDwvVGVycmFmb3JtQ29udGV4dERpc3BhdGNoLlByb3ZpZGVyPlxuICAgIDwvVGVycmFmb3JtQ29udGV4dFN0YXRlLlByb3ZpZGVyPlxuICApO1xufTtcblxuZXhwb3J0IGNvbnN0IHVzZVRlcnJhZm9ybVN0YXRlID0gKCkgPT4ge1xuICBjb25zdCBzdGF0ZSA9IFJlYWN0LnVzZUNvbnRleHQoVGVycmFmb3JtQ29udGV4dFN0YXRlKTtcblxuICBpZiAoc3RhdGUgPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwidXNlVGVycmFmb3JtU3RhdGUgbXVzdCBiZSB1c2VkIHdpdGhpbiBhIFRlcnJhZm9ybUNvbnRleHRTdGF0ZS5Qcm92aWRlclwiXG4gICAgKTtcbiAgfVxuXG4gIHJldHVybiBzdGF0ZTtcbn07XG5cbmNvbnN0IHVzZVRlcnJhZm9ybURpc3BhdGNoID0gKCkgPT4ge1xuICBjb25zdCBkaXNwYXRjaCA9IFJlYWN0LnVzZUNvbnRleHQoVGVycmFmb3JtQ29udGV4dERpc3BhdGNoKTtcblxuICBpZiAoZGlzcGF0Y2ggPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwidXNlVGVycmFmb3JtIG11c3QgYmUgdXNlZCB3aXRoaW4gYSBUZXJyYWZvcm1Db250ZXh0RGlzcGF0Y2guUHJvdmlkZXJcIlxuICAgICk7XG4gIH1cblxuICByZXR1cm4gZGlzcGF0Y2g7XG59O1xuXG5jb25zdCB1c2VDb25maXJtYXRpb24gPSAoe1xuICBhdXRvQXBwcm92ZSA9IGZhbHNlLFxufToge1xuICBhdXRvQXBwcm92ZT86IGJvb2xlYW47XG59KSA9PiB7XG4gIGNvbnN0IHsgZXhpdCB9ID0gdXNlQXBwKCk7XG4gIGNvbnN0IFtjb25maXJtZWQsIHNldENvbmZpcm1lZF0gPSBSZWFjdC51c2VTdGF0ZTxib29sZWFuPihhdXRvQXBwcm92ZSk7XG4gIGNvbnN0IGNvbmZpcm1hdGlvbkNhbGxiYWNrID0gUmVhY3QudXNlQ2FsbGJhY2soXG4gICAgKHN1Ym1pdFZhbHVlKSA9PiB7XG4gICAgICBpZiAoc3VibWl0VmFsdWUgPT09IGZhbHNlKSB7XG4gICAgICAgIGV4aXQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBzZXRDb25maXJtZWQoc3VibWl0VmFsdWUpO1xuICAgIH0sXG4gICAgW2V4aXRdXG4gICk7XG5cbiAgcmV0dXJuIFtjb25maXJtZWQsIGNvbmZpcm1hdGlvbkNhbGxiYWNrXSBhcyBjb25zdDtcbn07XG5cbmludGVyZmFjZSBVc2VUZXJyYWZvcm1PcHRpb25zIHtcbiAgdGFyZ2V0RGlyOiBzdHJpbmc7XG4gIHRhcmdldFN0YWNrPzogc3RyaW5nO1xuICBzeW50aENvbW1hbmQ6IHN0cmluZztcbiAgaXNTcGVjdWxhdGl2ZT86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjb25zdCB1c2VUZXJyYWZvcm0gPSAoe1xuICB0YXJnZXREaXIsXG4gIHRhcmdldFN0YWNrLFxuICBzeW50aENvbW1hbmQsXG4gIGlzU3BlY3VsYXRpdmUgPSBmYWxzZSxcbn06IFVzZVRlcnJhZm9ybU9wdGlvbnMpID0+IHtcbiAgY29uc3QgZGlzcGF0Y2ggPSB1c2VUZXJyYWZvcm1EaXNwYXRjaCgpO1xuICBjb25zdCBzdGF0ZSA9IHVzZVRlcnJhZm9ybVN0YXRlKCk7XG4gIGNvbnN0IFt0ZXJyYWZvcm0sIHNldFRlcnJhZm9ybV0gPSBSZWFjdC51c2VTdGF0ZTxUZXJyYWZvcm0+KCk7XG5cbiAgY29uc3QgZXhlY3V0b3JGb3JTdGFjayA9IGFzeW5jIChzdGFjazogU3ludGhlc2l6ZWRTdGFjayk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgIGNvbnN0IHBhcnNlZFN0YWNrID0gSlNPTi5wYXJzZShzdGFjay5jb250ZW50KSBhcyBUZXJyYWZvcm1Kc29uO1xuXG4gICAgaWYgKHBhcnNlZFN0YWNrLnRlcnJhZm9ybT8uYmFja2VuZD8ucmVtb3RlKSB7XG4gICAgICBjb25zdCB0ZkNsaWVudCA9IG5ldyBUZXJyYWZvcm1DbG91ZChcbiAgICAgICAgc3RhY2ssXG4gICAgICAgIHBhcnNlZFN0YWNrLnRlcnJhZm9ybT8uYmFja2VuZD8ucmVtb3RlLFxuICAgICAgICBpc1NwZWN1bGF0aXZlXG4gICAgICApO1xuICAgICAgaWYgKGF3YWl0IHRmQ2xpZW50LmlzUmVtb3RlV29ya3NwYWNlKCkpIHtcbiAgICAgICAgc2V0VGVycmFmb3JtKHRmQ2xpZW50KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNldFRlcnJhZm9ybShuZXcgVGVycmFmb3JtQ2xpKHN0YWNrKSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHNldFRlcnJhZm9ybShuZXcgVGVycmFmb3JtQ2xpKHN0YWNrKSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGV4ZWNUZXJyYWZvcm1TeW50aCA9IGFzeW5jIChsb2FkRXhlY3V0b3IgPSB0cnVlKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGRpc3BhdGNoKHsgdHlwZTogXCJTWU5USFwiIH0pO1xuICAgICAgY29uc3Qgc3RhY2tzID0gYXdhaXQgU3ludGhTdGFjay5zeW50aChzeW50aENvbW1hbmQsIHRhcmdldERpcik7XG5cbiAgICAgIHByaW50QW5ub3RhdGlvbnMoc3RhY2tzKTtcblxuICAgICAgaWYgKGxvYWRFeGVjdXRvcikge1xuICAgICAgICBpZiAoc3RhY2tzLmxlbmd0aCA+IDEgJiYgIXRhcmdldFN0YWNrKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYEZvdW5kIG1vcmUgdGhhbiBvbmUgc3RhY2ssIHBsZWFzZSBzcGVjaWZ5IGEgdGFyZ2V0IHN0YWNrLiBSdW4gY2RrdGYgPHZlcmI+IDxzdGFjaz4gd2l0aCBvbmUgb2YgdGhlc2Ugc3RhY2tzOiAke3N0YWNrc1xuICAgICAgICAgICAgICAubWFwKChzKSA9PiBzLm5hbWUpXG4gICAgICAgICAgICAgIC5qb2luKFwiLCBcIil9IGBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN0YWNrID0gdGFyZ2V0U3RhY2tcbiAgICAgICAgICA/IHN0YWNrcy5maW5kKChzKSA9PiBzLm5hbWUgPT09IHRhcmdldFN0YWNrKVxuICAgICAgICAgIDogc3RhY2tzWzBdO1xuICAgICAgICBpZiAoIXN0YWNrKVxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIGBDYW4ndCBmaW5kIGdpdmVuIHN0YWNrICR7dGFyZ2V0U3RhY2t9IC0gRm91bmQgdGhlIGZvbGxvd2luZyBzdGFja3MgJHtzdGFja3NcbiAgICAgICAgICAgICAgLm1hcCgocykgPT4gcy5uYW1lKVxuICAgICAgICAgICAgICAuam9pbihcIiwgXCIpfWBcbiAgICAgICAgICApO1xuXG4gICAgICAgIGRpc3BhdGNoKHsgdHlwZTogXCJDVVJSRU5UX1NUQUNLXCIsIGN1cnJlbnRTdGFjazogc3RhY2sgfSk7XG5cbiAgICAgICAgYXdhaXQgZXhlY3V0b3JGb3JTdGFjayhzdGFjayk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBzeW50aFxuICAgICAgICBjb25zdCBzdGFjayA9IHRhcmdldFN0YWNrXG4gICAgICAgICAgPyBzdGFja3MuZmluZCgocykgPT4gcy5uYW1lID09PSB0YXJnZXRTdGFjaylcbiAgICAgICAgICA6IHN0YWNrc1swXTtcbiAgICAgICAgaWYgKHN0YWNrKSB7XG4gICAgICAgICAgZGlzcGF0Y2goeyB0eXBlOiBcIkNVUlJFTlRfU1RBQ0tcIiwgY3VycmVudFN0YWNrOiBzdGFjayB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBkaXNwYXRjaCh7IHR5cGU6IFwiU1lOVEhFU0laRURcIiwgc3RhY2tzIH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGRpc3BhdGNoKHsgdHlwZTogXCJFUlJPUlwiLCBlcnJvcjogZSB9KTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZXhlY1RlcnJhZm9ybUluaXQgPSBhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICghdGVycmFmb3JtKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgXCJJbnRlcm5hbCBlcnJvcjogVGVycmFmb3JtIGlzIG5vdCBpbml0aWFsaXplZCB5ZXQuIFBsZWFzZSBjYWxsIHN5bnRoKCkgd2l0aCBsb2FkRXhlY3V0b3I6IHRydWUgZmlyc3RcIlxuICAgICAgICApO1xuICAgICAgZGlzcGF0Y2goeyB0eXBlOiBcIklOSVRcIiB9KTtcbiAgICAgIGF3YWl0IHRlcnJhZm9ybS5pbml0KCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgZGlzcGF0Y2goeyB0eXBlOiBcIkVSUk9SXCIsIGVycm9yOiBlIH0pO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBleGVjVGVycmFmb3JtT3V0cHV0ID0gYXN5bmMgKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAoIXRlcnJhZm9ybSkgdGhyb3cgbmV3IEVycm9yKFwiVGVycmFmb3JtIGlzIG5vdCBpbml0aWFsaXplZCB5ZXRcIik7XG4gICAgICBjb25zdCBvdXRwdXQgPSBhd2FpdCB0ZXJyYWZvcm0ub3V0cHV0KCk7XG4gICAgICBkaXNwYXRjaCh7IHR5cGU6IFwiT1VUUFVUXCIsIG91dHB1dCB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBkaXNwYXRjaCh7IHR5cGU6IFwiRVJST1JcIiwgZXJyb3I6IGUgfSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGV4ZWNUZXJyYWZvcm1QbGFuID0gYXN5bmMgKFxuICAgIGRlc3Ryb3kgPSBmYWxzZVxuICApOiBQcm9taXNlPFRlcnJhZm9ybVBsYW4gfCB1bmRlZmluZWQ+ID0+IHtcbiAgICBsZXQgcGxhbjogVGVycmFmb3JtUGxhbjtcbiAgICB0cnkge1xuICAgICAgaWYgKCF0ZXJyYWZvcm0pIHRocm93IG5ldyBFcnJvcihcIlRlcnJhZm9ybSBpcyBub3QgaW5pdGlhbGl6ZWQgeWV0XCIpO1xuICAgICAgZGlzcGF0Y2goeyB0eXBlOiBcIlBMQU5cIiB9KTtcbiAgICAgIHBsYW4gPSBhd2FpdCB0ZXJyYWZvcm0ucGxhbihkZXN0cm95KTtcbiAgICAgIGRpc3BhdGNoKHsgdHlwZTogXCJQTEFOTkVEXCIsIHBsYW4gfSk7XG4gICAgICByZXR1cm4gcGxhbjtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBkaXNwYXRjaCh7IHR5cGU6IFwiRVJST1JcIiwgZXJyb3I6IGUgfSk7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfTtcblxuICBjb25zdCBleGVjVGVycmFmb3JtQXBwbHkgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgcGxhbiA9IHN0YXRlLnBsYW47XG4gICAgdHJ5IHtcbiAgICAgIGlmICghdGVycmFmb3JtKSB0aHJvdyBuZXcgRXJyb3IoXCJUZXJyYWZvcm0gaXMgbm90IGluaXRpYWxpemVkIHlldFwiKTtcbiAgICAgIGlmICghcGxhbikgdGhyb3cgbmV3IEVycm9yKFwiTm8gcGxhblwiKTtcbiAgICAgIGlmIChwbGFuLm5lZWRzQXBwbHkpIHtcbiAgICAgICAgY29uc3QgcmVzb3VyY2VzOiBEZXBsb3lpbmdSZXNvdXJjZVtdID0gcGxhbi5hcHBseWFibGVSZXNvdXJjZXMubWFwKFxuICAgICAgICAgIChyOiBQbGFubmVkUmVzb3VyY2UpID0+XG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKHt9LCByLCB7XG4gICAgICAgICAgICAgIGFwcGx5U3RhdGU6IERlcGxveWluZ1Jlc291cmNlQXBwbHlTdGF0ZS5XQUlUSU5HLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgICAgZGlzcGF0Y2goeyB0eXBlOiBcIkRFUExPWVwiLCByZXNvdXJjZXMgfSk7XG4gICAgICAgIGF3YWl0IHRlcnJhZm9ybS5kZXBsb3kocGxhbi5wbGFuRmlsZSwgKG91dHB1dDogQnVmZmVyKSA9PiB7XG4gICAgICAgICAgY29uc3QgcmVzb3VyY2VzID0gcGFyc2VPdXRwdXQob3V0cHV0LnRvU3RyaW5nKCkpO1xuICAgICAgICAgIGRpc3BhdGNoKHsgdHlwZTogXCJVUERBVEVfUkVTT1VSQ0VTXCIsIHJlc291cmNlcyB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBkaXNwYXRjaCh7IHR5cGU6IFwiRE9ORVwiIH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGRpc3BhdGNoKHsgdHlwZTogXCJFUlJPUlwiLCBlcnJvcjogZSB9KTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZXhlY1RlcnJhZm9ybURlc3Ryb3kgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgcGxhbiA9IHN0YXRlLnBsYW47XG4gICAgdHJ5IHtcbiAgICAgIGlmICghdGVycmFmb3JtKSB0aHJvdyBuZXcgRXJyb3IoXCJUZXJyYWZvcm0gaXMgbm90IGluaXRpYWxpemVkIHlldFwiKTtcbiAgICAgIGlmICghcGxhbikgdGhyb3cgbmV3IEVycm9yKFwiTm8gcGxhblwiKTtcbiAgICAgIGlmIChwbGFuLm5lZWRzQXBwbHkpIHtcbiAgICAgICAgY29uc3QgcmVzb3VyY2VzOiBEZXBsb3lpbmdSZXNvdXJjZVtdID0gcGxhbi5hcHBseWFibGVSZXNvdXJjZXMubWFwKFxuICAgICAgICAgIChyOiBQbGFubmVkUmVzb3VyY2UpID0+XG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKHt9LCByLCB7XG4gICAgICAgICAgICAgIGFwcGx5U3RhdGU6IERlcGxveWluZ1Jlc291cmNlQXBwbHlTdGF0ZS5XQUlUSU5HLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgICAgZGlzcGF0Y2goeyB0eXBlOiBcIkRFU1RST1lcIiwgcmVzb3VyY2VzIH0pO1xuXG4gICAgICAgIGF3YWl0IHRlcnJhZm9ybS5kZXN0cm95KChvdXRwdXQ6IEJ1ZmZlcikgPT4ge1xuICAgICAgICAgIGNvbnN0IHJlc291cmNlcyA9IHBhcnNlT3V0cHV0KG91dHB1dC50b1N0cmluZygpKTtcbiAgICAgICAgICBkaXNwYXRjaCh7IHR5cGU6IFwiVVBEQVRFX1JFU09VUkNFU1wiLCByZXNvdXJjZXMgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgZGlzcGF0Y2goeyB0eXBlOiBcIkRPTkVcIiB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBkaXNwYXRjaCh7IHR5cGU6IFwiRVJST1JcIiwgZXJyb3I6IGUgfSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiB7XG4gICAgc3ludGg6IGV4ZWNUZXJyYWZvcm1TeW50aCxcbiAgICBkZXBsb3k6IGV4ZWNUZXJyYWZvcm1BcHBseSxcbiAgICBkaWZmOiBleGVjVGVycmFmb3JtUGxhbixcbiAgICBvdXRwdXQ6IGV4ZWNUZXJyYWZvcm1PdXRwdXQsXG4gICAgZGVzdHJveTogZXhlY1RlcnJhZm9ybURlc3Ryb3ksXG4gICAgaW5pdDogZXhlY1RlcnJhZm9ybUluaXQsXG4gIH07XG59O1xuXG5jb25zdCB1c2VSdW5PbmNlID0gPEZuIGV4dGVuZHMgKC4uLmFyZ3M6IGFueVtdKSA9PiBhbnk+KFxuICBmbjogRm4sXG4gIC4uLmFyZ3M6IFBhcmFtZXRlcnM8Rm4+XG4pID0+IHtcbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBmbiguLi5hcmdzKTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gIH0sIFtdKTsgLy8gb25seSBydW4gb25jZSBvbiBtb3VudCDigJMgaWdub3JlIGFueSBjaGFuZ2VzIHRvIGZuXG59O1xuXG5leHBvcnQgY29uc3QgdXNlUnVuV2hlbiA9IDxGbiBleHRlbmRzICguLi5hcmdzOiBhbnlbXSkgPT4gYW55PihcbiAgY29uZGl0aW9uOiBib29sZWFuLFxuICBmbjogRm4sXG4gIC4uLmFyZ3M6IFBhcmFtZXRlcnM8Rm4+XG4pID0+IHtcbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoY29uZGl0aW9uKSBmbiguLi5hcmdzKTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gIH0sIFtjb25kaXRpb25dKTsgLy8gb25seSBydW4gaWYgY29uZGl0aW9uIGNoYW5nZXNcbn07XG5cbnR5cGUgVXNlUnVuU3ludGhPcHRpb25zID0gVXNlVGVycmFmb3JtT3B0aW9ucztcbmV4cG9ydCBjb25zdCB1c2VSdW5TeW50aCA9IChvcHRpb25zOiBVc2VSdW5TeW50aE9wdGlvbnMpID0+IHtcbiAgY29uc3Qgc3RhdGUgPSB1c2VUZXJyYWZvcm1TdGF0ZSgpO1xuICBjb25zdCB7IHN5bnRoIH0gPSB1c2VUZXJyYWZvcm0ob3B0aW9ucyk7XG5cbiAgdXNlUnVuT25jZShzeW50aCwgZmFsc2UpO1xuXG4gIHJldHVybiBzdGF0ZTtcbn07XG5cbnR5cGUgVXNlUnVuSW5pdE9wdGlvbnMgPSBVc2VUZXJyYWZvcm1PcHRpb25zO1xuZXhwb3J0IGNvbnN0IHVzZVJ1bkluaXQgPSAob3B0aW9uczogVXNlUnVuSW5pdE9wdGlvbnMpID0+IHtcbiAgY29uc3QgeyBzeW50aCwgaW5pdCB9ID0gdXNlVGVycmFmb3JtKG9wdGlvbnMpO1xuICBjb25zdCBzdGF0ZSA9IHVzZVRlcnJhZm9ybVN0YXRlKCk7XG5cbiAgdXNlUnVuT25jZShzeW50aCk7XG4gIHVzZVJ1bldoZW4oc3RhdGUuc3RhdHVzID09PSBTdGF0dXMuU1lOVEhFU0laRUQsIGluaXQpO1xuXG4gIHJldHVybiBzdGF0ZTtcbn07XG5cbnR5cGUgVXNlUnVuRGlmZk9wdGlvbnMgPSBVc2VUZXJyYWZvcm1PcHRpb25zO1xuZXhwb3J0IGNvbnN0IHVzZVJ1bkRpZmYgPSAob3B0aW9uczogVXNlUnVuRGlmZk9wdGlvbnMpID0+IHtcbiAgY29uc3QgeyBzeW50aCwgaW5pdCwgZGlmZiB9ID0gdXNlVGVycmFmb3JtKG9wdGlvbnMpO1xuICBjb25zdCBzdGF0ZSA9IHVzZVRlcnJhZm9ybVN0YXRlKCk7XG5cbiAgdXNlUnVuT25jZShzeW50aCk7XG4gIHVzZVJ1bldoZW4oc3RhdGUuc3RhdHVzID09PSBTdGF0dXMuU1lOVEhFU0laRUQsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBpbml0KCk7XG4gICAgYXdhaXQgZGlmZigpO1xuICB9KTtcblxuICByZXR1cm4gc3RhdGU7XG59O1xuXG5pbnRlcmZhY2UgVXNlUnVuRGVwbG95T3B0aW9ucyBleHRlbmRzIFVzZVRlcnJhZm9ybU9wdGlvbnMge1xuICBhdXRvQXBwcm92ZT86IGJvb2xlYW47XG59XG5leHBvcnQgY29uc3QgdXNlUnVuRGVwbG95ID0gKHtcbiAgYXV0b0FwcHJvdmUsXG4gIC4uLm9wdGlvbnNcbn06IFVzZVJ1bkRlcGxveU9wdGlvbnMpID0+IHtcbiAgY29uc3Qgc3RhdGUgPSB1c2VUZXJyYWZvcm1TdGF0ZSgpO1xuICBjb25zdCB7IHN5bnRoLCBpbml0LCBkaWZmLCBkZXBsb3ksIG91dHB1dCB9ID0gdXNlVGVycmFmb3JtKG9wdGlvbnMpO1xuICBjb25zdCBbY29uZmlybWVkLCBjb25maXJtYXRpb25DYWxsYmFja10gPSB1c2VDb25maXJtYXRpb24oeyBhdXRvQXBwcm92ZSB9KTtcblxuICB1c2VSdW5PbmNlKHN5bnRoKTtcbiAgdXNlUnVuV2hlbihzdGF0ZS5zdGF0dXMgPT09IFN0YXR1cy5TWU5USEVTSVpFRCwgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGluaXQoKTtcbiAgICBhd2FpdCBkaWZmKCk7XG4gIH0pO1xuICB1c2VSdW5XaGVuKGNvbmZpcm1lZCAmJiBzdGF0ZS5zdGF0dXMgPT09IFN0YXR1cy5QTEFOTkVELCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgZGVwbG95KCk7XG4gICAgYXdhaXQgb3V0cHV0KCk7XG4gIH0pO1xuXG4gIHJldHVybiB7XG4gICAgc3RhdGUsXG4gICAgY29uZmlybWF0aW9uOiBjb25maXJtYXRpb25DYWxsYmFjayxcbiAgICBpc0NvbmZpcm1lZDogY29uZmlybWVkLFxuICB9O1xufTtcblxuaW50ZXJmYWNlIFVzZVJ1bkRlc3Ryb3lPcHRpb25zIGV4dGVuZHMgVXNlVGVycmFmb3JtT3B0aW9ucyB7XG4gIGF1dG9BcHByb3ZlPzogYm9vbGVhbjtcbn1cbmV4cG9ydCBjb25zdCB1c2VSdW5EZXN0cm95ID0gKHtcbiAgYXV0b0FwcHJvdmUsXG4gIC4uLm9wdGlvbnNcbn06IFVzZVJ1bkRlc3Ryb3lPcHRpb25zKSA9PiB7XG4gIGNvbnN0IHN0YXRlID0gdXNlVGVycmFmb3JtU3RhdGUoKTtcbiAgY29uc3QgeyBzeW50aCwgaW5pdCwgZGlmZiwgZGVzdHJveSB9ID0gdXNlVGVycmFmb3JtKG9wdGlvbnMpO1xuICBjb25zdCBbY29uZmlybWVkLCBjb25maXJtYXRpb25DYWxsYmFja10gPSB1c2VDb25maXJtYXRpb24oeyBhdXRvQXBwcm92ZSB9KTtcblxuICB1c2VSdW5PbmNlKHN5bnRoKTtcbiAgdXNlUnVuV2hlbihzdGF0ZS5zdGF0dXMgPT09IFN0YXR1cy5TWU5USEVTSVpFRCwgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGluaXQoKTtcbiAgICBhd2FpdCBkaWZmKHRydWUpOyAvLyB0cnVlID0gcGxhbiBhIGRlc3Ryb3lcbiAgfSk7XG4gIHVzZVJ1bldoZW4oY29uZmlybWVkICYmIHN0YXRlLnN0YXR1cyA9PT0gU3RhdHVzLlBMQU5ORUQsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBkZXN0cm95KCk7XG4gIH0pO1xuXG4gIHJldHVybiB7XG4gICAgc3RhdGUsXG4gICAgY29uZmlybWF0aW9uOiBjb25maXJtYXRpb25DYWxsYmFjayxcbiAgICBpc0NvbmZpcm1lZDogY29uZmlybWVkLFxuICB9O1xufTtcblxuLyoqXG4gKiBwcmludHMgYW5ub3RhdGlvbnMgdmlhIGNvbnNvbGVcbiAqIEB0aHJvd3MgRXJyb3IgaWYgYW4gQW5ub3RhdGlvbiB3aXRoIGxldmVsID09PSBFUlJPUiBoYXMgYmVlbiBlbmNvdW50ZXJlZFxuICovXG5mdW5jdGlvbiBwcmludEFubm90YXRpb25zKHN0YWNrczogU3ludGhlc2l6ZWRTdGFja1tdKSB7XG4gIGxldCBlbmNvdW50ZXJlZEFubm90YXRpb25FcnJvciA9IGZhbHNlO1xuXG4gIHN0YWNrcy5mb3JFYWNoKChzdGFjaykgPT5cbiAgICAoc3RhY2suYW5ub3RhdGlvbnMgfHwgW10pLmZvckVhY2goKGFubm90YXRpb24pID0+IHtcbiAgICAgIGlmIChhbm5vdGF0aW9uLmxldmVsID09PSBBbm5vdGF0aW9uTWV0YWRhdGFFbnRyeVR5cGUuRVJST1IpXG4gICAgICAgIGVuY291bnRlcmVkQW5ub3RhdGlvbkVycm9yID0gdHJ1ZTtcblxuICAgICAgbGV0IGNvbG9yID0gY2hhbGtDb2xvdXIud2hpdGVCcmlnaHQ7XG4gICAgICBsZXQgbGV2ZWw6IHN0cmluZyA9IGFubm90YXRpb24ubGV2ZWw7XG4gICAgICBzd2l0Y2ggKGFubm90YXRpb24ubGV2ZWwpIHtcbiAgICAgICAgY2FzZSBBbm5vdGF0aW9uTWV0YWRhdGFFbnRyeVR5cGUuSU5GTzoge1xuICAgICAgICAgIGxldmVsID0gXCJJTkZPXCI7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBBbm5vdGF0aW9uTWV0YWRhdGFFbnRyeVR5cGUuV0FSTjoge1xuICAgICAgICAgIGNvbG9yID0gY2hhbGtDb2xvdXIuaGV4KFwiI0ZGQTUwMFwiKTsgLy8gb3JhbmdlXG4gICAgICAgICAgbGV2ZWwgPSBcIldBUk5cIjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIEFubm90YXRpb25NZXRhZGF0YUVudHJ5VHlwZS5FUlJPUjoge1xuICAgICAgICAgIGNvbG9yID0gY2hhbGtDb2xvdXIucmVkQnJpZ2h0O1xuICAgICAgICAgIGxldmVsID0gXCJFUlJPUlwiO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgY29sb3IoYCR7bGV2ZWx9IFske2Fubm90YXRpb24uY29uc3RydWN0UGF0aH1dOiAke2Fubm90YXRpb24ubWVzc2FnZX1gKVxuICAgICAgKTtcbiAgICAgIGlmIChcbiAgICAgICAgYW5ub3RhdGlvbi5sZXZlbCA9PT0gQW5ub3RhdGlvbk1ldGFkYXRhRW50cnlUeXBlLkVSUk9SICYmXG4gICAgICAgIGFubm90YXRpb24uc3RhY2t0cmFjZVxuICAgICAgKVxuICAgICAgICBjb25zb2xlLmxvZyhjaGFsa0NvbG91ci5ncmF5KGFubm90YXRpb24uc3RhY2t0cmFjZS5qb2luKFwiXFxuXCIpKSk7XG4gICAgfSlcbiAgKTtcblxuICBpZiAoZW5jb3VudGVyZWRBbm5vdGF0aW9uRXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBcIldoaWxlIHN5bnRoZXNpemluZyBvbmUgb3IgbW9yZSBlcnJvciBhbm5vdGF0aW9ucyBoYXZlIGJlZW4gZW5jb3VudGVyZWQuIFBsZWFzZSBjaGVjayB0aGUgbG9nIG91dHB1dCBhYm92ZS5cIlxuICAgICk7XG4gIH1cbn1cbiJdfQ==