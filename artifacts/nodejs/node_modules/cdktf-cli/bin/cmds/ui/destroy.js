"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Destroy = exports.DestroyComponent = exports.DeploySummary = void 0;
/* eslint-disable no-control-regex */
const react_1 = __importStar(require("react"));
const ink_1 = require("ink");
const ink_spinner_1 = __importDefault(require("ink-spinner"));
const ink_confirm_input_1 = __importDefault(require("@skorfmann/ink-confirm-input"));
const components_1 = require("./components");
const terraform_1 = require("./models/terraform");
const terraform_context_1 = require("./terraform-context");
const diff_1 = require("./diff");
exports.DeploySummary = ({ resources, }) => {
    const summary = resources.reduce((accumulator, resource) => {
        if (accumulator[resource.applyState] !== undefined) {
            accumulator[resource.applyState] += 1;
        }
        return accumulator;
    }, {
        destroyed: 0,
    });
    return (react_1.default.createElement(react_1.default.Fragment, null, Object.keys(summary).map((key, i) => (react_1.default.createElement(ink_1.Box, { key: key },
        i > 0 && react_1.default.createElement(ink_1.Text, null, ", "),
        react_1.default.createElement(ink_1.Text, null,
            summary[key],
            " ",
            key))))));
};
const Confirm = ({ callback }) => {
    const [value, setValue] = react_1.useState("");
    return (react_1.default.createElement(ink_1.Box, { flexDirection: "column", marginTop: 1 },
        react_1.default.createElement(ink_1.Text, { bold: true }, "Do you want to perform these actions?"),
        react_1.default.createElement(ink_1.Text, null, " CDK for Terraform will perform the actions described above."),
        react_1.default.createElement(ink_1.Text, null, " Only 'yes' will be accepted to approve."),
        react_1.default.createElement(ink_1.Box, { flexDirection: "row", marginTop: 1 },
            react_1.default.createElement(ink_1.Text, { bold: true }, " Enter a value:"),
            react_1.default.createElement(ink_confirm_input_1.default, { value: value, onChange: setValue, onSubmit: callback }))));
};
exports.DestroyComponent = () => {
    const { resources, status, currentStack } = terraform_context_1.useTerraformState();
    const applyActions = [
        terraform_1.PlannedResourceAction.UPDATE,
        terraform_1.PlannedResourceAction.CREATE,
        terraform_1.PlannedResourceAction.DELETE,
        terraform_1.PlannedResourceAction.READ,
    ];
    const applyableResources = resources.filter((resource) => applyActions.includes(resource.action));
    return (react_1.default.createElement(react_1.Fragment, null,
        react_1.default.createElement(ink_1.Box, { flexDirection: "column" },
            react_1.default.createElement(ink_1.Box, null, terraform_context_1.Status.DESTROYING == status ? (react_1.default.createElement(react_1.default.Fragment, null,
                react_1.default.createElement(ink_1.Text, { color: "green" },
                    react_1.default.createElement(ink_spinner_1.default, { type: "dots" })),
                react_1.default.createElement(ink_1.Box, { paddingLeft: 1 },
                    react_1.default.createElement(ink_1.Text, null, "Destroying Stack: "),
                    react_1.default.createElement(ink_1.Text, { bold: true }, currentStack.name)))) : (react_1.default.createElement(react_1.default.Fragment, null,
                react_1.default.createElement(ink_1.Text, null, "Destroying Stack: "),
                react_1.default.createElement(ink_1.Text, { bold: true }, currentStack.name)))),
            react_1.default.createElement(ink_1.Text, { bold: true }, "Resources"),
            applyableResources.map((resource) => (react_1.default.createElement(ink_1.Box, { key: resource.id, marginLeft: 1 },
                react_1.default.createElement(components_1.DeployingElement, { resource: resource, stackName: currentStack.name })))),
            react_1.default.createElement(ink_1.Box, { marginTop: 1 },
                react_1.default.createElement(ink_1.Text, { bold: true }, "Summary: "),
                react_1.default.createElement(exports.DeploySummary, { resources: applyableResources }),
                react_1.default.createElement(ink_1.Text, null, ".")))));
};
exports.Destroy = ({ targetDir, targetStack, synthCommand, autoApprove, }) => {
    const { state: { status, currentStack, errors, plan }, confirmation, isConfirmed, } = terraform_context_1.useRunDestroy({
        targetDir,
        targetStack,
        synthCommand,
        autoApprove,
    });
    const planStages = [
        terraform_context_1.Status.INITIALIZING,
        terraform_context_1.Status.PLANNING,
        terraform_context_1.Status.SYNTHESIZING,
        terraform_context_1.Status.SYNTHESIZED,
        terraform_context_1.Status.STARTING,
    ];
    const isPlanning = planStages.includes(status);
    const statusText = currentStack.name === "" ? (react_1.default.createElement(ink_1.Text, null,
        status,
        "...")) : (react_1.default.createElement(ink_1.Text, null,
        status,
        react_1.default.createElement(ink_1.Text, { bold: true },
            "\u00A0",
            currentStack.name),
        "..."));
    if (errors)
        return react_1.default.createElement(ink_1.Box, null, errors);
    if (plan && !plan.needsApply)
        return (react_1.default.createElement(react_1.default.Fragment, null,
            react_1.default.createElement(ink_1.Text, null,
                "No changes for Stack: ",
                react_1.default.createElement(ink_1.Text, { bold: true }, currentStack.name))));
    return (react_1.default.createElement(ink_1.Box, null, isPlanning ? (react_1.default.createElement(react_1.Fragment, null,
        react_1.default.createElement(ink_1.Text, { color: "green" },
            react_1.default.createElement(ink_spinner_1.default, { type: "dots" })),
        react_1.default.createElement(ink_1.Box, { paddingLeft: 1 },
            react_1.default.createElement(ink_1.Text, null, statusText)))) : (react_1.default.createElement(react_1.default.Fragment, null,
        !isConfirmed && (react_1.default.createElement(ink_1.Box, { flexDirection: "column" },
            react_1.default.createElement(diff_1.Plan, null),
            react_1.default.createElement(Confirm, { callback: confirmation }))),
        isConfirmed && react_1.default.createElement(exports.DestroyComponent, null)))));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVzdHJveS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRlc3Ryb3kudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxxQ0FBcUM7QUFDckMsK0NBQWtEO0FBQ2xELDZCQUFnQztBQUNoQyw4REFBa0M7QUFDbEMscUZBQXdEO0FBQ3hELDZDQUFnRDtBQUNoRCxrREFBOEU7QUFDOUUsMkRBQStFO0FBQy9FLGlDQUE4QjtBQU1qQixRQUFBLGFBQWEsR0FBRyxDQUFDLEVBQzVCLFNBQVMsR0FDVyxFQUFzQixFQUFFO0lBQzVDLE1BQU0sT0FBTyxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQzlCLENBQUMsV0FBVyxFQUFFLFFBQVEsRUFBRSxFQUFFO1FBQ3hCLElBQUksV0FBVyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsS0FBSyxTQUFTLEVBQUU7WUFDbEQsV0FBVyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDdkM7UUFFRCxPQUFPLFdBQVcsQ0FBQztJQUNyQixDQUFDLEVBQ0Q7UUFDRSxTQUFTLEVBQUUsQ0FBQztLQUNOLENBQ1QsQ0FBQztJQUVGLE9BQU8sQ0FDTCw4REFDRyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQ3BDLDhCQUFDLFNBQUcsSUFBQyxHQUFHLEVBQUUsR0FBRztRQUNWLENBQUMsR0FBRyxDQUFDLElBQUksOEJBQUMsVUFBSSxhQUFVO1FBQ3pCLDhCQUFDLFVBQUk7WUFDRixPQUFPLENBQUMsR0FBRyxDQUFDOztZQUFHLEdBQUcsQ0FDZCxDQUNILENBQ1AsQ0FBQyxDQUNELENBQ0osQ0FBQztBQUNKLENBQUMsQ0FBQztBQU1GLE1BQU0sT0FBTyxHQUFHLENBQUMsRUFBRSxRQUFRLEVBQWlCLEVBQXNCLEVBQUU7SUFDbEUsTUFBTSxDQUFDLEtB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QUksUUFBRSxVQUFVLENBQVEsQ0FDckIsQ0FDRyxDQUNaLENBQUMsQ0FBQyxDQUFDLENBQ0Y7UUFDRyxDQUFDLFdBQVcsSUFBSSxDQUNmLDhCQUFDLFNBQUcsSUFBQyxhQUFhLEVBQUMsUUFBUTtZQUN6Qiw4QkFBQyxXQUFJLE9BQUc7WUFDUiw4QkFBQyxPQUFPLElBQUMsUUFBUSxFQUFFLFlBQVksR0FBSSxDQUMvQixDQUNQO1FBQ0EsV0FBVyxJQUFJLDhCQUFDLHdCQUFnQixPQUFHLENBQ25DLENBQ0osQ0FDRyxDQUNQLENBQUM7QUFDSixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBuby1jb250cm9sLXJlZ2V4ICovXG5pbXBvcnQgUmVhY3QsIHsgRnJhZ21lbnQsIHVzZVN0YXRlIH0gZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBUZXh0LCBCb3ggfSBmcm9tIFwiaW5rXCI7XG5pbXBvcnQgU3Bpbm5lciBmcm9tIFwiaW5rLXNwaW5uZXJcIjtcbmltcG9ydCBDb25maXJtSW5wdXQgZnJvbSBcIkBza29yZm1hbm4vaW5rLWNvbmZpcm0taW5wdXRcIjtcbmltcG9ydCB7IERlcGxveWluZ0VsZW1lbnQgfSBmcm9tIFwiLi9jb21wb25lbnRzXCI7XG5pbXBvcnQgeyBEZXBsb3lpbmdSZXNvdXJjZSwgUGxhbm5lZFJlc291cmNlQWN0aW9uIH0gZnJvbSBcIi4vbW9kZWxzL3RlcnJhZm9ybVwiO1xuaW1wb3J0IHsgU3RhdHVzLCB1c2VUZXJyYWZvcm1TdGF0ZSwgdXNlUnVuRGVzdHJveSB9IGZyb20gXCIuL3RlcnJhZm9ybS1jb250ZXh0XCI7XG5pbXBvcnQgeyBQbGFuIH0gZnJvbSBcIi4vZGlmZlwiO1xuXG5pbnRlcmZhY2UgRGVwbG95U3VtbWFyeUNvbmZpZyB7XG4gIHJlc291cmNlczogRGVwbG95aW5nUmVzb3VyY2VbXTtcbn1cblxuZXhwb3J0IGNvbnN0IERlcGxveVN1bW1hcnkgPSAoe1xuICByZXNvdXJjZXMsXG59OiBEZXBsb3lTdW1tYXJ5Q29uZmlnKTogUmVhY3QuUmVhY3RFbGVtZW50ID0+IHtcbiAgY29uc3Qgc3VtbWFyeSA9IHJlc291cmNlcy5yZWR1Y2UoXG4gICAgKGFjY3VtdWxhdG9yLCByZXNvdXJjZSkgPT4ge1xuICAgICAgaWYgKGFjY3VtdWxhdG9yW3Jlc291cmNlLmFwcGx5U3RhdGVdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgYWNjdW11bGF0b3JbcmVzb3VyY2UuYXBwbHlTdGF0ZV0gKz0gMTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yO1xuICAgIH0sXG4gICAge1xuICAgICAgZGVzdHJveWVkOiAwLFxuICAgIH0gYXMgYW55XG4gICk7XG5cbiAgcmV0dXJuIChcbiAgICA8PlxuICAgICAge09iamVjdC5rZXlzKHN1bW1hcnkpLm1hcCgoa2V5LCBpKSA9PiAoXG4gICAgICAgIDxCb3gga2V5PXtrZXl9PlxuICAgICAgICAgIHtpID4gMCAmJiA8VGV4dD4sIDwvVGV4dD59XG4gICAgICAgICAgPFRleHQ+XG4gICAgICAgICAgICB7c3VtbWFyeVtrZXldfSB7a2V5fVxuICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgPC9Cb3g+XG4gICAgICApKX1cbiAgICA8Lz5cbiAgKTtcbn07XG5cbmludGVyZmFjZSBDb25maXJtQ29uZmlnIHtcbiAgY2FsbGJhY2s6ICh2YWx1ZTogYW55KSA9PiBhbnk7XG59XG5cbmNvbnN0IENvbmZpcm0gPSAoeyBjYWxsYmFjayB9OiBDb25maXJtQ29uZmlnKTogUmVhY3QuUmVhY3RFbGVtZW50ID0+IHtcbiAgY29uc3QgW3ZhbHVlLCBzZXRWYWx1ZV0gPSB1c2VTdGF0ZShcIlwiKTtcblxuICByZXR1cm4gKFxuICAgIDxCb3ggZmxleERpcmVjdGlvbj1cImNvbHVtblwiIG1hcmdpblRvcD17MX0+XG4gICAgICA8VGV4dCBib2xkPkRvIHlvdSB3YW50IHRvIHBlcmZvcm0gdGhlc2UgYWN0aW9ucz88L1RleHQ+XG4gICAgICA8VGV4dD4gQ0RLIGZvciBUZXJyYWZvcm0gd2lsbCBwZXJmb3JtIHRoZSBhY3Rpb25zIGRlc2NyaWJlZCBhYm92ZS48L1RleHQ+XG4gICAgICA8VGV4dD4gT25seSAneWVzJyB3aWxsIGJlIGFjY2VwdGVkIHRvIGFwcHJvdmUuPC9UZXh0PlxuXG4gICAgICA8Qm94IGZsZXhEaXJlY3Rpb249XCJyb3dcIiBtYXJnaW5Ub3A9ezF9PlxuICAgICAgICA8VGV4dCBib2xkPiBFbnRlciBhIHZhbHVlOjwvVGV4dD5cbiAgICAgICAgPENvbmZpcm1JbnB1dCB2YWx1ZT17dmFsdWV9IG9uQ2hhbmdlPXtzZXRWYWx1ZX0gb25TdWJtaXQ9e2NhbGxiYWNrfSAvPlxuICAgICAgPC9Cb3g+XG4gICAgPC9Cb3g+XG4gICk7XG59O1xuXG5leHBvcnQgY29uc3QgRGVzdHJveUNvbXBvbmVudCA9ICgpOiBSZWFjdC5SZWFjdEVsZW1lbnQgPT4ge1xuICBjb25zdCB7IHJlc291cmNlcywgc3RhdHVzLCBjdXJyZW50U3RhY2sgfSA9IHVzZVRlcnJhZm9ybVN0YXRlKCk7XG4gIGNvbnN0IGFwcGx5QWN0aW9ucyA9IFtcbiAgICBQbGFubmVkUmVzb3VyY2VBY3Rpb24uVVBEQVRFLFxuICAgIFBsYW5uZWRSZXNvdXJjZUFjdGlvbi5DUkVBVEUsXG4gICAgUGxhbm5lZFJlc291cmNlQWN0aW9uLkRFTEVURSxcbiAgICBQbGFubmVkUmVzb3VyY2VBY3Rpb24uUkVBRCxcbiAgXTtcbiAgY29uc3QgYXBwbHlhYmxlUmVzb3VyY2VzID0gcmVzb3VyY2VzLmZpbHRlcigocmVzb3VyY2UpID0+XG4gICAgYXBwbHlBY3Rpb25zLmluY2x1ZGVzKHJlc291cmNlLmFjdGlvbilcbiAgKTtcbiAgcmV0dXJuIChcbiAgICA8RnJhZ21lbnQ+XG4gICAgICA8Qm94IGZsZXhEaXJlY3Rpb249XCJjb2x1bW5cIj5cbiAgICAgICAgPEJveD5cbiAgICAgICAgICB7U3RhdHVzLkRFU1RST1lJTkcgPT0gc3RhdHVzID8gKFxuICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAgPFRleHQgY29sb3I9XCJncmVlblwiPlxuICAgICAgICAgICAgICAgIDxTcGlubmVyIHR5cGU9XCJkb3RzXCIgLz5cbiAgICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgICAgICA8Qm94IHBhZGRpbmdMZWZ0PXsxfT5cbiAgICAgICAgICAgICAgICA8VGV4dD5EZXN0cm95aW5nIFN0YWNrOiA8L1RleHQ+XG4gICAgICAgICAgICAgICAgPFRleHQgYm9sZD57Y3VycmVudFN0YWNrLm5hbWV9PC9UZXh0PlxuICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgIDwvPlxuICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICA8PlxuICAgICAgICAgICAgICA8VGV4dD5EZXN0cm95aW5nIFN0YWNrOiA8L1RleHQ+XG4gICAgICAgICAgICAgIDxUZXh0IGJvbGQ+e2N1cnJlbnRTdGFjay5uYW1lfTwvVGV4dD5cbiAgICAgICAgICAgIDwvPlxuICAgICAgICAgICl9XG4gICAgICAgIDwvQm94PlxuICAgICAgICA8VGV4dCBib2xkPlJlc291cmNlczwvVGV4dD5cbiAgICAgICAge2FwcGx5YWJsZVJlc291cmNlcy5tYXAoKHJlc291cmNlOiBhbnkpID0+IChcbiAgICAgICAgICA8Qm94IGtleT17cmVzb3VyY2UuaWR9IG1hcmdpbkxlZnQ9ezF9PlxuICAgICAgICAgICAgPERlcGxveWluZ0VsZW1lbnRcbiAgICAgICAgICAgICAgcmVzb3VyY2U9e3Jlc291cmNlfVxuICAgICAgICAgICAgICBzdGFja05hbWU9e2N1cnJlbnRTdGFjay5uYW1lfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L0JveD5cbiAgICAgICAgKSl9XG4gICAgICAgIDxCb3ggbWFyZ2luVG9wPXsxfT5cbiAgICAgICAgICA8VGV4dCBib2xkPlN1bW1hcnk6IDwvVGV4dD5cbiAgICAgICAgICA8RGVwbG95U3VtbWFyeSByZXNvdXJjZXM9e2FwcGx5YWJsZVJlc291cmNlc30gLz5cbiAgICAgICAgICA8VGV4dD4uPC9UZXh0PlxuICAgICAgICA8L0JveD5cbiAgICAgIDwvQm94PlxuICAgIDwvRnJhZ21lbnQ+XG4gICk7XG59O1xuXG5pbnRlcmZhY2UgRGVzdHJveUNvbmZpZyB7XG4gIHRhcmdldERpcjogc3RyaW5nO1xuICB0YXJnZXRTdGFjaz86IHN0cmluZztcbiAgc3ludGhDb21tYW5kOiBzdHJpbmc7XG4gIGF1dG9BcHByb3ZlOiBib29sZWFuO1xufVxuXG5leHBvcnQgY29uc3QgRGVzdHJveSA9ICh7XG4gIHRhcmdldERpcixcbiAgdGFyZ2V0U3RhY2ssXG4gIHN5bnRoQ29tbWFuZCxcbiAgYXV0b0FwcHJvdmUsXG59OiBEZXN0cm95Q29uZmlnKTogUmVhY3QuUmVhY3RFbGVtZW50ID0+IHtcbiAgY29uc3Qge1xuICAgIHN0YXRlOiB7IHN0YXR1cywgY3VycmVudFN0YWNrLCBlcnJvcnMsIHBsYW4gfSxcbiAgICBjb25maXJtYXRpb24sXG4gICAgaXNDb25maXJtZWQsXG4gIH0gPSB1c2VSdW5EZXN0cm95KHtcbiAgICB0YXJnZXREaXIsXG4gICAgdGFyZ2V0U3RhY2ssXG4gICAgc3ludGhDb21tYW5kLFxuICAgIGF1dG9BcHByb3ZlLFxuICB9KTtcblxuICBjb25zdCBwbGFuU3RhZ2VzID0gW1xuICAgIFN0YXR1cy5JTklUSUFMSVpJTkcsXG4gICAgU3RhdHVzLlBMQU5OSU5HLFxuICAgIFN0YXR1cy5TWU5USEVTSVpJTkcsXG4gICAgU3RhdHVzLlNZTlRIRVNJWkVELFxuICAgIFN0YXR1cy5TVEFSVElORyxcbiAgXTtcbiAgY29uc3QgaXNQbGFubmluZyA9IHBsYW5TdGFnZXMuaW5jbHVkZXMoc3RhdHVzKTtcbiAgY29uc3Qgc3RhdHVzVGV4dCA9XG4gICAgY3VycmVudFN0YWNrLm5hbWUgPT09IFwiXCIgPyAoXG4gICAgICA8VGV4dD57c3RhdHVzfS4uLjwvVGV4dD5cbiAgICApIDogKFxuICAgICAgPFRleHQ+XG4gICAgICAgIHtzdGF0dXN9XG4gICAgICAgIDxUZXh0IGJvbGQ+Jm5ic3A7e2N1cnJlbnRTdGFjay5uYW1lfTwvVGV4dD4uLi5cbiAgICAgIDwvVGV4dD5cbiAgICApO1xuXG4gIGlmIChlcnJvcnMpIHJldHVybiA8Qm94PntlcnJvcnN9PC9Cb3g+O1xuICBpZiAocGxhbiAmJiAhcGxhbi5uZWVkc0FwcGx5KVxuICAgIHJldHVybiAoXG4gICAgICA8PlxuICAgICAgICA8VGV4dD5cbiAgICAgICAgICBObyBjaGFuZ2VzIGZvciBTdGFjazogPFRleHQgYm9sZD57Y3VycmVudFN0YWNrLm5hbWV9PC9UZXh0PlxuICAgICAgICA8L1RleHQ+XG4gICAgICA8Lz5cbiAgICApO1xuXG4gIHJldHVybiAoXG4gICAgPEJveD5cbiAgICAgIHtpc1BsYW5uaW5nID8gKFxuICAgICAgICA8RnJhZ21lbnQ+XG4gICAgICAgICAgPFRleHQgY29sb3I9XCJncmVlblwiPlxuICAgICAgICAgICAgPFNwaW5uZXIgdHlwZT1cImRvdHNcIiAvPlxuICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICA8Qm94IHBhZGRpbmdMZWZ0PXsxfT5cbiAgICAgICAgICAgIDxUZXh0PntzdGF0dXNUZXh0fTwvVGV4dD5cbiAgICAgICAgICA8L0JveD5cbiAgICAgICAgPC9GcmFnbWVudD5cbiAgICAgICkgOiAoXG4gICAgICAgIDw+XG4gICAgICAgICAgeyFpc0NvbmZpcm1lZCAmJiAoXG4gICAgICAgICAgICA8Qm94IGZsZXhEaXJlY3Rpb249XCJjb2x1bW5cIj5cbiAgICAgICAgICAgICAgPFBsYW4gLz5cbiAgICAgICAgICAgICAgPENvbmZpcm0gY2FsbGJhY2s9e2NvbmZpcm1hdGlvbn0gLz5cbiAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICl9XG4gICAgICAgICAge2lzQ29uZmlybWVkICYmIDxEZXN0cm95Q29tcG9uZW50IC8+fVxuICAgICAgICA8Lz5cbiAgICAgICl9XG4gICAgPC9Cb3g+XG4gICk7XG59O1xuIl19