"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const yargs = __importStar(require("yargs"));
const srcmak_1 = require("./srcmak");
async function main() {
    const args = yargs
        .usage('$0 SRCDIR [OPTIONS]')
        .option('entrypoint', { desc: 'typescript entrypoint (relative to SRCDIR)', default: 'index.ts' })
        .option('dep', { desc: 'node module directories to include in compilation', type: 'array', string: true })
        .option('jsii-path', { desc: 'write .jsii output to this path', type: 'string' })
        .option('python-outdir', { desc: 'python output directory (requires --python-module-name)', type: 'string' })
        .option('python-module-name', { desc: 'python module name', type: 'string' })
        .option('java-outdir', { desc: 'java output directory (requires --java-package)', type: 'string' })
        .option('java-package', { desc: 'the java package (namespace) to use for all generated types', type: 'string' })
        .option('csharp-outdir', { desc: 'C# output directory (requires --csharp-namespace)', type: 'string' })
        .option('csharp-namespace', { desc: 'the C# namespace to use for all generated types', type: 'string' })
        .option('golang-outdir', { desc: 'golang output directory (requires --golang-module)', type: 'string' })
        .option('golang-module', { desc: 'the golang module to use for all generated types', type: 'string' })
        .option('golang-package', { desc: 'the golang package name to use for all generated types', type: 'string' })
        .showHelpOnFail(true)
        .help();
    const argv = args.argv;
    if (argv._.length !== 1) {
        args.showHelp();
        console.error();
        console.error('Invalid number of arguments. expecting a single positional argument.');
        process.exit(1);
    }
    const srcdir = argv._[0];
    await (0, srcmak_1.srcmak)(srcdir, {
        entrypoint: argv.entrypoint,
        ...parseDepOption(),
        ...parseJsiiOptions(),
        ...parsePythonOptions(),
        ...parseJavaOptions(),
        ...parseCSharpOptions(),
        ...parseGoLangOptions(),
    });
    function parseJsiiOptions() {
        const jsiiPath = argv['jsii-path'];
        if (!jsiiPath) {
            return undefined;
        }
        return {
            jsii: {
                path: jsiiPath,
            },
        };
    }
    function parsePythonOptions() {
        const outdir = argv['python-outdir'];
        const moduleName = argv['python-module-name'];
        if (!outdir && !moduleName) {
            return undefined;
        }
        if (!outdir) {
            throw new Error('--python-outdir is required if --python-module-name is specified');
        }
        if (!moduleName) {
            throw new Error('--python-module-name is required if --python-outdir is specified');
        }
        return {
            python: {
                outdir: outdir,
                moduleName: moduleName,
            },
        };
    }
    function parseJavaOptions() {
        const outdir = argv['java-outdir'];
        const packageName = argv['java-package'];
        if (!outdir && !packageName) {
            return undefined;
        }
        if (!outdir) {
            throw new Error('--java-outdir is required');
        }
        if (!packageName) {
            throw new Error('--java-package is required');
        }
        return {
            java: {
                outdir: outdir,
                package: packageName,
            },
        };
    }
    function parseCSharpOptions() {
        const outdir = argv['csharp-outdir'];
        const namespace = argv['csharp-namespace'];
        if (!outdir && !namespace) {
            return undefined;
        }
        if (!outdir) {
            throw new Error('--csharp-outdir is required');
        }
        if (!namespace) {
            throw new Error('--csharp-namespace is required');
        }
        return {
            csharp: {
                outdir: outdir,
                namespace: namespace,
            },
        };
    }
    function parseGoLangOptions() {
        const outdir = argv['golang-outdir'];
        const module = argv['golang-module'];
        const packageName = argv['golang-package'];
        if (!outdir && !module) {
            return undefined;
        }
        if (!outdir) {
            throw new Error('--golang-outdir is required');
        }
        if (!module) {
            throw new Error('--golang-module is required');
        }
        if (!packageName) {
            throw new Error('--golang-package is required');
        }
        return {
            golang: {
                outdir: outdir,
                moduleName: module,
                packageName: packageName,
            },
        };
    }
    function parseDepOption() {
        var _a;
        if (((_a = argv.dep) === null || _a === void 0 ? void 0 : _a.length) === 0) {
            return undefined;
        }
        return {
            deps: argv.dep,
        };
    }
}
main().catch((e) => {
    console.error(e.stack);
    process.exit(1);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NsaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw2Q0FBK0I7QUFDL0IscUNBQWtDO0FBRWxDLEtBQUssVUFBVSxJQUFJO0lBQ2pCLE1BQU0sSUFBSSxHQUFHLEtBQUs7U0FDZixLQUFLLENBQUMscUJBQXFCLENBQUM7U0FDNUIsTUFBTSxDQUFDLFlBQVksRUFBRSxFQUFFLElBQUksRUFBRSw0Q0FBNEMsRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLENBQUM7U0FDakcsTUFBTSxDQUFDLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxtREFBbUQsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQztTQUN6RyxNQUFNLENBQUMsV0FBVyxFQUFFLEVBQUUsSUFBSSxFQUFFLGlDQUFpQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQztTQUNoRixNQUFNLENBQUMsZUFBZSxFQUFFLEVBQUUsSUFBSSxFQUFFLHlEQUF5RCxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQztTQUM1RyxNQUFNLENBQUMsb0JBQW9CLEVBQUUsRUFBRSxJQUFJLEVBQUUsb0JBQW9CLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDO1NBQzVFLE1BQU0sQ0FBQyxhQUFhLEVBQUUsRUFBRSxJQUFJLEVBQUUsaURBQWlELEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDO1NBQ2xHLE1BQU0sQ0FBQyxjQUFjLEVBQUUsRUFBRSxJQUFJLEVBQUUsNkRBQTZELEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDO1NBQy9HLE1BQU0sQ0FBQyxlQUFlLEVBQUUsRUFBRSxJQUFJLEVBQUUsbURBQW1ELEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDO1NBQ3RHLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRSxFQUFFLElBQUks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QThCLENBQUMsQ0FBQztTQUFFO1FBQ3RFLE9BQU87WUFDTCxNQUFNLEVBQUU7Z0JBQ04sTUFBTSxFQUFFLE1BQU07Z0JBQ2QsVUFBVSxFQUFFLE1BQU07Z0JBQ2xCLFdBQVcsRUFBRSxXQUFXO2FBQ3pCO1NBQ0YsQ0FBQztJQUNKLENBQUM7SUFFRCxTQUFTLGNBQWM7O1FBQ3JCLElBQUksQ0FBQSxNQUFBLElBQUksQ0FBQyxHQUFHLDBDQUFFLE1BQU0sTUFBSyxDQUFDLEVBQUU7WUFBRSxPQUFPLFNBQVMsQ0FBQztTQUFFO1FBQ2pELE9BQU87WUFDTCxJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUc7U0FDZixDQUFDO0lBQ0osQ0FBQztBQUNILENBQUM7QUFFRCxJQUFJLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFRLEVBQUUsRUFBRTtJQUN4QixPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN2QixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2xCLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgeWFyZ3MgZnJvbSAneWFyZ3MnO1xuaW1wb3J0IHsgc3JjbWFrIH0gZnJvbSAnLi9zcmNtYWsnO1xuXG5hc3luYyBmdW5jdGlvbiBtYWluKCkge1xuICBjb25zdCBhcmdzID0geWFyZ3NcbiAgICAudXNhZ2UoJyQwIFNSQ0RJUiBbT1BUSU9OU10nKVxuICAgIC5vcHRpb24oJ2VudHJ5cG9pbnQnLCB7IGRlc2M6ICd0eXBlc2NyaXB0IGVudHJ5cG9pbnQgKHJlbGF0aXZlIHRvIFNSQ0RJUiknLCBkZWZhdWx0OiAnaW5kZXgudHMnIH0pXG4gICAgLm9wdGlvbignZGVwJywgeyBkZXNjOiAnbm9kZSBtb2R1bGUgZGlyZWN0b3JpZXMgdG8gaW5jbHVkZSBpbiBjb21waWxhdGlvbicsIHR5cGU6ICdhcnJheScsIHN0cmluZzogdHJ1ZSB9KVxuICAgIC5vcHRpb24oJ2pzaWktcGF0aCcsIHsgZGVzYzogJ3dyaXRlIC5qc2lpIG91dHB1dCB0byB0aGlzIHBhdGgnLCB0eXBlOiAnc3RyaW5nJyB9KVxuICAgIC5vcHRpb24oJ3B5dGhvbi1vdXRkaXInLCB7IGRlc2M6ICdweXRob24gb3V0cHV0IGRpcmVjdG9yeSAocmVxdWlyZXMgLS1weXRob24tbW9kdWxlLW5hbWUpJywgdHlwZTogJ3N0cmluZycgfSlcbiAgICAub3B0aW9uKCdweXRob24tbW9kdWxlLW5hbWUnLCB7IGRlc2M6ICdweXRob24gbW9kdWxlIG5hbWUnLCB0eXBlOiAnc3RyaW5nJyB9KVxuICAgIC5vcHRpb24oJ2phdmEtb3V0ZGlyJywgeyBkZXNjOiAnamF2YSBvdXRwdXQgZGlyZWN0b3J5IChyZXF1aXJlcyAtLWphdmEtcGFja2FnZSknLCB0eXBlOiAnc3RyaW5nJyB9KVxuICAgIC5vcHRpb24oJ2phdmEtcGFja2FnZScsIHsgZGVzYzogJ3RoZSBqYXZhIHBhY2thZ2UgKG5hbWVzcGFjZSkgdG8gdXNlIGZvciBhbGwgZ2VuZXJhdGVkIHR5cGVzJywgdHlwZTogJ3N0cmluZycgfSlcbiAgICAub3B0aW9uKCdjc2hhcnAtb3V0ZGlyJywgeyBkZXNjOiAnQyMgb3V0cHV0IGRpcmVjdG9yeSAocmVxdWlyZXMgLS1jc2hhcnAtbmFtZXNwYWNlKScsIHR5cGU6ICdzdHJpbmcnIH0pXG4gICAgLm9wdGlvbignY3NoYXJwLW5hbWVzcGFjZScsIHsgZGVzYzogJ3RoZSBDIyBuYW1lc3BhY2UgdG8gdXNlIGZvciBhbGwgZ2VuZXJhdGVkIHR5cGVzJywgdHlwZTogJ3N0cmluZycgfSlcbiAgICAub3B0aW9uKCdnb2xhbmctb3V0ZGlyJywgeyBkZXNjOiAnZ29sYW5nIG91dHB1dCBkaXJlY3RvcnkgKHJlcXVpcmVzIC0tZ29sYW5nLW1vZHVsZSknLCB0eXBlOiAnc3RyaW5nJyB9KVxuICAgIC5vcHRpb24oJ2dvbGFuZy1tb2R1bGUnLCB7IGRlc2M6ICd0aGUgZ29sYW5nIG1vZHVsZSB0byB1c2UgZm9yIGFsbCBnZW5lcmF0ZWQgdHlwZXMnLCB0eXBlOiAnc3RyaW5nJyB9KVxuICAgIC5vcHRpb24oJ2dvbGFuZy1wYWNrYWdlJywgeyBkZXNjOiAndGhlIGdvbGFuZyBwYWNrYWdlIG5hbWUgdG8gdXNlIGZvciBhbGwgZ2VuZXJhdGVkIHR5cGVzJywgdHlwZTogJ3N0cmluZycgfSlcbiAgICAuc2hvd0hlbHBPbkZhaWwodHJ1ZSlcbiAgICAuaGVscCgpO1xuXG4gIGNvbnN0IGFyZ3YgPSBhcmdzLmFyZ3Y7XG5cbiAgaWYgKGFyZ3YuXy5sZW5ndGggIT09IDEpIHtcbiAgICBhcmdzLnNob3dIZWxwKCk7XG4gICAgY29uc29sZS5lcnJvcigpO1xuICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgbnVtYmVyIG9mIGFyZ3VtZW50cy4gZXhwZWN0aW5nIGEgc2luZ2xlIHBvc2l0aW9uYWwgYXJndW1lbnQuJyk7XG4gICAgcHJvY2Vzcy5leGl0KDEpO1xuICB9XG5cbiAgY29uc3Qgc3JjZGlyID0gYXJndi5fWzBdIGFzIHN0cmluZztcbiAgYXdhaXQgc3JjbWFrKHNyY2Rpciwge1xuICAgIGVudHJ5cG9pbnQ6IGFyZ3YuZW50cnlwb2ludCxcbiAgICAuLi5wYXJzZURlcE9wdGlvbigpLFxuICAgIC4uLnBhcnNlSnNpaU9wdGlvbnMoKSxcbiAgICAuLi5wYXJzZVB5dGhvbk9wdGlvbnMoKSxcbiAgICAuLi5wYXJzZUphdmFPcHRpb25zKCksXG4gICAgLi4ucGFyc2VDU2hhcnBPcHRpb25zKCksXG4gICAgLi4ucGFyc2VHb0xhbmdPcHRpb25zKCksXG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHBhcnNlSnNpaU9wdGlvbnMoKSB7XG4gICAgY29uc3QganNpaVBhdGggPSBhcmd2Wydqc2lpLXBhdGgnXTtcbiAgICBpZiAoIWpzaWlQYXRoKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cbiAgICByZXR1cm4ge1xuICAgICAganNpaToge1xuICAgICAgICBwYXRoOiBqc2lpUGF0aCxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlUHl0aG9uT3B0aW9ucygpIHtcbiAgICBjb25zdCBvdXRkaXIgPSBhcmd2WydweXRob24tb3V0ZGlyJ107XG4gICAgY29uc3QgbW9kdWxlTmFtZSA9IGFyZ3ZbJ3B5dGhvbi1tb2R1bGUtbmFtZSddO1xuICAgIGlmICghb3V0ZGlyICYmICFtb2R1bGVOYW1lKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cbiAgICBpZiAoIW91dGRpcikgeyB0aHJvdyBuZXcgRXJyb3IoJy0tcHl0aG9uLW91dGRpciBpcyByZXF1aXJlZCBpZiAtLXB5dGhvbi1tb2R1bGUtbmFtZSBpcyBzcGVjaWZpZWQnKTsgfVxuICAgIGlmICghbW9kdWxlTmFtZSkgeyB0aHJvdyBuZXcgRXJyb3IoJy0tcHl0aG9uLW1vZHVsZS1uYW1lIGlzIHJlcXVpcmVkIGlmIC0tcHl0aG9uLW91dGRpciBpcyBzcGVjaWZpZWQnKTsgfVxuICAgIHJldHVybiB7XG4gICAgICBweXRob246IHtcbiAgICAgICAgb3V0ZGlyOiBvdXRkaXIsXG4gICAgICAgIG1vZHVsZU5hbWU6IG1vZHVsZU5hbWUsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZUphdmFPcHRpb25zKCkge1xuICAgIGNvbnN0IG91dGRpciA9IGFyZ3ZbJ2phdmEtb3V0ZGlyJ107XG4gICAgY29uc3QgcGFja2FnZU5hbWUgPSBhcmd2WydqYXZhLXBhY2thZ2UnXTtcbiAgICBpZiAoIW91dGRpciAmJiAhcGFja2FnZU5hbWUpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfVxuICAgIGlmICghb3V0ZGlyKSB7IHRocm93IG5ldyBFcnJvcignLS1qYXZhLW91dGRpciBpcyByZXF1aXJlZCcpOyB9XG4gICAgaWYgKCFwYWNrYWdlTmFtZSkgeyB0aHJvdyBuZXcgRXJyb3IoJy0tamF2YS1wYWNrYWdlIGlzIHJlcXVpcmVkJyk7IH1cbiAgICByZXR1cm4ge1xuICAgICAgamF2YToge1xuICAgICAgICBvdXRkaXI6IG91dGRpcixcbiAgICAgICAgcGFja2FnZTogcGFja2FnZU5hbWUsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZUNTaGFycE9wdGlvbnMoKSB7XG4gICAgY29uc3Qgb3V0ZGlyID0gYXJndlsnY3NoYXJwLW91dGRpciddO1xuICAgIGNvbnN0IG5hbWVzcGFjZSA9IGFyZ3ZbJ2NzaGFycC1uYW1lc3BhY2UnXTtcbiAgICBpZiAoIW91dGRpciAmJiAhbmFtZXNwYWNlKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cbiAgICBpZiAoIW91dGRpcikgeyB0aHJvdyBuZXcgRXJyb3IoJy0tY3NoYXJwLW91dGRpciBpcyByZXF1aXJlZCcpOyB9XG4gICAgaWYgKCFuYW1lc3BhY2UpIHsgdGhyb3cgbmV3IEVycm9yKCctLWNzaGFycC1uYW1lc3BhY2UgaXMgcmVxdWlyZWQnKTsgfVxuICAgIHJldHVybiB7XG4gICAgICBjc2hhcnA6IHtcbiAgICAgICAgb3V0ZGlyOiBvdXRkaXIsXG4gICAgICAgIG5hbWVzcGFjZTogbmFtZXNwYWNlLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VHb0xhbmdPcHRpb25zKCkge1xuICAgIGNvbnN0IG91dGRpciA9IGFyZ3ZbJ2dvbGFuZy1vdXRkaXInXTtcbiAgICBjb25zdCBtb2R1bGUgPSBhcmd2Wydnb2xhbmctbW9kdWxlJ107XG4gICAgY29uc3QgcGFja2FnZU5hbWUgPSBhcmd2Wydnb2xhbmctcGFja2FnZSddO1xuICAgIGlmICghb3V0ZGlyICYmICFtb2R1bGUpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfVxuICAgIGlmICghb3V0ZGlyKSB7IHRocm93IG5ldyBFcnJvcignLS1nb2xhbmctb3V0ZGlyIGlzIHJlcXVpcmVkJyk7IH1cbiAgICBpZiAoIW1vZHVsZSkgeyB0aHJvdyBuZXcgRXJyb3IoJy0tZ29sYW5nLW1vZHVsZSBpcyByZXF1aXJlZCcpOyB9XG4gICAgaWYgKCFwYWNrYWdlTmFtZSkgeyB0aHJvdyBuZXcgRXJyb3IoJy0tZ29sYW5nLXBhY2thZ2UgaXMgcmVxdWlyZWQnKTsgfVxuICAgIHJldHVybiB7XG4gICAgICBnb2xhbmc6IHtcbiAgICAgICAgb3V0ZGlyOiBvdXRkaXIsXG4gICAgICAgIG1vZHVsZU5hbWU6IG1vZHVsZSxcbiAgICAgICAgcGFja2FnZU5hbWU6IHBhY2thZ2VOYW1lLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VEZXBPcHRpb24oKSB7XG4gICAgaWYgKGFyZ3YuZGVwPy5sZW5ndGggPT09IDApIHsgcmV0dXJuIHVuZGVmaW5lZDsgfVxuICAgIHJldHVybiB7XG4gICAgICBkZXBzOiBhcmd2LmRlcCxcbiAgICB9O1xuICB9XG59XG5cbm1haW4oKS5jYXRjaCgoZTogRXJyb3IpID0+IHtcbiAgY29uc29sZS5lcnJvcihlLnN0YWNrKTtcbiAgcHJvY2Vzcy5leGl0KDEpO1xufSk7XG5cbiJdfQ==