"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TypeSystemTree = void 0;
const spec_1 = require("@jsii/spec");
const colors = require("colors/safe");
const oo_ascii_tree_1 = require("oo-ascii-tree");
const method_1 = require("./method");
const optional_value_1 = require("./optional-value");
const property_1 = require("./property");
/**
 * Visualizes a `TypeSystem` as an ASCII tree.
 */
class TypeSystemTree extends oo_ascii_tree_1.AsciiTree {
    constructor(typesys, options = {}) {
        super();
        if (options.showAll) {
            options.dependencies = true;
            options.inheritance = true;
            options.members = true;
            options.signatures = true;
            options.types = true;
        }
        const shouldUseColors = options.colors === undefined ? true : options.colors;
        withColors(shouldUseColors, () => {
            if (typesys.assemblies.length > 0) {
                const assemblies = new TitleNode('assemblies');
                assemblies.add(...typesys.assemblies.map((a) => new AssemblyNode(a, options)));
                this.add(assemblies);
            }
        });
    }
}
exports.TypeSystemTree = TypeSystemTree;
class AssemblyNode extends oo_ascii_tree_1.AsciiTree {
    constructor(assembly, options) {
        super(colors.green(assembly.name));
        if (options.dependencies && assembly.dependencies.length > 0) {
            const deps = new TitleNode('dependencies');
            this.add(deps);
            deps.add(...assembly.dependencies.map((d) => new DependencyNode(d, options)));
        }
        const submodules = assembly.submodules;
        if (submodules.length > 0) {
            const title = new TitleNode('submodules');
            this.add(title);
            title.add(...submodules.map((s) => new SubmoduleNode(s, options)));
        }
        if (options.types) {
            const types = new TitleNode('types');
            this.add(types);
            types.add(...assembly.classes.map((c) => new ClassNode(c, options)));
            types.add(...assembly.interfaces.map((c) => new InterfaceNode(c, options)));
            types.add(...assembly.enums.map((c) => new EnumNode(c, options)));
        }
    }
}
class SubmoduleNode extends oo_ascii_tree_1.AsciiTree {
    constructor(submodule, options) {
        super(colors.green(submodule.name));
        const submodules = submodule.submodules;
        if (submodules.length > 0) {
            const title = new TitleNode('submodules');
            this.add(title);
            title.add(...submodules.map((s) => new SubmoduleNode(s, options)));
        }
        if (options.types) {
            const types = new TitleNode('types');
            this.add(types);
            types.add(...submodule.classes.map((c) => new ClassNode(c, options)));
            types.add(...submodule.interfaces.map((i) => new InterfaceNode(i, options)));
            types.add(...submodule.enums.map((e) => new EnumNode(e, options)));
        }
    }
}
class MethodNode extends oo_ascii_tree_1.AsciiTree {
    constructor(method, options) {
        const args = method.parameters.map((p) => p.name).join(',');
        super(`${maybeStatic(method)}${method.name}(${args}) ${colors.gray('method')}${describeStability(method, options)}`);
        if (options.signatures) {
            if (method.abstract) {
                this.add(new FlagNode('abstract'));
            }
            if (method.protected) {
                this.add(new FlagNode('protected'));
            }
            if (method.static) {
                this.add(new FlagNode('static'));
            }
            if (method.variadic) {
                this.add(new FlagNode('variadic'));
            }
            if (method.parameters.length > 0) {
                const params = new TitleNode('parameters');
                this.add(params);
                params.add(...method.parameters.map((p) => new ParameterNode(p, options)));
            }
            this.add(new OptionalValueNode('returns', method.returns, {
                asPromise: method.async,
            }));
        }
    }
}
class InitializerNode extends oo_ascii_tree_1.AsciiTree {
    constructor(initializer, options) {
        const args = initializer.parameters.map((p) => p.name).join(',');
        super(`${initializer.name}(${args}) ${colors.gray('initializer')}${describeStability(initializer, options)}`);
        if (options.signatures) {
            if (initializer.protected) {
                this.add(new FlagNode('protected'));
            }
            if (initializer.variadic) {
                this.add(new FlagNode('variadic'));
            }
            if (initializer.parameters.length > 0) {
                const params = new TitleNode('parameters');
                this.add(params);
                params.add(...initializer.parameters.map((p) => new ParameterNode(p, options)));
            }
        }
    }
}
class ParameterNode extends oo_ascii_tree_1.AsciiTree {
    constructor(param, _options) {
        super(param.name);
        this.add(new OptionalValueNode('type', param));
        if (param.variadic) {
            this.add(new FlagNode('variadic'));
        }
    }
}
class PropertyNode extends oo_ascii_tree_1.AsciiTree {
    constructor(property, options) {
        super(`${maybeStatic(property)}${property.name} ${colors.gray('property')}${describeStability(property, options)}`);
        if (options.signatures) {
            if (property.abstract) {
                this.add(new FlagNode('abstract'));
            }
            if (property.const) {
                this.add(new FlagNode('const'));
            }
            if (property.immutable) {
                this.add(new FlagNode('immutable'));
            }
            if (property.protected) {
                this.add(new FlagNode('protected'));
            }
            if (property.static) {
                this.add(new FlagNode('static'));
            }
            this.add(new OptionalValueNode('type', property));
        }
    }
}
class OptionalValueNode extends oo_ascii_tree_1.AsciiTree {
    constructor(name, optionalValue, { asPromise } = { asPromise: false }) {
        let type = optional_value_1.OptionalValue.describe(optionalValue);
        if (asPromise) {
            type = `Promise<${type}>`;
        }
        super(`${colors.underline(name)}: ${type}`);
    }
}
class ClassNode extends oo_ascii_tree_1.AsciiTree {
    constructor(type, options) {
        super(`${colors.gray('class')} ${colors.cyan(type.name)}${describeStability(type, options)}`);
        if (options.inheritance && type.base) {
            this.add(new KeyValueNode('base', type.base.name));
        }
        if (options.inheritance && type.interfaces.length > 0) {
            this.add(new KeyValueNode('interfaces', type.interfaces.map((i) => i.name).join(',')));
        }
        if (options.members) {
            const members = new TitleNode('members');
            this.add(members);
            if (type.initializer) {
                members.add(new InitializerNode(type.initializer, options));
            }
            members.add(...type.ownMethods.map((m) => new MethodNode(m, options)));
            members.add(...type.ownProperties.map((p) => new PropertyNode(p, options)));
        }
    }
}
class InterfaceNode extends oo_ascii_tree_1.AsciiTree {
    constructor(type, options) {
        super(`${colors.gray('interface')} ${colors.cyan(type.name)}${describeStability(type, options)}`);
        if (options.inheritance && type.interfaces.length > 0) {
            const interfaces = new TitleNode('interfaces');
            this.add(interfaces);
            interfaces.add(...type.interfaces.map((i) => new TextNode(i.name)));
        }
        if (options.members) {
            const members = new TitleNode('members');
            members.add(...type.ownMethods.map((m) => new MethodNode(m, options)));
            members.add(...type.ownProperties.map((p) => new PropertyNode(p, options)));
            this.add(members);
        }
    }
}
class EnumNode extends oo_ascii_tree_1.AsciiTree {
    constructor(enumType, options) {
        super(`${colors.gray('enum')} ${colors.cyan(enumType.name)}${describeStability(enumType, options)}`);
        if (options.members) {
            enumType.members.forEach((mem) => {
                this.add(new oo_ascii_tree_1.AsciiTree(mem.name + describeStability(mem, options)));
            });
        }
    }
}
class DependencyNode extends oo_ascii_tree_1.AsciiTree {
    constructor(dep, _options) {
        super(dep.assembly.name);
    }
}
class TitleNode extends oo_ascii_tree_1.AsciiTree {
    constructor(name, children = []) {
        super(colors.underline(name), ...children);
    }
}
class KeyValueNode extends oo_ascii_tree_1.AsciiTree {
    constructor(key, value) {
        super(`${colors.underline(key)}: ${value}`);
    }
}
class TextNode extends oo_ascii_tree_1.AsciiTree {
}
class FlagNode extends oo_ascii_tree_1.AsciiTree {
    constructor(flag) {
        super(colors.italic(flag));
    }
}
/**
 * Invokes `block` with colors enabled/disabled and reverts to old value afterwards.
 */
function withColors(enabled, block) {
    const oldEnabled = colors.enabled;
    try {
        if (enabled) {
            colors.enable();
        }
        else {
            colors.disable();
        }
        block();
    }
    finally {
        if (oldEnabled) {
            colors.enable();
        }
        else {
            colors.disable();
        }
    }
}
function describeStability(thing, options) {
    if (!options.stabilities || thing.docs.stability == null) {
        return '';
    }
    switch (thing.docs.stability) {
        case spec_1.Stability.Stable:
            return ` (${colors.green('stable')})`;
        case spec_1.Stability.External:
            return ` (${colors.green('external')})`;
        case spec_1.Stability.Experimental:
            return ` (${colors.yellow('experimental')})`;
        case spec_1.Stability.Deprecated:
            return ` (${colors.red('deprecated')})`;
        default:
            return '';
    }
}
function maybeStatic(mem) {
    let isStatic;
    if (mem instanceof property_1.Property) {
        isStatic = !!mem.static;
    }
    if (mem instanceof method_1.Method) {
        isStatic = !!mem.static;
    }
    return isStatic ? `${colors.grey('static')} ` : '';
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRyZWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEscUNBQXVDO0FBQ3ZDLHNDQUFzQztBQUN0QyxpREFBMEM7QUFTMUMscUNBQWtDO0FBQ2xDLHFEQUFpRDtBQUVqRCx5Q0FBc0M7QUF1RHRDOztHQUVHO0FBQ0gsTUFBYSxjQUFlLFNBQVEseUJBQVM7SUFDM0MsWUFBbUIsT0FBbUIsRUFBRSxVQUFpQyxFQUFFO1FBQ3pFLEtBQUssRUFBRSxDQUFDO1FBRVIsSUFBSSxPQUFPLENBQUMsT0FBTyxFQUFFO1lBQ25CLE9BQU8sQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO1lBQzVCLE9BQU8sQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1lBQzNCLE9BQU8sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1lBQ3ZCLE9BQU8sQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO1lBQzFCLE9BQU8sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1NBQ3RCO1FBRUQsTUFBTSxlQUFlLEdBQ25CLE9BQU8sQ0FBQyxNQUFNLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUM7UUFDdkQsVUFBVSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7WUFDL0IsSUFBSSxPQUFPLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQ2pDLE1BQU0sVUFBVSxHQUFHLElBQUksU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUMvQyxVQUFVLENBQUMsR0FBRyxDQUNaLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksWUFBWSxDQUFDLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUMvRCxDQUFDO2dCQUNGLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7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Q0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO0tBQ3pCO0lBRUQsT0FBTyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFDckQsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN0YWJpbGl0eSB9IGZyb20gJ0Bqc2lpL3NwZWMnO1xuaW1wb3J0ICogYXMgY29sb3JzIGZyb20gJ2NvbG9ycy9zYWZlJztcbmltcG9ydCB7IEFzY2lpVHJlZSB9IGZyb20gJ29vLWFzY2lpLXRyZWUnO1xuXG5pbXBvcnQgeyBBc3NlbWJseSB9IGZyb20gJy4vYXNzZW1ibHknO1xuaW1wb3J0IHsgQ2xhc3NUeXBlIH0gZnJvbSAnLi9jbGFzcyc7XG5pbXBvcnQgeyBEZXBlbmRlbmN5IH0gZnJvbSAnLi9kZXBlbmRlbmN5JztcbmltcG9ydCB7IERvY3VtZW50YWJsZSB9IGZyb20gJy4vZG9jcyc7XG5pbXBvcnQgeyBFbnVtVHlwZSB9IGZyb20gJy4vZW51bSc7XG5pbXBvcnQgeyBJbml0aWFsaXplciB9IGZyb20gJy4vaW5pdGlhbGl6ZXInO1xuaW1wb3J0IHsgSW50ZXJmYWNlVHlwZSB9IGZyb20gJy4vaW50ZXJmYWNlJztcbmltcG9ydCB7IE1ldGhvZCB9IGZyb20gJy4vbWV0aG9kJztcbmltcG9ydCB7IE9wdGlvbmFsVmFsdWUgfSBmcm9tICcuL29wdGlvbmFsLXZhbHVlJztcbmltcG9ydCB7IFBhcmFtZXRlciB9IGZyb20gJy4vcGFyYW1ldGVyJztcbmltcG9ydCB7IFByb3BlcnR5IH0gZnJvbSAnLi9wcm9wZXJ0eSc7XG5pbXBvcnQgeyBTdWJtb2R1bGUgfSBmcm9tICcuL3N1Ym1vZHVsZSc7XG5pbXBvcnQgeyBUeXBlU3lzdGVtIH0gZnJvbSAnLi90eXBlLXN5c3RlbSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVHlwZVN5c3RlbVRyZWVPcHRpb25zIHtcbiAgLyoqXG4gICAqIFNob3cgYWxsIGVudGl0eSB0eXBlcyAoc3VwZXJzZWRlcyBvdGhlciBvcHRpb25zKVxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKi9cbiAgc2hvd0FsbD86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFNob3cgdHlwZSBtZW1iZXJzIChtZXRob2RzLCBwcm9wZXJ0aWVzKVxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKi9cbiAgbWVtYmVycz86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFNob3cgZGVwZW5kZW5jaWVzXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICBkZXBlbmRlbmNpZXM/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBTaG93IGluaGVyaXRhbmNlIGluZm9ybWF0aW9uIChiYXNlIGNsYXNzZXMsIGludGVyZmFjZXMpXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICBpbmhlcml0YW5jZT86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFNob3cgdHlwZXNcbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHR5cGVzPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogU2hvdyBtZXRob2Qgc2lnbmF0dXJlcy5cbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHNpZ25hdHVyZXM/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBPdXRwdXQgd2l0aCBBTlNJIGNvbG9yc1xuICAgKiBAZGVmYXVsdCB0cnVlXG4gICAqL1xuICBjb2xvcnM/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBTaG93IHN0YWJpbGl0aWVzXG4gICAqXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICBzdGFiaWxpdGllcz86IGJvb2xlYW47XG59XG5cbi8qKlxuICogVmlzdWFsaXplcyBhIGBUeXBlU3lzdGVtYCBhcyBhbiBBU0NJSSB0cmVlLlxuICovXG5leHBvcnQgY2xhc3MgVHlwZVN5c3RlbVRyZWUgZXh0ZW5kcyBBc2NpaVRyZWUge1xuICBwdWJsaWMgY29uc3RydWN0b3IodHlwZXN5czogVHlwZVN5c3RlbSwgb3B0aW9uczogVHlwZVN5c3RlbVRyZWVPcHRpb25zID0ge30pIHtcbiAgICBzdXBlcigpO1xuXG4gICAgaWYgKG9wdGlvbnMuc2hvd0FsbCkge1xuICAgICAgb3B0aW9ucy5kZXBlbmRlbmNpZXMgPSB0cnVlO1xuICAgICAgb3B0aW9ucy5pbmhlcml0YW5jZSA9IHRydWU7XG4gICAgICBvcHRpb25zLm1lbWJlcnMgPSB0cnVlO1xuICAgICAgb3B0aW9ucy5zaWduYXR1cmVzID0gdHJ1ZTtcbiAgICAgIG9wdGlvbnMudHlwZXMgPSB0cnVlO1xuICAgIH1cblxuICAgIGNvbnN0IHNob3VsZFVzZUNvbG9ycyA9XG4gICAgICBvcHRpb25zLmNvbG9ycyA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IG9wdGlvbnMuY29sb3JzO1xuICAgIHdpdGhDb2xvcnMoc2hvdWxkVXNlQ29sb3JzLCAoKSA9PiB7XG4gICAgICBpZiAodHlwZXN5cy5hc3NlbWJsaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgYXNzZW1ibGllcyA9IG5ldyBUaXRsZU5vZGUoJ2Fzc2VtYmxpZXMnKTtcbiAgICAgICAgYXNzZW1ibGllcy5hZGQoXG4gICAgICAgICAgLi4udHlwZXN5cy5hc3NlbWJsaWVzLm1hcCgoYSkgPT4gbmV3IEFzc2VtYmx5Tm9kZShhLCBvcHRpb25zKSksXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuYWRkKGFzc2VtYmxpZXMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG5cbmNsYXNzIEFzc2VtYmx5Tm9kZSBleHRlbmRzIEFzY2lpVHJlZSB7XG4gIHB1YmxpYyBjb25zdHJ1Y3Rvcihhc3NlbWJseTogQXNzZW1ibHksIG9wdGlvbnM6IFR5cGVTeXN0ZW1UcmVlT3B0aW9ucykge1xuICAgIHN1cGVyKGNvbG9ycy5ncmVlbihhc3NlbWJseS5uYW1lKSk7XG5cbiAgICBpZiAob3B0aW9ucy5kZXBlbmRlbmNpZXMgJiYgYXNzZW1ibHkuZGVwZW5kZW5jaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGRlcHMgPSBuZXcgVGl0bGVOb2RlKCdkZXBlbmRlbmNpZXMnKTtcbiAgICAgIHRoaXMuYWRkKGRlcHMpO1xuICAgICAgZGVwcy5hZGQoXG4gICAgICAgIC4uLmFzc2VtYmx5LmRlcGVuZGVuY2llcy5tYXAoKGQpID0+IG5ldyBEZXBlbmRlbmN5Tm9kZShkLCBvcHRpb25zKSksXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHN1Ym1vZHVsZXMgPSBhc3NlbWJseS5zdWJtb2R1bGVzO1xuICAgIGlmIChzdWJtb2R1bGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHRpdGxlID0gbmV3IFRpdGxlTm9kZSgnc3VibW9kdWxlcycpO1xuICAgICAgdGhpcy5hZGQodGl0bGUpO1xuICAgICAgdGl0bGUuYWRkKC4uLnN1Ym1vZHVsZXMubWFwKChzKSA9PiBuZXcgU3VibW9kdWxlTm9kZShzLCBvcHRpb25zKSkpO1xuICAgIH1cblxuICAgIGlmIChvcHRpb25zLnR5cGVzKSB7XG4gICAgICBjb25zdCB0eXBlcyA9IG5ldyBUaXRsZU5vZGUoJ3R5cGVzJyk7XG4gICAgICB0aGlzLmFkZCh0eXBlcyk7XG4gICAgICB0eXBlcy5hZGQoLi4uYXNzZW1ibHkuY2xhc3Nlcy5tYXAoKGMpID0+IG5ldyBDbGFzc05vZGUoYywgb3B0aW9ucykpKTtcbiAgICAgIHR5cGVzLmFkZChcbiAgICAgICAgLi4uYXNzZW1ibHkuaW50ZXJmYWNlcy5tYXAoKGMpID0+IG5ldyBJbnRlcmZhY2VOb2RlKGMsIG9wdGlvbnMpKSxcbiAgICAgICk7XG4gICAgICB0eXBlcy5hZGQoLi4uYXNzZW1ibHkuZW51bXMubWFwKChjKSA9PiBuZXcgRW51bU5vZGUoYywgb3B0aW9ucykpKTtcbiAgICB9XG4gIH1cbn1cblxuY2xhc3MgU3VibW9kdWxlTm9kZSBleHRlbmRzIEFzY2lpVHJlZSB7XG4gIHB1YmxpYyBjb25zdHJ1Y3RvcihzdWJtb2R1bGU6IFN1Ym1vZHVsZSwgb3B0aW9uczogVHlwZVN5c3RlbVRyZWVPcHRpb25zKSB7XG4gICAgc3VwZXIoY29sb3JzLmdyZWVuKHN1Ym1vZHVsZS5uYW1lKSk7XG5cbiAgICBjb25zdCBzdWJtb2R1bGVzID0gc3VibW9kdWxlLnN1Ym1vZHVsZXM7XG4gICAgaWYgKHN1Ym1vZHVsZXMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgdGl0bGUgPSBuZXcgVGl0bGVOb2RlKCdzdWJtb2R1bGVzJyk7XG4gICAgICB0aGlzLmFkZCh0aXRsZSk7XG4gICAgICB0aXRsZS5hZGQoLi4uc3VibW9kdWxlcy5tYXAoKHMpID0+IG5ldyBTdWJtb2R1bGVOb2RlKHMsIG9wdGlvbnMpKSk7XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMudHlwZXMpIHtcbiAgICAgIGNvbnN0IHR5cGVzID0gbmV3IFRpdGxlTm9kZSgndHlwZXMnKTtcbiAgICAgIHRoaXMuYWRkKHR5cGVzKTtcbiAgICAgIHR5cGVzLmFkZCguLi5zdWJtb2R1bGUuY2xhc3Nlcy5tYXAoKGMpID0+IG5ldyBDbGFzc05vZGUoYywgb3B0aW9ucykpKTtcbiAgICAgIHR5cGVzLmFkZChcbiAgICAgICAgLi4uc3VibW9kdWxlLmludGVyZmFjZXMubWFwKChpKSA9PiBuZXcgSW50ZXJmYWNlTm9kZShpLCBvcHRpb25zKSksXG4gICAgICApO1xuICAgICAgdHlwZXMuYWRkKC4uLnN1Ym1vZHVsZS5lbnVtcy5tYXAoKGUpID0+IG5ldyBFbnVtTm9kZShlLCBvcHRpb25zKSkpO1xuICAgIH1cbiAgfVxufVxuXG5jbGFzcyBNZXRob2ROb2RlIGV4dGVuZHMgQXNjaWlUcmVlIHtcbiAgcHVibGljIGNvbnN0cnVjdG9yKG1ldGhvZDogTWV0aG9kLCBvcHRpb25zOiBUeXBlU3lzdGVtVHJlZU9wdGlvbnMpIHtcbiAgICBjb25zdCBhcmdzID0gbWV0aG9kLnBhcmFtZXRlcnMubWFwKChwKSA9PiBwLm5hbWUpLmpvaW4oJywnKTtcbiAgICBzdXBlcihcbiAgICAgIGAke21heWJlU3RhdGljKG1ldGhvZCl9JHttZXRob2QubmFtZX0oJHthcmdzfSkgJHtjb2xvcnMuZ3JheShcbiAgICAgICAgJ21ldGhvZCcsXG4gICAgICApfSR7ZGVzY3JpYmVTdGFiaWxpdHkobWV0aG9kLCBvcHRpb25zKX1gLFxuICAgICk7XG5cbiAgICBpZiAob3B0aW9ucy5zaWduYXR1cmVzKSB7XG4gICAgICBpZiAobWV0aG9kLmFic3RyYWN0KSB7XG4gICAgICAgIHRoaXMuYWRkKG5ldyBGbGFnTm9kZSgnYWJzdHJhY3QnKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChtZXRob2QucHJvdGVjdGVkKSB7XG4gICAgICAgIHRoaXMuYWRkKG5ldyBGbGFnTm9kZSgncHJvdGVjdGVkJykpO1xuICAgICAgfVxuXG4gICAgICBpZiAobWV0aG9kLnN0YXRpYykge1xuICAgICAgICB0aGlzLmFkZChuZXcgRmxhZ05vZGUoJ3N0YXRpYycpKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG1ldGhvZC52YXJpYWRpYykge1xuICAgICAgICB0aGlzLmFkZChuZXcgRmxhZ05vZGUoJ3ZhcmlhZGljJykpO1xuICAgICAgfVxuXG4gICAgICBpZiAobWV0aG9kLnBhcmFtZXRlcnMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBwYXJhbXMgPSBuZXcgVGl0bGVOb2RlKCdwYXJhbWV0ZXJzJyk7XG4gICAgICAgIHRoaXMuYWRkKHBhcmFtcyk7XG4gICAgICAgIHBhcmFtcy5hZGQoXG4gICAgICAgICAgLi4ubWV0aG9kLnBhcmFtZXRlcnMubWFwKChwKSA9PiBuZXcgUGFyYW1ldGVyTm9kZShwLCBvcHRpb25zKSksXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuYWRkKFxuICAgICAgICBuZXcgT3B0aW9uYWxWYWx1ZU5vZGUoJ3JldHVybnMnLCBtZXRob2QucmV0dXJucywge1xuICAgICAgICAgIGFzUHJvbWlzZTogbWV0aG9kLmFzeW5jLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfVxuICB9XG59XG5cbmNsYXNzIEluaXRpYWxpemVyTm9kZSBleHRlbmRzIEFzY2lpVHJlZSB7XG4gIHB1YmxpYyBjb25zdHJ1Y3Rvcihpbml0aWFsaXplcjogSW5pdGlhbGl6ZXIsIG9wdGlvbnM6IFR5cGVTeXN0ZW1UcmVlT3B0aW9ucykge1xuICAgIGNvbnN0IGFyZ3MgPSBpbml0aWFsaXplci5wYXJhbWV0ZXJzLm1hcCgocCkgPT4gcC5uYW1lKS5qb2luKCcsJyk7XG4gICAgc3VwZXIoXG4gICAgICBgJHtpbml0aWFsaXplci5uYW1lfSgke2FyZ3N9KSAke2NvbG9ycy5ncmF5KFxuICAgICAgICAnaW5pdGlhbGl6ZXInLFxuICAgICAgKX0ke2Rlc2NyaWJlU3RhYmlsaXR5KGluaXRpYWxpemVyLCBvcHRpb25zKX1gLFxuICAgICk7XG5cbiAgICBpZiAob3B0aW9ucy5zaWduYXR1cmVzKSB7XG4gICAgICBpZiAoaW5pdGlhbGl6ZXIucHJvdGVjdGVkKSB7XG4gICAgICAgIHRoaXMuYWRkKG5ldyBGbGFnTm9kZSgncHJvdGVjdGVkJykpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaW5pdGlhbGl6ZXIudmFyaWFkaWMpIHtcbiAgICAgICAgdGhpcy5hZGQobmV3IEZsYWdOb2RlKCd2YXJpYWRpYycpKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGluaXRpYWxpemVyLnBhcmFtZXRlcnMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBwYXJhbXMgPSBuZXcgVGl0bGVOb2RlKCdwYXJhbWV0ZXJzJyk7XG4gICAgICAgIHRoaXMuYWRkKHBhcmFtcyk7XG4gICAgICAgIHBhcmFtcy5hZGQoXG4gICAgICAgICAgLi4uaW5pdGlhbGl6ZXIucGFyYW1ldGVycy5tYXAoKHApID0+IG5ldyBQYXJhbWV0ZXJOb2RlKHAsIG9wdGlvbnMpKSxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuY2xhc3MgUGFyYW1ldGVyTm9kZSBleHRlbmRzIEFzY2lpVHJlZSB7XG4gIHB1YmxpYyBjb25zdHJ1Y3RvcihwYXJhbTogUGFyYW1ldGVyLCBfb3B0aW9uczogVHlwZVN5c3RlbVRyZWVPcHRpb25zKSB7XG4gICAgc3VwZXIocGFyYW0ubmFtZSk7XG5cbiAgICB0aGlzLmFkZChuZXcgT3B0aW9uYWxWYWx1ZU5vZGUoJ3R5cGUnLCBwYXJhbSkpO1xuICAgIGlmIChwYXJhbS52YXJpYWRpYykge1xuICAgICAgdGhpcy5hZGQobmV3IEZsYWdOb2RlKCd2YXJpYWRpYycpKTtcbiAgICB9XG4gIH1cbn1cblxuY2xhc3MgUHJvcGVydHlOb2RlIGV4dGVuZHMgQXNjaWlUcmVlIHtcbiAgcHVibGljIGNvbnN0cnVjdG9yKHByb3BlcnR5OiBQcm9wZXJ0eSwgb3B0aW9uczogVHlwZVN5c3RlbVRyZWVPcHRpb25zKSB7XG4gICAgc3VwZXIoXG4gICAgICBgJHttYXliZVN0YXRpYyhwcm9wZXJ0eSl9JHtwcm9wZXJ0eS5uYW1lfSAke2NvbG9ycy5ncmF5KFxuICAgICAgICAncHJvcGVydHknLFxuICAgICAgKX0ke2Rlc2NyaWJlU3RhYmlsaXR5KHByb3BlcnR5LCBvcHRpb25zKX1gLFxuICAgICk7XG5cbiAgICBpZiAob3B0aW9ucy5zaWduYXR1cmVzKSB7XG4gICAgICBpZiAocHJvcGVydHkuYWJzdHJhY3QpIHtcbiAgICAgICAgdGhpcy5hZGQobmV3IEZsYWdOb2RlKCdhYnN0cmFjdCcpKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHByb3BlcnR5LmNvbnN0KSB7XG4gICAgICAgIHRoaXMuYWRkKG5ldyBGbGFnTm9kZSgnY29uc3QnKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChwcm9wZXJ0eS5pbW11dGFibGUpIHtcbiAgICAgICAgdGhpcy5hZGQobmV3IEZsYWdOb2RlKCdpbW11dGFibGUnKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChwcm9wZXJ0eS5wcm90ZWN0ZWQpIHtcbiAgICAgICAgdGhpcy5hZGQobmV3IEZsYWdOb2RlKCdwcm90ZWN0ZWQnKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChwcm9wZXJ0eS5zdGF0aWMpIHtcbiAgICAgICAgdGhpcy5hZGQobmV3IEZsYWdOb2RlKCdzdGF0aWMnKSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuYWRkKG5ldyBPcHRpb25hbFZhbHVlTm9kZSgndHlwZScsIHByb3BlcnR5KSk7XG4gICAgfVxuICB9XG59XG5cbmNsYXNzIE9wdGlvbmFsVmFsdWVOb2RlIGV4dGVuZHMgQXNjaWlUcmVlIHtcbiAgcHVibGljIGNvbnN0cnVjdG9yKFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBvcHRpb25hbFZhbHVlOiBPcHRpb25hbFZhbHVlLFxuICAgIHsgYXNQcm9taXNlIH0gPSB7IGFzUHJvbWlzZTogZmFsc2UgfSxcbiAgKSB7XG4gICAgbGV0IHR5cGUgPSBPcHRpb25hbFZhbHVlLmRlc2NyaWJlKG9wdGlvbmFsVmFsdWUpO1xuICAgIGlmIChhc1Byb21pc2UpIHtcbiAgICAgIHR5cGUgPSBgUHJvbWlzZTwke3R5cGV9PmA7XG4gICAgfVxuICAgIHN1cGVyKGAke2NvbG9ycy51bmRlcmxpbmUobmFtZSl9OiAke3R5cGV9YCk7XG4gIH1cbn1cblxuY2xhc3MgQ2xhc3NOb2RlIGV4dGVuZHMgQXNjaWlUcmVlIHtcbiAgcHVibGljIGNvbnN0cnVjdG9yKHR5cGU6IENsYXNzVHlwZSwgb3B0aW9uczogVHlwZVN5c3RlbVRyZWVPcHRpb25zKSB7XG4gICAgc3VwZXIoXG4gICAgICBgJHtjb2xvcnMuZ3JheSgnY2xhc3MnKX0gJHtjb2xvcnMuY3lhbih0eXBlLm5hbWUpfSR7ZGVzY3JpYmVTdGFiaWxpdHkoXG4gICAgICAgIHR5cGUsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICApfWAsXG4gICAgKTtcblxuICAgIGlmIChvcHRpb25zLmluaGVyaXRhbmNlICYmIHR5cGUuYmFzZSkge1xuICAgICAgdGhpcy5hZGQobmV3IEtleVZhbHVlTm9kZSgnYmFzZScsIHR5cGUuYmFzZS5uYW1lKSk7XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMuaW5oZXJpdGFuY2UgJiYgdHlwZS5pbnRlcmZhY2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuYWRkKFxuICAgICAgICBuZXcgS2V5VmFsdWVOb2RlKFxuICAgICAgICAgICdpbnRlcmZhY2VzJyxcbiAgICAgICAgICB0eXBlLmludGVyZmFjZXMubWFwKChpKSA9PiBpLm5hbWUpLmpvaW4oJywnKSxcbiAgICAgICAgKSxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMubWVtYmVycykge1xuICAgICAgY29uc3QgbWVtYmVycyA9IG5ldyBUaXRsZU5vZGUoJ21lbWJlcnMnKTtcbiAgICAgIHRoaXMuYWRkKG1lbWJlcnMpO1xuICAgICAgaWYgKHR5cGUuaW5pdGlhbGl6ZXIpIHtcbiAgICAgICAgbWVtYmVycy5hZGQobmV3IEluaXRpYWxpemVyTm9kZSh0eXBlLmluaXRpYWxpemVyLCBvcHRpb25zKSk7XG4gICAgICB9XG4gICAgICBtZW1iZXJzLmFkZCguLi50eXBlLm93bk1ldGhvZHMubWFwKChtKSA9PiBuZXcgTWV0aG9kTm9kZShtLCBvcHRpb25zKSkpO1xuICAgICAgbWVtYmVycy5hZGQoXG4gICAgICAgIC4uLnR5cGUub3duUHJvcGVydGllcy5tYXAoKHApID0+IG5ldyBQcm9wZXJ0eU5vZGUocCwgb3B0aW9ucykpLFxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cblxuY2xhc3MgSW50ZXJmYWNlTm9kZSBleHRlbmRzIEFzY2lpVHJlZSB7XG4gIHB1YmxpYyBjb25zdHJ1Y3Rvcih0eXBlOiBJbnRlcmZhY2VUeXBlLCBvcHRpb25zOiBUeXBlU3lzdGVtVHJlZU9wdGlvbnMpIHtcbiAgICBzdXBlcihcbiAgICAgIGAke2NvbG9ycy5ncmF5KCdpbnRlcmZhY2UnKX0gJHtjb2xvcnMuY3lhbih0eXBlLm5hbWUpfSR7ZGVzY3JpYmVTdGFiaWxpdHkoXG4gICAgICAgIHR5cGUsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICApfWAsXG4gICAgKTtcblxuICAgIGlmIChvcHRpb25zLmluaGVyaXRhbmNlICYmIHR5cGUuaW50ZXJmYWNlcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBpbnRlcmZhY2VzID0gbmV3IFRpdGxlTm9kZSgnaW50ZXJmYWNlcycpO1xuICAgICAgdGhpcy5hZGQoaW50ZXJmYWNlcyk7XG4gICAgICBpbnRlcmZhY2VzLmFkZCguLi50eXBlLmludGVyZmFjZXMubWFwKChpKSA9PiBuZXcgVGV4dE5vZGUoaS5uYW1lKSkpO1xuICAgIH1cblxuICAgIGlmIChvcHRpb25zLm1lbWJlcnMpIHtcbiAgICAgIGNvbnN0IG1lbWJlcnMgPSBuZXcgVGl0bGVOb2RlKCdtZW1iZXJzJyk7XG4gICAgICBtZW1iZXJzLmFkZCguLi50eXBlLm93bk1ldGhvZHMubWFwKChtKSA9PiBuZXcgTWV0aG9kTm9kZShtLCBvcHRpb25zKSkpO1xuICAgICAgbWVtYmVycy5hZGQoXG4gICAgICAgIC4uLnR5cGUub3duUHJvcGVydGllcy5tYXAoKHApID0+IG5ldyBQcm9wZXJ0eU5vZGUocCwgb3B0aW9ucykpLFxuICAgICAgKTtcbiAgICAgIHRoaXMuYWRkKG1lbWJlcnMpO1xuICAgIH1cbiAgfVxufVxuXG5jbGFzcyBFbnVtTm9kZSBleHRlbmRzIEFzY2lpVHJlZSB7XG4gIHB1YmxpYyBjb25zdHJ1Y3RvcihlbnVtVHlwZTogRW51bVR5cGUsIG9wdGlvbnM6IFR5cGVTeXN0ZW1UcmVlT3B0aW9ucykge1xuICAgIHN1cGVyKFxuICAgICAgYCR7Y29sb3JzLmdyYXkoJ2VudW0nKX0gJHtjb2xvcnMuY3lhbihlbnVtVHlwZS5uYW1lKX0ke2Rlc2NyaWJlU3RhYmlsaXR5KFxuICAgICAgICBlbnVtVHlwZSxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICl9YCxcbiAgICApO1xuXG4gICAgaWYgKG9wdGlvbnMubWVtYmVycykge1xuICAgICAgZW51bVR5cGUubWVtYmVycy5mb3JFYWNoKChtZW0pID0+IHtcbiAgICAgICAgdGhpcy5hZGQobmV3IEFzY2lpVHJlZShtZW0ubmFtZSArIGRlc2NyaWJlU3RhYmlsaXR5KG1lbSwgb3B0aW9ucykpKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuXG5jbGFzcyBEZXBlbmRlbmN5Tm9kZSBleHRlbmRzIEFzY2lpVHJlZSB7XG4gIHB1YmxpYyBjb25zdHJ1Y3RvcihkZXA6IERlcGVuZGVuY3ksIF9vcHRpb25zOiBUeXBlU3lzdGVtVHJlZU9wdGlvbnMpIHtcbiAgICBzdXBlcihkZXAuYXNzZW1ibHkubmFtZSk7XG4gIH1cbn1cblxuY2xhc3MgVGl0bGVOb2RlIGV4dGVuZHMgQXNjaWlUcmVlIHtcbiAgcHVibGljIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZywgY2hpbGRyZW46IEFzY2lpVHJlZVtdID0gW10pIHtcbiAgICBzdXBlcihjb2xvcnMudW5kZXJsaW5lKG5hbWUpLCAuLi5jaGlsZHJlbik7XG4gIH1cbn1cblxuY2xhc3MgS2V5VmFsdWVOb2RlIGV4dGVuZHMgQXNjaWlUcmVlIHtcbiAgcHVibGljIGNvbnN0cnVjdG9yKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gICAgc3VwZXIoYCR7Y29sb3JzLnVuZGVybGluZShrZXkpfTogJHt2YWx1ZX1gKTtcbiAgfVxufVxuXG5jbGFzcyBUZXh0Tm9kZSBleHRlbmRzIEFzY2lpVHJlZSB7fVxuXG5jbGFzcyBGbGFnTm9kZSBleHRlbmRzIEFzY2lpVHJlZSB7XG4gIHB1YmxpYyBjb25zdHJ1Y3RvcihmbGFnOiBzdHJpbmcpIHtcbiAgICBzdXBlcihjb2xvcnMuaXRhbGljKGZsYWcpKTtcbiAgfVxufVxuXG4vKipcbiAqIEludm9rZXMgYGJsb2NrYCB3aXRoIGNvbG9ycyBlbmFibGVkL2Rpc2FibGVkIGFuZCByZXZlcnRzIHRvIG9sZCB2YWx1ZSBhZnRlcndhcmRzLlxuICovXG5mdW5jdGlvbiB3aXRoQ29sb3JzKGVuYWJsZWQ6IGJvb2xlYW4sIGJsb2NrOiAoKSA9PiB2b2lkKSB7XG4gIGNvbnN0IG9sZEVuYWJsZWQgPSBjb2xvcnMuZW5hYmxlZDtcbiAgdHJ5IHtcbiAgICBpZiAoZW5hYmxlZCkge1xuICAgICAgY29sb3JzLmVuYWJsZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb2xvcnMuZGlzYWJsZSgpO1xuICAgIH1cblxuICAgIGJsb2NrKCk7XG4gIH0gZmluYWxseSB7XG4gICAgaWYgKG9sZEVuYWJsZWQpIHtcbiAgICAgIGNvbG9ycy5lbmFibGUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29sb3JzLmRpc2FibGUoKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gZGVzY3JpYmVTdGFiaWxpdHkoXG4gIHRoaW5nOiBEb2N1bWVudGFibGUsXG4gIG9wdGlvbnM6IFR5cGVTeXN0ZW1UcmVlT3B0aW9ucyxcbikge1xuICBpZiAoIW9wdGlvbnMuc3RhYmlsaXRpZXMgfHwgdGhpbmcuZG9jcy5zdGFiaWxpdHkgPT0gbnVsbCkge1xuICAgIHJldHVybiAnJztcbiAgfVxuXG4gIHN3aXRjaCAodGhpbmcuZG9jcy5zdGFiaWxpdHkpIHtcbiAgICBjYXNlIFN0YWJpbGl0eS5TdGFibGU6XG4gICAgICByZXR1cm4gYCAoJHtjb2xvcnMuZ3JlZW4oJ3N0YWJsZScpfSlgO1xuICAgIGNhc2UgU3RhYmlsaXR5LkV4dGVybmFsOlxuICAgICAgcmV0dXJuIGAgKCR7Y29sb3JzLmdyZWVuKCdleHRlcm5hbCcpfSlgO1xuICAgIGNhc2UgU3RhYmlsaXR5LkV4cGVyaW1lbnRhbDpcbiAgICAgIHJldHVybiBgICgke2NvbG9ycy55ZWxsb3coJ2V4cGVyaW1lbnRhbCcpfSlgO1xuICAgIGNhc2UgU3RhYmlsaXR5LkRlcHJlY2F0ZWQ6XG4gICAgICByZXR1cm4gYCAoJHtjb2xvcnMucmVkKCdkZXByZWNhdGVkJyl9KWA7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiAnJztcbiAgfVxufVxuXG5mdW5jdGlvbiBtYXliZVN0YXRpYyhtZW06IFByb3BlcnR5IHwgTWV0aG9kKSB7XG4gIGxldCBpc1N0YXRpYztcbiAgaWYgKG1lbSBpbnN0YW5jZW9mIFByb3BlcnR5KSB7XG4gICAgaXNTdGF0aWMgPSAhIW1lbS5zdGF0aWM7XG4gIH1cbiAgaWYgKG1lbSBpbnN0YW5jZW9mIE1ldGhvZCkge1xuICAgIGlzU3RhdGljID0gISFtZW0uc3RhdGljO1xuICB9XG5cbiAgcmV0dXJuIGlzU3RhdGljID8gYCR7Y29sb3JzLmdyZXkoJ3N0YXRpYycpfSBgIDogJyc7XG59XG4iXX0=