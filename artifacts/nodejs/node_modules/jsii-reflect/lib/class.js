"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ClassType = void 0;
const initializer_1 = require("./initializer");
const method_1 = require("./method");
const property_1 = require("./property");
const reference_type_1 = require("./reference-type");
const util_1 = require("./util");
class ClassType extends reference_type_1.ReferenceType {
    constructor(system, assembly, spec) {
        super(system, assembly, spec);
        this.system = system;
        this.assembly = assembly;
        this.spec = spec;
    }
    /**
     * Base class (optional).
     */
    get base() {
        if (!this.spec.base) {
            return undefined;
        }
        const type = this.system.findFqn(this.spec.base);
        if (!(type instanceof ClassType)) {
            throw new Error(`FQN for base class points to a non-class type: ${this.spec.base}`);
        }
        return type;
    }
    /**
     * Initializer (constructor) method.
     */
    get initializer() {
        if (!this.spec.initializer) {
            return undefined;
        }
        return new initializer_1.Initializer(this.system, this.assembly, this, this.spec.initializer);
    }
    /**
     * Indicates if this class is an abstract class.
     */
    get abstract() {
        return !!this.spec.abstract;
    }
    /**
     * Returns list of all base classes (first is the direct base and last is the top-most).
     */
    getAncestors() {
        const out = new Array();
        if (this.base) {
            out.push(this.base);
            out.push(...this.base.getAncestors());
        }
        return out;
    }
    /**
     * Lists all properties in this class.
     * @param inherited include all properties inherited from base classes (default: false)
     */
    getProperties(inherited = false) {
        return this._getProperties(inherited, this);
    }
    /**
     * List all methods in this class.
     * @param inherited include all methods inherited from base classes (default: false)
     */
    getMethods(inherited = false) {
        return this._getMethods(inherited, this);
    }
    /**
     * Lists all interfaces this class implements.
     * @param inherited include all interfaces implemented by all base classes (default: false)
     */
    getInterfaces(inherited = false) {
        const out = new Array();
        if (inherited && this.base) {
            out.push(...this.base.getInterfaces(inherited));
        }
        if (this.spec.interfaces) {
            out.push(...flatten(this.spec.interfaces
                .map((fqn) => this.system.findInterface(fqn))
                .map((iface) => [
                iface,
                ...(inherited ? iface.getInterfaces(true) : []),
            ])));
        }
        return out;
    }
    isClassType() {
        return true;
    }
    _getProperties(inherited, parentType) {
        var _a;
        const base = inherited && this.base
            ? this.base._getProperties(inherited, parentType)
            : {};
        return Object.assign(base, util_1.indexBy(((_a = this.spec.properties) !== null && _a !== void 0 ? _a : []).map((p) => new property_1.Property(this.system, this.assembly, parentType, this, p)), (p) => p.name));
    }
    _getMethods(inherited, parentType) {
        var _a;
        const base = inherited && this.base
            ? this.base._getMethods(inherited, parentType)
            : {};
        return Object.assign(base, util_1.indexBy(((_a = this.spec.methods) !== null && _a !== void 0 ? _a : []).map((m) => new method_1.Method(this.system, this.assembly, parentType, this, m)), (m) => m.name));
    }
}
exports.ClassType = ClassType;
function flatten(xs) {
    return Array.prototype.concat([], ...xs);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xhc3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjbGFzcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFHQSwrQ0FBNEM7QUFFNUMscUNBQWtDO0FBQ2xDLHlDQUFzQztBQUN0QyxxREFBaUQ7QUFFakQsaUNBQWlDO0FBRWpDLE1BQWEsU0FBVSxTQUFRLDhCQUFhO0lBQzFDLFlBQ2tCLE1BQWtCLEVBQ2xCLFFBQWtCLEVBQ2xCLElBQW9CO1FBRXBDLEtBQUssQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBSmQsV0FBTSxHQUFOLE1BQU0sQ0FBWTtRQUNsQixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ2xCLFNBQUksR0FBSixJQUFJLENBQWdCO0lBR3RDLENBQUM7SUFFRDs7T0FFRztJQUNILElBQVcsSUFBSTtRQUNiLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRTtZQUNuQixPQUFPLFNBQVMsQ0FBQztTQUNsQjtRQUVELE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakQsSUFBSSxDQUFDLENBQUMsSUFBSSxZQUFZLFNBQVMsQ0FBQyxFQUFFO1lBQ2hDLE1BQU0sSUFBSSxLQUFLLENBQ2Isa0RBQWtELElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQ25FLENBQUM7U0FDSDtRQUVELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBVyxXQUFXO1FBQ3BCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUMxQixPQUFPLFNBQVMsQ0FBQztTQUNsQjtRQUVELE9BQU8sSUFBSSx5QkFBVyxDQUNwQixJQUFJLENBQUMsTUFBTSxFQUNYLElBQUksQ0FBQyxRQUFRLEVBQ2IsSUFBSSxFQUNKLElBQUksQ0FBQyxJQUFJLENB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LENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsU0FBUyxFQUFFLFVBQVUsQ0FBQztZQUM5QyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ1QsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUNsQixJQUFJLEVBQ0osY0FBTyxDQUNMLE9BQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLG1DQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FDM0IsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksZUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUNuRSxFQUNELENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUNkLENBQ0YsQ0FBQztJQUNKLENBQUM7Q0FDRjtBQS9JRCw4QkErSUM7QUFFRCxTQUFTLE9BQU8sQ0FBSSxFQUFTO0lBQzNCLE9BQU8sS0FBSyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7QUFDM0MsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGpzaWkgZnJvbSAnQGpzaWkvc3BlYyc7XG5cbmltcG9ydCB7IEFzc2VtYmx5IH0gZnJvbSAnLi9hc3NlbWJseSc7XG5pbXBvcnQgeyBJbml0aWFsaXplciB9IGZyb20gJy4vaW5pdGlhbGl6ZXInO1xuaW1wb3J0IHsgSW50ZXJmYWNlVHlwZSB9IGZyb20gJy4vaW50ZXJmYWNlJztcbmltcG9ydCB7IE1ldGhvZCB9IGZyb20gJy4vbWV0aG9kJztcbmltcG9ydCB7IFByb3BlcnR5IH0gZnJvbSAnLi9wcm9wZXJ0eSc7XG5pbXBvcnQgeyBSZWZlcmVuY2VUeXBlIH0gZnJvbSAnLi9yZWZlcmVuY2UtdHlwZSc7XG5pbXBvcnQgeyBUeXBlU3lzdGVtIH0gZnJvbSAnLi90eXBlLXN5c3RlbSc7XG5pbXBvcnQgeyBpbmRleEJ5IH0gZnJvbSAnLi91dGlsJztcblxuZXhwb3J0IGNsYXNzIENsYXNzVHlwZSBleHRlbmRzIFJlZmVyZW5jZVR5cGUge1xuICBwdWJsaWMgY29uc3RydWN0b3IoXG4gICAgcHVibGljIHJlYWRvbmx5IHN5c3RlbTogVHlwZVN5c3RlbSxcbiAgICBwdWJsaWMgcmVhZG9ubHkgYXNzZW1ibHk6IEFzc2VtYmx5LFxuICAgIHB1YmxpYyByZWFkb25seSBzcGVjOiBqc2lpLkNsYXNzVHlwZSxcbiAgKSB7XG4gICAgc3VwZXIoc3lzdGVtLCBhc3NlbWJseSwgc3BlYyk7XG4gIH1cblxuICAvKipcbiAgICogQmFzZSBjbGFzcyAob3B0aW9uYWwpLlxuICAgKi9cbiAgcHVibGljIGdldCBiYXNlKCk6IENsYXNzVHlwZSB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKCF0aGlzLnNwZWMuYmFzZSkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBjb25zdCB0eXBlID0gdGhpcy5zeXN0ZW0uZmluZEZxbih0aGlzLnNwZWMuYmFzZSk7XG4gICAgaWYgKCEodHlwZSBpbnN0YW5jZW9mIENsYXNzVHlwZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEZRTiBmb3IgYmFzZSBjbGFzcyBwb2ludHMgdG8gYSBub24tY2xhc3MgdHlwZTogJHt0aGlzLnNwZWMuYmFzZX1gLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHlwZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplciAoY29uc3RydWN0b3IpIG1ldGhvZC5cbiAgICovXG4gIHB1YmxpYyBnZXQgaW5pdGlhbGl6ZXIoKTogSW5pdGlhbGl6ZXIgfCB1bmRlZmluZWQge1xuICAgIGlmICghdGhpcy5zcGVjLmluaXRpYWxpemVyKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgSW5pdGlhbGl6ZXIoXG4gICAgICB0aGlzLnN5c3RlbSxcbiAgICAgIHRoaXMuYXNzZW1ibHksXG4gICAgICB0aGlzLFxuICAgICAgdGhpcy5zcGVjLmluaXRpYWxpemVyLFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogSW5kaWNhdGVzIGlmIHRoaXMgY2xhc3MgaXMgYW4gYWJzdHJhY3QgY2xhc3MuXG4gICAqL1xuICBwdWJsaWMgZ2V0IGFic3RyYWN0KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIXRoaXMuc3BlYy5hYnN0cmFjdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGxpc3Qgb2YgYWxsIGJhc2UgY2xhc3NlcyAoZmlyc3QgaXMgdGhlIGRpcmVjdCBiYXNlIGFuZCBsYXN0IGlzIHRoZSB0b3AtbW9zdCkuXG4gICAqL1xuICBwdWJsaWMgZ2V0QW5jZXN0b3JzKCkge1xuICAgIGNvbnN0IG91dCA9IG5ldyBBcnJheTxDbGFzc1R5cGU+KCk7XG4gICAgaWYgKHRoaXMuYmFzZSkge1xuICAgICAgb3V0LnB1c2godGhpcy5iYXNlKTtcbiAgICAgIG91dC5wdXNoKC4uLnRoaXMuYmFzZS5nZXRBbmNlc3RvcnMoKSk7XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG4gIH1cblxuICAvKipcbiAgICogTGlzdHMgYWxsIHByb3BlcnRpZXMgaW4gdGhpcyBjbGFzcy5cbiAgICogQHBhcmFtIGluaGVyaXRlZCBpbmNsdWRlIGFsbCBwcm9wZXJ0aWVzIGluaGVyaXRlZCBmcm9tIGJhc2UgY2xhc3NlcyAoZGVmYXVsdDogZmFsc2UpXG4gICAqL1xuICBwdWJsaWMgZ2V0UHJvcGVydGllcyhpbmhlcml0ZWQgPSBmYWxzZSk6IHsgW25hbWU6IHN0cmluZ106IFByb3BlcnR5IH0ge1xuICAgIHJldHVybiB0aGlzLl9nZXRQcm9wZXJ0aWVzKGluaGVyaXRlZCwgdGhpcyk7XG4gIH1cblxuICAvKipcbiAgICogTGlzdCBhbGwgbWV0aG9kcyBpbiB0aGlzIGNsYXNzLlxuICAgKiBAcGFyYW0gaW5oZXJpdGVkIGluY2x1ZGUgYWxsIG1ldGhvZHMgaW5oZXJpdGVkIGZyb20gYmFzZSBjbGFzc2VzIChkZWZhdWx0OiBmYWxzZSlcbiAgICovXG4gIHB1YmxpYyBnZXRNZXRob2RzKGluaGVyaXRlZCA9IGZhbHNlKTogeyBbbmFtZTogc3RyaW5nXTogTWV0aG9kIH0ge1xuICAgIHJldHVybiB0aGlzLl9nZXRNZXRob2RzKGluaGVyaXRlZCwgdGhpcyk7XG4gIH1cblxuICAvKipcbiAgICogTGlzdHMgYWxsIGludGVyZmFjZXMgdGhpcyBjbGFzcyBpbXBsZW1lbnRzLlxuICAgKiBAcGFyYW0gaW5oZXJpdGVkIGluY2x1ZGUgYWxsIGludGVyZmFjZXMgaW1wbGVtZW50ZWQgYnkgYWxsIGJhc2UgY2xhc3NlcyAoZGVmYXVsdDogZmFsc2UpXG4gICAqL1xuICBwdWJsaWMgZ2V0SW50ZXJmYWNlcyhpbmhlcml0ZWQgPSBmYWxzZSkge1xuICAgIGNvbnN0IG91dCA9IG5ldyBBcnJheTxJbnRlcmZhY2VUeXBlPigpO1xuICAgIGlmIChpbmhlcml0ZWQgJiYgdGhpcy5iYXNlKSB7XG4gICAgICBvdXQucHVzaCguLi50aGlzLmJhc2UuZ2V0SW50ZXJmYWNlcyhpbmhlcml0ZWQpKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuc3BlYy5pbnRlcmZhY2VzKSB7XG4gICAgICBvdXQucHVzaChcbiAgICAgICAgLi4uZmxhdHRlbihcbiAgICAgICAgICB0aGlzLnNwZWMuaW50ZXJmYWNlc1xuICAgICAgICAgICAgLm1hcCgoZnFuKSA9PiB0aGlzLnN5c3RlbS5maW5kSW50ZXJmYWNlKGZxbikpXG4gICAgICAgICAgICAubWFwKChpZmFjZSkgPT4gW1xuICAgICAgICAgICAgICBpZmFjZSxcbiAgICAgICAgICAgICAgLi4uKGluaGVyaXRlZCA/IGlmYWNlLmdldEludGVyZmFjZXModHJ1ZSkgOiBbXSksXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgKSxcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG4gIH1cblxuICBwdWJsaWMgaXNDbGFzc1R5cGUoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBwcml2YXRlIF9nZXRQcm9wZXJ0aWVzKFxuICAgIGluaGVyaXRlZDogYm9vbGVhbixcbiAgICBwYXJlbnRUeXBlOiBSZWZlcmVuY2VUeXBlLFxuICApOiB7IFtuYW1lOiBzdHJpbmddOiBQcm9wZXJ0eSB9IHtcbiAgICBjb25zdCBiYXNlID1cbiAgICAgIGluaGVyaXRlZCAmJiB0aGlzLmJhc2VcbiAgICAgICAgPyB0aGlzLmJhc2UuX2dldFByb3BlcnRpZXMoaW5oZXJpdGVkLCBwYXJlbnRUeXBlKVxuICAgICAgICA6IHt9O1xuICAgIHJldHVybiBPYmplY3QuYXNzaWduKFxuICAgICAgYmFzZSxcbiAgICAgIGluZGV4QnkoXG4gICAgICAgICh0aGlzLnNwZWMucHJvcGVydGllcyA/PyBbXSkubWFwKFxuICAgICAgICAgIChwKSA9PiBuZXcgUHJvcGVydHkodGhpcy5zeXN0ZW0sIHRoaXMuYXNzZW1ibHksIHBhcmVudFR5cGUsIHRoaXMsIHApLFxuICAgICAgICApLFxuICAgICAgICAocCkgPT4gcC5uYW1lLFxuICAgICAgKSxcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBfZ2V0TWV0aG9kcyhcbiAgICBpbmhlcml0ZWQ6IGJvb2xlYW4sXG4gICAgcGFyZW50VHlwZTogUmVmZXJlbmNlVHlwZSxcbiAgKTogeyBbbmFtZTogc3RyaW5nXTogTWV0aG9kIH0ge1xuICAgIGNvbnN0IGJhc2UgPVxuICAgICAgaW5oZXJpdGVkICYmIHRoaXMuYmFzZVxuICAgICAgICA/IHRoaXMuYmFzZS5fZ2V0TWV0aG9kcyhpbmhlcml0ZWQsIHBhcmVudFR5cGUpXG4gICAgICAgIDoge307XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oXG4gICAgICBiYXNlLFxuICAgICAgaW5kZXhCeShcbiAgICAgICAgKHRoaXMuc3BlYy5tZXRob2RzID8/IFtdKS5tYXAoXG4gICAgICAgICAgKG0pID0+IG5ldyBNZXRob2QodGhpcy5zeXN0ZW0sIHRoaXMuYXNzZW1ibHksIHBhcmVudFR5cGUsIHRoaXMsIG0pLFxuICAgICAgICApLFxuICAgICAgICAobSkgPT4gbS5uYW1lLFxuICAgICAgKSxcbiAgICApO1xuICB9XG59XG5cbmZ1bmN0aW9uIGZsYXR0ZW48QT4oeHM6IEFbXVtdKTogQVtdIHtcbiAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5jb25jYXQoW10sIC4uLnhzKTtcbn1cbiJdfQ==