"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DefaultVisitor = void 0;
const ts = require("typescript");
const jsii_types_1 = require("../jsii/jsii-types");
const jsii_utils_1 = require("../jsii/jsii-utils");
const o_tree_1 = require("../o-tree");
const renderer_1 = require("../renderer");
const ast_utils_1 = require("../typescript/ast-utils");
/**
 * A basic visitor that applies for most curly-braces-based languages
 */
class DefaultVisitor {
    constructor() {
        this.statementTerminator = ';';
    }
    commentRange(comment, _context) {
        return new o_tree_1.OTree([comment.isTrailing ? ' ' : '', comment.text, comment.hasTrailingNewLine ? '\n' : '']);
    }
    sourceFile(node, context) {
        return new o_tree_1.OTree(context.convertAll(node.statements));
    }
    jsDoc(_node, _context) {
        // Already handled by other doc handlers
        return new o_tree_1.OTree([]);
    }
    importStatement(node, context) {
        return this.notImplemented(node.node, context);
    }
    functionDeclaration(node, children) {
        return this.notImplemented(node, children);
    }
    stringLiteral(node, _renderer) {
        return new o_tree_1.OTree([JSON.stringify(node.text)]);
    }
    identifier(node, _children) {
        return new o_tree_1.OTree([node.text]);
    }
    block(node, children) {
        return new o_tree_1.OTree(['{'], ['\n', ...children.convertAll(node.statements)], {
            indent: 4,
            suffix: '}',
        });
    }
    parameterDeclaration(node, children) {
        return this.notImplemented(node, children);
    }
    returnStatement(node, children) {
        return new o_tree_1.OTree(['return ', children.convert(node.expression), this.statementTerminator], [], {
            canBreakLine: true,
        });
    }
    binaryExpression(node, context) {
        const operator = context.textOf(node.operatorToken);
        if (operator === '??') {
            context.reportUnsupported(node.operatorToken, undefined);
        }
        const operatorToken = this.translateBinaryOperator(operator);
        return new o_tree_1.OTree([context.convert(node.left), ' ', operatorToken, ' ', context.convert(node.right)]);
    }
    prefixUnaryExpression(node, context) {
        return new o_tree_1.OTree([this.translateUnaryOperator(node.operator), context.convert(node.operand)]);
    }
    translateUnaryOperator(operator) {
        return UNARY_OPS[operator];
    }
    translateBinaryOperator(operator) {
        if (operator === '===') {
            return '==';
        }
        return operator;
    }
    ifStatement(node, context) {
        return this.notImplemented(node, context);
    }
    propertyAccessExpression(node, context) {
        return new o_tree_1.OTree([context.convert(node.expression), '.', context.convert(node.name)]);
    }
    /**
     * Do some work on property accesses to translate common JavaScript-isms to language-specific idioms
     */
    callExpression(node, context) {
        const functionText = context.textOf(node.expression);
        if (functionText === 'console.log' || functionText === 'console.error') {
            return this.printStatement(node.arguments, context);
        }
        if (functionText === 'super') {
            return this.superCallExpression(node, context);
        }
        return this.regularCallExpression(node, context);
    }
    regularCallExpression(node, context) {
        return new o_tree_1.OTree([context.convert(node.expression), '(', this.argumentList(node.arguments, context), ')']);
    }
    superCallExpression(node, context) {
        return this.regularCallExpression(node, context);
    }
    printStatement(args, context) {
        return new o_tree_1.OTree(['<PRINT>', '(', this.argumentList(args, context), ')']);
    }
    expressionStatement(node, context) {
        return new o_tree_1.OTree([context.convert(node.expression)], [], {
            canBreakLine: true,
        });
    }
    token(node, context) {
        return new o_tree_1.OTree([context.textOf(node)]);
    }
    /**
     * An object literal can render as one of three things:
     *
     * - Don't know the type (render as an unknown struct)
     * - Know the type:
     *     - It's a struct (render as known struct)
     *     - It's not a struct (render as key-value map)
     */
    objectLiteralExpression(node, context) {
        // If any of the elements of the objectLiteralExpression are not a literal property
        // assignment, report them. We can't support those.
        const unsupported = node.properties.filter((p) => !ts.isPropertyAssignment(p) && !ts.isShorthandPropertyAssignment(p));
        for (const unsup of unsupported) {
            context.report(unsup, `Use of ${ts.SyntaxKind[unsup.kind]} in an object literal is not supported.`);
        }
        const lit = jsii_types_1.analyzeObjectLiteral(context.typeChecker, node);
        switch (lit.kind) {
            case 'unknown':
                return this.unknownTypeObjectLiteralExpression(node, context);
            case 'struct':
            case 'local-struct':
                return this.knownStructObjectLiteralExpression(node, lit, context);
            case 'map':
                return this.keyValueObjectLiteralExpression(node, context);
        }
    }
    unknownTypeObjectLiteralExpression(node, context) {
        return this.notImplemented(node, context);
    }
    knownStructObjectLiteralExpression(node, _structType, context) {
        return this.notImplemented(node, context);
    }
    keyValueObjectLiteralExpression(node, context) {
        return this.notImplemented(node, context);
    }
    newExpression(node, context) {
        return new o_tree_1.OTree(['new ', context.convert(node.expression), '(', this.argumentList(node.arguments, context), ')'], [], { canBreakLine: true });
    }
    propertyAssignment(node, context) {
        return this.notImplemented(node, context);
    }
    variableStatement(node, context) {
        return new o_tree_1.OTree([context.convert(node.declarationList)], [], {
            canBreakLine: true,
        });
    }
    variableDeclarationList(node, context) {
        return new o_tree_1.OTree([], context.convertAll(node.declarations));
    }
    variableDeclaration(node, context) {
        return this.notImplemented(node, context);
    }
    arrayLiteralExpression(node, context) {
        return new o_tree_1.OTree(['['], context.convertAll(node.elements), {
            separator: ', ',
            suffix: ']',
        });
    }
    shorthandPropertyAssignment(node, context) {
        return this.notImplemented(node, context);
    }
    forOfStatement(node, context) {
        return this.notImplemented(node, context);
    }
    classDeclaration(node, context) {
        return this.notImplemented(node, context);
    }
    constructorDeclaration(node, context) {
        return this.notImplemented(node, context);
    }
    propertyDeclaration(node, context) {
        return this.notImplemented(node, context);
    }
    computedPropertyName(node, context) {
        return context.convert(node);
    }
    methodDeclaration(node, context) {
        return this.notImplemented(node, context);
    }
    interfaceDeclaration(node, context) {
        if (jsii_utils_1.isNamedLikeStruct(context.textOf(node.name))) {
            return this.structInterfaceDeclaration(node, context);
        }
        return this.regularInterfaceDeclaration(node, context);
    }
    structInterfaceDeclaration(node, context) {
        return this.notImplemented(node, context);
    }
    regularInterfaceDeclaration(node, context) {
        return this.notImplemented(node, context);
    }
    propertySignature(node, context) {
        return this.notImplemented(node, context);
    }
    methodSignature(node, context) {
        return this.notImplemented(node, context);
    }
    asExpression(node, context) {
        return this.notImplemented(node, context);
    }
    spreadElement(node, context) {
        return this.notImplemented(node, context);
    }
    spreadAssignment(node, context) {
        return this.notImplemented(node, context);
    }
    ellipsis(_node, _context) {
        return new o_tree_1.OTree(['...']);
    }
    templateExpression(node, context) {
        return this.notImplemented(node, context);
    }
    elementAccessExpression(node, context) {
        const expression = context.convert(node.expression);
        const index = context.convert(node.argumentExpression);
        return new o_tree_1.OTree([expression, '[', index, ']']);
    }
    nonNullExpression(node, context) {
        // We default we drop the non-null assertion
        return context.convert(node.expression);
    }
    parenthesizedExpression(node, context) {
        return new o_tree_1.OTree(['(', context.convert(node.expression), ')']);
    }
    maskingVoidExpression(node, context) {
        // Don't render anything by default when nodes are masked
        const arg = ast_utils_1.voidExpressionString(node);
        if (arg === 'block') {
            return this.commentRange({
                pos: context.getPosition(node).start,
                text: '\n// ...',
                kind: ts.SyntaxKind.SingleLineCommentTrivia,
                hasTrailingNewLine: false,
            }, context);
        }
        if (arg === '...') {
            return new o_tree_1.OTree(['...']);
        }
        return o_tree_1.NO_SYNTAX;
    }
    argumentList(args, context) {
        return new o_tree_1.OTree([], args ? context.convertAll(args) : [], {
            separator: ', ',
        });
    }
    notImplemented(node, context) {
        context.reportUnsupported(node, this.language);
        return renderer_1.nimpl(node, context);
    }
}
exports.DefaultVisitor = DefaultVisitor;
const UNARY_OPS = {
    [ts.SyntaxKind.PlusPlusToken]: '++',
    [ts.SyntaxKind.MinusMinusToken]: '--',
    [ts.SyntaxKind.PlusToken]: '+',
    [ts.SyntaxKind.MinusToken]: '-',
    [ts.SyntaxKind.TildeToken]: '~',
    [ts.SyntaxKind.ExclamationToken]: '!',
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVmYXVsdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRlZmF1bHQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsaUNBQWlDO0FBRWpDLG1EQUErRTtBQUMvRSxtREFBdUQ7QUFDdkQsc0NBQTZDO0FBQzdDLDBDQUE0RTtBQUM1RSx1REFBK0Q7QUFLL0Q7O0dBRUc7QUFDSCxNQUFzQixjQUFjO0lBQXBDO1FBTVksd0JBQW1CLEdBQUcsR0FBRyxDQUFDO0lBMFR0QyxDQUFDO0lBeFRRLFlBQVksQ0FBQyxPQUFzQixFQUFFLFFBQXdCO1FBQ2xFLE9BQU8sSUFBSSxjQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxPQUFPLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzFHLENBQUM7SUFFTSxVQUFVLENBQUMsSUFBbUIsRUFBRSxPQUF1QjtRQUM1RCxPQUFPLElBQUksY0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7SUFDeEQsQ0FBQztJQUVNLEtBQUssQ0FBQyxLQUFlLEVBQUUsUUFBd0I7UUFDcEQsd0NBQXdDO1FBQ3hDLE9BQU8sSUFBSSxjQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDdkIsQ0FBQztJQUVNLGVBQWUsQ0FBQyxJQUFxQixFQUFFLE9BQXVCO1FBQ25FLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ2pELENBQUM7SUFFTSxtQkFBbUIsQ0FBQyxJQUE0QixFQUFFLFFBQXdCO1FBQy9FLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDN0MsQ0FB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QkFBSyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztJQUM5QixDQUFDO0NBQ0Y7QUFoVUQsd0NBZ1VDO0FBRUQsTUFBTSxTQUFTLEdBQStDO0lBQzVELENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsRUFBRSxJQUFJO0lBQ25DLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxlQUFlLENBQUMsRUFBRSxJQUFJO0lBQ3JDLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsRUFBRSxHQUFHO0lBQzlCLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsRUFBRSxHQUFHO0lBQy9CLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsRUFBRSxHQUFHO0lBQy9CLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLEdBQUc7Q0FDdEMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHRzIGZyb20gJ3R5cGVzY3JpcHQnO1xuXG5pbXBvcnQgeyBhbmFseXplT2JqZWN0TGl0ZXJhbCwgT2JqZWN0TGl0ZXJhbFN0cnVjdCB9IGZyb20gJy4uL2pzaWkvanNpaS10eXBlcyc7XG5pbXBvcnQgeyBpc05hbWVkTGlrZVN0cnVjdCB9IGZyb20gJy4uL2pzaWkvanNpaS11dGlscyc7XG5pbXBvcnQgeyBPVHJlZSwgTk9fU1lOVEFYIH0gZnJvbSAnLi4vby10cmVlJztcbmltcG9ydCB7IEFzdFJlbmRlcmVyLCBBc3RIYW5kbGVyLCBuaW1wbCwgQ29tbWVudFN5bnRheCB9IGZyb20gJy4uL3JlbmRlcmVyJztcbmltcG9ydCB7IHZvaWRFeHByZXNzaW9uU3RyaW5nIH0gZnJvbSAnLi4vdHlwZXNjcmlwdC9hc3QtdXRpbHMnO1xuaW1wb3J0IHsgSW1wb3J0U3RhdGVtZW50IH0gZnJvbSAnLi4vdHlwZXNjcmlwdC9pbXBvcnRzJztcblxuaW1wb3J0IHsgVGFyZ2V0TGFuZ3VhZ2UgfSBmcm9tICcuJztcblxuLyoqXG4gKiBBIGJhc2ljIHZpc2l0b3IgdGhhdCBhcHBsaWVzIGZvciBtb3N0IGN1cmx5LWJyYWNlcy1iYXNlZCBsYW5ndWFnZXNcbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIERlZmF1bHRWaXNpdG9yPEM+IGltcGxlbWVudHMgQXN0SGFuZGxlcjxDPiB7XG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBkZWZhdWx0Q29udGV4dDogQztcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGxhbmd1YWdlOiBUYXJnZXRMYW5ndWFnZTtcblxuICBwdWJsaWMgYWJzdHJhY3QgbWVyZ2VDb250ZXh0KG9sZDogQywgdXBkYXRlOiBDKTogQztcblxuICBwcm90ZWN0ZWQgc3RhdGVtZW50VGVybWluYXRvciA9ICc7JztcblxuICBwdWJsaWMgY29tbWVudFJhbmdlKGNvbW1lbnQ6IENvbW1lbnRTeW50YXgsIF9jb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICByZXR1cm4gbmV3IE9UcmVlKFtjb21tZW50LmlzVHJhaWxpbmcgPyAnICcgOiAnJywgY29tbWVudC50ZXh0LCBjb21tZW50Lmhhc1RyYWlsaW5nTmV3TGluZSA/ICdcXG4nIDogJyddKTtcbiAgfVxuXG4gIHB1YmxpYyBzb3VyY2VGaWxlKG5vZGU6IHRzLlNvdXJjZUZpbGUsIGNvbnRleHQ6IEFzdFJlbmRlcmVyPEM+KTogT1RyZWUge1xuICAgIHJldHVybiBuZXcgT1RyZWUoY29udGV4dC5jb252ZXJ0QWxsKG5vZGUuc3RhdGVtZW50cykpO1xuICB9XG5cbiAgcHVibGljIGpzRG9jKF9ub2RlOiB0cy5KU0RvYywgX2NvbnRleHQ6IEFzdFJlbmRlcmVyPEM+KTogT1RyZWUge1xuICAgIC8vIEFscmVhZHkgaGFuZGxlZCBieSBvdGhlciBkb2MgaGFuZGxlcnNcbiAgICByZXR1cm4gbmV3IE9UcmVlKFtdKTtcbiAgfVxuXG4gIHB1YmxpYyBpbXBvcnRTdGF0ZW1lbnQobm9kZTogSW1wb3J0U3RhdGVtZW50LCBjb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICByZXR1cm4gdGhpcy5ub3RJbXBsZW1lbnRlZChub2RlLm5vZGUsIGNvbnRleHQpO1xuICB9XG5cbiAgcHVibGljIGZ1bmN0aW9uRGVjbGFyYXRpb24obm9kZTogdHMuRnVuY3Rpb25EZWNsYXJhdGlvbiwgY2hpbGRyZW46IEFzdFJlbmRlcmVyPEM+KTogT1RyZWUge1xuICAgIHJldHVybiB0aGlzLm5vdEltcGxlbWVudGVkKG5vZGUsIGNoaWxkcmVuKTtcbiAgfVxuXG4gIHB1YmxpYyBzdHJpbmdMaXRlcmFsKG5vZGU6IHRzLlN0cmluZ0xpdGVyYWwgfCB0cy5Ob1N1YnN0aXR1dGlvblRlbXBsYXRlTGl0ZXJhbCwgX3JlbmRlcmVyOiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICByZXR1cm4gbmV3IE9UcmVlKFtKU09OLnN0cmluZ2lmeShub2RlLnRleHQpXSk7XG4gIH1cblxuICBwdWJsaWMgaWRlbnRpZmllcihub2RlOiB0cy5JZGVudGlmaWVyLCBfY2hpbGRyZW46IEFzdFJlbmRlcmVyPEM+KTogT1RyZWUge1xuICAgIHJldHVybiBuZXcgT1RyZWUoW25vZGUudGV4dF0pO1xuICB9XG5cbiAgcHVibGljIGJsb2NrKG5vZGU6IHRzLkJsb2NrLCBjaGlsZHJlbjogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShbJ3snXSwgWydcXG4nLCAuLi5jaGlsZHJlbi5jb252ZXJ0QWxsKG5vZGUuc3RhdGVtZW50cyldLCB7XG4gICAgICBpbmRlbnQ6IDQsXG4gICAgICBzdWZmaXg6ICd9JyxcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBwYXJhbWV0ZXJEZWNsYXJhdGlvbihub2RlOiB0cy5QYXJhbWV0ZXJEZWNsYXJhdGlvbiwgY2hpbGRyZW46IEFzdFJlbmRlcmVyPEM+KTogT1RyZWUge1xuICAgIHJldHVybiB0aGlzLm5vdEltcGxlbWVudGVkKG5vZGUsIGNoaWxkcmVuKTtcbiAgfVxuXG4gIHB1YmxpYyByZXR1cm5TdGF0ZW1lbnQobm9kZTogdHMuUmV0dXJuU3RhdGVtZW50LCBjaGlsZHJlbjogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShbJ3JldHVybiAnLCBjaGlsZHJlbi5jb252ZXJ0KG5vZGUuZXhwcmVzc2lvbiksIHRoaXMuc3RhdGVtZW50VGVybWluYXRvcl0sIFtdLCB7XG4gICAgICBjYW5CcmVha0xpbmU6IHRydWUsXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgYmluYXJ5RXhwcmVzc2lvbihub2RlOiB0cy5CaW5hcnlFeHByZXNzaW9uLCBjb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICBjb25zdCBvcGVyYXRvciA9IGNvbnRleHQudGV4dE9mKG5vZGUub3BlcmF0b3JUb2tlbik7XG4gICAgaWYgKG9wZXJhdG9yID09PSAnPz8nKSB7XG4gICAgICBjb250ZXh0LnJlcG9ydFVuc3VwcG9ydGVkKG5vZGUub3BlcmF0b3JUb2tlbiwgdW5kZWZpbmVkKTtcbiAgICB9XG4gICAgY29uc3Qgb3BlcmF0b3JUb2tlbiA9IHRoaXMudHJhbnNsYXRlQmluYXJ5T3BlcmF0b3Iob3BlcmF0b3IpO1xuICAgIHJldHVybiBuZXcgT1RyZWUoW2NvbnRleHQuY29udmVydChub2RlLmxlZnQpLCAnICcsIG9wZXJhdG9yVG9rZW4sICcgJywgY29udGV4dC5jb252ZXJ0KG5vZGUucmlnaHQpXSk7XG4gIH1cblxuICBwdWJsaWMgcHJlZml4VW5hcnlFeHByZXNzaW9uKG5vZGU6IHRzLlByZWZpeFVuYXJ5RXhwcmVzc2lvbiwgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShbdGhpcy50cmFuc2xhdGVVbmFyeU9wZXJhdG9yKG5vZGUub3BlcmF0b3IpLCBjb250ZXh0LmNvbnZlcnQobm9kZS5vcGVyYW5kKV0pO1xuICB9XG5cbiAgcHVibGljIHRyYW5zbGF0ZVVuYXJ5T3BlcmF0b3Iob3BlcmF0b3I6IHRzLlByZWZpeFVuYXJ5T3BlcmF0b3IpIHtcbiAgICByZXR1cm4gVU5BUllfT1BTW29wZXJhdG9yXTtcbiAgfVxuXG4gIHB1YmxpYyB0cmFuc2xhdGVCaW5hcnlPcGVyYXRvcihvcGVyYXRvcjogc3RyaW5nKSB7XG4gICAgaWYgKG9wZXJhdG9yID09PSAnPT09Jykge1xuICAgICAgcmV0dXJuICc9PSc7XG4gICAgfVxuICAgIHJldHVybiBvcGVyYXRvcjtcbiAgfVxuXG4gIHB1YmxpYyBpZlN0YXRlbWVudChub2RlOiB0cy5JZlN0YXRlbWVudCwgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgcmV0dXJuIHRoaXMubm90SW1wbGVtZW50ZWQobm9kZSwgY29udGV4dCk7XG4gIH1cblxuICBwdWJsaWMgcHJvcGVydHlBY2Nlc3NFeHByZXNzaW9uKG5vZGU6IHRzLlByb3BlcnR5QWNjZXNzRXhwcmVzc2lvbiwgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShbY29udGV4dC5jb252ZXJ0KG5vZGUuZXhwcmVzc2lvbiksICcuJywgY29udGV4dC5jb252ZXJ0KG5vZGUubmFtZSldKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEbyBzb21lIHdvcmsgb24gcHJvcGVydHkgYWNjZXNzZXMgdG8gdHJhbnNsYXRlIGNvbW1vbiBKYXZhU2NyaXB0LWlzbXMgdG8gbGFuZ3VhZ2Utc3BlY2lmaWMgaWRpb21zXG4gICAqL1xuICBwdWJsaWMgY2FsbEV4cHJlc3Npb24obm9kZTogdHMuQ2FsbEV4cHJlc3Npb24sIGNvbnRleHQ6IEFzdFJlbmRlcmVyPEM+KTogT1RyZWUge1xuICAgIGNvbnN0IGZ1bmN0aW9uVGV4dCA9IGNvbnRleHQudGV4dE9mKG5vZGUuZXhwcmVzc2lvbik7XG4gICAgaWYgKGZ1bmN0aW9uVGV4dCA9PT0gJ2NvbnNvbGUubG9nJyB8fCBmdW5jdGlvblRleHQgPT09ICdjb25zb2xlLmVycm9yJykge1xuICAgICAgcmV0dXJuIHRoaXMucHJpbnRTdGF0ZW1lbnQobm9kZS5hcmd1bWVudHMsIGNvbnRleHQpO1xuICAgIH1cbiAgICBpZiAoZnVuY3Rpb25UZXh0ID09PSAnc3VwZXInKSB7XG4gICAgICByZXR1cm4gdGhpcy5zdXBlckNhbGxFeHByZXNzaW9uKG5vZGUsIGNvbnRleHQpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnJlZ3VsYXJDYWxsRXhwcmVzc2lvbihub2RlLCBjb250ZXh0KTtcbiAgfVxuXG4gIHB1YmxpYyByZWd1bGFyQ2FsbEV4cHJlc3Npb24obm9kZTogdHMuQ2FsbEV4cHJlc3Npb24sIGNvbnRleHQ6IEFzdFJlbmRlcmVyPEM+KTogT1RyZWUge1xuICAgIHJldHVybiBuZXcgT1RyZWUoW2NvbnRleHQuY29udmVydChub2RlLmV4cHJlc3Npb24pLCAnKCcsIHRoaXMuYXJndW1lbnRMaXN0KG5vZGUuYXJndW1lbnRzLCBjb250ZXh0KSwgJyknXSk7XG4gIH1cblxuICBwdWJsaWMgc3VwZXJDYWxsRXhwcmVzc2lvbihub2RlOiB0cy5DYWxsRXhwcmVzc2lvbiwgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgcmV0dXJuIHRoaXMucmVndWxhckNhbGxFeHByZXNzaW9uKG5vZGUsIGNvbnRleHQpO1xuICB9XG5cbiAgcHVibGljIHByaW50U3RhdGVtZW50KGFyZ3M6IHRzLk5vZGVBcnJheTx0cy5FeHByZXNzaW9uPiwgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pIHtcbiAgICByZXR1cm4gbmV3IE9UcmVlKFsnPFBSSU5UPicsICcoJywgdGhpcy5hcmd1bWVudExpc3QoYXJncywgY29udGV4dCksICcpJ10pO1xuICB9XG5cbiAgcHVibGljIGV4cHJlc3Npb25TdGF0ZW1lbnQobm9kZTogdHMuRXhwcmVzc2lvblN0YXRlbWVudCwgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShbY29udGV4dC5jb252ZXJ0KG5vZGUuZXhwcmVzc2lvbildLCBbXSwge1xuICAgICAgY2FuQnJlYWtMaW5lOiB0cnVlLFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHRva2VuPEEgZXh0ZW5kcyB0cy5TeW50YXhLaW5kPihub2RlOiB0cy5Ub2tlbjxBPiwgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShbY29udGV4dC50ZXh0T2Yobm9kZSldKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBbiBvYmplY3QgbGl0ZXJhbCBjYW4gcmVuZGVyIGFzIG9uZSBvZiB0aHJlZSB0aGluZ3M6XG4gICAqXG4gICAqIC0gRG9uJ3Qga25vdyB0aGUgdHlwZSAocmVuZGVyIGFzIGFuIHVua25vd24gc3RydWN0KVxuICAgKiAtIEtub3cgdGhlIHR5cGU6XG4gICAqICAgICAtIEl0J3MgYSBzdHJ1Y3QgKHJlbmRlciBhcyBrbm93biBzdHJ1Y3QpXG4gICAqICAgICAtIEl0J3Mgbm90IGEgc3RydWN0IChyZW5kZXIgYXMga2V5LXZhbHVlIG1hcClcbiAgICovXG4gIHB1YmxpYyBvYmplY3RMaXRlcmFsRXhwcmVzc2lvbihub2RlOiB0cy5PYmplY3RMaXRlcmFsRXhwcmVzc2lvbiwgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgLy8gSWYgYW55IG9mIHRoZSBlbGVtZW50cyBvZiB0aGUgb2JqZWN0TGl0ZXJhbEV4cHJlc3Npb24gYXJlIG5vdCBhIGxpdGVyYWwgcHJvcGVydHlcbiAgICAvLyBhc3NpZ25tZW50LCByZXBvcnQgdGhlbS4gV2UgY2FuJ3Qgc3VwcG9ydCB0aG9zZS5cbiAgICBjb25zdCB1bnN1cHBvcnRlZCA9IG5vZGUucHJvcGVydGllcy5maWx0ZXIoXG4gICAgICAocCkgPT4gIXRzLmlzUHJvcGVydHlBc3NpZ25tZW50KHApICYmICF0cy5pc1Nob3J0aGFuZFByb3BlcnR5QXNzaWdubWVudChwKSxcbiAgICApO1xuICAgIGZvciAoY29uc3QgdW5zdXAgb2YgdW5zdXBwb3J0ZWQpIHtcbiAgICAgIGNvbnRleHQucmVwb3J0KHVuc3VwLCBgVXNlIG9mICR7dHMuU3ludGF4S2luZFt1bnN1cC5raW5kXX0gaW4gYW4gb2JqZWN0IGxpdGVyYWwgaXMgbm90IHN1cHBvcnRlZC5gKTtcbiAgICB9XG5cbiAgICBjb25zdCBsaXQgPSBhbmFseXplT2JqZWN0TGl0ZXJhbChjb250ZXh0LnR5cGVDaGVja2VyLCBub2RlKTtcblxuICAgIHN3aXRjaCAobGl0LmtpbmQpIHtcbiAgICAgIGNhc2UgJ3Vua25vd24nOlxuICAgICAgICByZXR1cm4gdGhpcy51bmtub3duVHlwZU9iamVjdExpdGVyYWxFeHByZXNzaW9uKG5vZGUsIGNvbnRleHQpO1xuICAgICAgY2FzZSAnc3RydWN0JzpcbiAgICAgIGNhc2UgJ2xvY2FsLXN0cnVjdCc6XG4gICAgICAgIHJldHVybiB0aGlzLmtub3duU3RydWN0T2JqZWN0TGl0ZXJhbEV4cHJlc3Npb24obm9kZSwgbGl0LCBjb250ZXh0KTtcbiAgICAgIGNhc2UgJ21hcCc6XG4gICAgICAgIHJldHVybiB0aGlzLmtleVZhbHVlT2JqZWN0TGl0ZXJhbEV4cHJlc3Npb24obm9kZSwgY29udGV4dCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHVua25vd25UeXBlT2JqZWN0TGl0ZXJhbEV4cHJlc3Npb24obm9kZTogdHMuT2JqZWN0TGl0ZXJhbEV4cHJlc3Npb24sIGNvbnRleHQ6IEFzdFJlbmRlcmVyPEM+KTogT1RyZWUge1xuICAgIHJldHVybiB0aGlzLm5vdEltcGxlbWVudGVkKG5vZGUsIGNvbnRleHQpO1xuICB9XG5cbiAgcHVibGljIGtub3duU3RydWN0T2JqZWN0TGl0ZXJhbEV4cHJlc3Npb24oXG4gICAgbm9kZTogdHMuT2JqZWN0TGl0ZXJhbEV4cHJlc3Npb24sXG4gICAgX3N0cnVjdFR5cGU6IE9iamVjdExpdGVyYWxTdHJ1Y3QsXG4gICAgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4sXG4gICk6IE9UcmVlIHtcbiAgICByZXR1cm4gdGhpcy5ub3RJbXBsZW1lbnRlZChub2RlLCBjb250ZXh0KTtcbiAgfVxuXG4gIHB1YmxpYyBrZXlWYWx1ZU9iamVjdExpdGVyYWxFeHByZXNzaW9uKG5vZGU6IHRzLk9iamVjdExpdGVyYWxFeHByZXNzaW9uLCBjb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICByZXR1cm4gdGhpcy5ub3RJbXBsZW1lbnRlZChub2RlLCBjb250ZXh0KTtcbiAgfVxuXG4gIHB1YmxpYyBuZXdFeHByZXNzaW9uKG5vZGU6IHRzLk5ld0V4cHJlc3Npb24sIGNvbnRleHQ6IEFzdFJlbmRlcmVyPEM+KTogT1RyZWUge1xuICAgIHJldHVybiBuZXcgT1RyZWUoXG4gICAgICBbJ25ldyAnLCBjb250ZXh0LmNvbnZlcnQobm9kZS5leHByZXNzaW9uKSwgJygnLCB0aGlzLmFyZ3VtZW50TGlzdChub2RlLmFyZ3VtZW50cywgY29udGV4dCksICcpJ10sXG4gICAgICBbXSxcbiAgICAgIHsgY2FuQnJlYWtMaW5lOiB0cnVlIH0sXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBwcm9wZXJ0eUFzc2lnbm1lbnQobm9kZTogdHMuUHJvcGVydHlBc3NpZ25tZW50LCBjb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICByZXR1cm4gdGhpcy5ub3RJbXBsZW1lbnRlZChub2RlLCBjb250ZXh0KTtcbiAgfVxuXG4gIHB1YmxpYyB2YXJpYWJsZVN0YXRlbWVudChub2RlOiB0cy5WYXJpYWJsZVN0YXRlbWVudCwgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShbY29udGV4dC5jb252ZXJ0KG5vZGUuZGVjbGFyYXRpb25MaXN0KV0sIFtdLCB7XG4gICAgICBjYW5CcmVha0xpbmU6IHRydWUsXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgdmFyaWFibGVEZWNsYXJhdGlvbkxpc3Qobm9kZTogdHMuVmFyaWFibGVEZWNsYXJhdGlvbkxpc3QsIGNvbnRleHQ6IEFzdFJlbmRlcmVyPEM+KTogT1RyZWUge1xuICAgIHJldHVybiBuZXcgT1RyZWUoW10sIGNvbnRleHQuY29udmVydEFsbChub2RlLmRlY2xhcmF0aW9ucykpO1xuICB9XG5cbiAgcHVibGljIHZhcmlhYmxlRGVjbGFyYXRpb24obm9kZTogdHMuVmFyaWFibGVEZWNsYXJhdGlvbiwgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgcmV0dXJuIHRoaXMubm90SW1wbGVtZW50ZWQobm9kZSwgY29udGV4dCk7XG4gIH1cblxuICBwdWJsaWMgYXJyYXlMaXRlcmFsRXhwcmVzc2lvbihub2RlOiB0cy5BcnJheUxpdGVyYWxFeHByZXNzaW9uLCBjb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICByZXR1cm4gbmV3IE9UcmVlKFsnWyddLCBjb250ZXh0LmNvbnZlcnRBbGwobm9kZS5lbGVtZW50cyksIHtcbiAgICAgIHNlcGFyYXRvcjogJywgJyxcbiAgICAgIHN1ZmZpeDogJ10nLFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHNob3J0aGFuZFByb3BlcnR5QXNzaWdubWVudChub2RlOiB0cy5TaG9ydGhhbmRQcm9wZXJ0eUFzc2lnbm1lbnQsIGNvbnRleHQ6IEFzdFJlbmRlcmVyPEM+KTogT1RyZWUge1xuICAgIHJldHVybiB0aGlzLm5vdEltcGxlbWVudGVkKG5vZGUsIGNvbnRleHQpO1xuICB9XG5cbiAgcHVibGljIGZvck9mU3RhdGVtZW50KG5vZGU6IHRzLkZvck9mU3RhdGVtZW50LCBjb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICByZXR1cm4gdGhpcy5ub3RJbXBsZW1lbnRlZChub2RlLCBjb250ZXh0KTtcbiAgfVxuXG4gIHB1YmxpYyBjbGFzc0RlY2xhcmF0aW9uKG5vZGU6IHRzLkNsYXNzRGVjbGFyYXRpb24sIGNvbnRleHQ6IEFzdFJlbmRlcmVyPEM+KTogT1RyZWUge1xuICAgIHJldHVybiB0aGlzLm5vdEltcGxlbWVudGVkKG5vZGUsIGNvbnRleHQpO1xuICB9XG5cbiAgcHVibGljIGNvbnN0cnVjdG9yRGVjbGFyYXRpb24obm9kZTogdHMuQ29uc3RydWN0b3JEZWNsYXJhdGlvbiwgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgcmV0dXJuIHRoaXMubm90SW1wbGVtZW50ZWQobm9kZSwgY29udGV4dCk7XG4gIH1cblxuICBwdWJsaWMgcHJvcGVydHlEZWNsYXJhdGlvbihub2RlOiB0cy5Qcm9wZXJ0eURlY2xhcmF0aW9uLCBjb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICByZXR1cm4gdGhpcy5ub3RJbXBsZW1lbnRlZChub2RlLCBjb250ZXh0KTtcbiAgfVxuXG4gIHB1YmxpYyBjb21wdXRlZFByb3BlcnR5TmFtZShub2RlOiB0cy5FeHByZXNzaW9uLCBjb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICByZXR1cm4gY29udGV4dC5jb252ZXJ0KG5vZGUpO1xuICB9XG5cbiAgcHVibGljIG1ldGhvZERlY2xhcmF0aW9uKG5vZGU6IHRzLk1ldGhvZERlY2xhcmF0aW9uLCBjb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICByZXR1cm4gdGhpcy5ub3RJbXBsZW1lbnRlZChub2RlLCBjb250ZXh0KTtcbiAgfVxuXG4gIHB1YmxpYyBpbnRlcmZhY2VEZWNsYXJhdGlvbihub2RlOiB0cy5JbnRlcmZhY2VEZWNsYXJhdGlvbiwgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgaWYgKGlzTmFtZWRMaWtlU3RydWN0KGNvbnRleHQudGV4dE9mKG5vZGUubmFtZSkpKSB7XG4gICAgICByZXR1cm4gdGhpcy5zdHJ1Y3RJbnRlcmZhY2VEZWNsYXJhdGlvbihub2RlLCBjb250ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMucmVndWxhckludGVyZmFjZURlY2xhcmF0aW9uKG5vZGUsIGNvbnRleHQpO1xuICB9XG5cbiAgcHVibGljIHN0cnVjdEludGVyZmFjZURlY2xhcmF0aW9uKG5vZGU6IHRzLkludGVyZmFjZURlY2xhcmF0aW9uLCBjb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICByZXR1cm4gdGhpcy5ub3RJbXBsZW1lbnRlZChub2RlLCBjb250ZXh0KTtcbiAgfVxuXG4gIHB1YmxpYyByZWd1bGFySW50ZXJmYWNlRGVjbGFyYXRpb24obm9kZTogdHMuSW50ZXJmYWNlRGVjbGFyYXRpb24sIGNvbnRleHQ6IEFzdFJlbmRlcmVyPEM+KTogT1RyZWUge1xuICAgIHJldHVybiB0aGlzLm5vdEltcGxlbWVudGVkKG5vZGUsIGNvbnRleHQpO1xuICB9XG5cbiAgcHVibGljIHByb3BlcnR5U2lnbmF0dXJlKG5vZGU6IHRzLlByb3BlcnR5U2lnbmF0dXJlLCBjb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICByZXR1cm4gdGhpcy5ub3RJbXBsZW1lbnRlZChub2RlLCBjb250ZXh0KTtcbiAgfVxuXG4gIHB1YmxpYyBtZXRob2RTaWduYXR1cmUobm9kZTogdHMuTWV0aG9kU2lnbmF0dXJlLCBjb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICByZXR1cm4gdGhpcy5ub3RJbXBsZW1lbnRlZChub2RlLCBjb250ZXh0KTtcbiAgfVxuXG4gIHB1YmxpYyBhc0V4cHJlc3Npb24obm9kZTogdHMuQXNFeHByZXNzaW9uLCBjb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICByZXR1cm4gdGhpcy5ub3RJbXBsZW1lbnRlZChub2RlLCBjb250ZXh0KTtcbiAgfVxuXG4gIHB1YmxpYyBzcHJlYWRFbGVtZW50KG5vZGU6IHRzLlNwcmVhZEVsZW1lbnQsIGNvbnRleHQ6IEFzdFJlbmRlcmVyPEM+KTogT1RyZWUge1xuICAgIHJldHVybiB0aGlzLm5vdEltcGxlbWVudGVkKG5vZGUsIGNvbnRleHQpO1xuICB9XG5cbiAgcHVibGljIHNwcmVhZEFzc2lnbm1lbnQobm9kZTogdHMuU3ByZWFkQXNzaWdubWVudCwgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgcmV0dXJuIHRoaXMubm90SW1wbGVtZW50ZWQobm9kZSwgY29udGV4dCk7XG4gIH1cblxuICBwdWJsaWMgZWxsaXBzaXMoX25vZGU6IHRzLlNwcmVhZEVsZW1lbnQgfCB0cy5TcHJlYWRBc3NpZ25tZW50LCBfY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShbJy4uLiddKTtcbiAgfVxuXG4gIHB1YmxpYyB0ZW1wbGF0ZUV4cHJlc3Npb24obm9kZTogdHMuVGVtcGxhdGVFeHByZXNzaW9uLCBjb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICByZXR1cm4gdGhpcy5ub3RJbXBsZW1lbnRlZChub2RlLCBjb250ZXh0KTtcbiAgfVxuXG4gIHB1YmxpYyBlbGVtZW50QWNjZXNzRXhwcmVzc2lvbihub2RlOiB0cy5FbGVtZW50QWNjZXNzRXhwcmVzc2lvbiwgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgY29uc3QgZXhwcmVzc2lvbiA9IGNvbnRleHQuY29udmVydChub2RlLmV4cHJlc3Npb24pO1xuICAgIGNvbnN0IGluZGV4ID0gY29udGV4dC5jb252ZXJ0KG5vZGUuYXJndW1lbnRFeHByZXNzaW9uKTtcblxuICAgIHJldHVybiBuZXcgT1RyZWUoW2V4cHJlc3Npb24sICdbJywgaW5kZXgsICddJ10pO1xuICB9XG5cbiAgcHVibGljIG5vbk51bGxFeHByZXNzaW9uKG5vZGU6IHRzLk5vbk51bGxFeHByZXNzaW9uLCBjb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICAvLyBXZSBkZWZhdWx0IHdlIGRyb3AgdGhlIG5vbi1udWxsIGFzc2VydGlvblxuICAgIHJldHVybiBjb250ZXh0LmNvbnZlcnQobm9kZS5leHByZXNzaW9uKTtcbiAgfVxuXG4gIHB1YmxpYyBwYXJlbnRoZXNpemVkRXhwcmVzc2lvbihub2RlOiB0cy5QYXJlbnRoZXNpemVkRXhwcmVzc2lvbiwgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShbJygnLCBjb250ZXh0LmNvbnZlcnQobm9kZS5leHByZXNzaW9uKSwgJyknXSk7XG4gIH1cblxuICBwdWJsaWMgbWFza2luZ1ZvaWRFeHByZXNzaW9uKG5vZGU6IHRzLlZvaWRFeHByZXNzaW9uLCBjb250ZXh0OiBBc3RSZW5kZXJlcjxDPik6IE9UcmVlIHtcbiAgICAvLyBEb24ndCByZW5kZXIgYW55dGhpbmcgYnkgZGVmYXVsdCB3aGVuIG5vZGVzIGFyZSBtYXNrZWRcbiAgICBjb25zdCBhcmcgPSB2b2lkRXhwcmVzc2lvblN0cmluZyhub2RlKTtcbiAgICBpZiAoYXJnID09PSAnYmxvY2snKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb21tZW50UmFuZ2UoXG4gICAgICAgIHtcbiAgICAgICAgICBwb3M6IGNvbnRleHQuZ2V0UG9zaXRpb24obm9kZSkuc3RhcnQsXG4gICAgICAgICAgdGV4dDogJ1xcbi8vIC4uLicsXG4gICAgICAgICAga2luZDogdHMuU3ludGF4S2luZC5TaW5nbGVMaW5lQ29tbWVudFRyaXZpYSxcbiAgICAgICAgICBoYXNUcmFpbGluZ05ld0xpbmU6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgICBjb250ZXh0LFxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKGFyZyA9PT0gJy4uLicpIHtcbiAgICAgIHJldHVybiBuZXcgT1RyZWUoWycuLi4nXSk7XG4gICAgfVxuICAgIHJldHVybiBOT19TWU5UQVg7XG4gIH1cblxuICBwcm90ZWN0ZWQgYXJndW1lbnRMaXN0KGFyZ3M6IHJlYWRvbmx5IHRzLk5vZGVbXSB8IHVuZGVmaW5lZCwgY29udGV4dDogQXN0UmVuZGVyZXI8Qz4pOiBPVHJlZSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShbXSwgYXJncyA/IGNvbnRleHQuY29udmVydEFsbChhcmdzKSA6IFtdLCB7XG4gICAgICBzZXBhcmF0b3I6ICcsICcsXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIG5vdEltcGxlbWVudGVkKG5vZGU6IHRzLk5vZGUsIGNvbnRleHQ6IEFzdFJlbmRlcmVyPEM+KSB7XG4gICAgY29udGV4dC5yZXBvcnRVbnN1cHBvcnRlZChub2RlLCB0aGlzLmxhbmd1YWdlKTtcbiAgICByZXR1cm4gbmltcGwobm9kZSwgY29udGV4dCk7XG4gIH1cbn1cblxuY29uc3QgVU5BUllfT1BTOiB7IFtvcCBpbiB0cy5QcmVmaXhVbmFyeU9wZXJhdG9yXTogc3RyaW5nIH0gPSB7XG4gIFt0cy5TeW50YXhLaW5kLlBsdXNQbHVzVG9rZW5dOiAnKysnLFxuICBbdHMuU3ludGF4S2luZC5NaW51c01pbnVzVG9rZW5dOiAnLS0nLFxuICBbdHMuU3ludGF4S2luZC5QbHVzVG9rZW5dOiAnKycsXG4gIFt0cy5TeW50YXhLaW5kLk1pbnVzVG9rZW5dOiAnLScsXG4gIFt0cy5TeW50YXhLaW5kLlRpbGRlVG9rZW5dOiAnficsXG4gIFt0cy5TeW50YXhLaW5kLkV4Y2xhbWF0aW9uVG9rZW5dOiAnIScsXG59O1xuIl19