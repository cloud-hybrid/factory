"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CSharpVisitor = void 0;
const ts = require("typescript");
const jsii_types_1 = require("../jsii/jsii-types");
const jsii_utils_1 = require("../jsii/jsii-utils");
const packages_1 = require("../jsii/packages");
const o_tree_1 = require("../o-tree");
const renderer_1 = require("../renderer");
const ast_utils_1 = require("../typescript/ast-utils");
const types_1 = require("../typescript/types");
const util_1 = require("../util");
const default_1 = require("./default");
const target_language_1 = require("./target-language");
class CSharpVisitor extends default_1.DefaultVisitor {
    constructor() {
        super(...arguments);
        this.language = target_language_1.TargetLanguage.CSHARP;
        this.defaultContext = {
            propertyOrMethod: false,
            inStructInterface: false,
            inRegularInterface: false,
            inKeyValueList: false,
            stringAsIdentifier: false,
            identifierAsString: false,
            preferObjectLiteralAsStruct: true,
            privatePropertyNames: [],
        };
        /**
         * Aliases for modules
         *
         * If these are encountered in the LHS of a property access, they will be dropped.
         */
        this.dropPropertyAccesses = new Set();
        /**
         * Already imported modules so we don't emit duplicate imports
         */
        this.alreadyImportedNamespaces = new Set();
        /**
         * A map to undo import renames
         *
         * We will always reference the original name in the translation.
         *
         * Maps a local-name to a C# name.
         */
        this.renamedSymbols = new Map();
    }
    mergeContext(old, update) {
        return Object.assign({}, old, update);
    }
    identifier(node, renderer) {
        let text = node.text;
        if (renderer.currentContext.identifierAsString) {
            return new o_tree_1.OTree([JSON.stringify(text)]);
        }
        // Uppercase methods and properties, leave the rest as-is
        if (renderer.currentContext.propertyOrMethod && !renderer.currentContext.privatePropertyNames.includes(text)) {
            text = ucFirst(text);
        }
        return new o_tree_1.OTree([text]);
    }
    importStatement(importStatement, context) {
        var _a, _b, _c, _d, _e, _f;
        const guessedNamespace = guessDotnetNamespace(importStatement.packageName);
        const namespace = (_a = util_1.fmap(importStatement.moduleSymbol, findDotnetName)) !== null && _a !== void 0 ? _a : guessedNamespace;
        if (importStatement.imports.import === 'full') {
            this.dropPropertyAccesses.add(importStatement.imports.alias);
            this.alreadyImportedNamespaces.add(namespace);
            return new o_tree_1.OTree([`using ${namespace};`], [], { canBreakLine: true });
        }
        if (importStatement.imports.import === 'selective') {
            const statements = new Array();
            for (const el of importStatement.imports.elements) {
                const dotnetNs = (_b = util_1.fmap(el.importedSymbol, findDotnetName)) !== null && _b !== void 0 ? _b : `${guessedNamespace}.${ucFirst(el.sourceName)}`;
                // If this is an alias, we only honor it if it's NOT for sure a module
                // (could be an alias import of a class or enum).
                if (el.alias && ((_c = el.importedSymbol) === null || _c === void 0 ? void 0 : _c.symbolType) !== 'module') {
                    this.renamedSymbols.set(el.alias, jsii_utils_1.simpleName(dotnetNs));
                    statements.push(`using ${ucFirst(el.alias)} = ${dotnetNs};`);
                    continue;
                }
                // If we are importing a module directly, drop the occurrences of that
                // identifier further down (turn `mod.MyClass` into `MyClass`).
                if (((_d = el.importedSymbol) === null || _d === void 0 ? void 0 : _d.symbolType) === 'module') {
                    this.dropPropertyAccesses.add((_e = el.alias) !== null && _e !== void 0 ? _e : el.sourceName);
                }
                // Output an import statement for the containing namespace
                const importableNamespace = ((_f = el.importedSymbol) === null || _f === void 0 ? void 0 : _f.symbolType) === 'module' ? dotnetNs : jsii_utils_1.namespaceName(dotnetNs);
                if (this.alreadyImportedNamespaces.has(importableNamespace)) {
                    continue;
                }
                this.alreadyImportedNamespaces.add(importableNamespace);
                statements.push(`using ${importableNamespace};`);
            }
            return new o_tree_1.OTree([], statements, { canBreakLine: true, separator: '\n' });
        }
        return renderer_1.nimpl(importStatement.node, context);
    }
    functionDeclaration(node, renderer) {
        return this.functionLike(node, renderer);
    }
    constructorDeclaration(node, renderer) {
        return this.functionLike(node, renderer, { isConstructor: true });
    }
    methodDeclaration(node, renderer) {
        return this.functionLike(node, renderer);
    }
    methodSignature(node, renderer) {
        return new o_tree_1.OTree([
            this.renderTypeNode(node.type, false, renderer),
            ' ',
            renderer.updateContext({ propertyOrMethod: true }).convert(node.name),
            '(',
            new o_tree_1.OTree([], renderer.convertAll(node.parameters), {
                separator: ', ',
            }),
            ');',
        ], [], { canBreakLine: true });
    }
    // tslint:disable-next-line:max-line-length
    functionLike(node, renderer, opts = {}) {
        var _a, _b, _c;
        const methodName = opts.isConstructor
            ? (_c = (_b = (_a = ast_utils_1.findEnclosingClassDeclaration(node)) === null || _a === void 0 ? void 0 : _a.name) === null || _b === void 0 ? void 0 : _b.text) !== null && _c !== void 0 ? _c : 'MyClass' : renderer.updateContext({ propertyOrMethod: true }).convert(node.name);
        const retType = types_1.determineReturnType(renderer.typeChecker, node);
        const returnType = opts.isConstructor ? '' : this.renderType(node, retType, false, 'void', renderer);
        const baseConstructorCall = new Array();
        if (opts.isConstructor) {
            const superCall = ast_utils_1.findSuperCall(node.body, renderer);
            if (superCall) {
                baseConstructorCall.push(': base(', this.argumentList(superCall.arguments, renderer), ') ');
            }
        }
        const ret = new o_tree_1.OTree([
            ast_utils_1.visibility(node),
            ' ',
            returnType,
            returnType ? ' ' : '',
            methodName,
            '(',
            new o_tree_1.OTree([], renderer.convertAll(node.parameters), {
                separator: ', ',
            }),
            ') ',
            ...baseConstructorCall,
        ], [renderer.convert(node.body)], {
            canBreakLine: true,
        });
        return ret;
    }
    propertyDeclaration(node, renderer) {
        const vis = ast_utils_1.visibility(node);
        const propertyOrMethod = vis !== 'private'; // Capitalize non-private fields
        if (vis === 'private' || node.initializer) {
            // Emit member field
            return new o_tree_1.OTree([
                vis,
                ast_utils_1.isReadOnly(node) ? ' readonly' : '',
                ' ',
                this.renderTypeNode(node.type, node.questionToken !== undefined, renderer),
                ' ',
                renderer.updateContext({ propertyOrMethod }).convert(node.name),
                ...(node.initializer ? [' = ', renderer.convert(node.initializer)] : []),
                ';',
            ], [], { canBreakLine: true });
        }
        // Emit property. No functional difference but slightly more idiomatic
        return new o_tree_1.OTree([
            vis,
            ' ',
            this.renderTypeNode(node.type, node.questionToken !== undefined, renderer),
            ' ',
            renderer.updateContext({ propertyOrMethod }).convert(node.name),
            ' ',
            ast_utils_1.isReadOnly(node) ? '{ get; }' : '{ get; set; }',
        ], [], { canBreakLine: true });
    }
    printStatement(args, renderer) {
        const renderedArgs = args.length === 1
            ? renderer.convertAll(args)
            : [
                '$"',
                new o_tree_1.OTree([], args.map((a) => new o_tree_1.OTree(['{', renderer.convert(a), '}'])), { separator: ' ' }),
                '"',
            ];
        return new o_tree_1.OTree(['Console.WriteLine(', ...renderedArgs, ')']);
    }
    superCallExpression(_node, _renderer) {
        // super() call rendered as part of the constructor already
        return o_tree_1.NO_SYNTAX;
    }
    stringLiteral(node, renderer) {
        if (renderer.currentContext.stringAsIdentifier) {
            return this.identifier(node, renderer);
        }
        if (node.text.includes('\n')) {
            // Multi-line string literals (@"string") in C# do not do escaping. Only " needs to be doubled.
            return new o_tree_1.OTree(['@"', node.text.replace(/"/g, '""'), '"']);
        }
        return new o_tree_1.OTree([JSON.stringify(node.text)]);
    }
    expressionStatement(node, renderer) {
        const inner = renderer.convert(node.expression);
        if (inner.isEmpty) {
            return inner;
        }
        return new o_tree_1.OTree([inner, ';'], [], { canBreakLine: true });
    }
    propertyAccessExpression(node, renderer) {
        const lhs = renderer.textOf(node.expression);
        // Suppress the LHS of the dot operator if it's "this." (not necessary in C#)
        // or if it's an imported module reference (C# has namespace-wide imports).
        const objectExpression = lhs === 'this' || this.dropPropertyAccesses.has(lhs)
            ? []
            : [renderer.updateContext({ propertyOrMethod: false }).convert(node.expression), '.'];
        return new o_tree_1.OTree([...objectExpression, renderer.updateContext({ propertyOrMethod: true }).convert(node.name)]);
    }
    parameterDeclaration(node, renderer) {
        return new o_tree_1.OTree([
            ...(node.dotDotDotToken ? ['params '] : []),
            this.renderTypeNode(node.type, node.questionToken !== undefined, renderer),
            ' ',
            renderer.convert(node.name),
            ...(types_1.parameterAcceptsUndefined(node, node.type && renderer.typeOfType(node.type))
                ? ['=', node.initializer ? renderer.convert(node.initializer) : 'null']
                : []),
        ]);
    }
    propertySignature(node, renderer) {
        const canSet = renderer.currentContext.inStructInterface || !ast_utils_1.isReadOnly(node);
        return new o_tree_1.OTree([
            !renderer.currentContext.inRegularInterface ? `${ast_utils_1.visibility(node)} ` : o_tree_1.NO_SYNTAX,
            this.renderTypeNode(node.type, node.questionToken !== undefined, renderer),
            ' ',
            renderer.updateContext({ propertyOrMethod: true }).convert(node.name),
            ' ',
            canSet ? '{ get; set; }' : '{ get; }',
        ], [], { canBreakLine: true });
    }
    /**
     * Do some work on property accesses to translate common JavaScript-isms to language-specific idioms
     */
    regularCallExpression(node, renderer) {
        return new o_tree_1.OTree([
            renderer.updateContext({ propertyOrMethod: true }).convert(node.expression),
            '(',
            this.argumentList(node.arguments, renderer),
            ')',
        ]);
    }
    classDeclaration(node, renderer) {
        return new o_tree_1.OTree(['class ', renderer.convert(node.name), ...this.classHeritage(node, renderer), '\n{'], renderer
            .updateContext({
            privatePropertyNames: ast_utils_1.privatePropertyNames(node.members, renderer),
        })
            .convertAll(node.members), {
            indent: 4,
            canBreakLine: true,
            suffix: '\n}',
        });
    }
    structInterfaceDeclaration(node, renderer) {
        return new o_tree_1.OTree(['class ', renderer.convert(node.name), ...this.classHeritage(node, renderer), '\n{'], renderer.updateContext({ inStructInterface: true }).convertAll(node.members), {
            indent: 4,
            canBreakLine: true,
            suffix: '\n}',
        });
    }
    regularInterfaceDeclaration(node, renderer) {
        return new o_tree_1.OTree(['interface ', renderer.convert(node.name), ...this.classHeritage(node, renderer), '\n{'], renderer.updateContext({ inRegularInterface: true }).convertAll(node.members), {
            indent: 4,
            canBreakLine: true,
            suffix: '\n}',
        });
    }
    block(node, children) {
        return new o_tree_1.OTree(['\n{'], [...children.convertAll(node.statements)], {
            indent: 4,
            suffix: '\n}',
        });
    }
    unknownTypeObjectLiteralExpression(node, renderer) {
        if (renderer.currentContext.preferObjectLiteralAsStruct) {
            // Type information missing and from context we prefer a struct
            return new o_tree_1.OTree(['new Struct { '], renderer.convertAll(node.properties), {
                suffix: renderer.mirrorNewlineBefore(node.properties[0], '}', ' '),
                separator: ', ',
                indent: 4,
            });
        }
        // Type information missing and from context we prefer a map
        return this.keyValueObjectLiteralExpression(node, renderer);
    }
    knownStructObjectLiteralExpression(node, structType, renderer) {
        return new o_tree_1.OTree(['new ', structType.type.symbol.name, ' { '], renderer.convertAll(node.properties), {
            suffix: renderer.mirrorNewlineBefore(node.properties[0], '}', ' '),
            separator: ', ',
            indent: 4,
        });
    }
    keyValueObjectLiteralExpression(node, renderer) {
        // Try to infer an element type from the elements
        const valueType = types_1.inferMapElementType(node.properties, renderer.typeChecker);
        return new o_tree_1.OTree(['new Dictionary<string, ', this.renderType(node, valueType, false, 'object', renderer), '> { '], renderer.updateContext({ inKeyValueList: true }).convertAll(node.properties), {
            suffix: renderer.mirrorNewlineBefore(node.properties[0], '}', ' '),
            separator: ', ',
            indent: 4,
        });
    }
    shorthandPropertyAssignment(node, renderer) {
        return this.renderPropertyAssignment(node.name, node.name, renderer);
    }
    propertyAssignment(node, renderer) {
        return this.renderPropertyAssignment(node.name, node.initializer, renderer);
    }
    renderPropertyAssignment(key, value, renderer) {
        if (renderer.currentContext.inKeyValueList) {
            return new o_tree_1.OTree([
                '{ ',
                renderer
                    .updateContext({
                    propertyOrMethod: false,
                    identifierAsString: !ts.isComputedPropertyName(key),
                })
                    .convert(key),
                ', ',
                renderer.updateContext({ inKeyValueList: false }).convert(value),
                ' }',
            ], [], { canBreakLine: true });
        }
        return new o_tree_1.OTree([
            renderer.updateContext({ propertyOrMethod: true, stringAsIdentifier: true }).convert(key),
            ' = ',
            renderer.convert(value),
        ], [], { canBreakLine: true });
    }
    arrayLiteralExpression(node, renderer) {
        return new o_tree_1.OTree(['new [] { '], renderer.convertAll(node.elements), {
            separator: ', ',
            suffix: ' }',
            indent: 4,
        });
    }
    ifStatement(node, renderer) {
        const ifStmt = new o_tree_1.OTree(['if (', renderer.convert(node.expression), ') '], [renderer.convert(node.thenStatement)], { canBreakLine: true });
        const elseStmt = node.elseStatement
            ? new o_tree_1.OTree(['else '], [renderer.convert(node.elseStatement)], {
                canBreakLine: true,
            })
            : undefined;
        return elseStmt
            ? new o_tree_1.OTree([], [ifStmt, elseStmt], {
                separator: '\n',
                canBreakLine: true,
            })
            : ifStmt;
    }
    forOfStatement(node, renderer) {
        // This is what a "for (const x of ...)" looks like in the AST
        let variableName = '???';
        ast_utils_1.matchAst(node.initializer, ast_utils_1.nodeOfType(ts.SyntaxKind.VariableDeclarationList, ast_utils_1.nodeOfType('var', ts.SyntaxKind.VariableDeclaration)), (bindings) => {
            variableName = renderer.textOf(bindings.var.name);
        });
        return new o_tree_1.OTree(['for (var ', variableName, ' in ', renderer.convert(node.expression), ') '], [renderer.convert(node.statement)], { canBreakLine: true });
    }
    asExpression(node, context) {
        return new o_tree_1.OTree(['(', this.renderTypeNode(node.type, false, context), ')', context.convert(node.expression)]);
    }
    variableDeclaration(node, renderer) {
        let fallback = 'var';
        if (node.type) {
            fallback = node.type.getText();
        }
        const type = (node.type && renderer.typeOfType(node.type)) ||
            (node.initializer && renderer.typeOfExpression(node.initializer));
        let renderedType = this.renderType(node, type, false, fallback, renderer);
        if (renderedType === 'object') {
            renderedType = 'var';
        }
        if (!node.initializer) {
            return new o_tree_1.OTree([renderedType, ' ', renderer.convert(node.name), ';'], []);
        }
        return new o_tree_1.OTree([
            renderedType,
            ' ',
            renderer.convert(node.name),
            ' = ',
            renderer.updateContext({ preferObjectLiteralAsStruct: false }).convert(node.initializer),
            ';',
        ], [], { canBreakLine: true });
    }
    templateExpression(node, context) {
        var _a;
        // If this is a multi-line string literal, we need not quote much, as @"string" literals in C#
        // do not perform any quoting. The literal quotes in the text however must be doubled.
        const isMultiLine = !!((_a = node.head.rawText) === null || _a === void 0 ? void 0 : _a.includes('\n')) || node.templateSpans.some((span) => { var _a; return (_a = span.literal.rawText) === null || _a === void 0 ? void 0 : _a.includes('\n'); });
        const parts = new Array();
        if (node.head.rawText) {
            parts.push(isMultiLine ? node.head.rawText.replace(/"/g, '""') : ast_utils_1.quoteStringLiteral(node.head.rawText));
        }
        for (const span of node.templateSpans) {
            parts.push(`{${context.textOf(span.expression)}}`);
            if (span.literal.rawText) {
                parts.push(isMultiLine ? span.literal.rawText.replace(/"/g, '""') : ast_utils_1.quoteStringLiteral(span.literal.rawText));
            }
        }
        return new o_tree_1.OTree([isMultiLine ? '$@"' : '$"', ...parts, '"']);
    }
    argumentList(args, renderer) {
        return new o_tree_1.OTree([], args ? renderer.updateContext({ preferObjectLiteralAsStruct: true }).convertAll(args) : [], {
            separator: ', ',
        });
    }
    renderTypeNode(typeNode, questionMark, renderer) {
        if (!typeNode) {
            return 'void';
        }
        return this.renderType(typeNode, renderer.typeOfType(typeNode), questionMark, renderer.textOf(typeNode), renderer);
    }
    renderType(typeNode, type, questionMark, fallback, renderer) {
        if (type === undefined) {
            return fallback;
        }
        const renderedType = doRender(jsii_types_1.determineJsiiType(renderer.typeChecker, type));
        const suffix = questionMark || types_1.typeContainsUndefined(type) ? '?' : '';
        return renderedType + suffix;
        // eslint-disable-next-line consistent-return
        function doRender(jsiiType) {
            switch (jsiiType.kind) {
                case 'unknown':
                    return fallback;
                case 'error':
                    renderer.report(typeNode, jsiiType.message);
                    return fallback;
                case 'map':
                    return `IDictionary<string, ${doRender(jsiiType.elementType)}>`;
                case 'list':
                    return `${doRender(jsiiType.elementType)}[]`;
                case 'namedType':
                    return jsiiType.name;
                case 'builtIn':
                    switch (jsiiType.builtIn) {
                        case 'boolean':
                            return 'boolean';
                        case 'number':
                            return 'int';
                        case 'string':
                            return 'string';
                        case 'any':
                            return 'object';
                    }
            }
        }
    }
    classHeritage(node, renderer) {
        var _a;
        const heritage = util_1.flat(Array.from((_a = node.heritageClauses) !== null && _a !== void 0 ? _a : []).map((h) => Array.from(h.types))).map((t) => renderer.convert(t.expression));
        return heritage.length > 0 ? [' : ', new o_tree_1.OTree([], heritage, { separator: ', ' })] : [];
    }
}
exports.CSharpVisitor = CSharpVisitor;
/**
 * Translation version
 *
 * Bump this when you change something in the implementation to invalidate
 * existing cached translations.
 */
CSharpVisitor.VERSION = '1';
/**
 * Uppercase the first letter
 */
function ucFirst(x) {
    return x.substr(0, 1).toUpperCase() + x.substr(1);
}
/**
 * Find the Java name of a module or type
 */
function findDotnetName(jsiiSymbol) {
    var _a, _b;
    if (!((_a = jsiiSymbol.sourceAssembly) === null || _a === void 0 ? void 0 : _a.assembly)) {
        // Don't have accurate info, just guess
        return jsiiSymbol.symbolType !== 'module' ? jsii_utils_1.simpleName(jsiiSymbol.fqn) : guessDotnetNamespace(jsiiSymbol.fqn);
    }
    const asm = (_b = jsiiSymbol.sourceAssembly) === null || _b === void 0 ? void 0 : _b.assembly;
    return recurse(jsiiSymbol.fqn);
    function recurse(fqn) {
        var _a, _b;
        if (fqn === asm.name) {
            return (_a = packages_1.jsiiTargetParameter(asm, 'dotnet.namespace')) !== null && _a !== void 0 ? _a : guessDotnetNamespace(fqn);
        }
        if ((_b = asm.submodules) === null || _b === void 0 ? void 0 : _b[fqn]) {
            const modName = packages_1.jsiiTargetParameter(asm.submodules[fqn], 'dotnet.namespace');
            if (modName) {
                return modName;
            }
        }
        return `${recurse(jsii_utils_1.namespaceName(fqn))}.${jsii_utils_1.simpleName(jsiiSymbol.fqn)}`;
    }
}
function guessDotnetNamespace(ref) {
    return ref
        .split(/[^a-zA-Z0-9]+/g)
        .filter((s) => s !== '')
        .map(ucFirst)
        .join('.');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3NoYXJwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY3NoYXJwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLGlDQUFpQztBQUVqQyxtREFBc0Y7QUFDdEYsbURBQTJFO0FBQzNFLCtDQUF1RDtBQUN2RCxzQ0FBNkM7QUFDN0MsMENBQWlEO0FBQ2pELHVEQVNpQztBQUVqQywrQ0FLNkI7QUFDN0Isa0NBQXFDO0FBQ3JDLHVDQUEyQztBQUMzQyx1REFBbUQ7QUE4Q25ELE1BQWEsYUFBYyxTQUFRLHdCQUFxQztJQUF4RTs7UUFTa0IsYUFBUSxHQUFHLGdDQUFjLENBQUMsTUFBTSxDQUFDO1FBRWpDLG1CQUFjLEdBQUc7WUFDL0IsZ0JBQWdCLEVBQUUsS0FBSztZQUN2QixpQkFBaUIsRUFBRSxLQUFLO1lBQ3hCLGtCQUFrQixFQUFFLEtBQUs7WUFDekIsY0FBYyxFQUFFLEtBQUs7WUFDckIsa0JBQWtCLEVBQUUsS0FBSztZQUN6QixrQkFBa0IsRUFBRSxLQUFLO1lBQ3pCLDJCQUEyQixFQUFFLElBQUk7WUFDakMsb0JBQW9CLEVBQUUsRUFBRTtTQUN6QixDQUFDO1FBRUY7Ozs7V0FJRztRQUNjLHlCQUFvQixHQUFHLElBQUksR0FBRyxFQUFVLENBQUM7UUFFMUQ7O1dBRUc7UUFDYyw4QkFBeUIsR0FBRyxJQUFJLEdBQUcsRUFBVSxDQUFDO1FBRS9EOzs7Ozs7V0FNRztRQUNjLG1CQUFjLEdBQUcsSUFBSSxHQUFHLEVBQWtCLENBQUM7SUEwakI5RCxDQUFDO0lBeGpCUSxZQUFZLENBQUMsR0FBMEIsRUFBRSxNQUFzQztRQUNwRixPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRU0sVUFBVSxDQUNmLElBQXlFLEVBQ3pFLFFBQXdCO1FBRXhCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFFckIsSUFBSSxRQUFRLENBQUMsY0FBYyxD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VSxDQUFDLEdBQUcsQ0FBQyxFQUFFLGtCQUFrQixDQUFDLENBQUM7WUFDN0UsSUFBSSxPQUFPLEVBQUU7Z0JBQ1gsT0FBTyxPQUFPLENBQUM7YUFDaEI7U0FDRjtRQUVELE9BQU8sR0FBRyxPQUFPLENBQUMsMEJBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLHVCQUFVLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7SUFDeEUsQ0FBQztBQUNILENBQUM7QUFFRCxTQUFTLG9CQUFvQixDQUFDLEdBQVc7SUFDdkMsT0FBTyxHQUFHO1NBQ1AsS0FBSyxDQUFDLGdCQUFnQixDQUFDO1NBQ3ZCLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztTQUN2QixHQUFHLENBQUMsT0FBTyxDQUFDO1NBQ1osSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ2YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHRzIGZyb20gJ3R5cGVzY3JpcHQnO1xuXG5pbXBvcnQgeyBkZXRlcm1pbmVKc2lpVHlwZSwgSnNpaVR5cGUsIE9iamVjdExpdGVyYWxTdHJ1Y3QgfSBmcm9tICcuLi9qc2lpL2pzaWktdHlwZXMnO1xuaW1wb3J0IHsgSnNpaVN5bWJvbCwgc2ltcGxlTmFtZSwgbmFtZXNwYWNlTmFtZSB9IGZyb20gJy4uL2pzaWkvanNpaS11dGlscyc7XG5pbXBvcnQgeyBqc2lpVGFyZ2V0UGFyYW1ldGVyIH0gZnJvbSAnLi4vanNpaS9wYWNrYWdlcyc7XG5pbXBvcnQgeyBPVHJlZSwgTk9fU1lOVEFYIH0gZnJvbSAnLi4vby10cmVlJztcbmltcG9ydCB7IEFzdFJlbmRlcmVyLCBuaW1wbCB9IGZyb20gJy4uL3JlbmRlcmVyJztcbmltcG9ydCB7XG4gIG1hdGNoQXN0LFxuICBub2RlT2ZUeXBlLFxuICBxdW90ZVN0cmluZ0xpdGVyYWwsXG4gIHZpc2liaWxpdHksXG4gIGlzUmVhZE9ubHksXG4gIGZpbmRTdXBlckNhbGwsXG4gIHByaXZhdGVQcm9wZXJ0eU5hbWVzLFxuICBmaW5kRW5jbG9zaW5nQ2xhc3NEZWNsYXJhdGlvbixcbn0gZnJvbSAnLi4vdHlwZXNjcmlwdC9hc3QtdXRpbHMnO1xuaW1wb3J0IHsgSW1wb3J0U3RhdGVtZW50IH0gZnJvbSAnLi4vdHlwZXNjcmlwdC9pbXBvcnRzJztcbmltcG9ydCB7XG4gIHR5cGVDb250YWluc1VuZGVmaW5lZCxcbiAgcGFyYW1ldGVyQWNjZXB0c1VuZGVmaW5lZCxcbiAgaW5mZXJNYXBFbGVtZW50VHlwZSxcbiAgZGV0ZXJtaW5lUmV0dXJuVHlwZSxcbn0gZnJvbSAnLi4vdHlwZXNjcmlwdC90eXBlcyc7XG5pbXBvcnQgeyBmbGF0LCBmbWFwIH0gZnJvbSAnLi4vdXRpbCc7XG5pbXBvcnQgeyBEZWZhdWx0VmlzaXRvciB9IGZyb20gJy4vZGVmYXVsdCc7XG5pbXBvcnQgeyBUYXJnZXRMYW5ndWFnZSB9IGZyb20gJy4vdGFyZ2V0LWxhbmd1YWdlJztcblxuaW50ZXJmYWNlIENTaGFycExhbmd1YWdlQ29udGV4dCB7XG4gIC8qKlxuICAgKiBVc2VkIHRvIGNhcGl0YWxpemUgbWVtYmVyIGFjY2Vzc2VzXG4gICAqL1xuICByZWFkb25seSBwcm9wZXJ0eU9yTWV0aG9kOiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBTbyB3ZSBrbm93IGhvdyB0byByZW5kZXIgcHJvcGVydHkgc2lnbmF0dXJlc1xuICAgKi9cbiAgcmVhZG9ubHkgaW5TdHJ1Y3RJbnRlcmZhY2U6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFNvIHdlIGtub3cgaG93IHRvIHJlbmRlciBwcm9wZXJ0eSBzaWduYXR1cmVzXG4gICAqL1xuICByZWFkb25seSBpblJlZ3VsYXJJbnRlcmZhY2U6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFNvIHdlIGtub3cgaG93IHRvIHJlbmRlciBwcm9wZXJ0eSBhc3NpZ25tZW50c1xuICAgKi9cbiAgcmVhZG9ubHkgaW5LZXlWYWx1ZUxpc3Q6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgYSBzdHJpbmcgbGl0ZXJhbCBpcyBjdXJyZW50bHkgaW4gdGhlIHBvc2l0aW9uIG9mIGhhdmluZyB0byByZW5kZXIgYXMgYW4gaWRlbnRpZmllciAoTEhTIGluIHByb3BlcnR5IGFzc2lnbm1lbnQpXG4gICAqL1xuICByZWFkb25seSBzdHJpbmdBc0lkZW50aWZpZXI6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgYW4gaWRlbnRpZmllciBsaXRlcmFsIGlzIGN1cnJlbnRseSBpbiB0aGUgcG9zaXRpb24gb2YgaGF2aW5nIHRvIHJlbmRlciBhcyBhIHN0cmluZyAoTEhTIGluIHByb3BlcnR5IGFzc2lnbm1lbnQpXG4gICAqL1xuICByZWFkb25seSBpZGVudGlmaWVyQXNTdHJpbmc6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFdoZW4gcGFyc2luZyBhbiBvYmplY3QgbGl0ZXJhbCBhbmQgbm8gdHlwZSBpbmZvcm1hdGlvbiBpcyBhdmFpbGFibGUsIHByZWZlciBwYXJzaW5nIGl0IGFzIGEgc3RydWN0IHRvIHBhcnNpbmcgaXQgYXMgYSBtYXBcbiAgICovXG4gIHJlYWRvbmx5IHByZWZlck9iamVjdExpdGVyYWxBc1N0cnVjdDogYm9vbGVhbjtcblxuICAvKipcbiAgICogV2hlbiBlbmNvdW50ZXJpbmcgdGhlc2UgcHJvcGVydGllcywgcmVuZGVyIHRoZW0gYXMgbG93ZXJjYXNlIGluc3RlYWQgb2YgdXBwZXJjYXNlXG4gICAqL1xuICByZWFkb25seSBwcml2YXRlUHJvcGVydHlOYW1lczogc3RyaW5nW107XG59XG5cbnR5cGUgQ1NoYXJwUmVuZGVyZXIgPSBBc3RSZW5kZXJlcjxDU2hhcnBMYW5ndWFnZUNvbnRleHQ+O1xuXG5leHBvcnQgY2xhc3MgQ1NoYXJwVmlzaXRvciBleHRlbmRzIERlZmF1bHRWaXNpdG9yPENTaGFycExhbmd1YWdlQ29udGV4dD4ge1xuICAvKipcbiAgICogVHJhbnNsYXRpb24gdmVyc2lvblxuICAgKlxuICAgKiBCdW1wIHRoaXMgd2hlbiB5b3UgY2hhbmdlIHNvbWV0aGluZyBpbiB0aGUgaW1wbGVtZW50YXRpb24gdG8gaW52YWxpZGF0ZVxuICAgKiBleGlzdGluZyBjYWNoZWQgdHJhbnNsYXRpb25zLlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBWRVJTSU9OID0gJzEnO1xuXG4gIHB1YmxpYyByZWFkb25seSBsYW5ndWFnZSA9IFRhcmdldExhbmd1YWdlLkNTSEFSUDtcblxuICBwdWJsaWMgcmVhZG9ubHkgZGVmYXVsdENvbnRleHQgPSB7XG4gICAgcHJvcGVydHlPck1ldGhvZDogZmFsc2UsXG4gICAgaW5TdHJ1Y3RJbnRlcmZhY2U6IGZhbHNlLFxuICAgIGluUmVndWxhckludGVyZmFjZTogZmFsc2UsXG4gICAgaW5LZXlWYWx1ZUxpc3Q6IGZhbHNlLFxuICAgIHN0cmluZ0FzSWRlbnRpZmllcjogZmFsc2UsXG4gICAgaWRlbnRpZmllckFzU3RyaW5nOiBmYWxzZSxcbiAgICBwcmVmZXJPYmplY3RMaXRlcmFsQXNTdHJ1Y3Q6IHRydWUsXG4gICAgcHJpdmF0ZVByb3BlcnR5TmFtZXM6IFtdLFxuICB9O1xuXG4gIC8qKlxuICAgKiBBbGlhc2VzIGZvciBtb2R1bGVzXG4gICAqXG4gICAqIElmIHRoZXNlIGFyZSBlbmNvdW50ZXJlZCBpbiB0aGUgTEhTIG9mIGEgcHJvcGVydHkgYWNjZXNzLCB0aGV5IHdpbGwgYmUgZHJvcHBlZC5cbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgZHJvcFByb3BlcnR5QWNjZXNzZXMgPSBuZXcgU2V0PHN0cmluZz4oKTtcblxuICAvKipcbiAgICogQWxyZWFkeSBpbXBvcnRlZCBtb2R1bGVzIHNvIHdlIGRvbid0IGVtaXQgZHVwbGljYXRlIGltcG9ydHNcbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgYWxyZWFkeUltcG9ydGVkTmFtZXNwYWNlcyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuXG4gIC8qKlxuICAgKiBBIG1hcCB0byB1bmRvIGltcG9ydCByZW5hbWVzXG4gICAqXG4gICAqIFdlIHdpbGwgYWx3YXlzIHJlZmVyZW5jZSB0aGUgb3JpZ2luYWwgbmFtZSBpbiB0aGUgdHJhbnNsYXRpb24uXG4gICAqXG4gICAqIE1hcHMgYSBsb2NhbC1uYW1lIHRvIGEgQyMgbmFtZS5cbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgcmVuYW1lZFN5bWJvbHMgPSBuZXcgTWFwPHN0cmluZywgc3RyaW5nPigpO1xuXG4gIHB1YmxpYyBtZXJnZUNvbnRleHQob2xkOiBDU2hhcnBMYW5ndWFnZUNvbnRleHQsIHVwZGF0ZTogUGFydGlhbDxDU2hhcnBMYW5ndWFnZUNvbnRleHQ+KTogQ1NoYXJwTGFuZ3VhZ2VDb250ZXh0IHtcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgb2xkLCB1cGRhdGUpO1xuICB9XG5cbiAgcHVibGljIGlkZW50aWZpZXIoXG4gICAgbm9kZTogdHMuSWRlbnRpZmllciB8IHRzLlN0cmluZ0xpdGVyYWwgfCB0cy5Ob1N1YnN0aXR1dGlvblRlbXBsYXRlTGl0ZXJhbCxcbiAgICByZW5kZXJlcjogQ1NoYXJwUmVuZGVyZXIsXG4gICkge1xuICAgIGxldCB0ZXh0ID0gbm9kZS50ZXh0O1xuXG4gICAgaWYgKHJlbmRlcmVyLmN1cnJlbnRDb250ZXh0LmlkZW50aWZpZXJBc1N0cmluZykge1xuICAgICAgcmV0dXJuIG5ldyBPVHJlZShbSlNPTi5zdHJpbmdpZnkodGV4dCldKTtcbiAgICB9XG5cbiAgICAvLyBVcHBlcmNhc2UgbWV0aG9kcyBhbmQgcHJvcGVydGllcywgbGVhdmUgdGhlIHJlc3QgYXMtaXNcbiAgICBpZiAocmVuZGVyZXIuY3VycmVudENvbnRleHQucHJvcGVydHlPck1ldGhvZCAmJiAhcmVuZGVyZXIuY3VycmVudENvbnRleHQucHJpdmF0ZVByb3BlcnR5TmFtZXMuaW5jbHVkZXModGV4dCkpIHtcbiAgICAgIHRleHQgPSB1Y0ZpcnN0KHRleHQpO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgT1RyZWUoW3RleHRdKTtcbiAgfVxuXG4gIHB1YmxpYyBpbXBvcnRTdGF0ZW1lbnQoaW1wb3J0U3RhdGVtZW50OiBJbXBvcnRTdGF0ZW1lbnQsIGNvbnRleHQ6IENTaGFycFJlbmRlcmVyKTogT1RyZWUge1xuICAgIGNvbnN0IGd1ZXNzZWROYW1lc3BhY2UgPSBndWVzc0RvdG5ldE5hbWVzcGFjZShpbXBvcnRTdGF0ZW1lbnQucGFja2FnZU5hbWUpO1xuICAgIGNvbnN0IG5hbWVzcGFjZSA9IGZtYXAoaW1wb3J0U3RhdGVtZW50Lm1vZHVsZVN5bWJvbCwgZmluZERvdG5ldE5hbWUpID8/IGd1ZXNzZWROYW1lc3BhY2U7XG5cbiAgICBpZiAoaW1wb3J0U3RhdGVtZW50LmltcG9ydHMuaW1wb3J0ID09PSAnZnVsbCcpIHtcbiAgICAgIHRoaXMuZHJvcFByb3BlcnR5QWNjZXNzZXMuYWRkKGltcG9ydFN0YXRlbWVudC5pbXBvcnRzLmFsaWFzKTtcbiAgICAgIHRoaXMuYWxyZWFkeUltcG9ydGVkTmFtZXNwYWNlcy5hZGQobmFtZXNwYWNlKTtcbiAgICAgIHJldHVybiBuZXcgT1RyZWUoW2B1c2luZyAke25hbWVzcGFjZX07YF0sIFtdLCB7IGNhbkJyZWFrTGluZTogdHJ1ZSB9KTtcbiAgICB9XG4gICAgaWYgKGltcG9ydFN0YXRlbWVudC5pbXBvcnRzLmltcG9ydCA9PT0gJ3NlbGVjdGl2ZScpIHtcbiAgICAgIGNvbnN0IHN0YXRlbWVudHMgPSBuZXcgQXJyYXk8c3RyaW5nPigpO1xuXG4gICAgICBmb3IgKGNvbnN0IGVsIG9mIGltcG9ydFN0YXRlbWVudC5pbXBvcnRzLmVsZW1lbnRzKSB7XG4gICAgICAgIGNvbnN0IGRvdG5ldE5zID0gZm1hcChlbC5pbXBvcnRlZFN5bWJvbCwgZmluZERvdG5ldE5hbWUpID8/IGAke2d1ZXNzZWROYW1lc3BhY2V9LiR7dWNGaXJzdChlbC5zb3VyY2VOYW1lKX1gO1xuXG4gICAgICAgIC8vIElmIHRoaXMgaXMgYW4gYWxpYXMsIHdlIG9ubHkgaG9ub3IgaXQgaWYgaXQncyBOT1QgZm9yIHN1cmUgYSBtb2R1bGVcbiAgICAgICAgLy8gKGNvdWxkIGJlIGFuIGFsaWFzIGltcG9ydCBvZiBhIGNsYXNzIG9yIGVudW0pLlxuICAgICAgICBpZiAoZWwuYWxpYXMgJiYgZWwuaW1wb3J0ZWRTeW1ib2w/LnN5bWJvbFR5cGUgIT09ICdtb2R1bGUnKSB7XG4gICAgICAgICAgdGhpcy5yZW5hbWVkU3ltYm9scy5zZXQoZWwuYWxpYXMsIHNpbXBsZU5hbWUoZG90bmV0TnMpKTtcbiAgICAgICAgICBzdGF0ZW1lbnRzLnB1c2goYHVzaW5nICR7dWNGaXJzdChlbC5hbGlhcyl9ID0gJHtkb3RuZXROc307YCk7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiB3ZSBhcmUgaW1wb3J0aW5nIGEgbW9kdWxlIGRpcmVjdGx5LCBkcm9wIHRoZSBvY2N1cnJlbmNlcyBvZiB0aGF0XG4gICAgICAgIC8vIGlkZW50aWZpZXIgZnVydGhlciBkb3duICh0dXJuIGBtb2QuTXlDbGFzc2AgaW50byBgTXlDbGFzc2ApLlxuICAgICAgICBpZiAoZWwuaW1wb3J0ZWRTeW1ib2w/LnN5bWJvbFR5cGUgPT09ICdtb2R1bGUnKSB7XG4gICAgICAgICAgdGhpcy5kcm9wUHJvcGVydHlBY2Nlc3Nlcy5hZGQoZWwuYWxpYXMgPz8gZWwuc291cmNlTmFtZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBPdXRwdXQgYW4gaW1wb3J0IHN0YXRlbWVudCBmb3IgdGhlIGNvbnRhaW5pbmcgbmFtZXNwYWNlXG4gICAgICAgIGNvbnN0IGltcG9ydGFibGVOYW1lc3BhY2UgPSBlbC5pbXBvcnRlZFN5bWJvbD8uc3ltYm9sVHlwZSA9PT0gJ21vZHVsZScgPyBkb3RuZXROcyA6IG5hbWVzcGFjZU5hbWUoZG90bmV0TnMpO1xuICAgICAgICBpZiAodGhpcy5hbHJlYWR5SW1wb3J0ZWROYW1lc3BhY2VzLmhhcyhpbXBvcnRhYmxlTmFtZXNwYWNlKSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hbHJlYWR5SW1wb3J0ZWROYW1lc3BhY2VzLmFkZChpbXBvcnRhYmxlTmFtZXNwYWNlKTtcbiAgICAgICAgc3RhdGVtZW50cy5wdXNoKGB1c2luZyAke2ltcG9ydGFibGVOYW1lc3BhY2V9O2ApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IE9UcmVlKFtdLCBzdGF0ZW1lbnRzLCB7IGNhbkJyZWFrTGluZTogdHJ1ZSwgc2VwYXJhdG9yOiAnXFxuJyB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmltcGwoaW1wb3J0U3RhdGVtZW50Lm5vZGUsIGNvbnRleHQpO1xuICB9XG5cbiAgcHVibGljIGZ1bmN0aW9uRGVjbGFyYXRpb24obm9kZTogdHMuRnVuY3Rpb25EZWNsYXJhdGlvbiwgcmVuZGVyZXI6IENTaGFycFJlbmRlcmVyKTogT1RyZWUge1xuICAgIHJldHVybiB0aGlzLmZ1bmN0aW9uTGlrZShub2RlLCByZW5kZXJlcik7XG4gIH1cblxuICBwdWJsaWMgY29uc3RydWN0b3JEZWNsYXJhdGlvbihub2RlOiB0cy5Db25zdHJ1Y3RvckRlY2xhcmF0aW9uLCByZW5kZXJlcjogQ1NoYXJwUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgcmV0dXJuIHRoaXMuZnVuY3Rpb25MaWtlKG5vZGUsIHJlbmRlcmVyLCB7IGlzQ29uc3RydWN0b3I6IHRydWUgfSk7XG4gIH1cblxuICBwdWJsaWMgbWV0aG9kRGVjbGFyYXRpb24obm9kZTogdHMuTWV0aG9kRGVjbGFyYXRpb24sIHJlbmRlcmVyOiBDU2hhcnBSZW5kZXJlcik6IE9UcmVlIHtcbiAgICByZXR1cm4gdGhpcy5mdW5jdGlvbkxpa2Uobm9kZSwgcmVuZGVyZXIpO1xuICB9XG5cbiAgcHVibGljIG1ldGhvZFNpZ25hdHVyZShub2RlOiB0cy5NZXRob2RTaWduYXR1cmUsIHJlbmRlcmVyOiBDU2hhcnBSZW5kZXJlcik6IE9UcmVlIHtcbiAgICByZXR1cm4gbmV3IE9UcmVlKFxuICAgICAgW1xuICAgICAgICB0aGlzLnJlbmRlclR5cGVOb2RlKG5vZGUudHlwZSwgZmFsc2UsIHJlbmRlcmVyKSxcbiAgICAgICAgJyAnLFxuICAgICAgICByZW5kZXJlci51cGRhdGVDb250ZXh0KHsgcHJvcGVydHlPck1ldGhvZDogdHJ1ZSB9KS5jb252ZXJ0KG5vZGUubmFtZSksXG4gICAgICAgICcoJyxcbiAgICAgICAgbmV3IE9UcmVlKFtdLCByZW5kZXJlci5jb252ZXJ0QWxsKG5vZGUucGFyYW1ldGVycyksIHtcbiAgICAgICAgICBzZXBhcmF0b3I6ICcsICcsXG4gICAgICAgIH0pLFxuICAgICAgICAnKTsnLFxuICAgICAgXSxcbiAgICAgIFtdLFxuICAgICAgeyBjYW5CcmVha0xpbmU6IHRydWUgfSxcbiAgICApO1xuICB9XG5cbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxuICBwdWJsaWMgZnVuY3Rpb25MaWtlKFxuICAgIG5vZGU6IHRzLkZ1bmN0aW9uTGlrZURlY2xhcmF0aW9uIHwgdHMuQ29uc3RydWN0b3JEZWNsYXJhdGlvbiB8IHRzLk1ldGhvZERlY2xhcmF0aW9uLFxuICAgIHJlbmRlcmVyOiBDU2hhcnBSZW5kZXJlcixcbiAgICBvcHRzOiB7IGlzQ29uc3RydWN0b3I/OiBib29sZWFuIH0gPSB7fSxcbiAgKTogT1RyZWUge1xuICAgIGNvbnN0IG1ldGhvZE5hbWUgPSBvcHRzLmlzQ29uc3RydWN0b3JcbiAgICAgID8gZmluZEVuY2xvc2luZ0NsYXNzRGVjbGFyYXRpb24obm9kZSk/Lm5hbWU/LnRleHQgPz8gJ015Q2xhc3MnXG4gICAgICA6IHJlbmRlcmVyLnVwZGF0ZUNvbnRleHQoeyBwcm9wZXJ0eU9yTWV0aG9kOiB0cnVlIH0pLmNvbnZlcnQobm9kZS5uYW1lKTtcblxuICAgIGNvbnN0IHJldFR5cGUgPSBkZXRlcm1pbmVSZXR1cm5UeXBlKHJlbmRlcmVyLnR5cGVDaGVja2VyLCBub2RlKTtcbiAgICBjb25zdCByZXR1cm5UeXBlID0gb3B0cy5pc0NvbnN0cnVjdG9yID8gJycgOiB0aGlzLnJlbmRlclR5cGUobm9kZSwgcmV0VHlwZSwgZmFsc2UsICd2b2lkJywgcmVuZGVyZXIpO1xuXG4gICAgY29uc3QgYmFzZUNvbnN0cnVjdG9yQ2FsbCA9IG5ldyBBcnJheTxzdHJpbmcgfCBPVHJlZT4oKTtcbiAgICBpZiAob3B0cy5pc0NvbnN0cnVjdG9yKSB7XG4gICAgICBjb25zdCBzdXBlckNhbGwgPSBmaW5kU3VwZXJDYWxsKG5vZGUuYm9keSwgcmVuZGVyZXIpO1xuICAgICAgaWYgKHN1cGVyQ2FsbCkge1xuICAgICAgICBiYXNlQ29uc3RydWN0b3JDYWxsLnB1c2goJzogYmFzZSgnLCB0aGlzLmFyZ3VtZW50TGlzdChzdXBlckNhbGwuYXJndW1lbnRzLCByZW5kZXJlciksICcpICcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHJldCA9IG5ldyBPVHJlZShcbiAgICAgIFtcbiAgICAgICAgdmlzaWJpbGl0eShub2RlKSxcbiAgICAgICAgJyAnLFxuICAgICAgICByZXR1cm5UeXBlLFxuICAgICAgICByZXR1cm5UeXBlID8gJyAnIDogJycsXG4gICAgICAgIG1ldGhvZE5hbWUsXG4gICAgICAgICcoJyxcbiAgICAgICAgbmV3IE9UcmVlKFtdLCByZW5kZXJlci5jb252ZXJ0QWxsKG5vZGUucGFyYW1ldGVycyksIHtcbiAgICAgICAgICBzZXBhcmF0b3I6ICcsICcsXG4gICAgICAgIH0pLFxuICAgICAgICAnKSAnLFxuICAgICAgICAuLi5iYXNlQ29uc3RydWN0b3JDYWxsLFxuICAgICAgXSxcbiAgICAgIFtyZW5kZXJlci5jb252ZXJ0KG5vZGUuYm9keSldLFxuICAgICAge1xuICAgICAgICBjYW5CcmVha0xpbmU6IHRydWUsXG4gICAgICB9LFxuICAgICk7XG5cbiAgICByZXR1cm4gcmV0O1xuICB9XG5cbiAgcHVibGljIHByb3BlcnR5RGVjbGFyYXRpb24obm9kZTogdHMuUHJvcGVydHlEZWNsYXJhdGlvbiwgcmVuZGVyZXI6IENTaGFycFJlbmRlcmVyKTogT1RyZWUge1xuICAgIGNvbnN0IHZpcyA9IHZpc2liaWxpdHkobm9kZSk7XG4gICAgY29uc3QgcHJvcGVydHlPck1ldGhvZCA9IHZpcyAhPT0gJ3ByaXZhdGUnOyAvLyBDYXBpdGFsaXplIG5vbi1wcml2YXRlIGZpZWxkc1xuXG4gICAgaWYgKHZpcyA9PT0gJ3ByaXZhdGUnIHx8IG5vZGUuaW5pdGlhbGl6ZXIpIHtcbiAgICAgIC8vIEVtaXQgbWVtYmVyIGZpZWxkXG4gICAgICByZXR1cm4gbmV3IE9UcmVlKFxuICAgICAgICBbXG4gICAgICAgICAgdmlzLFxuICAgICAgICAgIGlzUmVhZE9ubHkobm9kZSkgPyAnIHJlYWRvbmx5JyA6ICcnLFxuICAgICAgICAgICcgJyxcbiAgICAgICAgICB0aGlzLnJlbmRlclR5cGVOb2RlKG5vZGUudHlwZSwgbm9kZS5xdWVzdGlvblRva2VuICE9PSB1bmRlZmluZWQsIHJlbmRlcmVyKSxcbiAgICAgICAgICAnICcsXG4gICAgICAgICAgcmVuZGVyZXIudXBkYXRlQ29udGV4dCh7IHByb3BlcnR5T3JNZXRob2QgfSkuY29udmVydChub2RlLm5hbWUpLFxuICAgICAgICAgIC4uLihub2RlLmluaXRpYWxpemVyID8gWycgPSAnLCByZW5kZXJlci5jb252ZXJ0KG5vZGUuaW5pdGlhbGl6ZXIpXSA6IFtdKSxcbiAgICAgICAgICAnOycsXG4gICAgICAgIF0sXG4gICAgICAgIFtdLFxuICAgICAgICB7IGNhbkJyZWFrTGluZTogdHJ1ZSB9LFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBFbWl0IHByb3BlcnR5LiBObyBmdW5jdGlvbmFsIGRpZmZlcmVuY2UgYnV0IHNsaWdodGx5IG1vcmUgaWRpb21hdGljXG4gICAgcmV0dXJuIG5ldyBPVHJlZShcbiAgICAgIFtcbiAgICAgICAgdmlzLFxuICAgICAgICAnICcsXG4gICAgICAgIHRoaXMucmVuZGVyVHlwZU5vZGUobm9kZS50eXBlLCBub2RlLnF1ZXN0aW9uVG9rZW4gIT09IHVuZGVmaW5lZCwgcmVuZGVyZXIpLFxuICAgICAgICAnICcsXG4gICAgICAgIHJlbmRlcmVyLnVwZGF0ZUNvbnRleHQoeyBwcm9wZXJ0eU9yTWV0aG9kIH0pLmNvbnZlcnQobm9kZS5uYW1lKSxcbiAgICAgICAgJyAnLFxuICAgICAgICBpc1JlYWRPbmx5KG5vZGUpID8gJ3sgZ2V0OyB9JyA6ICd7IGdldDsgc2V0OyB9JyxcbiAgICAgIF0sXG4gICAgICBbXSxcbiAgICAgIHsgY2FuQnJlYWtMaW5lOiB0cnVlIH0sXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBwcmludFN0YXRlbWVudChhcmdzOiB0cy5Ob2RlQXJyYXk8dHMuRXhwcmVzc2lvbj4sIHJlbmRlcmVyOiBDU2hhcnBSZW5kZXJlcikge1xuICAgIGNvbnN0IHJlbmRlcmVkQXJncyA9XG4gICAgICBhcmdzLmxlbmd0aCA9PT0gMVxuICAgICAgICA/IHJlbmRlcmVyLmNvbnZlcnRBbGwoYXJncylcbiAgICAgICAgOiBbXG4gICAgICAgICAgICAnJFwiJyxcbiAgICAgICAgICAgIG5ldyBPVHJlZShcbiAgICAgICAgICAgICAgW10sXG4gICAgICAgICAgICAgIGFyZ3MubWFwKChhKSA9PiBuZXcgT1RyZWUoWyd7JywgcmVuZGVyZXIuY29udmVydChhKSwgJ30nXSkpLFxuICAgICAgICAgICAgICB7IHNlcGFyYXRvcjogJyAnIH0sXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgJ1wiJyxcbiAgICAgICAgICBdO1xuXG4gICAgcmV0dXJuIG5ldyBPVHJlZShbJ0NvbnNvbGUuV3JpdGVMaW5lKCcsIC4uLnJlbmRlcmVkQXJncywgJyknXSk7XG4gIH1cblxuICBwdWJsaWMgc3VwZXJDYWxsRXhwcmVzc2lvbihfbm9kZTogdHMuQ2FsbEV4cHJlc3Npb24sIF9yZW5kZXJlcjogQ1NoYXJwUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgLy8gc3VwZXIoKSBjYWxsIHJlbmRlcmVkIGFzIHBhcnQgb2YgdGhlIGNvbnN0cnVjdG9yIGFscmVhZHlcbiAgICByZXR1cm4gTk9fU1lOVEFYO1xuICB9XG5cbiAgcHVibGljIHN0cmluZ0xpdGVyYWwobm9kZTogdHMuU3RyaW5nTGl0ZXJhbCB8IHRzLk5vU3Vic3RpdHV0aW9uVGVtcGxhdGVMaXRlcmFsLCByZW5kZXJlcjogQ1NoYXJwUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgaWYgKHJlbmRlcmVyLmN1cnJlbnRDb250ZXh0LnN0cmluZ0FzSWRlbnRpZmllcikge1xuICAgICAgcmV0dXJuIHRoaXMuaWRlbnRpZmllcihub2RlLCByZW5kZXJlcik7XG4gICAgfVxuICAgIGlmIChub2RlLnRleHQuaW5jbHVkZXMoJ1xcbicpKSB7XG4gICAgICAvLyBNdWx0aS1saW5lIHN0cmluZyBsaXRlcmFscyAoQFwic3RyaW5nXCIpIGluIEMjIGRvIG5vdCBkbyBlc2NhcGluZy4gT25seSBcIiBuZWVkcyB0byBiZSBkb3VibGVkLlxuICAgICAgcmV0dXJuIG5ldyBPVHJlZShbJ0BcIicsIG5vZGUudGV4dC5yZXBsYWNlKC9cIi9nLCAnXCJcIicpLCAnXCInXSk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgT1RyZWUoW0pTT04uc3RyaW5naWZ5KG5vZGUudGV4dCldKTtcbiAgfVxuXG4gIHB1YmxpYyBleHByZXNzaW9uU3RhdGVtZW50KG5vZGU6IHRzLkV4cHJlc3Npb25TdGF0ZW1lbnQsIHJlbmRlcmVyOiBDU2hhcnBSZW5kZXJlcik6IE9UcmVlIHtcbiAgICBjb25zdCBpbm5lciA9IHJlbmRlcmVyLmNvbnZlcnQobm9kZS5leHByZXNzaW9uKTtcbiAgICBpZiAoaW5uZXIuaXNFbXB0eSkge1xuICAgICAgcmV0dXJuIGlubmVyO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IE9UcmVlKFtpbm5lciwgJzsnXSwgW10sIHsgY2FuQnJlYWtMaW5lOiB0cnVlIH0pO1xuICB9XG5cbiAgcHVibGljIHByb3BlcnR5QWNjZXNzRXhwcmVzc2lvbihub2RlOiB0cy5Qcm9wZXJ0eUFjY2Vzc0V4cHJlc3Npb24sIHJlbmRlcmVyOiBDU2hhcnBSZW5kZXJlcik6IE9UcmVlIHtcbiAgICBjb25zdCBsaHMgPSByZW5kZXJlci50ZXh0T2Yobm9kZS5leHByZXNzaW9uKTtcblxuICAgIC8vIFN1cHByZXNzIHRoZSBMSFMgb2YgdGhlIGRvdCBvcGVyYXRvciBpZiBpdCdzIFwidGhpcy5cIiAobm90IG5lY2Vzc2FyeSBpbiBDIylcbiAgICAvLyBvciBpZiBpdCdzIGFuIGltcG9ydGVkIG1vZHVsZSByZWZlcmVuY2UgKEMjIGhhcyBuYW1lc3BhY2Utd2lkZSBpbXBvcnRzKS5cbiAgICBjb25zdCBvYmplY3RFeHByZXNzaW9uID1cbiAgICAgIGxocyA9PT0gJ3RoaXMnIHx8IHRoaXMuZHJvcFByb3BlcnR5QWNjZXNzZXMuaGFzKGxocylcbiAgICAgICAgPyBbXVxuICAgICAgICA6IFtyZW5kZXJlci51cGRhdGVDb250ZXh0KHsgcHJvcGVydHlPck1ldGhvZDogZmFsc2UgfSkuY29udmVydChub2RlLmV4cHJlc3Npb24pLCAnLiddO1xuXG4gICAgcmV0dXJuIG5ldyBPVHJlZShbLi4ub2JqZWN0RXhwcmVzc2lvbiwgcmVuZGVyZXIudXBkYXRlQ29udGV4dCh7IHByb3BlcnR5T3JNZXRob2Q6IHRydWUgfSkuY29udmVydChub2RlLm5hbWUpXSk7XG4gIH1cblxuICBwdWJsaWMgcGFyYW1ldGVyRGVjbGFyYXRpb24obm9kZTogdHMuUGFyYW1ldGVyRGVjbGFyYXRpb24sIHJlbmRlcmVyOiBDU2hhcnBSZW5kZXJlcik6IE9UcmVlIHtcbiAgICByZXR1cm4gbmV3IE9UcmVlKFtcbiAgICAgIC4uLihub2RlLmRvdERvdERvdFRva2VuID8gWydwYXJhbXMgJ10gOiBbXSksIC8vIFZhcmFyZ3MuIFJlbmRlciB3aXRoICdwYXJhbXMnIGtleXdvcmRcbiAgICAgIHRoaXMucmVuZGVyVHlwZU5vZGUobm9kZS50eXBlLCBub2RlLnF1ZXN0aW9uVG9rZW4gIT09IHVuZGVmaW5lZCwgcmVuZGVyZXIpLFxuICAgICAgJyAnLFxuICAgICAgcmVuZGVyZXIuY29udmVydChub2RlLm5hbWUpLFxuICAgICAgLi4uKHBhcmFtZXRlckFjY2VwdHNVbmRlZmluZWQobm9kZSwgbm9kZS50eXBlICYmIHJlbmRlcmVyLnR5cGVPZlR5cGUobm9kZS50eXBlKSlcbiAgICAgICAgPyBbJz0nLCBub2RlLmluaXRpYWxpemVyID8gcmVuZGVyZXIuY29udmVydChub2RlLmluaXRpYWxpemVyKSA6ICdudWxsJ11cbiAgICAgICAgOiBbXSksXG4gICAgXSk7XG4gIH1cblxuICBwdWJsaWMgcHJvcGVydHlTaWduYXR1cmUobm9kZTogdHMuUHJvcGVydHlTaWduYXR1cmUsIHJlbmRlcmVyOiBDU2hhcnBSZW5kZXJlcik6IE9UcmVlIHtcbiAgICBjb25zdCBjYW5TZXQgPSByZW5kZXJlci5jdXJyZW50Q29udGV4dC5pblN0cnVjdEludGVyZmFjZSB8fCAhaXNSZWFkT25seShub2RlKTtcblxuICAgIHJldHVybiBuZXcgT1RyZWUoXG4gICAgICBbXG4gICAgICAgICFyZW5kZXJlci5jdXJyZW50Q29udGV4dC5pblJlZ3VsYXJJbnRlcmZhY2UgPyBgJHt2aXNpYmlsaXR5KG5vZGUpfSBgIDogTk9fU1lOVEFYLFxuICAgICAgICB0aGlzLnJlbmRlclR5cGVOb2RlKG5vZGUudHlwZSwgbm9kZS5xdWVzdGlvblRva2VuICE9PSB1bmRlZmluZWQsIHJlbmRlcmVyKSxcbiAgICAgICAgJyAnLFxuICAgICAgICByZW5kZXJlci51cGRhdGVDb250ZXh0KHsgcHJvcGVydHlPck1ldGhvZDogdHJ1ZSB9KS5jb252ZXJ0KG5vZGUubmFtZSksXG4gICAgICAgICcgJyxcbiAgICAgICAgY2FuU2V0ID8gJ3sgZ2V0OyBzZXQ7IH0nIDogJ3sgZ2V0OyB9JyxcbiAgICAgIF0sXG4gICAgICBbXSxcbiAgICAgIHsgY2FuQnJlYWtMaW5lOiB0cnVlIH0sXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEbyBzb21lIHdvcmsgb24gcHJvcGVydHkgYWNjZXNzZXMgdG8gdHJhbnNsYXRlIGNvbW1vbiBKYXZhU2NyaXB0LWlzbXMgdG8gbGFuZ3VhZ2Utc3BlY2lmaWMgaWRpb21zXG4gICAqL1xuICBwdWJsaWMgcmVndWxhckNhbGxFeHByZXNzaW9uKG5vZGU6IHRzLkNhbGxFeHByZXNzaW9uLCByZW5kZXJlcjogQ1NoYXJwUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShbXG4gICAgICByZW5kZXJlci51cGRhdGVDb250ZXh0KHsgcHJvcGVydHlPck1ldGhvZDogdHJ1ZSB9KS5jb252ZXJ0KG5vZGUuZXhwcmVzc2lvbiksXG4gICAgICAnKCcsXG4gICAgICB0aGlzLmFyZ3VtZW50TGlzdChub2RlLmFyZ3VtZW50cywgcmVuZGVyZXIpLFxuICAgICAgJyknLFxuICAgIF0pO1xuICB9XG5cbiAgcHVibGljIGNsYXNzRGVjbGFyYXRpb24obm9kZTogdHMuQ2xhc3NEZWNsYXJhdGlvbiwgcmVuZGVyZXI6IENTaGFycFJlbmRlcmVyKTogT1RyZWUge1xuICAgIHJldHVybiBuZXcgT1RyZWUoXG4gICAgICBbJ2NsYXNzICcsIHJlbmRlcmVyLmNvbnZlcnQobm9kZS5uYW1lKSwgLi4udGhpcy5jbGFzc0hlcml0YWdlKG5vZGUsIHJlbmRlcmVyKSwgJ1xcbnsnXSxcbiAgICAgIHJlbmRlcmVyXG4gICAgICAgIC51cGRhdGVDb250ZXh0KHtcbiAgICAgICAgICBwcml2YXRlUHJvcGVydHlOYW1lczogcHJpdmF0ZVByb3BlcnR5TmFtZXMobm9kZS5tZW1iZXJzLCByZW5kZXJlciksXG4gICAgICAgIH0pXG4gICAgICAgIC5jb252ZXJ0QWxsKG5vZGUubWVtYmVycyksXG4gICAgICB7XG4gICAgICAgIGluZGVudDogNCxcbiAgICAgICAgY2FuQnJlYWtMaW5lOiB0cnVlLFxuICAgICAgICBzdWZmaXg6ICdcXG59JyxcbiAgICAgIH0sXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBzdHJ1Y3RJbnRlcmZhY2VEZWNsYXJhdGlvbihub2RlOiB0cy5JbnRlcmZhY2VEZWNsYXJhdGlvbiwgcmVuZGVyZXI6IENTaGFycFJlbmRlcmVyKTogT1RyZWUge1xuICAgIHJldHVybiBuZXcgT1RyZWUoXG4gICAgICBbJ2NsYXNzICcsIHJlbmRlcmVyLmNvbnZlcnQobm9kZS5uYW1lKSwgLi4udGhpcy5jbGFzc0hlcml0YWdlKG5vZGUsIHJlbmRlcmVyKSwgJ1xcbnsnXSxcbiAgICAgIHJlbmRlcmVyLnVwZGF0ZUNvbnRleHQoeyBpblN0cnVjdEludGVyZmFjZTogdHJ1ZSB9KS5jb252ZXJ0QWxsKG5vZGUubWVtYmVycyksXG4gICAgICB7XG4gICAgICAgIGluZGVudDogNCxcbiAgICAgICAgY2FuQnJlYWtMaW5lOiB0cnVlLFxuICAgICAgICBzdWZmaXg6ICdcXG59JyxcbiAgICAgIH0sXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyByZWd1bGFySW50ZXJmYWNlRGVjbGFyYXRpb24obm9kZTogdHMuSW50ZXJmYWNlRGVjbGFyYXRpb24sIHJlbmRlcmVyOiBDU2hhcnBSZW5kZXJlcik6IE9UcmVlIHtcbiAgICByZXR1cm4gbmV3IE9UcmVlKFxuICAgICAgWydpbnRlcmZhY2UgJywgcmVuZGVyZXIuY29udmVydChub2RlLm5hbWUpLCAuLi50aGlzLmNsYXNzSGVyaXRhZ2Uobm9kZSwgcmVuZGVyZXIpLCAnXFxueyddLFxuICAgICAgcmVuZGVyZXIudXBkYXRlQ29udGV4dCh7IGluUmVndWxhckludGVyZmFjZTogdHJ1ZSB9KS5jb252ZXJ0QWxsKG5vZGUubWVtYmVycyksXG4gICAgICB7XG4gICAgICAgIGluZGVudDogNCxcbiAgICAgICAgY2FuQnJlYWtMaW5lOiB0cnVlLFxuICAgICAgICBzdWZmaXg6ICdcXG59JyxcbiAgICAgIH0sXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBibG9jayhub2RlOiB0cy5CbG9jaywgY2hpbGRyZW46IENTaGFycFJlbmRlcmVyKTogT1RyZWUge1xuICAgIHJldHVybiBuZXcgT1RyZWUoWydcXG57J10sIFsuLi5jaGlsZHJlbi5jb252ZXJ0QWxsKG5vZGUuc3RhdGVtZW50cyldLCB7XG4gICAgICBpbmRlbnQ6IDQsXG4gICAgICBzdWZmaXg6ICdcXG59JyxcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyB1bmtub3duVHlwZU9iamVjdExpdGVyYWxFeHByZXNzaW9uKG5vZGU6IHRzLk9iamVjdExpdGVyYWxFeHByZXNzaW9uLCByZW5kZXJlcjogQ1NoYXJwUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgaWYgKHJlbmRlcmVyLmN1cnJlbnRDb250ZXh0LnByZWZlck9iamVjdExpdGVyYWxBc1N0cnVjdCkge1xuICAgICAgLy8gVHlwZSBpbmZvcm1hdGlvbiBtaXNzaW5nIGFuZCBmcm9tIGNvbnRleHQgd2UgcHJlZmVyIGEgc3RydWN0XG4gICAgICByZXR1cm4gbmV3IE9UcmVlKFsnbmV3IFN0cnVjdCB7ICddLCByZW5kZXJlci5jb252ZXJ0QWxsKG5vZGUucHJvcGVydGllcyksIHtcbiAgICAgICAgc3VmZml4OiByZW5kZXJlci5taXJyb3JOZXdsaW5lQmVmb3JlKG5vZGUucHJvcGVydGllc1swXSwgJ30nLCAnICcpLFxuICAgICAgICBzZXBhcmF0b3I6ICcsICcsXG4gICAgICAgIGluZGVudDogNCxcbiAgICAgIH0pO1xuICAgIH1cbiAgICAvLyBUeXBlIGluZm9ybWF0aW9uIG1pc3NpbmcgYW5kIGZyb20gY29udGV4dCB3ZSBwcmVmZXIgYSBtYXBcbiAgICByZXR1cm4gdGhpcy5rZXlWYWx1ZU9iamVjdExpdGVyYWxFeHByZXNzaW9uKG5vZGUsIHJlbmRlcmVyKTtcbiAgfVxuXG4gIHB1YmxpYyBrbm93blN0cnVjdE9iamVjdExpdGVyYWxFeHByZXNzaW9uKFxuICAgIG5vZGU6IHRzLk9iamVjdExpdGVyYWxFeHByZXNzaW9uLFxuICAgIHN0cnVjdFR5cGU6IE9iamVjdExpdGVyYWxTdHJ1Y3QsXG4gICAgcmVuZGVyZXI6IENTaGFycFJlbmRlcmVyLFxuICApOiBPVHJlZSB7XG4gICAgcmV0dXJuIG5ldyBPVHJlZShbJ25ldyAnLCBzdHJ1Y3RUeXBlLnR5cGUuc3ltYm9sLm5hbWUsICcgeyAnXSwgcmVuZGVyZXIuY29udmVydEFsbChub2RlLnByb3BlcnRpZXMpLCB7XG4gICAgICBzdWZmaXg6IHJlbmRlcmVyLm1pcnJvck5ld2xpbmVCZWZvcmUobm9kZS5wcm9wZXJ0aWVzWzBdLCAnfScsICcgJyksXG4gICAgICBzZXBhcmF0b3I6ICcsICcsXG4gICAgICBpbmRlbnQ6IDQsXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMga2V5VmFsdWVPYmplY3RMaXRlcmFsRXhwcmVzc2lvbihub2RlOiB0cy5PYmplY3RMaXRlcmFsRXhwcmVzc2lvbiwgcmVuZGVyZXI6IENTaGFycFJlbmRlcmVyKTogT1RyZWUge1xuICAgIC8vIFRyeSB0byBpbmZlciBhbiBlbGVtZW50IHR5cGUgZnJvbSB0aGUgZWxlbWVudHNcbiAgICBjb25zdCB2YWx1ZVR5cGUgPSBpbmZlck1hcEVsZW1lbnRUeXBlKG5vZGUucHJvcGVydGllcywgcmVuZGVyZXIudHlwZUNoZWNrZXIpO1xuXG4gICAgcmV0dXJuIG5ldyBPVHJlZShcbiAgICAgIFsnbmV3IERpY3Rpb25hcnk8c3RyaW5nLCAnLCB0aGlzLnJlbmRlclR5cGUobm9kZSwgdmFsdWVUeXBlLCBmYWxzZSwgJ29iamVjdCcsIHJlbmRlcmVyKSwgJz4geyAnXSxcbiAgICAgIHJlbmRlcmVyLnVwZGF0ZUNvbnRleHQoeyBpbktleVZhbHVlTGlzdDogdHJ1ZSB9KS5jb252ZXJ0QWxsKG5vZGUucHJvcGVydGllcyksXG4gICAgICB7XG4gICAgICAgIHN1ZmZpeDogcmVuZGVyZXIubWlycm9yTmV3bGluZUJlZm9yZShub2RlLnByb3BlcnRpZXNbMF0sICd9JywgJyAnKSxcbiAgICAgICAgc2VwYXJhdG9yOiAnLCAnLFxuICAgICAgICBpbmRlbnQ6IDQsXG4gICAgICB9LFxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgc2hvcnRoYW5kUHJvcGVydHlBc3NpZ25tZW50KG5vZGU6IHRzLlNob3J0aGFuZFByb3BlcnR5QXNzaWdubWVudCwgcmVuZGVyZXI6IENTaGFycFJlbmRlcmVyKTogT1RyZWUge1xuICAgIHJldHVybiB0aGlzLnJlbmRlclByb3BlcnR5QXNzaWdubWVudChub2RlLm5hbWUsIG5vZGUubmFtZSwgcmVuZGVyZXIpO1xuICB9XG5cbiAgcHVibGljIHByb3BlcnR5QXNzaWdubWVudChub2RlOiB0cy5Qcm9wZXJ0eUFzc2lnbm1lbnQsIHJlbmRlcmVyOiBDU2hhcnBSZW5kZXJlcik6IE9UcmVlIHtcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJQcm9wZXJ0eUFzc2lnbm1lbnQobm9kZS5uYW1lLCBub2RlLmluaXRpYWxpemVyLCByZW5kZXJlcik7XG4gIH1cblxuICBwdWJsaWMgcmVuZGVyUHJvcGVydHlBc3NpZ25tZW50KGtleTogdHMuTm9kZSwgdmFsdWU6IHRzLk5vZGUsIHJlbmRlcmVyOiBDU2hhcnBSZW5kZXJlcik6IE9UcmVlIHtcbiAgICBpZiAocmVuZGVyZXIuY3VycmVudENvbnRleHQuaW5LZXlWYWx1ZUxpc3QpIHtcbiAgICAgIHJldHVybiBuZXcgT1RyZWUoXG4gICAgICAgIFtcbiAgICAgICAgICAneyAnLFxuICAgICAgICAgIHJlbmRlcmVyXG4gICAgICAgICAgICAudXBkYXRlQ29udGV4dCh7XG4gICAgICAgICAgICAgIHByb3BlcnR5T3JNZXRob2Q6IGZhbHNlLFxuICAgICAgICAgICAgICBpZGVudGlmaWVyQXNTdHJpbmc6ICF0cy5pc0NvbXB1dGVkUHJvcGVydHlOYW1lKGtleSksXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNvbnZlcnQoa2V5KSxcbiAgICAgICAgICAnLCAnLFxuICAgICAgICAgIHJlbmRlcmVyLnVwZGF0ZUNvbnRleHQoeyBpbktleVZhbHVlTGlzdDogZmFsc2UgfSkuY29udmVydCh2YWx1ZSksXG4gICAgICAgICAgJyB9JyxcbiAgICAgICAgXSxcbiAgICAgICAgW10sXG4gICAgICAgIHsgY2FuQnJlYWtMaW5lOiB0cnVlIH0sXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IE9UcmVlKFxuICAgICAgW1xuICAgICAgICByZW5kZXJlci51cGRhdGVDb250ZXh0KHsgcHJvcGVydHlPck1ldGhvZDogdHJ1ZSwgc3RyaW5nQXNJZGVudGlmaWVyOiB0cnVlIH0pLmNvbnZlcnQoa2V5KSxcbiAgICAgICAgJyA9ICcsXG4gICAgICAgIHJlbmRlcmVyLmNvbnZlcnQodmFsdWUpLFxuICAgICAgXSxcbiAgICAgIFtdLFxuICAgICAgeyBjYW5CcmVha0xpbmU6IHRydWUgfSxcbiAgICApO1xuICB9XG5cbiAgcHVibGljIGFycmF5TGl0ZXJhbEV4cHJlc3Npb24obm9kZTogdHMuQXJyYXlMaXRlcmFsRXhwcmVzc2lvbiwgcmVuZGVyZXI6IENTaGFycFJlbmRlcmVyKTogT1RyZWUge1xuICAgIHJldHVybiBuZXcgT1RyZWUoWyduZXcgW10geyAnXSwgcmVuZGVyZXIuY29udmVydEFsbChub2RlLmVsZW1lbnRzKSwge1xuICAgICAgc2VwYXJhdG9yOiAnLCAnLFxuICAgICAgc3VmZml4OiAnIH0nLFxuICAgICAgaW5kZW50OiA0LFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGlmU3RhdGVtZW50KG5vZGU6IHRzLklmU3RhdGVtZW50LCByZW5kZXJlcjogQ1NoYXJwUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgY29uc3QgaWZTdG10ID0gbmV3IE9UcmVlKFxuICAgICAgWydpZiAoJywgcmVuZGVyZXIuY29udmVydChub2RlLmV4cHJlc3Npb24pLCAnKSAnXSxcbiAgICAgIFtyZW5kZXJlci5jb252ZXJ0KG5vZGUudGhlblN0YXRlbWVudCldLFxuICAgICAgeyBjYW5CcmVha0xpbmU6IHRydWUgfSxcbiAgICApO1xuICAgIGNvbnN0IGVsc2VTdG10ID0gbm9kZS5lbHNlU3RhdGVtZW50XG4gICAgICA/IG5ldyBPVHJlZShbJ2Vsc2UgJ10sIFtyZW5kZXJlci5jb252ZXJ0KG5vZGUuZWxzZVN0YXRlbWVudCldLCB7XG4gICAgICAgICAgY2FuQnJlYWtMaW5lOiB0cnVlLFxuICAgICAgICB9KVxuICAgICAgOiB1bmRlZmluZWQ7XG5cbiAgICByZXR1cm4gZWxzZVN0bXRcbiAgICAgID8gbmV3IE9UcmVlKFtdLCBbaWZTdG10LCBlbHNlU3RtdF0sIHtcbiAgICAgICAgICBzZXBhcmF0b3I6ICdcXG4nLFxuICAgICAgICAgIGNhbkJyZWFrTGluZTogdHJ1ZSxcbiAgICAgICAgfSlcbiAgICAgIDogaWZTdG10O1xuICB9XG5cbiAgcHVibGljIGZvck9mU3RhdGVtZW50KG5vZGU6IHRzLkZvck9mU3RhdGVtZW50LCByZW5kZXJlcjogQ1NoYXJwUmVuZGVyZXIpOiBPVHJlZSB7XG4gICAgLy8gVGhpcyBpcyB3aGF0IGEgXCJmb3IgKGNvbnN0IHggb2YgLi4uKVwiIGxvb2tzIGxpa2UgaW4gdGhlIEFTVFxuICAgIGxldCB2YXJpYWJsZU5hbWUgPSAnPz8/JztcblxuICAgIG1hdGNoQXN0KFxuICAgICAgbm9kZS5pbml0aWFsaXplcixcbiAgICAgIG5vZGVPZlR5cGUodHMuU3ludGF4S2luZC5WYXJpYWJsZURlY2xhcmF0aW9uTGlzdCwgbm9kZU9mVHlwZSgndmFyJywgdHMuU3ludGF4S2luZC5WYXJpYWJsZURlY2xhcmF0aW9uKSksXG4gICAgICAoYmluZGluZ3MpID0+IHtcbiAgICAgICAgdmFyaWFibGVOYW1lID0gcmVuZGVyZXIudGV4dE9mKGJpbmRpbmdzLnZhci5uYW1lKTtcbiAgICAgIH0sXG4gICAgKTtcblxuICAgIHJldHVybiBuZXcgT1RyZWUoXG4gICAgICBbJ2ZvciAodmFyICcsIHZhcmlhYmxlTmFtZSwgJyBpbiAnLCByZW5kZXJlci5jb252ZXJ0KG5vZGUuZXhwcmVzc2lvbiksICcpICddLFxuICAgICAgW3JlbmRlcmVyLmNvbnZlcnQobm9kZS5zdGF0ZW1lbnQpXSxcbiAgICAgIHsgY2FuQnJlYWtMaW5lOiB0cnVlIH0sXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBhc0V4cHJlc3Npb24obm9kZTogdHMuQXNFeHByZXNzaW9uLCBjb250ZXh0OiBDU2hhcnBSZW5kZXJlcik6IE9UcmVlIHtcbiAgICByZXR1cm4gbmV3IE9UcmVlKFsnKCcsIHRoaXMucmVuZGVyVHlwZU5vZGUobm9kZS50eXBlLCBmYWxzZSwgY29udGV4dCksICcpJywgY29udGV4dC5jb252ZXJ0KG5vZGUuZXhwcmVzc2lvbildKTtcbiAgfVxuXG4gIHB1YmxpYyB2YXJpYWJsZURlY2xhcmF0aW9uKG5vZGU6IHRzLlZhcmlhYmxlRGVjbGFyYXRpb24sIHJlbmRlcmVyOiBDU2hhcnBSZW5kZXJlcik6IE9UcmVlIHtcbiAgICBsZXQgZmFsbGJhY2sgPSAndmFyJztcbiAgICBpZiAobm9kZS50eXBlKSB7XG4gICAgICBmYWxsYmFjayA9IG5vZGUudHlwZS5nZXRUZXh0KCk7XG4gICAgfVxuXG4gICAgY29uc3QgdHlwZSA9XG4gICAgICAobm9kZS50eXBlICYmIHJlbmRlcmVyLnR5cGVPZlR5cGUobm9kZS50eXBlKSkgfHxcbiAgICAgIChub2RlLmluaXRpYWxpemVyICYmIHJlbmRlcmVyLnR5cGVPZkV4cHJlc3Npb24obm9kZS5pbml0aWFsaXplcikpO1xuXG4gICAgbGV0IHJlbmRlcmVkVHlwZSA9IHRoaXMucmVuZGVyVHlwZShub2RlLCB0eXBlLCBmYWxzZSwgZmFsbGJhY2ssIHJlbmRlcmVyKTtcbiAgICBpZiAocmVuZGVyZWRUeXBlID09PSAnb2JqZWN0Jykge1xuICAgICAgcmVuZGVyZWRUeXBlID0gJ3Zhcic7XG4gICAgfVxuXG4gICAgaWYgKCFub2RlLmluaXRpYWxpemVyKSB7XG4gICAgICByZXR1cm4gbmV3IE9UcmVlKFtyZW5kZXJlZFR5cGUsICcgJywgcmVuZGVyZXIuY29udmVydChub2RlLm5hbWUpLCAnOyddLCBbXSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBPVHJlZShcbiAgICAgIFtcbiAgICAgICAgcmVuZGVyZWRUeXBlLFxuICAgICAgICAnICcsXG4gICAgICAgIHJlbmRlcmVyLmNvbnZlcnQobm9kZS5uYW1lKSxcbiAgICAgICAgJyA9ICcsXG4gICAgICAgIHJlbmRlcmVyLnVwZGF0ZUNvbnRleHQoeyBwcmVmZXJPYmplY3RMaXRlcmFsQXNTdHJ1Y3Q6IGZhbHNlIH0pLmNvbnZlcnQobm9kZS5pbml0aWFsaXplciksXG4gICAgICAgICc7JyxcbiAgICAgIF0sXG4gICAgICBbXSxcbiAgICAgIHsgY2FuQnJlYWtMaW5lOiB0cnVlIH0sXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyB0ZW1wbGF0ZUV4cHJlc3Npb24obm9kZTogdHMuVGVtcGxhdGVFeHByZXNzaW9uLCBjb250ZXh0OiBDU2hhcnBSZW5kZXJlcik6IE9UcmVlIHtcbiAgICAvLyBJZiB0aGlzIGlzIGEgbXVsdGktbGluZSBzdHJpbmcgbGl0ZXJhbCwgd2UgbmVlZCBub3QgcXVvdGUgbXVjaCwgYXMgQFwic3RyaW5nXCIgbGl0ZXJhbHMgaW4gQyNcbiAgICAvLyBkbyBub3QgcGVyZm9ybSBhbnkgcXVvdGluZy4gVGhlIGxpdGVyYWwgcXVvdGVzIGluIHRoZSB0ZXh0IGhvd2V2ZXIgbXVzdCBiZSBkb3VibGVkLlxuICAgIGNvbnN0IGlzTXVsdGlMaW5lID1cbiAgICAgICEhbm9kZS5oZWFkLnJhd1RleHQ/LmluY2x1ZGVzKCdcXG4nKSB8fCBub2RlLnRlbXBsYXRlU3BhbnMuc29tZSgoc3BhbikgPT4gc3Bhbi5saXRlcmFsLnJhd1RleHQ/LmluY2x1ZGVzKCdcXG4nKSk7XG5cbiAgICBjb25zdCBwYXJ0cyA9IG5ldyBBcnJheTxzdHJpbmc+KCk7XG4gICAgaWYgKG5vZGUuaGVhZC5yYXdUZXh0KSB7XG4gICAgICBwYXJ0cy5wdXNoKGlzTXVsdGlMaW5lID8gbm9kZS5oZWFkLnJhd1RleHQucmVwbGFjZSgvXCIvZywgJ1wiXCInKSA6IHF1b3RlU3RyaW5nTGl0ZXJhbChub2RlLmhlYWQucmF3VGV4dCkpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IHNwYW4gb2Ygbm9kZS50ZW1wbGF0ZVNwYW5zKSB7XG4gICAgICBwYXJ0cy5wdXNoKGB7JHtjb250ZXh0LnRleHRPZihzcGFuLmV4cHJlc3Npb24pfX1gKTtcbiAgICAgIGlmIChzcGFuLmxpdGVyYWwucmF3VGV4dCkge1xuICAgICAgICBwYXJ0cy5wdXNoKGlzTXVsdGlMaW5lID8gc3Bhbi5saXRlcmFsLnJhd1RleHQucmVwbGFjZSgvXCIvZywgJ1wiXCInKSA6IHF1b3RlU3RyaW5nTGl0ZXJhbChzcGFuLmxpdGVyYWwucmF3VGV4dCkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBuZXcgT1RyZWUoW2lzTXVsdGlMaW5lID8gJyRAXCInIDogJyRcIicsIC4uLnBhcnRzLCAnXCInXSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgYXJndW1lbnRMaXN0KGFyZ3M6IHJlYWRvbmx5IHRzLk5vZGVbXSB8IHVuZGVmaW5lZCwgcmVuZGVyZXI6IENTaGFycFJlbmRlcmVyKTogT1RyZWUge1xuICAgIHJldHVybiBuZXcgT1RyZWUoW10sIGFyZ3MgPyByZW5kZXJlci51cGRhdGVDb250ZXh0KHsgcHJlZmVyT2JqZWN0TGl0ZXJhbEFzU3RydWN0OiB0cnVlIH0pLmNvbnZlcnRBbGwoYXJncykgOiBbXSwge1xuICAgICAgc2VwYXJhdG9yOiAnLCAnLFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJUeXBlTm9kZSh0eXBlTm9kZTogdHMuVHlwZU5vZGUgfCB1bmRlZmluZWQsIHF1ZXN0aW9uTWFyazogYm9vbGVhbiwgcmVuZGVyZXI6IENTaGFycFJlbmRlcmVyKTogc3RyaW5nIHtcbiAgICBpZiAoIXR5cGVOb2RlKSB7XG4gICAgICByZXR1cm4gJ3ZvaWQnO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5yZW5kZXJUeXBlKHR5cGVOb2RlLCByZW5kZXJlci50eXBlT2ZUeXBlKHR5cGVOb2RlKSwgcXVlc3Rpb25NYXJrLCByZW5kZXJlci50ZXh0T2YodHlwZU5vZGUpLCByZW5kZXJlcik7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlclR5cGUoXG4gICAgdHlwZU5vZGU6IHRzLk5vZGUsXG4gICAgdHlwZTogdHMuVHlwZSB8IHVuZGVmaW5lZCxcbiAgICBxdWVzdGlvbk1hcms6IGJvb2xlYW4sXG4gICAgZmFsbGJhY2s6IHN0cmluZyxcbiAgICByZW5kZXJlcjogQ1NoYXJwUmVuZGVyZXIsXG4gICk6IHN0cmluZyB7XG4gICAgaWYgKHR5cGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIGZhbGxiYWNrO1xuICAgIH1cblxuICAgIGNvbnN0IHJlbmRlcmVkVHlwZSA9IGRvUmVuZGVyKGRldGVybWluZUpzaWlUeXBlKHJlbmRlcmVyLnR5cGVDaGVja2VyLCB0eXBlKSk7XG5cbiAgICBjb25zdCBzdWZmaXggPSBxdWVzdGlvbk1hcmsgfHwgdHlwZUNvbnRhaW5zVW5kZWZpbmVkKHR5cGUpID8gJz8nIDogJyc7XG5cbiAgICByZXR1cm4gcmVuZGVyZWRUeXBlICsgc3VmZml4O1xuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbnNpc3RlbnQtcmV0dXJuXG4gICAgZnVuY3Rpb24gZG9SZW5kZXIoanNpaVR5cGU6IEpzaWlUeXBlKTogc3RyaW5nIHtcbiAgICAgIHN3aXRjaCAoanNpaVR5cGUua2luZCkge1xuICAgICAgICBjYXNlICd1bmtub3duJzpcbiAgICAgICAgICByZXR1cm4gZmFsbGJhY2s7XG4gICAgICAgIGNhc2UgJ2Vycm9yJzpcbiAgICAgICAgICByZW5kZXJlci5yZXBvcnQodHlwZU5vZGUsIGpzaWlUeXBlLm1lc3NhZ2UpO1xuICAgICAgICAgIHJldHVybiBmYWxsYmFjaztcbiAgICAgICAgY2FzZSAnbWFwJzpcbiAgICAgICAgICByZXR1cm4gYElEaWN0aW9uYXJ5PHN0cmluZywgJHtkb1JlbmRlcihqc2lpVHlwZS5lbGVtZW50VHlwZSl9PmA7XG4gICAgICAgIGNhc2UgJ2xpc3QnOlxuICAgICAgICAgIHJldHVybiBgJHtkb1JlbmRlcihqc2lpVHlwZS5lbGVtZW50VHlwZSl9W11gO1xuICAgICAgICBjYXNlICduYW1lZFR5cGUnOlxuICAgICAgICAgIHJldHVybiBqc2lpVHlwZS5uYW1lO1xuICAgICAgICBjYXNlICdidWlsdEluJzpcbiAgICAgICAgICBzd2l0Y2ggKGpzaWlUeXBlLmJ1aWx0SW4pIHtcbiAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICByZXR1cm4gJ2Jvb2xlYW4nO1xuICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgcmV0dXJuICdpbnQnO1xuICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgcmV0dXJuICdzdHJpbmcnO1xuICAgICAgICAgICAgY2FzZSAnYW55JzpcbiAgICAgICAgICAgICAgcmV0dXJuICdvYmplY3QnO1xuICAgICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNsYXNzSGVyaXRhZ2Uobm9kZTogdHMuQ2xhc3NEZWNsYXJhdGlvbiB8IHRzLkludGVyZmFjZURlY2xhcmF0aW9uLCByZW5kZXJlcjogQ1NoYXJwUmVuZGVyZXIpIHtcbiAgICBjb25zdCBoZXJpdGFnZSA9IGZsYXQoQXJyYXkuZnJvbShub2RlLmhlcml0YWdlQ2xhdXNlcyA/PyBbXSkubWFwKChoKSA9PiBBcnJheS5mcm9tKGgudHlwZXMpKSkubWFwKCh0KSA9PlxuICAgICAgcmVuZGVyZXIuY29udmVydCh0LmV4cHJlc3Npb24pLFxuICAgICk7XG5cbiAgICByZXR1cm4gaGVyaXRhZ2UubGVuZ3RoID4gMCA/IFsnIDogJywgbmV3IE9UcmVlKFtdLCBoZXJpdGFnZSwgeyBzZXBhcmF0b3I6ICcsICcgfSldIDogW107XG4gIH1cbn1cblxuLyoqXG4gKiBVcHBlcmNhc2UgdGhlIGZpcnN0IGxldHRlclxuICovXG5mdW5jdGlvbiB1Y0ZpcnN0KHg6IHN0cmluZykge1xuICByZXR1cm4geC5zdWJzdHIoMCwgMSkudG9VcHBlckNhc2UoKSArIHguc3Vic3RyKDEpO1xufVxuXG4vKipcbiAqIEZpbmQgdGhlIEphdmEgbmFtZSBvZiBhIG1vZHVsZSBvciB0eXBlXG4gKi9cbmZ1bmN0aW9uIGZpbmREb3RuZXROYW1lKGpzaWlTeW1ib2w6IEpzaWlTeW1ib2wpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICBpZiAoIWpzaWlTeW1ib2wuc291cmNlQXNzZW1ibHk/LmFzc2VtYmx5KSB7XG4gICAgLy8gRG9uJ3QgaGF2ZSBhY2N1cmF0ZSBpbmZvLCBqdXN0IGd1ZXNzXG4gICAgcmV0dXJuIGpzaWlTeW1ib2wuc3ltYm9sVHlwZSAhPT0gJ21vZHVsZScgPyBzaW1wbGVOYW1lKGpzaWlTeW1ib2wuZnFuKSA6IGd1ZXNzRG90bmV0TmFtZXNwYWNlKGpzaWlTeW1ib2wuZnFuKTtcbiAgfVxuXG4gIGNvbnN0IGFzbSA9IGpzaWlTeW1ib2wuc291cmNlQXNzZW1ibHk/LmFzc2VtYmx5O1xuICByZXR1cm4gcmVjdXJzZShqc2lpU3ltYm9sLmZxbik7XG5cbiAgZnVuY3Rpb24gcmVjdXJzZShmcW46IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKGZxbiA9PT0gYXNtLm5hbWUpIHtcbiAgICAgIHJldHVybiBqc2lpVGFyZ2V0UGFyYW1ldGVyKGFzbSwgJ2RvdG5ldC5uYW1lc3BhY2UnKSA/PyBndWVzc0RvdG5ldE5hbWVzcGFjZShmcW4pO1xuICAgIH1cbiAgICBpZiAoYXNtLnN1Ym1vZHVsZXM/LltmcW5dKSB7XG4gICAgICBjb25zdCBtb2ROYW1lID0ganNpaVRhcmdldFBhcmFtZXRlcihhc20uc3VibW9kdWxlc1tmcW5dLCAnZG90bmV0Lm5hbWVzcGFjZScpO1xuICAgICAgaWYgKG1vZE5hbWUpIHtcbiAgICAgICAgcmV0dXJuIG1vZE5hbWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGAke3JlY3Vyc2UobmFtZXNwYWNlTmFtZShmcW4pKX0uJHtzaW1wbGVOYW1lKGpzaWlTeW1ib2wuZnFuKX1gO1xuICB9XG59XG5cbmZ1bmN0aW9uIGd1ZXNzRG90bmV0TmFtZXNwYWNlKHJlZjogc3RyaW5nKSB7XG4gIHJldHVybiByZWZcbiAgICAuc3BsaXQoL1teYS16QS1aMC05XSsvZylcbiAgICAuZmlsdGVyKChzKSA9PiBzICE9PSAnJylcbiAgICAubWFwKHVjRmlyc3QpXG4gICAgLmpvaW4oJy4nKTtcbn1cbiJdfQ==